// tag::header[]

# How Mill's Executable Jars Work


:author: Li Haoyi
:revdate: ???
_{author}, {revdate}_

include::mill:ROOT:partial$gtag-config.adoc[]

One feature of the Mill JVM build tool is that the assembly jars it creates are
directly executable:

```bash
> ./mill show foo.assembly
"ref:v0:bd2c6c70:/Users/lihaoyi/test/out/foo/assembly.dest/out.jar"

> /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
Hello World
```

Most other JVM build tools require you to run their assemblies via `java -jar`,
or require you to use `jlink` or `jpackage` which are much more heavyweight. While not
groundbreaking, Mill's executable assemblies is a nice convenience that makes your JVM
code built with Mill fit more nicely into command-line centric workflows common in modern
systems.

This article will discuss how Mill's executable assemblies are implemented, so perhaps
other build tools and toolchains will be able to provide the same convenience

// end::header[]

## Trying Out Mill's Executable Assmeblies

To try out Mill's executable assembly jars, you can reproduce the above steps
with the following code and config:

```scala
// build.mill
import mill._, javalib._

object foo extends JavaModule
```

```java
// foo/src/Foo.java
package foo;

public class Foo{
  public static void main(String[] args){
    System.out.println("Hello World");
  }
}
```

```bash
> ./mill show foo.assembly
"ref:v0:bd2c6c70:/Users/lihaoyi/test/out/foo/assembly.dest/out.jar"

> /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
Hello World
```

Mill's ``JavaModule``s come with `.assembly` tasks built in by default, without needing
to install plugins like is necessary in other build tools like
https://maven.apache.org/plugins/maven-assembly-plugin/usage.html[Maven] or
https://github.com/sbt/sbt-assembly[SBT].

While the above example is a trivial single-module project, this also works for more complicated
projects with multiple modules and third-party dependencies. The assembly jar will aggregate
the code from all upstream modules and dependencies into a single `.jar` file that you can then
execute from the command line.

Most `.jar` files are not directly executable. To understand how Mill makes direct execution
possible, we first need to understand what a `.jar` file is.

## What is an Assembly Jar?

An "assembly" jar is just a jar file that includes all transitive dependencies, and a jar file
is just a zip file. You can see that from the command line, where although you normally use
`jar tf` to list the contents of a `.jar` file, `unzip -l` works as well:

```bash
> jar tf /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
META-INF/MANIFEST.MF
META-INF/
foo/
foo/Foo.class

> unzip -l /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
Archive:  /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
warning [/Users/lihaoyi/test/out/foo/assembly.dest/out.jar]:  203 extra bytes at beginning or within zipfile
  (attempting to process anyway)
  Length      Date    Time    Name
---------  ---------- -----   ----
      110  01-02-2025 12:05   META-INF/MANIFEST.MF
        0  01-02-2025 12:05   META-INF/
        0  01-02-2025 12:05   foo/
      415  01-02-2025 12:05   foo/Foo.class
---------                     -------
      525                     4 files
```

In this case, the example project only has one `Foo.java` source file, compiled into a single
`Foo.class` JVM class file. Larger projects will have multiple class files, including those
from upstream modules and third-party dependencies.

In addition to the class files, jars also can contain metadata. For example, we can see
this generated `out.jar` contains a `META-INF/MANIFEST.MF` file, which contains some basic
metadata including the `Main-Class: foo.Foo` which is the entrypoint of the Java program:

```bash
$ unzip -p /Users/lihaoyi/test/out/foo/assembly.dest/out.jar META-INF/MANIFEST.MF
warning [/Users/lihaoyi/test/out/foo/assembly.dest/out.jar]:  203 extra bytes at beginning or within zipfile
  (attempting to process anyway)
Manifest-Version: 1.0
Created-By: Mill 0.12.4-23-2ff492
Tool: Mill-0.12.4-23-2ff492
Main-Class: foo.Foo
```

The `warning:  203 extra bytes at beginning or within zipfile` is a hint that although
this is a valid zip file, something unusual is going on, which leads us to the trick
that we use to make the `out.jar` file executable

## What is a Zip file?



## What about Windows?