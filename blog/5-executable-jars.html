<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>How JVM Executable Assembly Jars Work :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/blog/5-executable-jars.html" />
    <link rel="prev" href="6-garbage-collector-perf.html" />
    <link rel="next" href="4-flaky-tests.html" />
    <meta name="generator" content="Antora 3.1.12" />
    <link rel="stylesheet" href="../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../_/favicon.png" type="image/x-icon" />
  
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style></head><body class="article">
  
<header class="header">
  
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../_/logo-white.svg" height="20" />Â The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/mill.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="blog" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html"><em>The Mill Build Engineering Blog</em></a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="16-zero-setup.html">Zero-Setup All-in-One Java Tooling via Mill Bootstrap Scripts</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="15-android-build-flow.html">Mill as an Alternative Android Build Tool</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="14-bash-zsh-completion.html">Writing Your Own Simple Tab-Completions for Bash and Zsh</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="13-mill-build-tool-v1-0-0.html">Mill Build Tool v1.0.0 Release Highlights</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="12-direct-style-build-tool.html">Mill as a Direct Style Build Tool</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="11-jvm-test-parallelism.html">Strategies for Efficiently Parallelizing JVM Test Suites</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="10-bytecode-callgraph-analysis.html">Invalidating build caches using JVM bytecode callgraph analysis</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="9-mill-faster-assembly-jars.html">Fast Incremental JVM Assembly Jar Creation with Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="8-what-is-a-build-tool.html">What does a Build Tool do?</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="7-graal-native-executables.html">How to Compile Java into Native Binaries with Mill and Graal</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="6-garbage-collector-perf.html">Understanding JVM Garbage Collector Performance</a>
  </li>

  <li class="nav-item is-current-page is-active" data-depth="1">
    <a class="nav-link" href="5-executable-jars.html">How JVM Executable Assembly Jars Work</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="4-flaky-tests.html">How To Manage Flaky Tests in your CI Workflows</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="3-selective-testing.html">Faster CI with Selective Testing</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="2-monorepo-build-tool.html">Why Use a Monorepo Build Tool?</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="1-java-compile.html">How Fast Does Java Compile?</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Mill Build Engineering Blog</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../mill/index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../mill/main-branch/index.html">main-branch</a>
        </li>
        <li class="version is-latest">
          <a href="../mill/index.html">1.0.5</a>
        </li>
        <li class="version">
          <a href="../mill/dev-1.0.5-15-2cc69d/index.html">dev-1.0.5-15-2cc69d</a>
        </li>
        <li class="version">
          <a href="../mill/0.12.x/index.html">0.12.16</a>
        </li>
        <li class="version">
          <a href="../mill/0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../mill/0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../mill/0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px;">
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/out/website/blogFolder.dest/modules/ROOT/pages/5-executable-jars.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">How JVM Executable Assembly Jars Work</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>One feature of the <a href="https://mill-build.org">Mill JVM build tool</a> is that the
assembly jars it creates are directly executable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill show foo.assembly # generate the assembly jar
&quot;ref:v0:bd2c6c70:/Users/lihaoyi/test/out/foo/assembly.dest/out.jar&quot;

&gt; out/foo/assembly.dest/out.jar # run the assembly jar directly
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other JVM build tools also can generate assemblies, but most need you to run them
via <code>java -jar</code> or <code>java -cp</code>,
or require you to use <a href="https://docs.oracle.com/en/java/javase/11/tools/jlink.html">jlink</a> or
<a href="https://docs.oracle.com/en/java/javase/17/docs/specs/man/jpackage.html">jpackage</a>
which are much more heavyweight and troublesome to set up. Mill automates that, and while not
groundbreaking, it is a nice convenience that makes your JVM
code built with Mill fit more nicely into command-line centric workflows common in modern
software systems.</p>
</div>
<div class="paragraph">
<p>This article will discuss how Millâs executable assemblies are implemented, so perhaps
other build tools and toolchains will be able to provide the same convenience</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trying_out_mills_executable_assemblies"><a class="anchor" href="#_trying_out_mills_executable_assemblies"></a>Trying Out Millâs Executable Assemblies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To try out Millâs executable assembly jars, you can reproduce the above steps
with the following code and config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">// build.mill
import mill._, javalib._

object foo extends JavaModule</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// foo/src/Foo.java
package foo;

public class Foo{
  public static void main(String[] args){
    System.out.println(&quot;Hello World&quot;);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill show foo.assembly
&quot;ref:v0:bd2c6c70:/Users/lihaoyi/test/out/foo/assembly.dest/out.jar&quot;

&gt; /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Millâs <code>JavaModule</code>s come with <code>.assembly</code> tasks built in by default, without needing
to install plugins like is necessary in other build tools like
<a href="https://maven.apache.org/plugins/maven-assembly-plugin/usage.html">Maven</a> or
<a href="https://github.com/sbt/sbt-assembly">sbt</a>.</p>
</div>
<div class="paragraph">
<p>While the above example is a trivial single-module project, this also works for more complicated
projects with multiple modules and third-party dependencies. The assembly jar will aggregate
the code from all upstream modules and dependencies into a single <code>.jar</code> file that you can then
execute from the command line.</p>
</div>
<div class="paragraph">
<p>Most <code>.jar</code> files are not directly executable, hence the need for a <code>java -jar</code> or <code>java -cp</code>
command to run them. To understand how Mill makes direct execution
possible, we first need to understand what a <code>.jar</code> file is.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_an_assembly_jar"><a class="anchor" href="#_what_is_an_assembly_jar"></a>What is an Assembly Jar?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An &quot;assembly&quot; jar is just a jar file that includes all transitive dependencies.
What makes an assembly different from a &quot;normal&quot; jar is that it should (in theory) contain
everything needed to run you JVM program. In contrast, most &quot;normal&quot; jars do not contain
their dependencies, and you need to separately go download those dependencies and pass them in
via <code>-classpath</code>/<code>-cp</code> before you can run your Java program.</p>
</div>
<div class="paragraph">
<p>One thing that many people donât know is that jar files are just zip files. You can see
that from the command line, where although you normally use <code>jar tf</code> to list the contents
of a <code>.jar</code> file, <code>unzip -l</code> works as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; jar tf /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
META-INF/MANIFEST.MF
META-INF/
foo/
foo/Foo.class</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; unzip -l /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
Archive:  /Users/lihaoyi/test/out/foo/assembly.dest/out.jar
warning [/Users/lihaoyi/test/out/foo/assembly.dest/out.jar]:  203 extra bytes at beginning or within zipfile
  (attempting to process anyway)
  Length      Date    Time    Name
---------  ---------- -----   ----
      110  01-02-2025 12:05   META-INF/MANIFEST.MF
        0  01-02-2025 12:05   META-INF/
        0  01-02-2025 12:05   foo/
      415  01-02-2025 12:05   foo/Foo.class
---------                     -------
      525                     4 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the example project only has one <code>Foo.java</code> source file, compiled into a single
<code>Foo.class</code> JVM class file. Larger projects will have multiple class files, including those
from upstream modules and third-party dependencies.</p>
</div>
<div class="paragraph">
<p>In addition to the compiled class files, jars also can contain metadata. For example, we can see
this generated <code>out.jar</code> contains a <code>META-INF/MANIFEST.MF</code> file, which contains some basic
metadata including the <code>Main-Class: foo.Foo</code> which is the entrypoint of the Java program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ unzip -p /Users/lihaoyi/test/out/foo/assembly.dest/out.jar META-INF/MANIFEST.MF
warning [/Users/lihaoyi/test/out/foo/assembly.dest/out.jar]:  203 extra bytes at beginning or within zipfile
  (attempting to process anyway)
Manifest-Version: 1.0
Created-By: Mill 0.12.4-23-2ff492
Tool: Mill-0.12.4-23-2ff492
Main-Class: foo.Foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>warning:  203 extra bytes at beginning or within zipfile</code> is a hint that although
this is a valid zip file, something unusual is going on, which leads us to the trick
that we use to make the <code>out.jar</code> file executable</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_a_zip_file"><a class="anchor" href="#_what_is_a_zip_file"></a>What is a Zip file?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="https://en.wikipedia.org/wiki/ZIP_(file_format)">zip file</a> is an archive made of multiple smaller files, individually compressed,
concatenated together followed by a &quot;central directory&quot; containing the <em>reverse offsets</em> of
every file within the archive, relative to the central directory.</p>
</div>
<div class="paragraph">
<center>
<svg width="388px" height="87px" viewBox="0.00 0.00 387.69 87.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 83.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-83.4 383.69,-83.4 383.69,4 -4,4"></polygon>
<text text-anchor="middle" x="189.85" y="-8.2" font-family="Times,serif" font-size="14.00">archive.zip</text>
<!-- zip -->
<g id="node1" class="node">
<title>zip</title>
<polygon fill="white" stroke="black" points="0,-25.3 0,-50.1 379.69,-50.1 379.69,-25.3 0,-25.3"></polygon>
<text text-anchor="middle" x="34.25" y="-33.5" font-family="Times,serif" font-size="14.00">Foo.class</text>
<polyline fill="none" stroke="black" points="68.49,-25.3 68.49,-50.1"></polyline>
<text text-anchor="middle" x="123.35" y="-33.5" font-family="Times,serif" font-size="14.00">MANIFEST.MF</text>
<polyline fill="none" stroke="black" points="178.21,-25.3 178.21,-50.1"></polyline>
<text text-anchor="middle" x="224.89" y="-33.5" font-family="Times,serif" font-size="14.00">...other files...</text>
<polyline fill="none" stroke="black" points="271.57,-25.3 271.57,-50.1"></polyline>
<text text-anchor="middle" x="325.63" y="-33.5" font-family="Times,serif" font-size="14.00">central directory</text>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge1" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M325.85,-49.7C334.85,-54.6 334.85,-62.6 224.85,-62.6 169.85,-62.6 142.35,-60.6 129.72,-57.99"></path>
<polygon fill="black" stroke="black" points="132.48,-55.83 123.85,-49.7 126.77,-59.88 132.48,-55.83"></polygon>
<text text-anchor="middle" x="189.85" y="-66.8" font-family="Times,serif" font-size="14.00">reverse offsets</text>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge2" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M325.85,-49.7C334.85,-54.6 334.85,-62.6 179.85,-62.6 95.08,-62.6 56.67,-60.21 40.74,-57.24"></path>
<polygon fill="black" stroke="black" points="43.18,-54.72 33.85,-49.7 38.01,-59.44 43.18,-54.72"></polygon>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge3" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M325.85,-49.7C334.85,-54.6 334.85,-62.6 275.35,-62.6 250.71,-62.6 236.27,-61.23 228.45,-59.27"></path>
<polygon fill="black" stroke="black" points="231.65,-57.82 224.85,-49.7 225.1,-60.29 231.65,-57.82"></polygon>
</g>
</g>
</svg>

</center>
</div>
<div class="paragraph">
<p>The typical way someone reads from a zip file is a follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Seek to the end of zip and find the central directory</p>
</li>
<li>
<p>Find the metadata containing the offset for the file you want</p>
</li>
<li>
<p>Seek backwards using that offset to the start of the entry you want</p>
</li>
<li>
<p>Read and decompress your entry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike <code>.tar.gz</code> files, the entries within a <code>.zip</code> file are compressed individually. This
is convenient for use cases like Java classfiles where you want to lazily load them
individually on-demand without having to first decompress the whole archive up front.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_executable_zip_archives"><a class="anchor" href="#_executable_zip_archives"></a>Executable Zip Archives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One quirk of the above Zip format is that <em>the zip data does not need to start at the
beginning of the file</em>! The zip data can be at the end of an arbitrarily long file, and
as long as programs can scan to the end of the zip to find the central directory, they
will be able to extract the zip.</p>
</div>
<div class="paragraph">
<center>
<svg width="479px" height="119px" viewBox="0.00 0.00 479.49 119.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 115.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-115.4 475.49,-115.4 475.49,4 -4,4"></polygon>
<text text-anchor="middle" x="235.75" y="-8.2" font-family="Times,serif" font-size="14.00">archive.zip</text>
<!-- extra_label -->
<g id="node1" class="node">
<title>extra_label</title>
</g>
<!-- zip -->
<g id="node2" class="node">
<title>zip</title>
<polygon fill="white" stroke="black" points="0,-25.3 0,-50.1 471.49,-50.1 471.49,-25.3 0,-25.3"></polygon>
<text text-anchor="middle" x="45.9" y="-33.5" font-family="Times,serif" font-size="14.00">...extra data...</text>
<polyline fill="none" stroke="black" points="91.8,-25.3 91.8,-50.1"></polyline>
<text text-anchor="middle" x="126.05" y="-33.5" font-family="Times,serif" font-size="14.00">Foo.class</text>
<polyline fill="none" stroke="black" points="160.29,-25.3 160.29,-50.1"></polyline>
<text text-anchor="middle" x="215.15" y="-33.5" font-family="Times,serif" font-size="14.00">MANIFEST.MF</text>
<polyline fill="none" stroke="black" points="270.01,-25.3 270.01,-50.1"></polyline>
<text text-anchor="middle" x="316.69" y="-33.5" font-family="Times,serif" font-size="14.00">...other files...</text>
<polyline fill="none" stroke="black" points="363.37,-25.3 363.37,-50.1"></polyline>
<text text-anchor="middle" x="417.43" y="-33.5" font-family="Times,serif" font-size="14.00">central directory</text>
</g>
<!-- extra_label&#45;&gt;zip -->
<g id="edge1" class="edge">
<title>extra_label:s-&gt;zip:n</title>
<path fill="none" stroke="red" stroke-width="3" d="M45.75,-86.6C45.75,-74.6 45.75,-69.35 45.75,-60.72"></path>
<polygon fill="red" stroke="red" stroke-width="3" points="49.25,-60.6 45.75,-50.6 42.25,-60.6 49.25,-60.6"></polygon>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge2" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M417.75,-49.7C426.75,-60.6 426.75,-80.6 316.25,-80.6 233.37,-80.6 212.65,-69.35 211.27,-59.13"></path>
<polygon fill="black" stroke="black" points="214.57,-60.29 214.75,-49.7 208,-57.87 214.57,-60.29"></polygon>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge3" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M417.75,-49.7C426.75,-60.6 426.75,-80.6 271.75,-80.6 156.71,-80.6 127.05,-69.58 123.08,-59.45"></path>
<polygon fill="black" stroke="black" points="126.48,-60.27 125.75,-49.7 119.73,-58.42 126.48,-60.27"></polygon>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge4" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M417.75,-49.7C426.75,-60.6 426.75,-80.6 367.25,-80.6 322.16,-80.6 311.24,-69.11 312.51,-58.81"></path>
<polygon fill="black" stroke="black" points="315.7,-60.24 316.75,-49.7 309.35,-57.29 315.7,-60.24"></polygon>
</g>
</g>
</svg>

</center>
</div>
<div class="paragraph">
<p>Thus, we can actually use the <code>.zip</code> format in two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As a <code>.zip</code> file, which is read and extracted starting from the end of the file on the right</p>
</li>
<li>
<p>As something else, such as a bash script, which is read and executed starting from start of the file on the left</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This technique is used in common Zip
<a href="https://en.wikipedia.org/wiki/Self-extracting_archives">self-extracting archives</a>, where
a short bash script is pre-pended to the zip archive that when run extracts the archive using
<code>unzip</code>. Although
this article is about Jars, <code>.jar</code> files are really just <code>.zip</code>s with a different name!
So we can prepend a bash script to our <code>.jar</code> file to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>java</code> with the current executable <code>&quot;$0&quot;</code> as the classpath</p>
</li>
<li>
<p>Pass any of the current executableâs command-line arguments `&quot;$@&quot;`as the Java programâs command-line arguments</p>
</li>
<li>
<p>Allow configuration of the <code>java</code> process (since weâre no longer calling it ourselves) via a <code>JAVA_OPTS</code> environment variable</p>
</li>
</ul>
</div>
<div class="paragraph">
<center>
<svg width="765px" height="214px" viewBox="0.00 0.00 764.93 213.80" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 209.8)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-209.8 760.93,-209.8 760.93,4 -4,4"></polygon>
<text text-anchor="middle" x="378.46" y="-8.2" font-family="Times,serif" font-size="14.00">out.jar</text>
<!-- left -->
<g id="node1" class="node">
<title>left</title>
<text text-anchor="middle" x="148.76" y="-189.2" font-family="Times,serif" font-size="14.00">bash script starts executing at start of file</text>
<text text-anchor="middle" x="148.76" y="-172.4" font-family="Times,serif" font-size="14.00">runs `java` passing itself as the classpath</text>
</g>
<!-- zip -->
<g id="node3" class="node">
<title>zip</title>
<polygon fill="white" stroke="black" points="0,-102.9 0,-127.7 677.52,-127.7 677.52,-102.9 0,-102.9"></polygon>
<text text-anchor="middle" x="148.91" y="-111.1" font-family="Times,serif" font-size="14.00">exec java $JAVA_OPTS -cp &quot;$0&quot; &apos;foo.Foo&apos; &quot;$@&quot;</text>
<polyline fill="none" stroke="black" points="297.83,-102.9 297.83,-127.7"></polyline>
<text text-anchor="middle" x="332.07" y="-111.1" font-family="Times,serif" font-size="14.00">Foo.class</text>
<polyline fill="none" stroke="black" points="366.32,-102.9 366.32,-127.7"></polyline>
<text text-anchor="middle" x="421.18" y="-111.1" font-family="Times,serif" font-size="14.00">MANIFEST.MF</text>
<polyline fill="none" stroke="black" points="476.03,-102.9 476.03,-127.7"></polyline>
<text text-anchor="middle" x="522.72" y="-111.1" font-family="Times,serif" font-size="14.00">...other files...</text>
<polyline fill="none" stroke="black" points="569.4,-102.9 569.4,-127.7"></polyline>
<text text-anchor="middle" x="623.46" y="-111.1" font-family="Times,serif" font-size="14.00">central directory</text>
</g>
<!-- left&#45;&gt;zip -->
<g id="edge4" class="edge">
<title>left-&gt;zip:n</title>
<path fill="none" stroke="red" stroke-width="3" d="M148.76,-164.37C148.76,-156.6 148.76,-147.37 148.76,-138.29"></path>
<polygon fill="red" stroke="red" stroke-width="3" points="152.26,-138.2 148.76,-128.2 145.26,-138.2 152.26,-138.2"></polygon>
</g>
<!-- right -->
<g id="node2" class="node">
<title>right</title>
<text text-anchor="middle" x="623.76" y="-49.8" font-family="Times,serif" font-size="14.00">`java` loads compiled classfiles from jar/zip</text>
<text text-anchor="middle" x="623.76" y="-33" font-family="Times,serif" font-size="14.00">by reading the central directory at end of file</text>
</g>
<!-- zip&#45;&gt;right -->
<g id="edge5" class="edge">
<title>zip:s-&gt;right</title>
<path fill="none" stroke="red" stroke-width="3" d="M623.76,-92.31C623.76,-83.23 623.76,-74 623.76,-66.23"></path>
<polygon fill="red" stroke="red" stroke-width="3" points="620.26,-92.4 623.76,-102.4 627.26,-92.4 620.26,-92.4"></polygon>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge1" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M623.76,-127.3C632.76,-139.53 632.76,-162.2 522.26,-162.2 436.79,-162.2 417.43,-148.64 417.21,-136.84"></path>
<polygon fill="black" stroke="black" points="420.55,-137.89 420.76,-127.3 413.99,-135.45 420.55,-137.89"></polygon>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge2" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M623.76,-127.3C632.76,-139.53 632.76,-162.2 477.76,-162.2 357.88,-162.2 330.72,-148.64 328.73,-136.84"></path>
<polygon fill="black" stroke="black" points="332.06,-137.89 331.76,-127.3 325.39,-135.77 332.06,-137.89"></polygon>
</g>
<!-- zip&#45;&gt;zip -->
<g id="edge3" class="edge">
<title>zip:n-&gt;zip:n</title>
<path fill="none" stroke="black" d="M623.76,-127.3C632.76,-139.53 632.76,-162.2 573.26,-162.2 526.77,-162.2 516.61,-148.37 518.67,-136.48"></path>
<polygon fill="black" stroke="black" points="521.89,-137.86 522.76,-127.3 515.5,-135.01 521.89,-137.86"></polygon>
</g>
</g>
</svg>

</center>
</div>
<div class="paragraph">
<p>If you use <code>less out.jar</code> to look at whatâs inside the Jar file, it looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; exec java $JAVA_OPTS -cp &quot;$0&quot; 'foo.Foo' &quot;$@&quot;
PK^C^D^T^@^H^H^H^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@^T^@^Q^@META-INF/MANIFEST.MFUT^M^@^G&lt;97&gt;^Pvg&lt;97&gt;^Pvg&lt;97&gt;^PvgeÉ±
&lt;80&gt; ^P^@&lt;D0&gt;&lt;FD&gt;&lt;C0&gt;^?&lt;B8&gt;^_81s&lt;C9&gt;1&lt;A1&gt;&lt;CD&gt;-&lt;DA&gt;^OR^P&lt;C4&gt;^Cu&lt;E9&gt;&lt;EF&gt;ESC^Z{&lt;EB&gt;&lt;8B&gt;&lt;DC&gt;JNcÒ&lt;FA&gt;(&lt;D2&gt;&lt;.&lt;DA&gt;=&lt;F1&gt;L7&lt;ED&gt;&lt;8F&gt;&lt;C7&gt;XjE&lt;A3&gt;^W&lt;AB&gt;^]Ùl&lt;CE&gt;n&lt;B3&gt;
N&lt;91&gt;&lt;FA&gt;%&lt;FD&gt;3ri^T*&lt;8F&gt;&lt;E1&gt;1&lt;8B&gt;&lt;E8&gt;CD&lt;81&gt;&lt;82&gt;^WPK^G^HB?^Xo[^@^@^@n^@^@^@PK^C^D
^@^@^@^@^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@       ^@^Q^@META-INF/UT^M^@^G&lt;97&gt;^Pvg&lt;97&gt;^Pvg&lt;97&gt;^PvgPK^C^D
^@^@^@^@^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@^D^@^Q^@foo/UT^M^@^G&lt;97&gt;^Pvg&lt;97&gt;^Pvg&lt;97&gt;^PvgPK^C^D^T^@^H^H^H^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@^M^@^Q^@foo/Foo.classUT^M^@^G&lt;97&gt;^Pvg&lt;97&gt;^Pvg&lt;97&gt;^Pvgm&lt;90&gt;&lt;CB&gt;J&lt;C3&gt;@^T&lt;86&gt;&lt;FF&gt;&lt;D3&gt;[&lt;9A&gt;4&lt;DA&gt;&lt;DA&gt;&lt;DA&gt;z-&lt;E8&gt;BH]&lt;&lt;98&gt;^G&lt;A8&gt;&lt;BA&gt;^Q&lt;8A&gt;&lt;8B&gt;&lt;A0&gt;B&lt;A4&gt;.\&lt;A5&gt;&lt;ED&gt;X&lt;A6&gt;L2^R^S&lt;C1&gt;&lt;C7&gt;Ò&lt;82&gt;^K^_&lt;C0&gt;&lt;87&gt;^R&lt;CF&gt;^DA&lt;85&gt;&lt;CE&gt;&lt;E2&gt;&lt;DC&gt;&lt;E6&gt;&lt;FB&gt;&lt;FF&gt;^C&lt;E7&gt;&lt;&lt;F3&gt;&lt;EB&gt;&lt;FD&gt;^C&lt;C0&gt;      &lt;FA&gt;^NJ([&lt;A8&gt;&lt;B8&gt;&lt;A8&gt;&lt;A2&gt;Fh-&lt;A2&gt;&lt;C7&gt;&lt;C8&gt;WQ2&lt;F7&gt;/'^K1&lt;CD&gt;^H&lt;B5&gt;c&lt;99&gt;&lt;C8&gt;&lt;EC&gt;&lt;94&gt;P&lt;F6&gt;^FcESCu&lt;D8&gt;^V^^\^W^M&lt;B8&gt;&lt;FF&gt;&lt;F0&gt;&lt;F0&gt;&lt;E9&gt;!^S1S:gQ7(~&lt;A4&gt;&lt;F6&gt;&lt;AF&gt;R&lt;99&gt;da&lt;96&gt;&lt;8A&gt;(^^Ö±Jh&lt;9C&gt;^K&lt;A5&gt;&lt;F4&gt;ÞN&lt;D5&gt;&lt;CC&gt;A^Kk^V&lt;DA&gt;.:X't&lt;96&gt;&lt;88&gt;^HÖ½&lt;E9&gt;T&reg;^&lt;F0&gt;ga&lt;C6&gt;&lt;E3&gt;&lt;F9&gt;p0&lt;B6&gt;&lt;D0&gt;c&lt;E8&gt;Nk^?&lt;A4&gt;5&lt;A1&gt;r&lt;A6&gt;g&lt;82&gt;&lt;D0&gt;^Ld&quot;.&lt;F2&gt;x&quot;&lt;D2&gt;&lt;EB&gt;h&lt;A2&gt;xR&lt;89&gt;#&lt;C9&gt;&amp;=&lt;EF&gt;v&lt;99&gt;^K&lt;C1&gt;     u&lt;&lt;9E&gt;N&lt;C5&gt;H^Z&lt;B8&gt;&lt;CE&gt;^G^F&lt;C3&gt;&gt;&lt;BA&gt;|#&lt;F3&gt;J s%&lt;8E&gt;ESC&lt;DC&gt;&lt;F5&gt;9^S&lt;E7&gt;&lt;EA&gt;&lt;E1&gt;ESC&lt;E8&gt;&lt;99&gt;^K&lt;C2&gt;&amp;&lt;C7&gt;Z1,&lt;C3&gt;&lt;C6&gt;^V&lt;B6&gt;^?ÐB
&lt;D8&gt;/&lt;B0&gt;&lt;DA&gt;+&lt;AF&gt;h&lt;FE&gt;&lt;E2&gt;N&lt;E1&gt;]&lt;E5&gt;&lt;B3&gt;^Z&lt;E1&gt;N&lt;B1&gt;e&lt;F7&gt;ESCPK^G^H&lt;94&gt;r+6 ^A^@^@&lt;9F&gt;^A^@^@PK^A^B^T^@^T^@^H^H^H^@&lt;B5&gt;`&quot;ZB?^^Xo[^@^@^@n^@^@^@^T^@   ^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@META-INF/MANIFEST.MFUT^E^@^G&lt;97&gt;^PvgPK^A^B
^@
^@^@^@^@^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@       ^@      ^@^@^@^@^@^@^@^@^@^@^@&lt;AE&gt;^@^@^@META-INF/UT^E^@^G&lt;97&gt;^PvgPK^A^B
^@
^@^@^@^@^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@^D^@   ^@^@^@^@^@^@^@^@^@^@^@&lt;E6&gt;^@^@^@foo/UT^E^@^G&lt;97&gt;^PvgPK^A^B^T^@^T^@^H^H^H^@&lt;B5&gt;`&quot;Z&lt;94&gt;r+6 ^A^@^@&lt;9F&gt;^A^@^@^M^@     ^@^@^@^@^@^@^@^@^@^@^@^Y^A^@^@foo/Foo.classUT^E^@^G&lt;97&gt;^PvgPK^E^F^@^@^@^@^D^@^D^@
^A^@^@&lt;85&gt;^B^@^@^@^@
/Users/lihaoyi/test/out/foo/assembly.dest/out.jar (END)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you can see a single line of <code>exec java $JAVA_OPTS -cp &quot;$0&quot; 'foo.Foo' &quot;$@&quot;</code> which
is the bash script we prepended to the zip, followed by the un-intelligible compressed
class file data that makes up the <code>.jar</code>. Since now you are running the Java program
via <code>./out.jar</code> instead of <code>java -jar</code>, we expose the <code>JAVA_OPTS</code> environment variable
as a way to pass flags to the <code>java</code> command that ends up being run.]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_about_windows"><a class="anchor" href="#_what_about_windows"></a>What about Windows?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The self-executing jar file above works by prepending a shell script. This works on Unix
environments like Linux or Mac, but not on the Windows machines which are also very common.</p>
</div>
<div class="paragraph">
<p>To fix this, we can replace our shell script zip prefix with a &quot;universal&quot; script that
is both a valid <code>.sh</code> program as well as valid <code>.bat</code> program, the latter being the
standard windows command line language. Thus, instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; exec java  $JAVA_OPTS -cp &quot;$0&quot; 'foo.Foo' &quot;$@&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can instead use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">@ 2&gt;/dev/null # 2&gt;nul &amp; echo off &amp; goto BOF
:
exec java  $JAVA_OPTS -cp &quot;$0&quot; 'foo.Foo' &quot;$@&quot;
exit

:BOF
setlocal
@echo off
java  %JAVA_OPTS% -cp &quot;%~dpnx0&quot; foo.Foo %*
endlocal
exit /B %errorlevel%</code></pre>
</div>
</div>
<div class="paragraph">
<p>This universal launcher script is worth digging into.</p>
</div>
<div class="paragraph">
<p>In a <code>sh</code> shell:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@ 2&gt;/dev/null # 2&gt;nul &amp; echo off &amp; goto BOF</code> is an invalid command, but we ignore
the error because we pipe it to <code>/dev/null</code></p>
</li>
<li>
<p>It then runs the <code>exec java -cp</code> command</p>
</li>
<li>
<p>We <code>exit</code> the script before we hit the invalid shell code below</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a <code>bat</code> environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We run the first line, doing nothing, until we hit <code>goto BOF</code>. This jumps over the <code>exec java</code>
line which is not valid <code>bat</code> code, to go straight to the <code>:BOF</code> label</p>
</li>
<li>
<p>We then run <code>java -cp</code>, but with slightly different syntax from the unix/shell version above
(e.g. <code>%~dpnx0</code> instead of <code>$0</code>) for windows/bat compatibility</p>
</li>
<li>
<p>We then <code>exit</code> the script, using <code>/B %errorlevel%</code> which is the windows syntax for propagating
the exit code, before we hit the compressed data below which is not valid <code>bat</code> code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result, we have a short script that we can call either from <code>sh</code> or <code>bat</code>,
that forwards arguments and the script itself (which is also a <code>.jar</code> file) to <code>java -cp</code>,
and then forwards the exit code back from <code>java -cp</code> to the caller. Although the script may
look fragile, the strong backwards compatibility of <code>.sh</code> and <code>.bat</code> scripts means that
once working it is unlikely to break in future versions of Mac/Linux/Windows.</p>
</div>
<div class="paragraph">
<p>If we look at the file using <code>less -n20</code>, we can now see our universal launcher script
pre-pended to the blobs of compressed classfile data that make up the rest of the jar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">@ 2&gt;/dev/null # 2&gt;nul &amp; echo off &amp; goto BOF
:
exec java  $JAVA_OPTS -cp &quot;$0&quot; 'foo.Foo' &quot;$@&quot;
exit

:BOF
setlocal
@echo off
java  %JAVA_OPTS% -cp &quot;%~dpnx0&quot; foo.Foo %*
endlocal
exit /B %errorlevel%
PK^C^D^T^@^H^H^H^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@^T^@^Q^@META-INF/MANIFEST.MFUT^M^@^G&lt;97&gt;^Pvg&lt;97&gt;^Pvg&lt;97&gt;^PvgeÉ±
&lt;80&gt; ^P^@&lt;D0&gt;&lt;FD&gt;&lt;C0&gt;^?&lt;B8&gt;^_81s&lt;C9&gt;1&lt;A1&gt;&lt;CD&gt;-&lt;DA&gt;^OR^P&lt;C4&gt;^Cu&lt;E9&gt;&lt;EF&gt;ESC^Z{&lt;EB&gt;&lt;8B&gt;&lt;DC&gt;JNcÒ&lt;FA&gt;(&lt;D2&gt;&lt;.&lt;DA&gt;=&lt;F1&gt;L7&lt;ED&gt;&lt;8F&gt;&lt;C7&gt;XjE&lt;A3&gt;^W&lt;AB&gt;^]Ùl&lt;CE&gt;n&lt;B3&gt;
N&lt;91&gt;&lt;FA&gt;%&lt;FD&gt;3ri^T*&lt;8F&gt;&lt;E1&gt;1&lt;8B&gt;&lt;E8&gt;CD&lt;81&gt;&lt;82&gt;^WPK^G^HB?^Xo[^@^@^@n^@^@^@PK^C^D
^@^@^@^@^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@       ^@^Q^@META-INF/UT^M^@^G&lt;97&gt;^Pvg&lt;97&gt;^Pvg&lt;97&gt;^PvgPK^C^D
^@^@^@^@^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@^D^@^Q^@foo/UT^M^@^G&lt;97&gt;^Pvg&lt;97&gt;^Pvg&lt;97&gt;^PvgPK^C^D^T^@^H^H^H^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@^M^@^Q^@foo/Foo.classUT^M^@^G&lt;97&gt;^Pvg&lt;97&gt;^Pvg&lt;97&gt;^Pvgm&lt;90&gt;&lt;CB&gt;J&lt;C3&gt;@^T&lt;86&gt;&lt;FF&gt;&lt;D3&gt;[&lt;9A&gt;4&lt;DA&gt;&lt;DA&gt;&lt;DA&gt;z-&lt;E8&gt;BH]&lt;&lt;98&gt;^G&lt;A8&gt;&lt;BA&gt;^Q&lt;8A&gt;&lt;8B&gt;&lt;A0&gt;B&lt;A4&gt;.\&lt;A5&gt;&lt;ED&gt;X&lt;A6&gt;L2^R^S&lt;C1&gt;&lt;C7&gt;Ò&lt;82&gt;^K^_&lt;C0&gt;&lt;87&gt;^R&lt;CF&gt;^DA&lt;85&gt;&lt;CE&gt;&lt;E2&gt;&lt;DC&gt;&lt;E6&gt;&lt;FB&gt;&lt;FF&gt;^C&lt;E7&gt;&lt;&lt;F3&gt;&lt;EB&gt;&lt;FD&gt;^C&lt;C0&gt;      &lt;FA&gt;^NJ([&lt;A8&gt;&lt;B8&gt;&lt;A8&gt;&lt;A2&gt;Fh-&lt;A2&gt;&lt;C7&gt;&lt;C8&gt;WQ2&lt;F7&gt;/'^K1&lt;CD&gt;^H&lt;B5&gt;c&lt;99&gt;&lt;C8&gt;&lt;EC&gt;&lt;94&gt;P&lt;F6&gt;^FcESCu&lt;D8&gt;^V^^\^W^M&lt;B8&gt;&lt;FF&gt;&lt;F0&gt;&lt;F0&gt;&lt;E9&gt;!^S1S:gQ7(~&lt;A4&gt;&lt;F6&gt;&lt;AF&gt;R&lt;99&gt;da&lt;96&gt;&lt;8A&gt;(^^Ö±Jh&lt;9C&gt;^K&lt;A5&gt;&lt;F4&gt;ÞN&lt;D5&gt;&lt;CC&gt;A^Kk^V&lt;DA&gt;.:X't&lt;96&gt;&lt;88&gt;^HÖ½&lt;E9&gt;T&reg;^&lt;F0&gt;ga&lt;C6&gt;&lt;E3&gt;&lt;F9&gt;p0&lt;B6&gt;&lt;D0&gt;c&lt;E8&gt;Nk^?&lt;A4&gt;5&lt;A1&gt;r&lt;A6&gt;g&lt;82&gt;&lt;D0&gt;^Ld&quot;.&lt;F2&gt;x&quot;&lt;D2&gt;&lt;EB&gt;h&lt;A2&gt;xR&lt;89&gt;#&lt;C9&gt;&amp;=&lt;EF&gt;v&lt;99&gt;^K&lt;C1&gt;     u&lt;&lt;9E&gt;N&lt;C5&gt;H^Z&lt;B8&gt;&lt;CE&gt;^G^F&lt;C3&gt;&gt;&lt;BA&gt;|#&lt;F3&gt;J s%&lt;8E&gt;ESC&lt;DC&gt;&lt;F5&gt;9^S&lt;E7&gt;&lt;EA&gt;&lt;E1&gt;ESC&lt;E8&gt;&lt;99&gt;^K&lt;C2&gt;&amp;&lt;C7&gt;Z1,&lt;C3&gt;&lt;C6&gt;^V&lt;B6&gt;^?ÐB
&lt;D8&gt;/&lt;B0&gt;&lt;DA&gt;+&lt;AF&gt;h&lt;FE&gt;&lt;E2&gt;N&lt;E1&gt;]&lt;E5&gt;&lt;B3&gt;^Z&lt;E1&gt;N&lt;B1&gt;e&lt;F7&gt;ESCPK^G^H&lt;94&gt;r+6 ^A^@^@&lt;9F&gt;^A^@^@PK^A^B^T^@^T^@^H^H^H^@&lt;B5&gt;`&quot;ZB?^^Xo[^@^@^@n^@^@^@^T^@   ^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@META-INF/MANIFEST.MFUT^E^@^G&lt;97&gt;^PvgPK^A^B
^@
^@^@^@^@^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@       ^@      ^@^@^@^@^@^@^@^@^@^@^@&lt;AE&gt;^@^@^@META-INF/UT^E^@^G&lt;97&gt;^PvgPK^A^B
^@
^@^@^@^@^@&lt;B5&gt;`&quot;Z^@^@^@^@^@^@^@^@^@^@^@^@^D^@   ^@^@^@^@^@^@^@^@^@^@^@&lt;E6&gt;^@^@^@foo/UT^E^@^G&lt;97&gt;^PvgPK^A^B^T^@^T^@^H^H^H^@&lt;B5&gt;`&quot;Z&lt;94&gt;r+6 ^A^@^@&lt;9F&gt;^A^@^@^M^@     ^@^@^@^@^@^@^@^@^@^@^@^Y^A^@^@foo/Foo.classUT^E^@^G&lt;97&gt;^PvgPK^E^F^@^@^@^@^D^@^D^@
^A^@^@&lt;85&gt;^B^@^@^@^@
/Users/lihaoyi/test/out/foo/assembly.dest/out.jar (END)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can run it directly on Mac/Linux:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill show foo.assembly # generate the assembly jar
&quot;ref:v0:bd2c6c70:/Users/lihaoyi/test/out/foo/assembly.dest/out.jar&quot;

&gt; out/foo/assembly.dest/out.jar # run the assembly jar directly
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we can run it on windows, although we need to rename
<code>out.jar</code> to <code>out.bat</code> before executing it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill show foo.assembly
&quot;ref:v0:bd2c6c70:C:\\Users\\haoyi\\test\\out\\foo\\assembly.dest\\out.jar&quot;

&gt; cp out\foo\assembly.dest\out.jar out.bat

&gt; ./out.bat
Hello World</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The executable assembly jars that Mill generates are very convenient; it means that
you can use Mill to compile (almost) any Java program into an executable you can run with
<code>./out.jar</code>, as long as you have the appropriate version of Java globally installed. This
is much easier than setting up JLink or JPackage. You can even have an executable jar that
runs on all of Mac/Linux/Windows just by carefully crafting a launcher script that runs
on all platforms.</p>
</div>
<div class="paragraph">
<p>The Mill JVM build tool provides these executable assembly jars out-of-the-box, the <code>sbt</code>
build tool as part of the <a href="https://github.com/sbt/sbt-assembly">sbt-assembly</a> plugin,
via the <code>prependShellScript</code> config.
Maven and Gradle do not provide this by default but it is pretty easy to set up yourself
simply by concatenating a shell script with an assembly jar, as described above.</p>
</div>
<div class="paragraph">
<p>Although running Java programs via
<code>java -jar</code> or <code>java -cp</code> is not a huge hardship, removing that friction really helps your
Java programs and codebase feel like a first class citizen on the command-line.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="6-garbage-collector-perf.html">Understanding JVM Garbage Collector Performance</a></span>
  <span class="next"><a href="4-flaky-tests.html">How To Manage Flaky Tests in your CI Workflows</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async="async" src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async="async" src="../search-index.js"></script>
  
</body></html>