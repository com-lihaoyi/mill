<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Understanding JVM Garbage Collector Performance :: The Mill JVM Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/blog/6-garbage-collector-perf.html" />
    <link rel="prev" href="index.html" />
    <link rel="next" href="5-executable-jars.html" />
    <meta name="generator" content="Antora 3.1.9" />
    <link rel="stylesheet" href="../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../_/favicon.png" type="image/x-icon" />
  
  <style>
*{
  hyphens: manual !important;
}
</style></head><body class="article">
  
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../_/logo-white.svg" height="20" /> The Mill JVM Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="blog" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="6-garbage-collector-perf.html">Understanding JVM Garbage Collector Performance</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="5-executable-jars.html">How JVM Executable Assembly Jars Work</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="4-flaky-tests.html">How To Manage Flaky Tests</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="3-selective-testing.html">Faster CI with Selective Testing</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="2-monorepo-build-tool.html">Why Use a Monorepo Build Tool?</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="1-java-compile.html">How Fast Does Java Compile?</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Mill Build Engineering Blog</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../mill/index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../mill/main-branch/index.html">main-branch</a>
        </li>
        <li class="version is-latest">
          <a href="../mill/index.html">latest-0.12.5</a>
        </li>
        <li class="version">
          <a href="../mill/0.12.x/index.html">0.12.x</a>
        </li>
        <li class="version">
          <a href="../mill/0.11.x/index.html">0.11.x</a>
        </li>
        <li class="version">
          <a href="../mill/0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../mill/0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../mill/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">The Mill Build Engineering Blog</a></li>
    <li><a href="6-garbage-collector-perf.html">Understanding JVM Garbage Collector Performance</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/out/docs/blogFolder.dest/modules/ROOT/pages/6-garbage-collector-perf.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Understanding JVM Garbage Collector Performance</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 10 January 2024</em></p>
</div>

<script>
gtag('config', 'AW-16649289906');

document.addEventListener('DOMContentLoaded', function() {
const links = document.querySelectorAll('a');
  links.forEach(link => {
    if (link.textContent.trim().toLowerCase() === 'download') {
      link.addEventListener('click', function(event) {
        console.log("download link clicked")
        gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
      });
    }
  });
});
</script>
<div class="paragraph">
<p>Garbage collectors are a core part of many programming languages, but are surprisingly
poorly understood. In developing the <a href="https://mill-build.org">Mill JVM build tool</a>,
we sometimes have to deal with GC-related issues to keep the tool fast and responsive,
but these issues can occur in any JVM application.
This article will discuss the fundamental design of how garbage collectors
work, and tie it to real benchmarks of how GCs perform on the Java Virtual Machine. You
should come away with a deeper understanding of how the JVM garbage collector works and
how you can work to optimize its performance in your own real-world projects.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_theoretical_garbage_collector"><a class="anchor" href="#_a_theoretical_garbage_collector"></a>A Theoretical Garbage Collector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To understand how the real-world JVM garbage collector works, it is best to start
by looking at the simplest possible garbage collector. This will both give an intuition
for how things work in general, and also help you notice when things diverge from this
idealized example.</p>
</div>
<div class="sect2">
<h3 id="_process_memory"><a class="anchor" href="#_process_memory"></a>Process Memory</h3>
<div class="paragraph">
<p>At its core, a garbage collector helps manage the free memory of a program, often called the
<em>heap</em>. The memory of a program can be modelled as a linear sequence of storage locations, e.g.
below where we have 16 slots in memory:</p>
</div>
<center>
<svg width="373px" height="95px" viewBox="0.00 0.00 372.55 94.60" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 90.6)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-90.6 368.55,-90.6 368.55,4 -4,4"></polygon>
<!-- heap -->
<g id="node1" class="node">
<title>heap</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 364.55,-86.1 364.55,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="26.27" y="-69.5" font-family="Times,serif" font-size="14.00">HEAP</text>
<polyline fill="none" stroke="black" points="52.55,-61.3 52.55,-86.1"></polyline>
<text text-anchor="middle" x="62.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="72.05,-61.3 72.05,-86.1"></polyline>
<text text-anchor="middle" x="81.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="91.55,-61.3 91.55,-86.1"></polyline>
<text text-anchor="middle" x="101.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="111.05,-61.3 111.05,-86.1"></polyline>
<text text-anchor="middle" x="120.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="130.55,-61.3 130.55,-86.1"></polyline>
<text text-anchor="middle" x="140.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="150.05,-61.3 150.05,-86.1"></polyline>
<text text-anchor="middle" x="159.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="169.55,-61.3 169.55,-86.1"></polyline>
<text text-anchor="middle" x="179.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="189.05,-61.3 189.05,-86.1"></polyline>
<text text-anchor="middle" x="198.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="208.55,-61.3 208.55,-86.1"></polyline>
<text text-anchor="middle" x="218.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="228.05,-61.3 228.05,-86.1"></polyline>
<text text-anchor="middle" x="237.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="247.55,-61.3 247.55,-86.1"></polyline>
<text text-anchor="middle" x="257.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="267.05,-61.3 267.05,-86.1"></polyline>
<text text-anchor="middle" x="276.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="286.55,-61.3 286.55,-86.1"></polyline>
<text text-anchor="middle" x="296.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="306.05,-61.3 306.05,-86.1"></polyline>
<text text-anchor="middle" x="315.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="325.55,-61.3 325.55,-86.1"></polyline>
<text text-anchor="middle" x="335.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="345.05,-61.3 345.05,-86.1"></polyline>
<text text-anchor="middle" x="354.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- alloc -->
<g id="node2" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="106.18,-24.7 18.37,-24.7 18.37,-0.1 106.18,-0.1 106.18,-24.7"></polygon>
<text text-anchor="middle" x="62.27" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap&#45;&gt;alloc -->
<g id="edge1" class="edge">
<title>heap:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M62.27,-50.67C62.27,-42.05 62.27,-36.8 62.27,-24.8"></path>
<polygon fill="black" stroke="black" points="58.77,-50.8 62.27,-60.8 65.77,-50.8 58.77,-50.8"></polygon>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>These storage locations can contain objects (below named <code>foo</code>, <code>bar</code>, <code>qux</code>, <code>baz</code>) that take
up memory and may reference other objects (solid arrows). Furthermore, the values may be referenced from outside
the heap (dashed lines), e.g. from the &quot;stack&quot; which represents all objects referenced by
local variables in methods that are currently being run (shown below) or from static global
variables (not shown). We keep a <code>free-memory</code> pointer to the first empty slot on the right.</p>
</div>
<center>
<svg width="436px" height="156px" viewBox="0.00 0.00 435.51 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 431.51,-152.4 431.51,4 -4,4"></polygon>
<!-- heap -->
<g id="node1" class="node">
<title>heap</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 427.51,-86.1 427.51,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="26.27" y="-69.5" font-family="Times,serif" font-size="14.00">HEAP</text>
<polyline fill="none" stroke="black" points="52.55,-61.3 52.55,-86.1"></polyline>
<text text-anchor="middle" x="69.88" y="-69.5" font-family="Times,serif" font-size="14.00">foo</text>
<polyline fill="none" stroke="black" points="87.21,-61.3 87.21,-86.1"></polyline>
<text text-anchor="middle" x="104.15" y="-69.5" font-family="Times,serif" font-size="14.00">bar</text>
<polyline fill="none" stroke="black" points="121.08,-61.3 121.08,-86.1"></polyline>
<text text-anchor="middle" x="139.58" y="-69.5" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="158.08,-61.3 158.08,-86.1"></polyline>
<text text-anchor="middle" x="175.8" y="-69.5" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="193.51,-61.3 193.51,-86.1"></polyline>
<text text-anchor="middle" x="203.26" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="213.01,-61.3 213.01,-86.1"></polyline>
<text text-anchor="middle" x="222.76" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="232.51,-61.3 232.51,-86.1"></polyline>
<text text-anchor="middle" x="242.26" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="252.01,-61.3 252.01,-86.1"></polyline>
<text text-anchor="middle" x="261.76" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="271.51,-61.3 271.51,-86.1"></polyline>
<text text-anchor="middle" x="281.26" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="291.01,-61.3 291.01,-86.1"></polyline>
<text text-anchor="middle" x="300.76" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="310.51,-61.3 310.51,-86.1"></polyline>
<text text-anchor="middle" x="320.26" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="330.01,-61.3 330.01,-86.1"></polyline>
<text text-anchor="middle" x="339.76" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="349.51,-61.3 349.51,-86.1"></polyline>
<text text-anchor="middle" x="359.26" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="369.01,-61.3 369.01,-86.1"></polyline>
<text text-anchor="middle" x="378.76" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="388.51,-61.3 388.51,-86.1"></polyline>
<text text-anchor="middle" x="398.26" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="408.01,-61.3 408.01,-86.1"></polyline>
<text text-anchor="middle" x="417.76" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge1" class="edge">
<title>heap:s-&gt;heap:s</title>
<path fill="none" stroke="black" d="M69.76,-61.7C60.76,-50.8 60.76,-30.8 86.76,-30.8 106.46,-30.8 111.23,-42.29 108.47,-52.59"></path>
<polygon fill="black" stroke="black" points="105.25,-51.21 103.76,-61.7 111.46,-54.43 105.25,-51.21"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge2" class="edge">
<title>heap:s-&gt;heap:s</title>
<path fill="none" stroke="black" d="M69.76,-61.7C60.76,-50.8 60.76,-30.8 104.76,-30.8 138.1,-30.8 146.18,-42.29 144.21,-52.59"></path>
<polygon fill="black" stroke="black" points="141.01,-51.18 139.76,-61.7 147.3,-54.26 141.01,-51.18"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge3" class="edge">
<title>heap:n-&gt;heap:n</title>
<path fill="none" stroke="black" d="M139.76,-85.7C130.76,-96.6 130.76,-116.6 157.76,-116.6 178.22,-116.6 183.17,-105.11 180.46,-94.81"></path>
<polygon fill="black" stroke="black" points="183.45,-92.98 175.76,-85.7 177.23,-96.19 183.45,-92.98"></polygon>
</g>
<!-- alloc -->
<g id="node2" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="247.66,-24.7 159.85,-24.7 159.85,-0.1 247.66,-0.1 247.66,-24.7"></polygon>
<text text-anchor="middle" x="203.76" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap&#45;&gt;alloc -->
<g id="edge4" class="edge">
<title>heap:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M203.76,-50.67C203.76,-42.05 203.76,-36.8 203.76,-24.8"></path>
<polygon fill="black" stroke="black" points="200.26,-50.8 203.76,-60.8 207.26,-50.8 200.26,-50.8"></polygon>
</g>
<!-- stack -->
<g id="node3" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="40.81,-123.1 40.81,-147.9 258.7,-147.9 258.7,-123.1 40.81,-123.1"></polygon>
<text text-anchor="middle" x="71.76" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="102.7,-123.1 102.7,-147.9"></polyline>
<text text-anchor="middle" x="112.45" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="122.2,-123.1 122.2,-147.9"></polyline>
<text text-anchor="middle" x="131.95" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="141.7,-123.1 141.7,-147.9"></polyline>
<text text-anchor="middle" x="151.45" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="161.2,-123.1 161.2,-147.9"></polyline>
<text text-anchor="middle" x="170.95" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="180.7,-123.1 180.7,-147.9"></polyline>
<text text-anchor="middle" x="190.45" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="200.2,-123.1 200.2,-147.9"></polyline>
<text text-anchor="middle" x="209.95" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="219.7,-123.1 219.7,-147.9"></polyline>
<text text-anchor="middle" x="229.45" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="239.2,-123.1 239.2,-147.9"></polyline>
<text text-anchor="middle" x="248.95" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge5" class="edge">
<title>stack:f0-&gt;heap:f1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M112.76,-122.6C112.76,-106.11 103.76,-103.09 103.76,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge6" class="edge">
<title>stack:f1-&gt;heap:f2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M131.76,-122.6C131.76,-106.21 139.76,-102.99 139.76,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>If we want to allocate a new object <code>new1</code>, we can simply put it at the location of
the <code>free-memory</code> pointer (green below), and bump <code>free-memory</code> 1 slot to the right</p>
</div>
<center>
<svg width="462px" height="156px" viewBox="0.00 0.00 462.33 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 458.33,-152.4 458.33,4 -4,4"></polygon>
<!-- heap -->
<g id="node1" class="node">
<title>heap</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 454.33,-86.1 454.33,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="26.27" y="-69.5" font-family="Times,serif" font-size="14.00">HEAP</text>
<polyline fill="none" stroke="black" points="52.55,-61.3 52.55,-86.1"></polyline>
<text text-anchor="middle" x="69.88" y="-69.5" font-family="Times,serif" font-size="14.00">foo</text>
<polyline fill="none" stroke="black" points="87.21,-61.3 87.21,-86.1"></polyline>
<text text-anchor="middle" x="104.15" y="-69.5" font-family="Times,serif" font-size="14.00">bar</text>
<polyline fill="none" stroke="black" points="121.08,-61.3 121.08,-86.1"></polyline>
<text text-anchor="middle" x="139.58" y="-69.5" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="158.08,-61.3 158.08,-86.1"></polyline>
<text text-anchor="middle" x="175.8" y="-69.5" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="193.51,-61.3 193.51,-86.1"></polyline>
<text text-anchor="middle" x="216.67" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="239.83,-61.3 239.83,-86.1"></polyline>
<text text-anchor="middle" x="249.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="259.33,-61.3 259.33,-86.1"></polyline>
<text text-anchor="middle" x="269.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="278.83,-61.3 278.83,-86.1"></polyline>
<text text-anchor="middle" x="288.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="298.33,-61.3 298.33,-86.1"></polyline>
<text text-anchor="middle" x="308.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="317.83,-61.3 317.83,-86.1"></polyline>
<text text-anchor="middle" x="327.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="337.33,-61.3 337.33,-86.1"></polyline>
<text text-anchor="middle" x="347.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="356.83,-61.3 356.83,-86.1"></polyline>
<text text-anchor="middle" x="366.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="376.33,-61.3 376.33,-86.1"></polyline>
<text text-anchor="middle" x="386.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="395.83,-61.3 395.83,-86.1"></polyline>
<text text-anchor="middle" x="405.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="415.33,-61.3 415.33,-86.1"></polyline>
<text text-anchor="middle" x="425.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="434.83,-61.3 434.83,-86.1"></polyline>
<text text-anchor="middle" x="444.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge1" class="edge">
<title>heap:s-&gt;heap:s</title>
<path fill="none" stroke="black" d="M70.17,-61.7C61.17,-50.8 61.17,-30.8 87.17,-30.8 106.87,-30.8 111.64,-42.29 108.88,-52.59"></path>
<polygon fill="black" stroke="black" points="105.66,-51.21 104.17,-61.7 111.87,-54.43 105.66,-51.21"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge2" class="edge">
<title>heap:s-&gt;heap:s</title>
<path fill="none" stroke="black" d="M70.17,-61.7C61.17,-50.8 61.17,-30.8 104.67,-30.8 137.63,-30.8 145.62,-42.29 143.63,-52.59"></path>
<polygon fill="black" stroke="black" points="140.43,-51.18 139.17,-61.7 146.71,-54.26 140.43,-51.18"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge3" class="edge">
<title>heap:n-&gt;heap:n</title>
<path fill="none" stroke="black" d="M139.17,-85.7C130.17,-96.6 130.17,-116.6 157.67,-116.6 178.51,-116.6 183.55,-105.11 180.86,-94.81"></path>
<polygon fill="black" stroke="black" points="183.86,-92.99 176.17,-85.7 177.64,-96.19 183.86,-92.99"></polygon>
</g>
<!-- alloc -->
<g id="node2" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="293.07,-24.7 205.26,-24.7 205.26,-0.1 293.07,-0.1 293.07,-24.7"></polygon>
<text text-anchor="middle" x="249.17" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap&#45;&gt;alloc -->
<g id="edge4" class="edge">
<title>heap:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M249.17,-50.67C249.17,-42.05 249.17,-36.8 249.17,-24.8"></path>
<polygon fill="black" stroke="black" points="245.67,-50.8 249.17,-60.8 252.67,-50.8 245.67,-50.8"></polygon>
</g>
<!-- stack -->
<g id="node3" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="48.22,-123.1 48.22,-147.9 266.11,-147.9 266.11,-123.1 48.22,-123.1"></polygon>
<text text-anchor="middle" x="79.17" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="110.11,-123.1 110.11,-147.9"></polyline>
<text text-anchor="middle" x="119.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="129.61,-123.1 129.61,-147.9"></polyline>
<text text-anchor="middle" x="139.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="149.11,-123.1 149.11,-147.9"></polyline>
<text text-anchor="middle" x="158.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="168.61,-123.1 168.61,-147.9"></polyline>
<text text-anchor="middle" x="178.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="188.11,-123.1 188.11,-147.9"></polyline>
<text text-anchor="middle" x="197.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="207.61,-123.1 207.61,-147.9"></polyline>
<text text-anchor="middle" x="217.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="227.11,-123.1 227.11,-147.9"></polyline>
<text text-anchor="middle" x="236.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="246.61,-123.1 246.61,-147.9"></polyline>
<text text-anchor="middle" x="256.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge5" class="edge">
<title>stack:f0-&gt;heap:f1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M120.17,-122.6C120.17,-105.09 104.17,-104.11 104.17,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge6" class="edge">
<title>stack:f1-&gt;heap:f2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M139.17,-122.6C139.17,-106.6 139.17,-102.6 139.17,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge7" class="edge">
<title>stack:f2-&gt;heap:f4</title>
<path fill="none" stroke="green" stroke-width="3" stroke-dasharray="5,2" d="M159.17,-122.6C159.17,-92.26 217.17,-116.94 217.17,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>Similarly, objects may stop being referenced, e.g. <code>bar</code> below no longer has a reference
pointing at it from the stack. This may happen because a local variable on the stack is
set to <code>null</code>, or because a method call returned and the local variables associated with
it are no longer necessary</p>
</div>
<center>
<svg width="462px" height="156px" viewBox="0.00 0.00 462.33 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 458.33,-152.4 458.33,4 -4,4"></polygon>
<!-- heap -->
<g id="node1" class="node">
<title>heap</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 454.33,-86.1 454.33,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="26.27" y="-69.5" font-family="Times,serif" font-size="14.00">HEAP</text>
<polyline fill="none" stroke="black" points="52.55,-61.3 52.55,-86.1"></polyline>
<text text-anchor="middle" x="69.88" y="-69.5" font-family="Times,serif" font-size="14.00">foo</text>
<polyline fill="none" stroke="black" points="87.21,-61.3 87.21,-86.1"></polyline>
<text text-anchor="middle" x="104.15" y="-69.5" font-family="Times,serif" font-size="14.00">bar</text>
<polyline fill="none" stroke="black" points="121.08,-61.3 121.08,-86.1"></polyline>
<text text-anchor="middle" x="139.58" y="-69.5" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="158.08,-61.3 158.08,-86.1"></polyline>
<text text-anchor="middle" x="175.8" y="-69.5" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="193.51,-61.3 193.51,-86.1"></polyline>
<text text-anchor="middle" x="216.67" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="239.83,-61.3 239.83,-86.1"></polyline>
<text text-anchor="middle" x="249.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="259.33,-61.3 259.33,-86.1"></polyline>
<text text-anchor="middle" x="269.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="278.83,-61.3 278.83,-86.1"></polyline>
<text text-anchor="middle" x="288.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="298.33,-61.3 298.33,-86.1"></polyline>
<text text-anchor="middle" x="308.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="317.83,-61.3 317.83,-86.1"></polyline>
<text text-anchor="middle" x="327.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="337.33,-61.3 337.33,-86.1"></polyline>
<text text-anchor="middle" x="347.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="356.83,-61.3 356.83,-86.1"></polyline>
<text text-anchor="middle" x="366.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="376.33,-61.3 376.33,-86.1"></polyline>
<text text-anchor="middle" x="386.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="395.83,-61.3 395.83,-86.1"></polyline>
<text text-anchor="middle" x="405.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="415.33,-61.3 415.33,-86.1"></polyline>
<text text-anchor="middle" x="425.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="434.83,-61.3 434.83,-86.1"></polyline>
<text text-anchor="middle" x="444.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge1" class="edge">
<title>heap:s-&gt;heap:s</title>
<path fill="none" stroke="black" d="M70.17,-61.7C61.17,-50.8 61.17,-30.8 87.17,-30.8 106.87,-30.8 111.64,-42.29 108.88,-52.59"></path>
<polygon fill="black" stroke="black" points="105.66,-51.21 104.17,-61.7 111.87,-54.43 105.66,-51.21"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge2" class="edge">
<title>heap:s-&gt;heap:s</title>
<path fill="none" stroke="black" d="M70.17,-61.7C61.17,-50.8 61.17,-30.8 104.67,-30.8 137.63,-30.8 145.62,-42.29 143.63,-52.59"></path>
<polygon fill="black" stroke="black" points="140.43,-51.18 139.17,-61.7 146.71,-54.26 140.43,-51.18"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge3" class="edge">
<title>heap:n-&gt;heap:n</title>
<path fill="none" stroke="black" d="M139.17,-85.7C130.17,-96.6 130.17,-116.6 157.67,-116.6 178.51,-116.6 183.55,-105.11 180.86,-94.81"></path>
<polygon fill="black" stroke="black" points="183.86,-92.99 176.17,-85.7 177.64,-96.19 183.86,-92.99"></polygon>
</g>
<!-- alloc -->
<g id="node2" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="293.07,-24.7 205.26,-24.7 205.26,-0.1 293.07,-0.1 293.07,-24.7"></polygon>
<text text-anchor="middle" x="249.17" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap&#45;&gt;alloc -->
<g id="edge4" class="edge">
<title>heap:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M249.17,-50.67C249.17,-42.05 249.17,-36.8 249.17,-24.8"></path>
<polygon fill="black" stroke="black" points="245.67,-50.8 249.17,-60.8 252.67,-50.8 245.67,-50.8"></polygon>
</g>
<!-- stack -->
<g id="node3" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="77.22,-123.1 77.22,-147.9 295.11,-147.9 295.11,-123.1 77.22,-123.1"></polygon>
<text text-anchor="middle" x="108.17" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="139.11,-123.1 139.11,-147.9"></polyline>
<text text-anchor="middle" x="148.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="158.61,-123.1 158.61,-147.9"></polyline>
<text text-anchor="middle" x="168.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="178.11,-123.1 178.11,-147.9"></polyline>
<text text-anchor="middle" x="187.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="197.61,-123.1 197.61,-147.9"></polyline>
<text text-anchor="middle" x="207.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="217.11,-123.1 217.11,-147.9"></polyline>
<text text-anchor="middle" x="226.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="236.61,-123.1 236.61,-147.9"></polyline>
<text text-anchor="middle" x="246.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="256.11,-123.1 256.11,-147.9"></polyline>
<text text-anchor="middle" x="265.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="275.61,-123.1 275.61,-147.9"></polyline>
<text text-anchor="middle" x="285.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge5" class="edge">
<title>stack:f1-&gt;heap:f2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M168.17,-122.6C168.17,-102.05 139.17,-107.15 139.17,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge6" class="edge">
<title>stack:f2-&gt;heap:f4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M188.17,-122.6C188.17,-102.05 217.17,-107.15 217.17,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>For the purposes of this example, we show all objects on the heap taking up 1 slot, but
in real programs the size of each object may vary depending on how many fields it has
or if it’s a variable-length array.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_simple_garbage_collector"><a class="anchor" href="#_a_simple_garbage_collector"></a>A Simple Garbage Collector</h3>
<div class="paragraph">
<p>The simplest kind of garbage collector splits the 16-slot heap we saw earlier into
two 8-slot halves. If
we want to allocate 4 more objects (<code>new2</code>, to <code>new5</code>), but there are only 3 slots left on the
heap, we will need to do a collection:</p>
</div>
<center>
<svg width="546px" height="156px" viewBox="0.00 0.00 546.44 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 542.44,-152.4 542.44,4 -4,4"></polygon>
<!-- heap1 -->
<g id="node1" class="node">
<title>heap1</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 305.33,-86.1 305.33,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="29.77" y="-69.5" font-family="Times,serif" font-size="14.00">HALF1</text>
<polyline fill="none" stroke="black" points="59.55,-61.3 59.55,-86.1"></polyline>
<text text-anchor="middle" x="76.88" y="-69.5" font-family="Times,serif" font-size="14.00">foo</text>
<polyline fill="none" stroke="black" points="94.21,-61.3 94.21,-86.1"></polyline>
<text text-anchor="middle" x="111.15" y="-69.5" font-family="Times,serif" font-size="14.00">bar</text>
<polyline fill="none" stroke="black" points="128.08,-61.3 128.08,-86.1"></polyline>
<text text-anchor="middle" x="145.8" y="-69.5" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="163.51,-61.3 163.51,-86.1"></polyline>
<text text-anchor="middle" x="182.01" y="-69.5" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="200.51,-61.3 200.51,-86.1"></polyline>
<text text-anchor="middle" x="223.67" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="246.83,-61.3 246.83,-86.1"></polyline>
<text text-anchor="middle" x="256.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="266.33,-61.3 266.33,-86.1"></polyline>
<text text-anchor="middle" x="276.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="285.83,-61.3 285.83,-86.1"></polyline>
<text text-anchor="middle" x="295.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap1&#45;&gt;heap1 -->
<g id="edge1" class="edge">
<title>heap1:s-&gt;heap1:s</title>
<path fill="none" stroke="black" d="M76.67,-61.7C67.67,-50.8 67.67,-30.8 93.67,-30.8 113.37,-30.8 118.14,-42.29 115.38,-52.59"></path>
<polygon fill="black" stroke="black" points="112.16,-51.21 110.67,-61.7 118.37,-54.43 112.16,-51.21"></polygon>
</g>
<!-- heap1&#45;&gt;heap1 -->
<g id="edge2" class="edge">
<title>heap1:s-&gt;heap1:s</title>
<path fill="none" stroke="black" d="M76.67,-61.7C67.67,-50.8 67.67,-30.8 111.17,-30.8 144.13,-30.8 152.12,-42.29 150.13,-52.59"></path>
<polygon fill="black" stroke="black" points="146.93,-51.18 145.67,-61.7 153.21,-54.26 146.93,-51.18"></polygon>
</g>
<!-- heap1&#45;&gt;heap1 -->
<g id="edge3" class="edge">
<title>heap1:n-&gt;heap1:n</title>
<path fill="none" stroke="black" d="M145.67,-85.7C136.67,-96.6 136.67,-116.6 163.67,-116.6 184.13,-116.6 189.08,-105.11 186.37,-94.81"></path>
<polygon fill="black" stroke="black" points="189.36,-92.98 181.67,-85.7 183.14,-96.19 189.36,-92.98"></polygon>
</g>
<!-- alloc -->
<g id="node3" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="300.57,-24.7 212.76,-24.7 212.76,-0.1 300.57,-0.1 300.57,-24.7"></polygon>
<text text-anchor="middle" x="256.67" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap1&#45;&gt;alloc -->
<g id="edge4" class="edge">
<title>heap1:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M256.67,-50.67C256.67,-42.05 256.67,-36.8 256.67,-24.8"></path>
<polygon fill="black" stroke="black" points="253.17,-50.8 256.67,-60.8 260.17,-50.8 253.17,-50.8"></polygon>
</g>
<!-- heap2 -->
<g id="node2" class="node">
<title>heap2</title>
<polygon fill="white" stroke="black" points="322.89,-61.3 322.89,-86.1 538.44,-86.1 538.44,-61.3 322.89,-61.3"></polygon>
<text text-anchor="middle" x="352.67" y="-69.5" font-family="Times,serif" font-size="14.00">HALF2</text>
<polyline fill="none" stroke="black" points="382.44,-61.3 382.44,-86.1"></polyline>
<text text-anchor="middle" x="392.19" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="401.94,-61.3 401.94,-86.1"></polyline>
<text text-anchor="middle" x="411.69" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="421.44,-61.3 421.44,-86.1"></polyline>
<text text-anchor="middle" x="431.19" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="440.94,-61.3 440.94,-86.1"></polyline>
<text text-anchor="middle" x="450.69" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="460.44,-61.3 460.44,-86.1"></polyline>
<text text-anchor="middle" x="470.19" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="479.94,-61.3 479.94,-86.1"></polyline>
<text text-anchor="middle" x="489.69" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="499.44,-61.3 499.44,-86.1"></polyline>
<text text-anchor="middle" x="509.19" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="518.94,-61.3 518.94,-86.1"></polyline>
<text text-anchor="middle" x="528.69" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack -->
<g id="node4" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="83.72,-123.1 83.72,-147.9 301.61,-147.9 301.61,-123.1 83.72,-123.1"></polygon>
<text text-anchor="middle" x="114.67" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="145.61,-123.1 145.61,-147.9"></polyline>
<text text-anchor="middle" x="155.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="165.11,-123.1 165.11,-147.9"></polyline>
<text text-anchor="middle" x="174.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="184.61,-123.1 184.61,-147.9"></polyline>
<text text-anchor="middle" x="194.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="204.11,-123.1 204.11,-147.9"></polyline>
<text text-anchor="middle" x="213.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="223.61,-123.1 223.61,-147.9"></polyline>
<text text-anchor="middle" x="233.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="243.11,-123.1 243.11,-147.9"></polyline>
<text text-anchor="middle" x="252.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="262.61,-123.1 262.61,-147.9"></polyline>
<text text-anchor="middle" x="272.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="282.11,-123.1 282.11,-147.9"></polyline>
<text text-anchor="middle" x="291.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge5" class="edge">
<title>stack:f1-&gt;heap1:f2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M174.67,-122.6C174.67,-102.05 145.67,-107.15 145.67,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge6" class="edge">
<title>stack:f2-&gt;heap1:f4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M194.67,-122.6C194.67,-102.05 223.67,-107.15 223.67,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>To do a collection, the GC first starts from all non-heap
references (e.g. the <code>STACK</code> references above) often called &quot;GC roots&quot;. It then traces
the graph of references, highlighted red below:</p>
</div>
<center>
<svg width="546px" height="156px" viewBox="0.00 0.00 546.44 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 542.44,-152.4 542.44,4 -4,4"></polygon>
<!-- heap1 -->
<g id="node1" class="node">
<title>heap1</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 305.33,-86.1 305.33,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="29.77" y="-69.5" font-family="Times,serif" font-size="14.00">HALF1</text>
<polyline fill="none" stroke="black" points="59.55,-61.3 59.55,-86.1"></polyline>
<text text-anchor="middle" x="76.88" y="-69.5" font-family="Times,serif" font-size="14.00">foo</text>
<polyline fill="none" stroke="black" points="94.21,-61.3 94.21,-86.1"></polyline>
<text text-anchor="middle" x="111.15" y="-69.5" font-family="Times,serif" font-size="14.00">bar</text>
<polyline fill="none" stroke="black" points="128.08,-61.3 128.08,-86.1"></polyline>
<text text-anchor="middle" x="146.58" y="-69.5" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="165.08,-61.3 165.08,-86.1"></polyline>
<text text-anchor="middle" x="182.8" y="-69.5" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="200.51,-61.3 200.51,-86.1"></polyline>
<text text-anchor="middle" x="223.67" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="246.83,-61.3 246.83,-86.1"></polyline>
<text text-anchor="middle" x="256.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="266.33,-61.3 266.33,-86.1"></polyline>
<text text-anchor="middle" x="276.08" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="285.83,-61.3 285.83,-86.1"></polyline>
<text text-anchor="middle" x="295.58" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap1&#45;&gt;heap1 -->
<g id="edge1" class="edge">
<title>heap1:s-&gt;heap1:s</title>
<path fill="none" stroke="black" d="M76.67,-61.7C67.67,-50.8 67.67,-30.8 93.67,-30.8 113.37,-30.8 118.14,-42.29 115.38,-52.59"></path>
<polygon fill="black" stroke="black" points="112.16,-51.21 110.67,-61.7 118.37,-54.43 112.16,-51.21"></polygon>
</g>
<!-- heap1&#45;&gt;heap1 -->
<g id="edge2" class="edge">
<title>heap1:s-&gt;heap1:s</title>
<path fill="none" stroke="black" d="M76.67,-61.7C67.67,-50.8 67.67,-30.8 111.67,-30.8 145.01,-30.8 153.09,-42.29 151.13,-52.59"></path>
<polygon fill="black" stroke="black" points="147.92,-51.18 146.67,-61.7 154.21,-54.26 147.92,-51.18"></polygon>
</g>
<!-- heap1&#45;&gt;heap1 -->
<g id="edge3" class="edge">
<title>heap1:n-&gt;heap1:n</title>
<path fill="none" stroke="red" stroke-width="3" d="M146.67,-85.7C137.67,-96.6 137.67,-116.6 164.67,-116.6 185.13,-116.6 190.08,-105.11 187.37,-94.81"></path>
<polygon fill="red" stroke="red" stroke-width="3" points="190.36,-92.98 182.67,-85.7 184.14,-96.19 190.36,-92.98"></polygon>
</g>
<!-- alloc -->
<g id="node3" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="300.57,-24.7 212.76,-24.7 212.76,-0.1 300.57,-0.1 300.57,-24.7"></polygon>
<text text-anchor="middle" x="256.67" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap1&#45;&gt;alloc -->
<g id="edge4" class="edge">
<title>heap1:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M256.67,-50.67C256.67,-42.05 256.67,-36.8 256.67,-24.8"></path>
<polygon fill="black" stroke="black" points="253.17,-50.8 256.67,-60.8 260.17,-50.8 253.17,-50.8"></polygon>
</g>
<!-- heap2 -->
<g id="node2" class="node">
<title>heap2</title>
<polygon fill="white" stroke="black" points="322.89,-61.3 322.89,-86.1 538.44,-86.1 538.44,-61.3 322.89,-61.3"></polygon>
<text text-anchor="middle" x="352.67" y="-69.5" font-family="Times,serif" font-size="14.00">HALF2</text>
<polyline fill="none" stroke="black" points="382.44,-61.3 382.44,-86.1"></polyline>
<text text-anchor="middle" x="392.19" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="401.94,-61.3 401.94,-86.1"></polyline>
<text text-anchor="middle" x="411.69" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="421.44,-61.3 421.44,-86.1"></polyline>
<text text-anchor="middle" x="431.19" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="440.94,-61.3 440.94,-86.1"></polyline>
<text text-anchor="middle" x="450.69" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="460.44,-61.3 460.44,-86.1"></polyline>
<text text-anchor="middle" x="470.19" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="479.94,-61.3 479.94,-86.1"></polyline>
<text text-anchor="middle" x="489.69" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="499.44,-61.3 499.44,-86.1"></polyline>
<text text-anchor="middle" x="509.19" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="518.94,-61.3 518.94,-86.1"></polyline>
<text text-anchor="middle" x="528.69" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- GC -->
<g id="node4" class="node">
<title>GC</title>
<polygon fill="white" stroke="black" points="356.61,-147.8 320.72,-147.8 320.72,-123.2 356.61,-123.2 356.61,-147.8"></polygon>
<text text-anchor="middle" x="338.67" y="-131.3" font-family="Times,serif" font-size="14.00">GC</text>
</g>
<!-- stack -->
<g id="node5" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="84.72,-123.1 84.72,-147.9 302.61,-147.9 302.61,-123.1 84.72,-123.1"></polygon>
<text text-anchor="middle" x="115.67" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="146.61,-123.1 146.61,-147.9"></polyline>
<text text-anchor="middle" x="156.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="166.11,-123.1 166.11,-147.9"></polyline>
<text text-anchor="middle" x="175.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="185.61,-123.1 185.61,-147.9"></polyline>
<text text-anchor="middle" x="195.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="205.11,-123.1 205.11,-147.9"></polyline>
<text text-anchor="middle" x="214.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="224.61,-123.1 224.61,-147.9"></polyline>
<text text-anchor="middle" x="234.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="244.11,-123.1 244.11,-147.9"></polyline>
<text text-anchor="middle" x="253.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="263.61,-123.1 263.61,-147.9"></polyline>
<text text-anchor="middle" x="273.36" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="283.11,-123.1 283.11,-147.9"></polyline>
<text text-anchor="middle" x="292.86" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge5" class="edge">
<title>stack:f1-&gt;heap1:f2</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M175.67,-122.6C175.67,-102.05 146.67,-107.15 146.67,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge6" class="edge">
<title>stack:f2-&gt;heap1:f4</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M195.67,-122.6C195.67,-102.33 223.67,-106.87 223.67,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>Here, we can see that <code>foo</code> is not referenced (&quot;garbage&quot;), <code>qux</code> and <code>new1</code> are referenced directly from the
<code>STACK</code>, and <code>baz</code> is referenced indirectly from <code>qux</code>. <code>bar</code> is referenced by <code>foo</code>, but
because <code>foo</code> is itself garbage we can count <code>bar</code> as garbage as well.</p>
</div>
<div class="paragraph">
<p>We then copy all objects we traced (often called the <em>live-set</em>) from <code>HALF1</code> to <code>HALF2</code>, adjust all the references
appropriately. Now <code>HALF2</code> is the half of the heap in use, and <code>HALF1</code> can be reset to empty.</p>
</div>
<center>
<svg width="518px" height="156px" viewBox="0.00 0.00 517.67 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 513.67,-152.4 513.67,4 -4,4"></polygon>
<!-- heap1 -->
<g id="node1" class="node">
<title>heap1</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 215.55,-86.1 215.55,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="29.77" y="-69.5" font-family="Times,serif" font-size="14.00">HALF1</text>
<polyline fill="none" stroke="black" points="59.55,-61.3 59.55,-86.1"></polyline>
<text text-anchor="middle" x="69.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="79.05,-61.3 79.05,-86.1"></polyline>
<text text-anchor="middle" x="88.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="98.55,-61.3 98.55,-86.1"></polyline>
<text text-anchor="middle" x="108.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="118.05,-61.3 118.05,-86.1"></polyline>
<text text-anchor="middle" x="127.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="137.55,-61.3 137.55,-86.1"></polyline>
<text text-anchor="middle" x="147.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="157.05,-61.3 157.05,-86.1"></polyline>
<text text-anchor="middle" x="166.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="176.55,-61.3 176.55,-86.1"></polyline>
<text text-anchor="middle" x="186.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="196.05,-61.3 196.05,-86.1"></polyline>
<text text-anchor="middle" x="205.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap2 -->
<g id="node2" class="node">
<title>heap2</title>
<polygon fill="white" stroke="black" points="233.87,-61.3 233.87,-86.1 509.67,-86.1 509.67,-61.3 233.87,-61.3"></polygon>
<text text-anchor="middle" x="263.65" y="-69.5" font-family="Times,serif" font-size="14.00">HALF2</text>
<polyline fill="none" stroke="black" points="293.42,-61.3 293.42,-86.1"></polyline>
<text text-anchor="middle" x="311.92" y="-69.5" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="330.42,-61.3 330.42,-86.1"></polyline>
<text text-anchor="middle" x="348.14" y="-69.5" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="365.85,-61.3 365.85,-86.1"></polyline>
<text text-anchor="middle" x="389.01" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="412.17,-61.3 412.17,-86.1"></polyline>
<text text-anchor="middle" x="421.92" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="431.67,-61.3 431.67,-86.1"></polyline>
<text text-anchor="middle" x="441.42" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="451.17,-61.3 451.17,-86.1"></polyline>
<text text-anchor="middle" x="460.92" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="470.67,-61.3 470.67,-86.1"></polyline>
<text text-anchor="middle" x="480.42" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="490.17,-61.3 490.17,-86.1"></polyline>
<text text-anchor="middle" x="499.92" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap2&#45;&gt;heap2 -->
<g id="edge1" class="edge">
<title>heap2:s-&gt;heap2:s</title>
<path fill="none" stroke="red" stroke-width="3" d="M311.77,-61.7C302.77,-50.8 302.77,-30.8 329.77,-30.8 350.24,-30.8 355.19,-42.29 352.47,-52.59"></path>
<polygon fill="red" stroke="red" stroke-width="3" points="349.25,-51.21 347.77,-61.7 355.47,-54.42 349.25,-51.21"></polygon>
</g>
<!-- alloc -->
<g id="node3" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="432.68,-24.7 344.87,-24.7 344.87,-0.1 432.68,-0.1 432.68,-24.7"></polygon>
<text text-anchor="middle" x="388.77" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap2&#45;&gt;alloc -->
<g id="edge2" class="edge">
<title>heap2:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M388.77,-50.67C388.77,-42.05 388.77,-36.8 388.77,-24.8"></path>
<polygon fill="black" stroke="black" points="385.27,-50.8 388.77,-60.8 392.27,-50.8 385.27,-50.8"></polygon>
</g>
<!-- stack -->
<g id="node4" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="268.83,-123.1 268.83,-147.9 486.72,-147.9 486.72,-123.1 268.83,-123.1"></polygon>
<text text-anchor="middle" x="299.77" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="330.72,-123.1 330.72,-147.9"></polyline>
<text text-anchor="middle" x="340.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="350.22,-123.1 350.22,-147.9"></polyline>
<text text-anchor="middle" x="359.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="369.72,-123.1 369.72,-147.9"></polyline>
<text text-anchor="middle" x="379.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="389.22,-123.1 389.22,-147.9"></polyline>
<text text-anchor="middle" x="398.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="408.72,-123.1 408.72,-147.9"></polyline>
<text text-anchor="middle" x="418.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="428.22,-123.1 428.22,-147.9"></polyline>
<text text-anchor="middle" x="437.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="447.72,-123.1 447.72,-147.9"></polyline>
<text text-anchor="middle" x="457.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="467.22,-123.1 467.22,-147.9"></polyline>
<text text-anchor="middle" x="476.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge3" class="edge">
<title>stack:f0-&gt;heap2:f0</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M340.77,-122.6C340.77,-102.05 311.77,-107.15 311.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge4" class="edge">
<title>stack:f1-&gt;heap2:f2</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M359.77,-122.6C359.77,-102.05 388.77,-107.15 388.77,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>This collection has free up 5 slots, so we now have space to allocate the
4 <code>new2</code> to <code>new5</code> objects we wanted (green) starting from our <code>free-memory</code> pointer:</p>
</div>
<center>
<svg width="659px" height="156px" viewBox="0.00 0.00 658.73 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 654.73,-152.4 654.73,4 -4,4"></polygon>
<!-- heap1 -->
<g id="node1" class="node">
<title>heap1</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 215.55,-86.1 215.55,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="29.77" y="-69.5" font-family="Times,serif" font-size="14.00">HALF1</text>
<polyline fill="none" stroke="black" points="59.55,-61.3 59.55,-86.1"></polyline>
<text text-anchor="middle" x="69.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="79.05,-61.3 79.05,-86.1"></polyline>
<text text-anchor="middle" x="88.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="98.55,-61.3 98.55,-86.1"></polyline>
<text text-anchor="middle" x="108.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="118.05,-61.3 118.05,-86.1"></polyline>
<text text-anchor="middle" x="127.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="137.55,-61.3 137.55,-86.1"></polyline>
<text text-anchor="middle" x="147.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="157.05,-61.3 157.05,-86.1"></polyline>
<text text-anchor="middle" x="166.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="176.55,-61.3 176.55,-86.1"></polyline>
<text text-anchor="middle" x="186.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="196.05,-61.3 196.05,-86.1"></polyline>
<text text-anchor="middle" x="205.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap2 -->
<g id="node2" class="node">
<title>heap2</title>
<polygon fill="white" stroke="black" points="233.23,-61.3 233.23,-86.1 616.32,-86.1 616.32,-61.3 233.23,-61.3"></polygon>
<text text-anchor="middle" x="263.01" y="-69.5" font-family="Times,serif" font-size="14.00">HALF2</text>
<polyline fill="none" stroke="black" points="292.78,-61.3 292.78,-86.1"></polyline>
<text text-anchor="middle" x="311.28" y="-69.5" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="329.78,-61.3 329.78,-86.1"></polyline>
<text text-anchor="middle" x="347.5" y="-69.5" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="365.21,-61.3 365.21,-86.1"></polyline>
<text text-anchor="middle" x="388.37" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="411.53,-61.3 411.53,-86.1"></polyline>
<text text-anchor="middle" x="434.69" y="-69.5" font-family="Times,serif" font-size="14.00">new2</text>
<polyline fill="none" stroke="black" points="457.85,-61.3 457.85,-86.1"></polyline>
<text text-anchor="middle" x="481.01" y="-69.5" font-family="Times,serif" font-size="14.00">new3</text>
<polyline fill="none" stroke="black" points="504.17,-61.3 504.17,-86.1"></polyline>
<text text-anchor="middle" x="527.33" y="-69.5" font-family="Times,serif" font-size="14.00">new4</text>
<polyline fill="none" stroke="black" points="550.49,-61.3 550.49,-86.1"></polyline>
<text text-anchor="middle" x="573.66" y="-69.5" font-family="Times,serif" font-size="14.00">new5</text>
<polyline fill="none" stroke="black" points="596.82,-61.3 596.82,-86.1"></polyline>
<text text-anchor="middle" x="606.57" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap2&#45;&gt;heap2 -->
<g id="edge1" class="edge">
<title>heap2:s-&gt;heap2:s</title>
<path fill="none" stroke="black" d="M311.77,-61.7C302.77,-50.8 302.77,-30.8 329.77,-30.8 350.24,-30.8 355.19,-42.29 352.47,-52.59"></path>
<polygon fill="black" stroke="black" points="349.25,-51.21 347.77,-61.7 355.47,-54.42 349.25,-51.21"></polygon>
</g>
<!-- alloc -->
<g id="node3" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="650.68,-24.7 562.87,-24.7 562.87,-0.1 650.68,-0.1 650.68,-24.7"></polygon>
<text text-anchor="middle" x="606.77" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap2&#45;&gt;alloc -->
<g id="edge2" class="edge">
<title>heap2:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M606.77,-50.67C606.77,-42.05 606.77,-36.8 606.77,-24.8"></path>
<polygon fill="black" stroke="black" points="603.27,-50.8 606.77,-60.8 610.27,-50.8 603.27,-50.8"></polygon>
</g>
<!-- stack -->
<g id="node4" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="336.83,-123.1 336.83,-147.9 554.72,-147.9 554.72,-123.1 336.83,-123.1"></polygon>
<text text-anchor="middle" x="367.77" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="398.72,-123.1 398.72,-147.9"></polyline>
<text text-anchor="middle" x="408.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="418.22,-123.1 418.22,-147.9"></polyline>
<text text-anchor="middle" x="427.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="437.72,-123.1 437.72,-147.9"></polyline>
<text text-anchor="middle" x="447.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="457.22,-123.1 457.22,-147.9"></polyline>
<text text-anchor="middle" x="466.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="476.72,-123.1 476.72,-147.9"></polyline>
<text text-anchor="middle" x="486.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="496.22,-123.1 496.22,-147.9"></polyline>
<text text-anchor="middle" x="505.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="515.72,-123.1 515.72,-147.9"></polyline>
<text text-anchor="middle" x="525.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="535.22,-123.1 535.22,-147.9"></polyline>
<text text-anchor="middle" x="544.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge3" class="edge">
<title>stack:f0-&gt;heap2:f0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M408.77,-122.6C408.77,-76.62 311.77,-132.58 311.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge4" class="edge">
<title>stack:f1-&gt;heap2:f2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M427.77,-122.6C427.77,-99.01 388.77,-110.19 388.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge5" class="edge">
<title>stack:f2-&gt;heap2:f3</title>
<path fill="none" stroke="green" stroke-width="3" stroke-dasharray="5,2" d="M447.77,-122.6C447.77,-105.59 434.77,-103.61 434.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge6" class="edge">
<title>stack:f3-&gt;heap2:f4</title>
<path fill="none" stroke="green" stroke-width="3" stroke-dasharray="5,2" d="M466.77,-122.6C466.77,-105.43 480.77,-103.77 480.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge7" class="edge">
<title>stack:f4-&gt;heap2:f5</title>
<path fill="none" stroke="green" stroke-width="3" stroke-dasharray="5,2" d="M486.77,-122.6C486.77,-98.35 527.77,-110.85 527.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge8" class="edge">
<title>stack:f5-&gt;heap2:f6</title>
<path fill="none" stroke="green" stroke-width="3" stroke-dasharray="5,2" d="M505.77,-122.6C505.77,-88.4 573.77,-120.8 573.77,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>You may notice that the objects <code>foo</code> and <code>bar</code> disappeared. This is because <code>foo</code> and <code>bar</code>
were not referenced directly or indirectly by any GC roots: they were unreachable, and thus
considered &quot;garbage&quot;. These garbage objects were
not explicitly deleted, but  simply did not get copied over from <code>HALF1</code> to <code>HALF2</code>
during collection, and thus was wiped out when <code>HALF1</code> was cleared.</p>
</div>
<div class="paragraph">
<p>As your program executes, the methods actively running may change, and thus the references
(both from stack to heap and within entries on your heap) may change. For example, we may
stop referencing <code>qux</code>, which also means that <code>baz</code> is now unreachable:</p>
</div>
<center>
<svg width="659px" height="156px" viewBox="0.00 0.00 658.73 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 654.73,-152.4 654.73,4 -4,4"></polygon>
<!-- heap1 -->
<g id="node1" class="node">
<title>heap1</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 215.55,-86.1 215.55,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="29.77" y="-69.5" font-family="Times,serif" font-size="14.00">HALF1</text>
<polyline fill="none" stroke="black" points="59.55,-61.3 59.55,-86.1"></polyline>
<text text-anchor="middle" x="69.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="79.05,-61.3 79.05,-86.1"></polyline>
<text text-anchor="middle" x="88.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="98.55,-61.3 98.55,-86.1"></polyline>
<text text-anchor="middle" x="108.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="118.05,-61.3 118.05,-86.1"></polyline>
<text text-anchor="middle" x="127.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="137.55,-61.3 137.55,-86.1"></polyline>
<text text-anchor="middle" x="147.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="157.05,-61.3 157.05,-86.1"></polyline>
<text text-anchor="middle" x="166.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="176.55,-61.3 176.55,-86.1"></polyline>
<text text-anchor="middle" x="186.3" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="196.05,-61.3 196.05,-86.1"></polyline>
<text text-anchor="middle" x="205.8" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap2 -->
<g id="node2" class="node">
<title>heap2</title>
<polygon fill="white" stroke="black" points="233.23,-61.3 233.23,-86.1 616.32,-86.1 616.32,-61.3 233.23,-61.3"></polygon>
<text text-anchor="middle" x="263.01" y="-69.5" font-family="Times,serif" font-size="14.00">HALF2</text>
<polyline fill="none" stroke="black" points="292.78,-61.3 292.78,-86.1"></polyline>
<text text-anchor="middle" x="311.28" y="-69.5" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="329.78,-61.3 329.78,-86.1"></polyline>
<text text-anchor="middle" x="347.5" y="-69.5" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="365.21,-61.3 365.21,-86.1"></polyline>
<text text-anchor="middle" x="388.37" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="411.53,-61.3 411.53,-86.1"></polyline>
<text text-anchor="middle" x="434.69" y="-69.5" font-family="Times,serif" font-size="14.00">new2</text>
<polyline fill="none" stroke="black" points="457.85,-61.3 457.85,-86.1"></polyline>
<text text-anchor="middle" x="481.01" y="-69.5" font-family="Times,serif" font-size="14.00">new3</text>
<polyline fill="none" stroke="black" points="504.17,-61.3 504.17,-86.1"></polyline>
<text text-anchor="middle" x="527.33" y="-69.5" font-family="Times,serif" font-size="14.00">new4</text>
<polyline fill="none" stroke="black" points="550.49,-61.3 550.49,-86.1"></polyline>
<text text-anchor="middle" x="573.66" y="-69.5" font-family="Times,serif" font-size="14.00">new5</text>
<polyline fill="none" stroke="black" points="596.82,-61.3 596.82,-86.1"></polyline>
<text text-anchor="middle" x="606.57" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap2&#45;&gt;heap2 -->
<g id="edge1" class="edge">
<title>heap2:s-&gt;heap2:s</title>
<path fill="none" stroke="black" d="M311.77,-61.7C302.77,-50.8 302.77,-30.8 329.77,-30.8 350.24,-30.8 355.19,-42.29 352.47,-52.59"></path>
<polygon fill="black" stroke="black" points="349.25,-51.21 347.77,-61.7 355.47,-54.42 349.25,-51.21"></polygon>
</g>
<!-- alloc -->
<g id="node3" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="650.68,-24.7 562.87,-24.7 562.87,-0.1 650.68,-0.1 650.68,-24.7"></polygon>
<text text-anchor="middle" x="606.77" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap2&#45;&gt;alloc -->
<g id="edge2" class="edge">
<title>heap2:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M606.77,-50.67C606.77,-42.05 606.77,-36.8 606.77,-24.8"></path>
<polygon fill="black" stroke="black" points="603.27,-50.8 606.77,-60.8 610.27,-50.8 603.27,-50.8"></polygon>
</g>
<!-- stack -->
<g id="node4" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="350.83,-123.1 350.83,-147.9 568.72,-147.9 568.72,-123.1 350.83,-123.1"></polygon>
<text text-anchor="middle" x="381.77" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="412.72,-123.1 412.72,-147.9"></polyline>
<text text-anchor="middle" x="422.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="432.22,-123.1 432.22,-147.9"></polyline>
<text text-anchor="middle" x="441.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="451.72,-123.1 451.72,-147.9"></polyline>
<text text-anchor="middle" x="461.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="471.22,-123.1 471.22,-147.9"></polyline>
<text text-anchor="middle" x="480.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="490.72,-123.1 490.72,-147.9"></polyline>
<text text-anchor="middle" x="500.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="510.22,-123.1 510.22,-147.9"></polyline>
<text text-anchor="middle" x="519.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="529.72,-123.1 529.72,-147.9"></polyline>
<text text-anchor="middle" x="539.47" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="549.22,-123.1 549.22,-147.9"></polyline>
<text text-anchor="middle" x="558.97" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge3" class="edge">
<title>stack:f1-&gt;heap2:f2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M441.77,-122.6C441.77,-94.12 388.77,-115.08 388.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge4" class="edge">
<title>stack:f2-&gt;heap2:f3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M461.77,-122.6C461.77,-102.6 434.77,-106.6 434.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge5" class="edge">
<title>stack:f3-&gt;heap2:f4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M480.77,-122.6C480.77,-106.6 480.77,-102.6 480.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge6" class="edge">
<title>stack:f4-&gt;heap2:f5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M500.77,-122.6C500.77,-102.6 527.77,-106.6 527.77,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap2 -->
<g id="edge7" class="edge">
<title>stack:f5-&gt;heap2:f6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M519.77,-122.6C519.77,-93.76 573.77,-115.44 573.77,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>Although <code>qux</code> and <code>baz</code> are now &quot;garbage&quot;, they still take up space in the heap. Thus, if we want
to allocate two new objects (e.g. <code>new6</code> and <code>new7</code>), and there is only one slot left on the heap (above),
we need to repeat the garbage collection process: tracing
the objects transitively reachable (<code>qux</code>, <code>bax</code>, <code>new1</code>, <code>new4</code>, <code>new5</code>), copying them
from <code>HALF2</code> to <code>HALF1</code>,
adjusting any references to now use <code>HALF1</code> as the new heap, and clearing anything that was left
behind in <code>HALF2</code>. This then gives us enough space to allocate <code>new6</code> and <code>new7</code> (below in green):</p>
</div>
<center>
<svg width="644px" height="156px" viewBox="0.00 0.00 644.42 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 640.42,-152.4 640.42,4 -4,4"></polygon>
<!-- heap1 -->
<g id="node1" class="node">
<title>heap1</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 403.3,-86.1 403.3,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="29.77" y="-69.5" font-family="Times,serif" font-size="14.00">HALF1</text>
<polyline fill="none" stroke="black" points="59.55,-61.3 59.55,-86.1"></polyline>
<text text-anchor="middle" x="82.71" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="105.87,-61.3 105.87,-86.1"></polyline>
<text text-anchor="middle" x="129.03" y="-69.5" font-family="Times,serif" font-size="14.00">new2</text>
<polyline fill="none" stroke="black" points="152.19,-61.3 152.19,-86.1"></polyline>
<text text-anchor="middle" x="175.35" y="-69.5" font-family="Times,serif" font-size="14.00">new3</text>
<polyline fill="none" stroke="black" points="198.51,-61.3 198.51,-86.1"></polyline>
<text text-anchor="middle" x="221.67" y="-69.5" font-family="Times,serif" font-size="14.00">new4</text>
<polyline fill="none" stroke="black" points="244.83,-61.3 244.83,-86.1"></polyline>
<text text-anchor="middle" x="267.99" y="-69.5" font-family="Times,serif" font-size="14.00">new5</text>
<polyline fill="none" stroke="black" points="291.15,-61.3 291.15,-86.1"></polyline>
<text text-anchor="middle" x="314.31" y="-69.5" font-family="Times,serif" font-size="14.00">new6</text>
<polyline fill="none" stroke="black" points="337.48,-61.3 337.48,-86.1"></polyline>
<text text-anchor="middle" x="360.64" y="-69.5" font-family="Times,serif" font-size="14.00">new7</text>
<polyline fill="none" stroke="black" points="383.8,-61.3 383.8,-86.1"></polyline>
<text text-anchor="middle" x="393.55" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- alloc -->
<g id="node4" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="437.56,-24.7 349.74,-24.7 349.74,-0.1 437.56,-0.1 437.56,-24.7"></polygon>
<text text-anchor="middle" x="393.65" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap1&#45;&gt;alloc -->
<g id="edge8" class="edge">
<title>heap1:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M393.65,-50.67C393.65,-42.05 393.65,-36.8 393.65,-24.8"></path>
<polygon fill="black" stroke="black" points="390.15,-50.8 393.65,-60.8 397.15,-50.8 390.15,-50.8"></polygon>
</g>
<!-- heap2 -->
<g id="node2" class="node">
<title>heap2</title>
<polygon fill="white" stroke="black" points="420.87,-61.3 420.87,-86.1 636.42,-86.1 636.42,-61.3 420.87,-61.3"></polygon>
<text text-anchor="middle" x="450.65" y="-69.5" font-family="Times,serif" font-size="14.00">HALF2</text>
<polyline fill="none" stroke="black" points="480.42,-61.3 480.42,-86.1"></polyline>
<text text-anchor="middle" x="490.17" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="499.92,-61.3 499.92,-86.1"></polyline>
<text text-anchor="middle" x="509.67" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="519.42,-61.3 519.42,-86.1"></polyline>
<text text-anchor="middle" x="529.17" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="538.92,-61.3 538.92,-86.1"></polyline>
<text text-anchor="middle" x="548.67" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="558.42,-61.3 558.42,-86.1"></polyline>
<text text-anchor="middle" x="568.17" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="577.92,-61.3 577.92,-86.1"></polyline>
<text text-anchor="middle" x="587.67" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="597.42,-61.3 597.42,-86.1"></polyline>
<text text-anchor="middle" x="607.17" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="616.92,-61.3 616.92,-86.1"></polyline>
<text text-anchor="middle" x="626.67" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack -->
<g id="node3" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="91.71,-123.1 91.71,-147.9 309.59,-147.9 309.59,-123.1 91.71,-123.1"></polygon>
<text text-anchor="middle" x="122.65" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="153.59,-123.1 153.59,-147.9"></polyline>
<text text-anchor="middle" x="163.34" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="173.09,-123.1 173.09,-147.9"></polyline>
<text text-anchor="middle" x="182.84" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="192.59,-123.1 192.59,-147.9"></polyline>
<text text-anchor="middle" x="202.34" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="212.09,-123.1 212.09,-147.9"></polyline>
<text text-anchor="middle" x="221.84" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="231.59,-123.1 231.59,-147.9"></polyline>
<text text-anchor="middle" x="241.34" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="251.09,-123.1 251.09,-147.9"></polyline>
<text text-anchor="middle" x="260.84" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="270.59,-123.1 270.59,-147.9"></polyline>
<text text-anchor="middle" x="280.34" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="290.09,-123.1 290.09,-147.9"></polyline>
<text text-anchor="middle" x="299.84" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge1" class="edge">
<title>stack:f0-&gt;heap1:f0</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M163.65,-122.6C163.65,-83.2 82.65,-126 82.65,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge2" class="edge">
<title>stack:f1-&gt;heap1:f1</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M182.65,-122.6C182.65,-93.76 128.65,-115.44 128.65,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge3" class="edge">
<title>stack:f2-&gt;heap1:f2</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M202.65,-122.6C202.65,-102.6 175.65,-106.6 175.65,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge4" class="edge">
<title>stack:f3-&gt;heap1:f3</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M221.65,-122.6C221.65,-106.6 221.65,-102.6 221.65,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge5" class="edge">
<title>stack:f4-&gt;heap1:f4</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M241.65,-122.6C241.65,-102.86 267.65,-106.34 267.65,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge6" class="edge">
<title>stack:f5-&gt;heap1:f5</title>
<path fill="none" stroke="green" stroke-width="3" stroke-dasharray="5,2" d="M260.65,-122.6C260.65,-93.76 314.65,-115.44 314.65,-86.6"></path>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge7" class="edge">
<title>stack:f6-&gt;heap1:f6</title>
<path fill="none" stroke="green" stroke-width="3" stroke-dasharray="5,2" d="M280.65,-122.6C280.65,-83.61 360.65,-125.59 360.65,-86.6"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>This process can repeat as many times as necessary: as long as there are <em>some</em> objects
that are unreachable, you can run a collection and copy the &quot;live&quot; objects to the other
half of the heap, freeing up some space to allocate new objects. The only reason this
may fail is that if you run a collection and there <em>still</em> isn’t enough space to allocate
the objects you want; that means your program  has run out of memory, and will fail with
an <code>OutOfMemoryError</code> or similar.</p>
</div>
<div class="paragraph">
<p>Even this simplistic GC has a lot of interesting properties, and you may have heard these
terms or labels that can apply to it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>semi-space</strong> garbage collector, because of the way it splits the heap into two halves</p>
</li>
<li>
<p><strong>copying</strong> garbage collector, because it needs to copy the heap objects back and forth
between <code>HALF1</code> and <code>HALF2</code></p>
</li>
<li>
<p><strong>tracing</strong> garbage collector, because of the way it traverses the graph of heap
references in order to decide what to copy.</p>
</li>
<li>
<p><strong>stop the world</strong> garbage collector, because while this whole trace-copy-update-references
workflow is happening, we have to stop the program to avoid race conditions between the garbage
collector and the program code.</p>
</li>
<li>
<p><strong>compacting</strong> garbage collector, because every time we run a GC, we copy everything to the
left-most memory, avoiding the memory fragmentation that occurs with other memory
management techniques such as <a href="https://en.wikipedia.org/wiki/Reference_counting">Reference Counting</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most modern GCs are considerably more complicated than this: e.g. they may have optimizations
to avoid wasting half the heap by leaving it empty, or they may have
<a href="#_generational_optimizations">optimizations for handling short-lived objects</a>, but at
their heart this is still what they do. And understanding the performance characteristics of
this simple, naive GC can help give you an intuition in how GCs compare to other memory management
strategies, and how modern GCs behave in terms of performance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compared_to_reference_counting"><a class="anchor" href="#_compared_to_reference_counting"></a>Compared to Reference Counting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a few major advantages that tracing garbage collector has over
<a href="https://en.wikipedia.org/wiki/Reference_counting">Reference Counting</a>, another popular
memory management strategy. Reference counting works by counting how many incoming
references each object has, and when that number reaches zero the object can be collected.
This approach has a few major differences from that of a tracing GC. We discuss a few of
them below:</p>
</div>
<div class="sect2">
<h3 id="_reference_counting_does_not_compact_the_heap"><a class="anchor" href="#_reference_counting_does_not_compact_the_heap"></a>Reference counting does not compact the heap</h3>
<div class="paragraph">
<p>Program that use reference
counting tend to find their heap getting more and more fragmented over time
We can see this in the heap diagrams: the tracing garbage collector heaps above always had a
single block of empty space to the right, and had the <code>new</code> objects allocated in ascending order
from left-to-right:</p>
</div>
<center>
<svg width="560px" height="156px" viewBox="0.00 0.00 560.30 156.40" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 152.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-152.4 556.3,-152.4 556.3,4 -4,4"></polygon>
<!-- heap1 -->
<g id="node1" class="node">
<title>heap1</title>
<polygon fill="white" stroke="black" points="0,-61.3 0,-86.1 552.3,-86.1 552.3,-61.3 0,-61.3"></polygon>
<text text-anchor="middle" x="26.27" y="-69.5" font-family="Times,serif" font-size="14.00">HEAP</text>
<polyline fill="none" stroke="black" points="52.55,-61.3 52.55,-86.1"></polyline>
<text text-anchor="middle" x="75.71" y="-69.5" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="98.87,-61.3 98.87,-86.1"></polyline>
<text text-anchor="middle" x="122.03" y="-69.5" font-family="Times,serif" font-size="14.00">new2</text>
<polyline fill="none" stroke="black" points="145.19,-61.3 145.19,-86.1"></polyline>
<text text-anchor="middle" x="168.35" y="-69.5" font-family="Times,serif" font-size="14.00">new3</text>
<polyline fill="none" stroke="black" points="191.51,-61.3 191.51,-86.1"></polyline>
<text text-anchor="middle" x="214.67" y="-69.5" font-family="Times,serif" font-size="14.00">new4</text>
<polyline fill="none" stroke="black" points="237.83,-61.3 237.83,-86.1"></polyline>
<text text-anchor="middle" x="260.99" y="-69.5" font-family="Times,serif" font-size="14.00">new5</text>
<polyline fill="none" stroke="black" points="284.15,-61.3 284.15,-86.1"></polyline>
<text text-anchor="middle" x="307.31" y="-69.5" font-family="Times,serif" font-size="14.00">new6</text>
<polyline fill="none" stroke="black" points="330.48,-61.3 330.48,-86.1"></polyline>
<text text-anchor="middle" x="353.64" y="-69.5" font-family="Times,serif" font-size="14.00">new7</text>
<polyline fill="none" stroke="black" points="376.8,-61.3 376.8,-86.1"></polyline>
<text text-anchor="middle" x="386.55" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="396.3,-61.3 396.3,-86.1"></polyline>
<text text-anchor="middle" x="406.05" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="415.8,-61.3 415.8,-86.1"></polyline>
<text text-anchor="middle" x="425.55" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="435.3,-61.3 435.3,-86.1"></polyline>
<text text-anchor="middle" x="445.05" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="454.8,-61.3 454.8,-86.1"></polyline>
<text text-anchor="middle" x="464.55" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="474.3,-61.3 474.3,-86.1"></polyline>
<text text-anchor="middle" x="484.05" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="493.8,-61.3 493.8,-86.1"></polyline>
<text text-anchor="middle" x="503.55" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="513.3,-61.3 513.3,-86.1"></polyline>
<text text-anchor="middle" x="523.05" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="532.8,-61.3 532.8,-86.1"></polyline>
<text text-anchor="middle" x="542.55" y="-69.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- alloc -->
<g id="node3" class="node">
<title>alloc</title>
<polygon fill="white" stroke="transparent" points="430.06,-24.7 342.24,-24.7 342.24,-0.1 430.06,-0.1 430.06,-24.7"></polygon>
<text text-anchor="middle" x="386.15" y="-8.2" font-family="Times,serif" font-size="14.00">free memory</text>
</g>
<!-- heap1&#45;&gt;alloc -->
<g id="edge8" class="edge">
<title>heap1:s-&gt;alloc:n</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M386.15,-50.67C386.15,-42.05 386.15,-36.8 386.15,-24.8"></path>
<polygon fill="black" stroke="black" points="382.65,-50.8 386.15,-60.8 389.65,-50.8 382.65,-50.8"></polygon>
</g>
<!-- stack -->
<g id="node2" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="85.21,-123.1 85.21,-147.9 303.09,-147.9 303.09,-123.1 85.21,-123.1"></polygon>
<text text-anchor="middle" x="116.15" y="-131.3" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="147.09,-123.1 147.09,-147.9"></polyline>
<text text-anchor="middle" x="156.84" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="166.59,-123.1 166.59,-147.9"></polyline>
<text text-anchor="middle" x="176.34" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="186.09,-123.1 186.09,-147.9"></polyline>
<text text-anchor="middle" x="195.84" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="205.59,-123.1 205.59,-147.9"></polyline>
<text text-anchor="middle" x="215.34" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="225.09,-123.1 225.09,-147.9"></polyline>
<text text-anchor="middle" x="234.84" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="244.59,-123.1 244.59,-147.9"></polyline>
<text text-anchor="middle" x="254.34" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="264.09,-123.1 264.09,-147.9"></polyline>
<text text-anchor="middle" x="273.84" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="283.59,-123.1 283.59,-147.9"></polyline>
<text text-anchor="middle" x="293.34" y="-131.3" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge1" class="edge">
<title>stack:f0-&gt;heap1:f0</title>
<path fill="none" stroke="black" d="M157.15,-122.6C157.15,-87.36 92.33,-117.88 78.66,-96.52"></path>
<polygon fill="black" stroke="black" points="82,-95.43 76.15,-86.6 75.21,-97.15 82,-95.43"></polygon>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge2" class="edge">
<title>stack:f1-&gt;heap1:f1</title>
<path fill="none" stroke="black" d="M176.15,-122.6C176.15,-98.04 136.99,-110.12 125.36,-96.44"></path>
<polygon fill="black" stroke="black" points="128.58,-95.02 122.15,-86.6 121.93,-97.19 128.58,-95.02"></polygon>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge3" class="edge">
<title>stack:f2-&gt;heap1:f2</title>
<path fill="none" stroke="black" d="M196.15,-122.6C196.15,-106.45 178.37,-106.05 171.14,-96.3"></path>
<polygon fill="black" stroke="black" points="174.44,-95.12 168.15,-86.6 167.76,-97.19 174.44,-95.12"></polygon>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge4" class="edge">
<title>stack:f3-&gt;heap1:f3</title>
<path fill="none" stroke="black" d="M215.15,-122.6C215.15,-110.6 215.15,-105.35 215.15,-96.72"></path>
<polygon fill="black" stroke="black" points="218.65,-96.6 215.15,-86.6 211.65,-96.6 218.65,-96.6"></polygon>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge5" class="edge">
<title>stack:f4-&gt;heap1:f4</title>
<path fill="none" stroke="black" d="M235.15,-122.6C235.15,-107.03 251.34,-105.9 258.17,-96.43"></path>
<polygon fill="black" stroke="black" points="261.59,-97.19 261.15,-86.6 254.89,-95.15 261.59,-97.19"></polygon>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge6" class="edge">
<title>stack:f5-&gt;heap1:f5</title>
<path fill="none" stroke="black" d="M254.15,-122.6C254.15,-98.35 292.58,-109.94 303.99,-96.34"></path>
<polygon fill="black" stroke="black" points="307.39,-97.19 307.15,-86.6 300.73,-95.03 307.39,-97.19"></polygon>
</g>
<!-- stack&#45;&gt;heap1 -->
<g id="edge7" class="edge">
<title>stack:f6-&gt;heap1:f6</title>
<path fill="none" stroke="black" d="M274.15,-122.6C274.15,-88.08 337.36,-117.39 350.7,-96.33"></path>
<polygon fill="black" stroke="black" points="354.1,-97.15 353.15,-86.6 347.31,-95.44 354.1,-97.15"></polygon>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>In contrast,
reference counted heaps (e.g. below) tend to get fragmented, with free space scattered about,
and the allocated objects jumbled up in no particular order</p>
</div>
<center>
<svg width="507px" height="96px" viewBox="0.00 0.00 506.65 95.60" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 91.6)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-91.6 502.65,-91.6 502.65,4 -4,4"></polygon>
<!-- heap -->
<g id="node1" class="node">
<title>heap</title>
<polygon fill="white" stroke="black" points="0,-0.5 0,-25.3 498.65,-25.3 498.65,-0.5 0,-0.5"></polygon>
<text text-anchor="middle" x="26.27" y="-8.7" font-family="Times,serif" font-size="14.00">HEAP</text>
<polyline fill="none" stroke="black" points="52.55,-0.5 52.55,-25.3"></polyline>
<text text-anchor="middle" x="75.71" y="-8.7" font-family="Times,serif" font-size="14.00">new2</text>
<polyline fill="none" stroke="black" points="98.87,-0.5 98.87,-25.3"></polyline>
<text text-anchor="middle" x="122.03" y="-8.7" font-family="Times,serif" font-size="14.00">new3</text>
<polyline fill="none" stroke="black" points="145.19,-0.5 145.19,-25.3"></polyline>
<text text-anchor="middle" x="154.94" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="164.69,-0.5 164.69,-25.3"></polyline>
<text text-anchor="middle" x="174.44" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="184.19,-0.5 184.19,-25.3"></polyline>
<text text-anchor="middle" x="207.35" y="-8.7" font-family="Times,serif" font-size="14.00">new1</text>
<polyline fill="none" stroke="black" points="230.51,-0.5 230.51,-25.3"></polyline>
<text text-anchor="middle" x="253.67" y="-8.7" font-family="Times,serif" font-size="14.00">new4</text>
<polyline fill="none" stroke="black" points="276.83,-0.5 276.83,-25.3"></polyline>
<text text-anchor="middle" x="299.99" y="-8.7" font-family="Times,serif" font-size="14.00">new5</text>
<polyline fill="none" stroke="black" points="323.15,-0.5 323.15,-25.3"></polyline>
<text text-anchor="middle" x="332.9" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="342.65,-0.5 342.65,-25.3"></polyline>
<text text-anchor="middle" x="352.4" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="362.15,-0.5 362.15,-25.3"></polyline>
<text text-anchor="middle" x="371.9" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="381.65,-0.5 381.65,-25.3"></polyline>
<text text-anchor="middle" x="391.4" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="401.15,-0.5 401.15,-25.3"></polyline>
<text text-anchor="middle" x="410.9" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="420.65,-0.5 420.65,-25.3"></polyline>
<text text-anchor="middle" x="430.4" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="440.15,-0.5 440.15,-25.3"></polyline>
<text text-anchor="middle" x="449.9" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="459.65,-0.5 459.65,-25.3"></polyline>
<text text-anchor="middle" x="469.4" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="479.15,-0.5 479.15,-25.3"></polyline>
<text text-anchor="middle" x="488.9" y="-8.7" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack -->
<g id="node2" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="96.38,-62.3 96.38,-87.1 314.27,-87.1 314.27,-62.3 96.38,-62.3"></polygon>
<text text-anchor="middle" x="127.33" y="-70.5" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="158.27,-62.3 158.27,-87.1"></polyline>
<text text-anchor="middle" x="168.02" y="-70.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="177.77,-62.3 177.77,-87.1"></polyline>
<text text-anchor="middle" x="187.52" y="-70.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="197.27,-62.3 197.27,-87.1"></polyline>
<text text-anchor="middle" x="207.02" y="-70.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="216.77,-62.3 216.77,-87.1"></polyline>
<text text-anchor="middle" x="226.52" y="-70.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="236.27,-62.3 236.27,-87.1"></polyline>
<text text-anchor="middle" x="246.02" y="-70.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="255.77,-62.3 255.77,-87.1"></polyline>
<text text-anchor="middle" x="265.52" y="-70.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="275.27,-62.3 275.27,-87.1"></polyline>
<text text-anchor="middle" x="285.02" y="-70.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="294.77,-62.3 294.77,-87.1"></polyline>
<text text-anchor="middle" x="304.52" y="-70.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge1" class="edge">
<title>stack:f0-&gt;heap:f0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M168.33,-61.8C168.33,-17.48 75.33,-70.12 75.33,-25.8"></path>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge2" class="edge">
<title>stack:f1-&gt;heap:f1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M187.33,-61.8C187.33,-28.78 122.33,-58.82 122.33,-25.8"></path>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge3" class="edge">
<title>stack:f2-&gt;heap:f4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M207.33,-61.8C207.33,-45.8 207.33,-41.8 207.33,-25.8"></path>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge4" class="edge">
<title>stack:f3-&gt;heap:f5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M226.33,-61.8C226.33,-41.8 253.33,-45.8 253.33,-25.8"></path>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge5" class="edge">
<title>stack:f4-&gt;heap:f6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M246.33,-61.8C246.33,-32.96 300.33,-54.64 300.33,-25.8"></path>
</g>
</g>
</svg>

</center>
<div class="paragraph">
<p>There are two main ways this affect performance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With garbage collection all the free memory is always on the right in one contiguous block,
so an allocation just involves putting the object at the <code>free-pointer</code> location and moving
<code>free-pointer</code> one slot to the right. Furthermore, newly allocated objects (which tend to
be used together) are placed next to each other, making them more cache-friendly and
improving access performance</p>
</li>
<li>
<p>With reference counting objects are usually freed in-place, meaning that the free space is
scattered throughout the heap, and you may need to scan the entire heap from left-to-right
in order to find a spot to allocate something. There are data structures and algorithms that
can make allocation faster than a linear scan, but they will never be as fast as the single
pointer lookup necessary with a GC</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_reference_counting_cannot_collect_cycles"><a class="anchor" href="#_reference_counting_cannot_collect_cycles"></a>Reference counting cannot collect cycles</h3>
<div class="paragraph">
<p>Objects that reference each other cyclically can thus
cause memory leaks when their objects never get collected, resulting in the program running
out of memory even though much of the heap could be cleaned up by a tracing garbage collector.</p>
</div>
<div class="paragraph">
<p>For example, consider the following heap, identical to the one we started with, but with an
additional edge from <code>bar</code> to <code>foo</code> (green), and with the edge from the stack to <code>bar</code> removed:</p>
</div>
<center>
<svg width="436px" height="126px" viewBox="0.00 0.00 435.51 125.60" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 121.6)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-121.6 431.51,-121.6 431.51,4 -4,4"></polygon>
<!-- heap -->
<g id="node1" class="node">
<title>heap</title>
<polygon fill="white" stroke="black" points="0,-30.5 0,-55.3 427.51,-55.3 427.51,-30.5 0,-30.5"></polygon>
<text text-anchor="middle" x="26.27" y="-38.7" font-family="Times,serif" font-size="14.00">HEAP</text>
<polyline fill="none" stroke="black" points="52.55,-30.5 52.55,-55.3"></polyline>
<text text-anchor="middle" x="69.88" y="-38.7" font-family="Times,serif" font-size="14.00">foo</text>
<polyline fill="none" stroke="black" points="87.21,-30.5 87.21,-55.3"></polyline>
<text text-anchor="middle" x="104.15" y="-38.7" font-family="Times,serif" font-size="14.00">bar</text>
<polyline fill="none" stroke="black" points="121.08,-30.5 121.08,-55.3"></polyline>
<text text-anchor="middle" x="139.58" y="-38.7" font-family="Times,serif" font-size="14.00">qux</text>
<polyline fill="none" stroke="black" points="158.08,-30.5 158.08,-55.3"></polyline>
<text text-anchor="middle" x="175.8" y="-38.7" font-family="Times,serif" font-size="14.00">baz</text>
<polyline fill="none" stroke="black" points="193.51,-30.5 193.51,-55.3"></polyline>
<text text-anchor="middle" x="203.26" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="213.01,-30.5 213.01,-55.3"></polyline>
<text text-anchor="middle" x="222.76" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="232.51,-30.5 232.51,-55.3"></polyline>
<text text-anchor="middle" x="242.26" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="252.01,-30.5 252.01,-55.3"></polyline>
<text text-anchor="middle" x="261.76" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="271.51,-30.5 271.51,-55.3"></polyline>
<text text-anchor="middle" x="281.26" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="291.01,-30.5 291.01,-55.3"></polyline>
<text text-anchor="middle" x="300.76" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="310.51,-30.5 310.51,-55.3"></polyline>
<text text-anchor="middle" x="320.26" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="330.01,-30.5 330.01,-55.3"></polyline>
<text text-anchor="middle" x="339.76" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="349.51,-30.5 349.51,-55.3"></polyline>
<text text-anchor="middle" x="359.26" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="369.01,-30.5 369.01,-55.3"></polyline>
<text text-anchor="middle" x="378.76" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="388.51,-30.5 388.51,-55.3"></polyline>
<text text-anchor="middle" x="398.26" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="408.01,-30.5 408.01,-55.3"></polyline>
<text text-anchor="middle" x="417.76" y="-38.7" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge1" class="edge">
<title>heap:s-&gt;heap:s</title>
<path fill="none" stroke="black" d="M69.76,-30.9C60.76,-20 60.76,0 86.76,0 106.46,0 111.23,-11.49 108.47,-21.79"></path>
<polygon fill="black" stroke="black" points="105.25,-20.41 103.76,-30.9 111.46,-23.63 105.25,-20.41"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge2" class="edge">
<title>heap:n-&gt;heap:n</title>
<path fill="none" stroke="green" stroke-width="3" d="M103.76,-54.9C112.76,-65.8 112.76,-85.8 86.76,-85.8 67.05,-85.8 62.28,-74.31 65.04,-64.01"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="68.27,-65.39 69.76,-54.9 62.05,-62.17 68.27,-65.39"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge3" class="edge">
<title>heap:s-&gt;heap:s</title>
<path fill="none" stroke="black" d="M69.76,-30.9C60.76,-20 60.76,0 104.76,0 138.1,0 146.18,-11.49 144.21,-21.79"></path>
<polygon fill="black" stroke="black" points="141.01,-20.38 139.76,-30.9 147.3,-23.46 141.01,-20.38"></polygon>
</g>
<!-- heap&#45;&gt;heap -->
<g id="edge4" class="edge">
<title>heap:n-&gt;heap:n</title>
<path fill="none" stroke="red" stroke-width="3" d="M139.76,-54.9C130.76,-65.8 130.76,-85.8 157.76,-85.8 178.22,-85.8 183.17,-74.31 180.46,-64.01"></path>
<polygon fill="red" stroke="red" stroke-width="3" points="183.45,-62.18 175.76,-54.9 177.23,-65.39 183.45,-62.18"></polygon>
</g>
<!-- stack -->
<g id="node2" class="node">
<title>stack</title>
<polygon fill="white" stroke="black" points="48.81,-92.3 48.81,-117.1 266.7,-117.1 266.7,-92.3 48.81,-92.3"></polygon>
<text text-anchor="middle" x="79.76" y="-100.5" font-family="Times,serif" font-size="14.00">STACK</text>
<polyline fill="none" stroke="black" points="110.7,-92.3 110.7,-117.1"></polyline>
<text text-anchor="middle" x="120.45" y="-100.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="130.2,-92.3 130.2,-117.1"></polyline>
<text text-anchor="middle" x="139.95" y="-100.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="149.7,-92.3 149.7,-117.1"></polyline>
<text text-anchor="middle" x="159.45" y="-100.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="169.2,-92.3 169.2,-117.1"></polyline>
<text text-anchor="middle" x="178.95" y="-100.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="188.7,-92.3 188.7,-117.1"></polyline>
<text text-anchor="middle" x="198.45" y="-100.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="208.2,-92.3 208.2,-117.1"></polyline>
<text text-anchor="middle" x="217.95" y="-100.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="227.7,-92.3 227.7,-117.1"></polyline>
<text text-anchor="middle" x="237.45" y="-100.5" font-family="Times,serif" font-size="14.00"> </text>
<polyline fill="none" stroke="black" points="247.2,-92.3 247.2,-117.1"></polyline>
<text text-anchor="middle" x="256.95" y="-100.5" font-family="Times,serif" font-size="14.00"> </text>
</g>
<!-- stack&#45;&gt;heap -->
<g id="edge5" class="edge">
<title>stack:f1-&gt;heap:f2</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="5,2" d="M139.76,-91.8C139.76,-75.8 139.76,-71.8 139.76,-55.8"></path>
</g>
</g>
</svg>

</center>
<div class="ulist">
<ul>
<li>
<p>With reference counting, even though <code>foo</code> and <code>bar</code> cannot be reached by any external reference -
they are &quot;garbage&quot; - each one still has a reference pointing at it from the other. Thus
they will never get collected</p>
</li>
<li>
<p>But with a tracing garbage collector, a collection can traverse the reference graph (red),
and copy <code>qux</code> and <code>baz</code> to the other half of the heap, leaving <code>foo</code> and <code>bar</code> behind as garbage,
despite the reference cycle between them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Garbage Collection</em> and <em>Reference Counting</em> have very different characteristics, and neither
is strictly superior to the other in all scenarios.
Many programming languages (e.g. Python) that use reference counting also have a backup
tracing garbage collector that runs once in a while to clean up unreachable reference cycles
and compact the heap, and most modern GCs (e.g. ZGC discussed above) use some reference-counting
techniques as part of their implementation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_theoretical_gc_performance"><a class="anchor" href="#_theoretical_gc_performance"></a>Theoretical GC Performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Typically, GC performance focuses on two main aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Overhead</strong>: what % of the time your program is spent collecting garbage, rather than
real work. Lower is better</p>
</li>
<li>
<p><strong>Pause Times</strong>: what is the longest time your program is completely paused while
collecting garbage. Lower is better</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two metrics are separate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Some programs only care about throughput</strong>, e.g. if you only care about how long a big batch
analysis takes to complete, and don’t care if it pauses in the middle to GC: you just want
it to finish as soon as possible</p>
</li>
<li>
<p><strong>Other programs only care about pause times</strong>, e.g. someone playing a videogame doesn’t care if
it can run faster than their eye can perceive, but they do care that it does not freeze or
pause for noticeable amounts of time while you are playing it</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even from the limited description above, we can already make some interesting inferences
about how the performance of a simple garbage collector will be like.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Allocations in garbage collectors are <em>cheap</em></strong>: when the heap is not yet full, we can
just allocate things on the first empty slots on the right side of the heap and bump <code>free-pointer</code>,
without having to scan the heap to find empty slots.</p>
</li>
<li>
<p><strong>Pause times should be proportional to the size of the live-set</strong>. That is because
a collection involves tracing, copying, then updating the references within the live-set.</p>
</li>
<li>
<p><strong>Pause times would <em>not</em> depend on the amount of garbage to be collected</strong>. The collection
we looked at above spend no time at all looking at or scanning for garbage objects,
they simply all disappeared when their half of the heap was wiped out following a collection.</p>
</li>
<li>
<p><strong>Interval between collections is inversely proportional to free memory</strong>.
We only need to run a collection when the garbage we allocate fills up the &quot;extra&quot; heap memory
our program has on top of what is necessary to store the live-set.</p>
</li>
<li>
<p><strong>GC overhead is the pause time divided by the interval, or proportional
to the extra memory and inversely proportional to the live-set size and heap size</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>allocation_cost = O(1)</code></p>
</li>
<li>
<p><code>gc_pause_time = O(live-set)</code></p>
</li>
<li>
<p><code>gc_interval = O(heap-size - live-set)</code></p>
</li>
<li>
<p><code>gc_overhead = gc_pause_time / gc_interval</code></p>
</li>
<li>
<p><code>gc_overhead = O(live-set / (heap-size - live-set))</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even from this small conclusions, we can already see some unintuitive results:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>More memory does <em>not</em> reduce pause times!</strong> <code>gc_pause_time = O(live-set)</code>, and so
pause times do not depend on how much <code>heap-size</code> you have.</p>
</li>
<li>
<p><strong>There is no point at which providing more memory does not improve GC overhead!</strong>
<code>gc_overhead = O(live-set / (heap-size - live-set))</code>, so
providing larger and larger <code>heap-size</code>s means less and less GC overhead, meaning a
larger % of your program time is spent on useful work.</p>
</li>
<li>
<p><strong>Conversely, providing exactly as much memory as the program requires_ is the worst
case possible!</strong> <code>gc_overhead = O(live-set / (heap-size - live-set))</code> when
<code>heap-size = live-set</code> means <code>gc_interval = 0</code> and <code>gc_overhead = infinity</code>:
the program will constantly need to run an expensive collections and have no time left
to do actual work. Garbage collectors therefore <em>need</em> excess memory to work with, on top
of the memory you would expect to need to allocate all the objects in your program.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Even from this theoretical analysis, we have already found a number of surprising results
in how GCs perform over time. Let’s now see how this applies to some real-world garbage
collectors included with the Java Virtual Machine</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_benchmarking_jvm_garbage_collectors"><a class="anchor" href="#_benchmarking_jvm_garbage_collectors"></a>Benchmarking JVM Garbage Collectors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have run through a theoretical introduction and analysis of how GCs work
and how we would expect them to perform, let’s look at some small Java programs and
monitor how garbage collection happens when using them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class GC {
    public static void main(String[] args) throws Exception{
        final long liveSetByteSize = Integer.parseInt(args[0]) * 1000000L;
        final int benchMillis = Integer.parseInt(args[1]);
        final int benchCount = Integer.parseInt(args[2]);
        // 0-490 array entries per object, * 4-bytes per entry,
        // + 20 byte array header = average 1000 bytes per entry
        final int maxObjectSize = 490;
        final int averageObjectSize = (maxObjectSize / 2) * 4 + 20;

        final int liveSetSize = (int)(liveSetByteSize / averageObjectSize);

        long maxPauseTotal = 0;
        long throughputTotal = 0;

        for(int i = 0; i &lt; benchCount + 1; i++) {
            int chunkSize = 256;
            Object[] liveSet = new Object[liveSetSize];
            for(int j = 0; j &lt; liveSetSize; j++) liveSet[j] = new int[j % maxObjectSize];
            System.gc();
            long maxPause = 0;
            long startTime = System.currentTimeMillis();

            long loopCount = 0;
            java.util.Random random = new java.util.Random(1337);
            int liveSetIndex = 0;

            while (startTime + benchMillis &gt; System.currentTimeMillis()) {
                if (loopCount % liveSetSize == 0) Thread.sleep(1);
                long loopStartTime = System.currentTimeMillis();
                liveSetIndex = random.nextInt(liveSetSize);
                liveSet[liveSetIndex] = new int[liveSetIndex % maxObjectSize];
                long loopTime = System.currentTimeMillis() - loopStartTime;
                if (loopTime &gt; maxPause) maxPause = loopTime;
                loopCount++;
            }
            if (i != 0) {
                long benchEndTime = System.currentTimeMillis();
                long bytesPerLoop = maxObjectSize / 2 * 4 + 20;
                throughputTotal += (long) (1.0 * loopCount * bytesPerLoop / 1000000 / (benchEndTime - startTime) * averageObjectSize);
                maxPauseTotal += maxPause;
            }

            System.out.println(liveSet[random.nextInt(liveSet.length)]);
        }

        long maxPause = maxPauseTotal / benchCount;
        long throughput = throughputTotal / benchCount;

        System.out.println(&quot;longest-gc: &quot; + maxPause + &quot;ms, throughput: &quot; + throughput + &quot; mb/s&quot;);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a small Java program designed to do a rough benchmark of Java garbage collection
performance. For each benchmark, it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starts off allocating a bunch of <code>int[]</code> arrays of varying size in <code>liveSet</code>, on
average taking up 1000 bytes each.</p>
</li>
<li>
<p>Loops continuously to allocate more <code>int[]</code>s and over-writes the references
to older ones</p>
</li>
<li>
<p>Tracks how long each allocation takes to run: ideally it should be almost instant, but if
that allocation triggers a GC it may take some time</p>
</li>
<li>
<p>Lastly, we print out the two numbers we care about
in a GC: the <code>maxPause</code> time in milliseconds, and the <code>throughput</code> it is able to handle
in megabytes per second (<code>throughput</code> being the opposite of <code>overhead</code> we mentioned earlier).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To be clear, this benchmark is <em>rough</em>. Performance will vary between runs, and on what hardware
and software you run it (I ran it on a M1 Macbook Pro running Java 23). But the results should be
clear even if the exact numbers will differ between runs.</p>
</div>
<div class="paragraph">
<p>You can run this program via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; javac -Xmx1g GC.java 800 10000 5 # Default is -XX:+UseG1GC
&gt; javac -Xmx1g -XX:+UseParallelGC GC.java 800 10000 5
&gt; javac -Xmx1g -XX:+UseZGC GC.java 800 10000 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above, <code>-Xmx1g</code> sets the heap size, the <code>-XX:</code> flags set the garbage collector, 800 sets
the <code>liveSet</code> size (in megabytes), and <code>10000</code> and <code>5</code> set the duration and number of
iterations to run the benchmark (here 10 seconds, 5 iterations). The measured pause times
and allocation rate are averaged over those 5 iterations.</p>
</div>
<div class="paragraph">
<p>I used the following <a href="https://ammonite.io/">Ammonite Scala script</a> to run the benchmark for a
range of inputs to collect the numbers shown below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="_attachments/GC-bench.sc" class="xref attachment">GC-bench.sc</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_g1_garbage_collector_benchmarks"><a class="anchor" href="#_g1_garbage_collector_benchmarks"></a>G1 Garbage Collector Benchmarks</h3>
<div class="paragraph">
<p>Running this on the default GC (G1), we get the followings numbers:</p>
</div>
<div class="paragraph">
<p><strong>Pause Times</strong></p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col />
<col />
<col />
<col />
<col />
<col />
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">live-set\heap-size</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12800 mb</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">66 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">60 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">78 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">93 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">135 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">108 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">93 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">160 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">262 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">158 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">164 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">564 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">331 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5909 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">14222 ms</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Throughput</strong></p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col />
<col />
<col />
<col />
<col />
<col />
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">live-set\heap-size</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12800 mb</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3140 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3823 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5087 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4871 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5199 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3022 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3598 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4374 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3741 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2911 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3440 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2095 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2797 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">888 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">338 mb/s</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As mentioned earlier, garbage collectors require some amount of free space in order to
work well, and so we only ran the benchmarks where the <code>heap-size</code> was twice or more
of the <code>live-set</code> size.</p>
</div>
<div class="paragraph">
<p>Above, we can see the behavior we discussed earlier in the theoretical performance analysis:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>GC pause times go up as the size of the live set increases</strong>. With a <code>800 mb</code> heap and
<code>400 mb</code> live set the average pause time is <code>66 ms</code>, and it scales smoothly up to a
<code>6400 mb</code> heap and <code>3200 mb</code> live set where the pause time is <code>331 ms</code></p>
</li>
<li>
<p><strong>GC pause times are relatively constant regardless of the heap size</strong>.
e.g. for <code>400 mb</code> live set a <code>800 mb</code> heap has a <code>66 ms</code> pause time, while a <code>400 mb</code> live set and
<code>6400 mb</code> heap (8 times as large!) has a <code>93 ms</code> pause time. There’s some variation
not a lot</p>
</li>
<li>
<p><strong>GC throughput goes up as the heap size increases</strong>, e.g. for a <code>400 mb</code> live set it goes
smoothly from <code>3140 mb/s</code> for a <code>800 mb</code> heap to a <code>4871 mb/s</code> pause time for a <code>6400 mb</code>
heap.</p>
</li>
<li>
<p><strong>Both pause times and throughput seems to suffer for very large live sets and very large
heaps</strong>: the <code>12800 mb</code> heap has disproportionately higher pause times compared to smaller
heap sizes, even compared to <code>6400 mb</code>, regardless of live-set size.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_generational_optimizations"><a class="anchor" href="#_generational_optimizations"></a>Generational Optimizations</h3>
<div class="paragraph">
<p>One additional GC behavior worth discussing is the &quot;Generational Hypothesis&quot;.
The idea is that <em>&quot;most&quot;</em> objects do not live a long time, e.g. objects allocated within a method are often
collect when the method returns. Given that assumption, many GCs have made optimizations
for the collection of objects that become garbage quickly, such that collecting them is
much cheaper. Practically, that means that the same <code>live-set</code> and <code>heap-size</code> can have
vastly different performance depending on how the allocations are structured:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>&quot;Least Recently Used&quot; garbage collections, where the <em>oldest</em> objects are the ones that
get collected, will perform the worst</p>
</li>
<li>
<p>&quot;Most Recently Used&quot; garbage collections, where the <em>newest</em> objects are the ones that
get collected, will perform the best</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notable, &quot;LRU&quot; is one of the most common caching strategies, which it is possible
for in-memory caches with LRU cache eviction to make GC problems worse!</p>
</div>
<div class="paragraph">
<p>The example Java benchmark above keeps objects around a while before they become garbage,
by assigning new allocations to randomly indices in the <code>liveSet</code> array.
We can instead always assign new allocations to indices via a
<a href="https://en.wikipedia.org/wiki/Random_walk">Random Walk</a>:
randomly adjacent to the left or right of the previously-assigned allocation, meaning
that recently allocated objects are likely to be over-written (becoming unreachable and
eligible for garbage collection) more quickly by newer allocations
in the same part of <code>liveSet</code>, while older objects in other parts of <code>liveSet</code> are less
likely to be become unreachable. This lets us emulate the &quot;generational&quot; behavior that
is common in real-world programs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-diff hljs" data-lang="diff">-liveSetIndex = random.nextInt(liveSetSize);
+liveSetIndex += (random.nextBoolean() ? 1 : -1) + liveSetSize;
+liveSetIndex %= liveSetSize;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we do this and measure the pause times and throughput of the example program,
we get the following:</p>
</div>
<div class="paragraph">
<p><strong>Pause Times</strong></p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col />
<col />
<col />
<col />
<col />
<col />
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">live-set\heap-size</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12800 mb</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">10 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">13 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">11 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">22 ms</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Throughput</strong></p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col />
<col />
<col />
<col />
<col />
<col />
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">live-set\heap-size</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12800 mb</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7218 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7495 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7536 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7550 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7634 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7497 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7790 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7580 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7819 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7563 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7464 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7830 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7128 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5854 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3286 mb/s</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Where the previous random-allocation benchmark has pause times of 10s to 100s to 1000s of
milliseconds, this &quot;generational&quot; benchmark has pause times in the 1s to 10s. The program
throughput is also significantly higher.
This demonstrates that the default G1 garbage collector does in fact have optimizations that
make it perform better for &quot;generational&quot; workloads.</p>
</div>
<div class="paragraph">
<p>Most GCs have some kind of optimization to make collecting recently-allocated objects
cheaper than collecting long-lived objects; these are often called <em>generational</em>
garbage collectors. Java’s G1GC is no different, and we can see that even with
the same live-set size and heap sizes, shorter-lived objects are dramatically
cheaper to collect than long-lived objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="_z_garbage_collector_benchmarks"><a class="anchor" href="#_z_garbage_collector_benchmarks"></a>Z Garbage Collector Benchmarks</h3>
<div class="paragraph">
<p>One interesting development in JVM garbage collectors is the
<a href="https://docs.oracle.com/en/java/javase/21/gctuning/z-garbage-collector.html">Z Garbage Collector</a>.
This is a garbage collector that is optimized for lower pause times, exchange for requiring
much more memory than the default G1GC. If we run the benchmarks above with ZGC,
even without the <a href="#_generational_optimizations">Generational Optimizations</a>, we get the numbers below:</p>
</div>
<div class="paragraph">
<p><strong>Pause Times</strong></p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col />
<col />
<col />
<col />
<col />
<col />
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">live-set\heap-size</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12800 mb</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">49 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">71 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">136 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">346 ms</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">886 ms</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Throughput</strong></p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col />
<col />
<col />
<col />
<col />
<col />
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">live-set\heap-size</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12800 mb</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">400 mb</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2305 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3959 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4858 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5318 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3261 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">800 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2573 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3888 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4707 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4645 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1600 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2633 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3555 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3350 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3200 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2381 mb/s</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2089 mb/s</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6400 mb</p></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">936 mb/s</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some things worth noting with ZGC:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the lower <code>heap-size</code> benchmarks - with <code>heap-size</code> twice <code>live-set</code> - ZGC
has similar pause times as the default G1GC (10s to 100s of milliseconds) but
with significantly worse throughput (<code>2300-2600 mb/s</code> rather than the <code>2800-3100 mb/s</code> of G1GC)</p>
</li>
<li>
<p>For larger <code>heap-size</code>s - 4 times the <code>live-set</code> and above - ZGC’s pause times drop to
single-digit milliseconds (1-2 ms), much lower than those of G1GC</p>
</li>
<li>
<p>Z1 does seem to have slower pause times with large 12800 mb heaps as well, although
instead of 100s to 1000s of millisecond pause times it slows down to 5-10 ms.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As mentioned in the discussion on <a href="#_theoretical_gc_performance">Theoretical GC Performance</a>, for
most garbage collectors pause times are proportional to the live set, and increasing the
heap size does not help at all (and according to our <a href="#_g1_garbage_collector_benchmarks">G1 Garbage Collector Benchmarks</a>, may
even make things worse!). This can be problematic, because there are many use cases that
cannot tolerate long GC pause times, but at the same time may require a significant amount
of live data to be kept in memory, so shrinking the live-set is not possible.</p>
</div>
<div class="paragraph">
<p>ZGC provides an option here, where if you are willing to provide <em>significantly</em>
more memory than the default G1GC requires, perhaps twice as much, you can get your pause times from
10-100s of milliseconds down to 1-2 milliseconds. These pause times remain low for a wide
range of heap sizes and live set sizes, and can be beneficial for a lot of applications
that cannot afford to just randomly stop for 100ms at a time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gc_performance_takeaways"><a class="anchor" href="#_gc_performance_takeaways"></a>GC Performance Takeaways</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we’ve studied garbage collections in theory, and looked at some concrete
numbers, there are some interesting conclusions that can be drawn:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Caching data <em>in-process</em> can make garbage collection pause times <em>worse</em>!</strong> If your
program is CPU-bottlenecked then caching to save computation can be worthwhile,
but if you have problems with GC pause times then caching things in-memory will
increase the size of your <em>live-set</em> and therefore make your pause times even worse!
&quot;LRU&quot; caches in particular are the worst case for garbage collectors, which are typically
optimized for collecting recently-allocated short-lived objects.</p>
</li>
<li>
<p><strong>In contrast, caching things <em>out of process</em> does not have this problem.</strong> So feel free
to cache things on disk, cache things in <a href="https://www.sqlite.org/">SQLite</a>,
<a href="https://github.com/redis/redis">Redis</a>, <a href="https://memcached.org/">Memcached</a>, and so on.
These are not traced by your program’s GC, and will not slow it down.</p>
</li>
<li>
<p><strong>Collecting Garbage doesn’t actually slow the garbage collector down!</strong> Most of the GC time
is spent <em>tracing</em> and <em>copying</em> and live-set, and the garbage is basically ignored
then wiped out in bulk. So it doesn’t not matter how much garbage the GC has to collect:
the time taken to run the collection will be the same regardless</p>
</li>
<li>
<p><strong>There will never be an <em>exact</em> amount of memory that a garbage-collected application
needs.</strong> You can <em>always</em> reduce-overhead/increase-throughput by providing more memory,
to make GCs less and less frequent, leaving more time to do useful work. And you can
usually provide less memory, at the cost of more and more frequent GCs. Exactly how much
memory to provide is thus something you tweak and tune rather than something you can
calculate exactly.</p>
</li>
<li>
<p><strong>Even when to declare the memory &quot;enough&quot; or &quot;not enough&quot; can be very arbitrary.</strong>
For example Java may throw an <code>OutOfMemoryError</code>
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/memleaks002.html">when
it spends 98% of the time in Garbage Collection</a>, which is an arbitrary threshold
that is arguably too low (the program can still make progress after all!)
and also arguably too high (do you really want to wait until your program slows down 50x
before declaring there’s not enough memory?)</p>
</li>
<li>
<p><strong>Shorter-lived objects are cheaper to collect</strong>, due to most GCs being <em>generational</em>. This
also ties into (1) above: caches tend to keep lots of long-lived objects in memory, which
apart from slowing down collections due to the size of the live-set, <em>also</em> slows them down
by missing out on the GC’s optimizations for short-lived objects.</p>
</li>
<li>
<p><strong>Fewer larger processes can have worse GC performance than more smaller processes, even if
they do the same things!</strong> There are
many ways in which consolidating smaller processes into larger ones can
improve efficiency: less per-process overhead, eliminating
<a href="https://en.wikipedia.org/wiki/Inter-process_communication">inter-process communication</a> cost,
etc. But GC pause times scale with <em>total live set size</em>, so combining two smaller
processes into one large one can make pause times <em>worse</em> than they were before.
And as we saw earlier, even within a single process allocating a large heap can make pause
times worse</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Java benchmarks above were run on one particular set of hardware on one version
of the JVM, and the exact numbers will differ when run on other hardware or JVM versions.
Nevertheless, the overall trends that you can see would remain the same, as would the
take-aways of what you need to know to understand garbage collector performance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Garbage collectors can be complicated, differing in design
and implementation between languages (Python, Java, Go, etc.) and even within the same
language (Java’s <a href="https://docs.oracle.com/en/java/javase/11/gctuning/parallel-collector1.html">ParallelGC</a>,
<a href="https://docs.oracle.com/en/java/javase/17/gctuning/garbage-first-g1-garbage-collector1.html">G1GC</a>,
the newer <a href="https://docs.oracle.com/en/java/javase/21/gctuning/z-garbage-collector.html">ZGC</a>, etc.).
There are endless clever optimizations for the language designers to implement and knobs
for language users to tweak and tune.</p>
</div>
<div class="paragraph">
<p>However, at a high level most GCs are actually surprisingly similar, have the same
odd performance characteristics, and the same surprising pitfalls.
Hopefully this article will have given you a good intuition for how garbage collectors work and behave, so
next time you need to do something with your GC you have a solid understanding to work with.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">The Mill Build Engineering Blog</a></span>
  <span class="next"><a href="5-executable-jars.html">How JVM Executable Assembly Jars Work</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async="async" src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async="async" src="../search-index.js"></script>
  
</body></html>