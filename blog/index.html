<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The Mill Build Engineering Blog :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/blog/index.html">
    <link rel="next" href="12-direct-style-build-tool.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../_/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style>
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../_/logo-white.svg" height="20" />&nbsp;The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="blog" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="12-direct-style-build-tool.html">Mill as a Direct Style Build Tool</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="11-jvm-test-parallelism.html">Strategies for Efficiently Parallelizing JVM Test Suites</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="10-bytecode-callgraph-analysis.html">Invalidating build caches using JVM bytecode callgraph analysis</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="9-mill-faster-assembly-jars.html">Fast Incremental JVM Assembly Jar Creation with Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="8-what-is-a-build-tool.html">What does a Build Tool do?</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="7-graal-native-executables.html">How to Compile Java into Native Binaries with Mill and Graal</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="6-garbage-collector-perf.html">Understanding JVM Garbage Collector Performance</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="5-executable-jars.html">How JVM Executable Assembly Jars Work</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="4-flaky-tests.html">How To Manage Flaky Tests in your CI Workflows</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="3-selective-testing.html">Faster CI with Selective Testing</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="2-monorepo-build-tool.html">Why Use a Monorepo Build Tool?</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="1-java-compile.html">How Fast Does Java Compile?</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Mill Build Engineering Blog</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../mill/index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../mill/main-branch/index.html">main-branch</a>
        </li>
        <li class="version">
          <a href="../mill/dev-1.0.0-RC3-28-3ea414/index.html">dev-1.0.0-RC3-28-3ea414</a>
        </li>
        <li class="version is-latest">
          <a href="../mill/index.html">0.12.14</a>
        </li>
        <li class="version">
          <a href="../mill/0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../mill/0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../mill/0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px; ">
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/out/website/blogFolder.dest/modules/ROOT/pages/index.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">The Mill Build Engineering Blog</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Welcome to the Mill build engineering blog! This is the home for articles on
technical topics related to JVM platform tooling and language-agnostic build tooling,
some specific to the Mill build tool but mostly applicable to anyone working on
build tooling for large codebases in JVM and non-JVM languages.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mill_as_a_direct_style_build_tool"><a class="anchor" href="#_mill_as_a_direct_style_build_tool"></a><a href="12-direct-style-build-tool.html" class="xref page">Mill as a Direct Style Build Tool</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 10 May 2025</em></p>
</div>
<div class="paragraph">
<p><a href="https://mill-build.org">Mill</a> is a JVM build tool that targets Java/Scala/Kotlin and has
potential to serve the large-monorepo codebases that Bazel currently serves. Mill has good
traction among its users, benchmarks that demonstrate 3-6x faster builds than its competitors,
and a unique "direct-style" design that make it easy to use and extend. This page discusses
one of the most interesting design decisions in Mill, and how it sets Mill apart from
other build tools on the market.</p>
</div>
<div class="paragraph">
<p><a href="12-direct-style-build-tool.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_strategies_for_efficiently_parallelizing_jvm_test_suites"><a class="anchor" href="#_strategies_for_efficiently_parallelizing_jvm_test_suites"></a><a href="11-jvm-test-parallelism.html" class="xref page">Strategies for Efficiently Parallelizing JVM Test Suites</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 17 March 2025</em></p>
</div>
<div class="paragraph">
<p>Test suites are in theory the ideal workload to parallelize, as they usually contain a large
number of independent tests that can each be run in parallel. But implementing parallelism in
practice can be challenging: a naive implementation can easily result in increased resource usage
without any speedup, or even slow things down compared to running things on a single thread.</p>
</div>
<div class="paragraph">
<p>This blog post will explore the design and evolution of the Mill JVM build tool&#8217;s test
parallelism strategy, from its start as a simple serial test runner, to naive module-based and
class-based sharding, to the dynamic sharding strategy implemented in the latest
version of Mill 0.12.9. We will discuss the pros and cons of the different approaches to
test parallelization, analyze how they perform both theoretically and with benchmarks,
and compare them to the runtime characteristics of other build tool test runners.</p>
</div>
<div class="paragraph">
<p><a href="11-jvm-test-parallelism.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_invalidating_build_caches_using_jvm_bytecode_callgraph_analysis"><a class="anchor" href="#_invalidating_build_caches_using_jvm_bytecode_callgraph_analysis"></a><a href="10-bytecode-callgraph-analysis.html" class="xref page">Invalidating build caches using JVM bytecode callgraph analysis</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 10 March 2025</em></p>
</div>
<div class="paragraph">
<p>Build tools often cache your task outputs and invalidate them when the input
files change, and build tools often let you implement tasks using blocks of arbitrary
code in some general-purpose language. But the combination of these raises a
question: if your tasks can contain arbitrary code, how can you detect when that code
has changed, and appropriately invalidate the task&#8217;s caches? In most programming
languages, "blocks of arbitrary code" are opaque - and the only thing you can do is
run them - so this problem is unsolvable.</p>
</div>
<div class="paragraph">
<p>This blog post explores how Mill extends its JVM runtime by analyzing the callgraph of your
build logic at a bytecode level. This lets Mill analyze a task&#8217;s code-block to detect
changes in its implementation or that of transitively-called methods, letting us automatically
invalidate task caches when the code is modified. We&#8217;ll discuss the implementation and
limitations of this bytecode analysis, and show empirically how this is able to provide
a significant improvement over more naive approaches to the problem.</p>
</div>
<div class="paragraph">
<p><a href="10-bytecode-callgraph-analysis.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fast_incremental_jvm_assembly_jar_creation_with_mill"><a class="anchor" href="#_fast_incremental_jvm_assembly_jar_creation_with_mill"></a><a href="9-mill-faster-assembly-jars.html" class="xref page">Fast Incremental JVM Assembly Jar Creation with Mill</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 16 February 2025</em></p>
</div>
<div class="paragraph">
<p>Assembly jars are a convenient deployment format for JVM applications, bundling
your application code and resources into a single file that can run anywhere a JVM
is installed. But assembly jars can be slow to create, which can slow down iterative
development workflows that depend on them. The Mill JVM build tool uses some special
tricks to let you iterate on your assembly jars much faster than traditional build tools
like Maven or Gradle, cutting down their incremental creation time from 10s of seconds
to less than a second. This can substantially increase your developer productivity by
saving time you would otherwise spend waiting for your assembly to be created.</p>
</div>
<div class="paragraph">
<p><a href="9-mill-faster-assembly-jars.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_does_a_build_tool_do"><a class="anchor" href="#_what_does_a_build_tool_do"></a><a href="8-what-is-a-build-tool.html" class="xref page">What does a Build Tool do?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 13 February 2025</em></p>
</div>
<div class="paragraph">
<p>The most common question I get asked about the Mill build tool is: what does a build
tool even do? Even software developers may not be familiar with the idea: they may run
<code>pip install</code> and <code>python foo.py</code>, <code>javac Foo.java</code>, or <code>go build</code> or some other
language-specific CLI directly. They may have a folder full of custom Bash scripts
they use during development. Or they may develop software on a team where someone
else has set up the tooling that they use. This blog post explores what build tools
are all about, why they are important to most software projects as they scale, and
how they work under the hood.</p>
</div>
<div class="paragraph">
<p><a href="8-what-is-a-build-tool.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_compile_java_into_native_binaries_with_mill_and_graal"><a class="anchor" href="#_how_to_compile_java_into_native_binaries_with_mill_and_graal"></a><a href="7-graal-native-executables.html" class="xref page">How to Compile Java into Native Binaries with Mill and Graal</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 1 February 2025</em></p>
</div>
<div class="paragraph">
<p>One recent development is the ability to compile Java programs into self-contained
native binaries. This provides more convenient
single-file distributions, faster startup time, and lower memory footprint, at a cost of
slower creation time and limitations around reflection and dynamic classloading. This
article explores how you can get started building your Java program into a native binary,
using the <a href="../mill/index.html" class="xref page">Mill build tool</a> and the
<a href="https://www.graalvm.org/latest/reference-manual/native-image/">Graal <em>native-image</em> compiler</a>,
and how to think about the benefits and challenges of doing so.</p>
</div>
<div class="paragraph">
<p><a href="7-graal-native-executables.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_jvm_garbage_collector_performance"><a class="anchor" href="#_understanding_jvm_garbage_collector_performance"></a><a href="6-garbage-collector-perf.html" class="xref page">Understanding JVM Garbage Collector Performance</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 10 January 2025</em></p>
</div>
<div class="paragraph">
<p>Garbage collectors are a core part of many programming languages. While they generally work
well, on occasion when they go wrong they can fail in very unintuitive ways.
This article will discuss the fundamental design of how garbage collectors
work, and tie it to real benchmarks of how GCs perform on the Java Virtual Machine. You
should come away with a deeper understanding of how the JVM garbage collector works and
concrete ways you can work to improve its performance in your own real-world projects.</p>
</div>
<div class="paragraph">
<p><a href="6-garbage-collector-perf.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_jvm_executable_assembly_jars_work"><a class="anchor" href="#_how_jvm_executable_assembly_jars_work"></a><a href="5-executable-jars.html" class="xref page">How JVM Executable Assembly Jars Work</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 2 January 2025</em></p>
</div>
<div class="paragraph">
<p>One feature of the <a href="https://mill-build.org">Mill JVM build tool</a> is that the
assembly jars it creates are directly executable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill show foo.assembly # generate the assembly jar
"ref:v0:bd2c6c70:/Users/lihaoyi/test/out/foo/assembly.dest/out.jar"

&gt; out/foo/assembly.dest/out.jar # run the assembly jar directly
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other JVM build tools also can generate assemblies, but most need you to run them
via <code>java -jar</code> or <code>java -cp</code>,
or require you to use <a href="https://docs.oracle.com/en/java/javase/11/tools/jlink.html">jlink</a> or
<a href="https://docs.oracle.com/en/java/javase/17/docs/specs/man/jpackage.html">jpackage</a>
which are much more heavyweight and troublesome to set up. Mill automates that, and while not
groundbreaking, it is a nice convenience that makes your JVM
code built with Mill fit more nicely into command-line centric workflows common in modern
software systems.</p>
</div>
<div class="paragraph">
<p>This article will discuss how Mill&#8217;s executable assemblies are implemented, so perhaps
other build tools and toolchains will be able to provide the same convenience</p>
</div>
<div class="paragraph">
<p><a href="5-executable-jars.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_manage_flaky_tests_in_your_ci_workflows"><a class="anchor" href="#_how_to_manage_flaky_tests_in_your_ci_workflows"></a><a href="4-flaky-tests.html" class="xref page">How To Manage Flaky Tests in your CI Workflows</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 1 January 2025</em></p>
</div>
<div class="paragraph">
<p>Many projects suffer from the problem of flaky tests: tests that pass or fail
non-deterministically. These cause confusion, slow development cycles, and endless
arguments between individuals and teams in an organization.</p>
</div>
<div class="paragraph">
<p>This article dives deep into working with flaky tests, from the perspective of someone
who built the first flaky test management systems at Dropbox and Databricks and maintained
the related build and CI workflows over the past decade. The issue of flaky tests can be
surprisingly unintuitive, with many "obvious" approaches being ineffective
or counterproductive. But it turns out there <em>are</em> right and wrong answers to many of
these issues, and we will discuss both so you can better understand what managing flaky tests
is all about.</p>
</div>
<div class="paragraph">
<p><a href="4-flaky-tests.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faster_ci_with_selective_testing"><a class="anchor" href="#_faster_ci_with_selective_testing"></a><a href="3-selective-testing.html" class="xref page">Faster CI with Selective Testing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 24 December 2024</em></p>
</div>
<div class="paragraph">
<p>Selective testing is a key technique necessary for working with any large codebase
or monorepo: picking which tests to run to validate a change or pull-request, because
running every test every time is costly and slow. This blog post will explore what
selective testing is all about, the different approaches you can take with selective
testing, based on my experience working on developer tooling and CI for the last decade at
Dropbox and Databricks. Lastly, we will discuss
<a href="../mill/large/selective-execution.html" class="xref page">how the Mill build tool supports selective testing</a>.</p>
</div>
<div class="paragraph">
<p><a href="3-selective-testing.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_use_a_monorepo_build_tool"><a class="anchor" href="#_why_use_a_monorepo_build_tool"></a><a href="2-monorepo-build-tool.html" class="xref page">Why Use a Monorepo Build Tool?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 17 December 2024</em></p>
</div>
<div class="paragraph">
<p>Software build tools mostly fall into two categories:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Single-language build tools, e.g.
<a href="https://maven.apache.org/">Maven</a> (Java), <a href="https://python-poetry.org/">Poetry</a> (Python),
<a href="https://doc.rust-lang.org/cargo/">Cargo</a> (Rust)</p>
</li>
<li>
<p>Monorepo build tools targeting large codebases, e.g. <a href="https://bazel.build/">Bazel</a>,
<a href="https://www.pantsbuild.org/">Pants</a>, <a href="https://buck.build/">Buck</a>, and <a href="https://mill-build.org/">Mill</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>One question that comes up constantly is why do people use Monorepo build tools? Tools
like Bazel are orders of magnitude more complicated and hard to use than tools
like Poetry or Cargo, so why do people use them at all?</p>
</div>
<div class="paragraph">
<p><a href="2-monorepo-build-tool.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_fast_does_java_compile"><a class="anchor" href="#_how_fast_does_java_compile"></a><a href="1-java-compile.html" class="xref page">How Fast Does Java Compile?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Li Haoyi, 29 November 2024</em></p>
</div>
<div class="paragraph">
<p>Java compiles have the reputation for being slow, but that reputation does
not match today&#8217;s reality. Nowadays the Java compiler can compile "typical" Java code at over
100,000 lines a second on a single core. That means that even a million line project
should take more than 10s to compile in a single-threaded fashion, and should be even
faster in the presence of parallelism</p>
</div>
<div class="paragraph">
<p><a href="1-java-compile.html" class="xref page">Read More&#8230;&#8203;</a></p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="next"><a href="12-direct-style-build-tool.html">Mill as a Direct Style Build Tool</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async src="../search-index.js"></script>
  </body>
</html>
