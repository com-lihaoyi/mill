//| mill-version: SNAPSHOT
//| mill-jvm-version: 11
package build

import mill.javalib._
import mill.javalib.publish._
import millbuild._

object `package` extends MavenModule with PublishModule {

  def mvnDeps = super.mvnDeps() ++ Seq(Deps.servletApi, Deps.jspApi)

  def javacOptions = super.javacOptions() ++
    Seq("-source", "1.6", "-target", "1.6")

  def pomSettings = PomSettings(
    "Sample single module Maven project with a working, deployable site.",
    "",
    "http://www.example.com",
    Seq(),
    VersionControl(
      Some("http://github.com/gabrielf/maven-samples"),
      Some("scm:git:git@github.com:gabrielf/maven-samples.git"),
      Some("scm:git:git@github.com:gabrielf/maven-samples.git"),
      Some("HEAD")
    ),
    Seq()
  )

  def publishVersion = "1.0-SNAPSHOT"

  def artifactMetadata = Artifact(
    "com.example.maven-samples",
    "single-module-project",
    "1.0-SNAPSHOT"
  )

  def repositories = super.repositories() ++ Seq(
    "https://maven.java.net/content/repositories/public/",
    "http://repository.jboss.org/nexus/content/groups/public/"
  )

  object test extends MavenTests with TestModule.Junit4 {

    def mandatoryMvnDeps = super.mandatoryMvnDeps() ++ Seq(Deps.junitDep)

    def mvnDeps = super.mvnDeps() ++
      Seq(Deps.hamcrestCore, Deps.hamcrestLibrary, Deps.mockitoCore)

    def forkWorkingDir = moduleDir

    def testParallelism = false

    def testSandboxWorkingDir = false
  }

}
