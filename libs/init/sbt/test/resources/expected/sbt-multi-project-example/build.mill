package build

import mill.api._
import mill.javalib._
import mill.javalib.publish._
import mill.scalalib._
import millbuild._

object `package` extends Module {

  object common extends SbtMultiProjectExampleBaseModule {

    def scalacOptions = super.scalacOptions() ++ Seq("-encoding", "utf8")

    def mvnDeps = super.mvnDeps() ++ Seq(
      Deps.logbackClassic,
      Deps.logstashLogbackEncoder,
      Deps.scalaLogging,
      Deps.jclOverSlf4j,
      Deps.config,
      Deps.akkaStream
    )

    def pomSettings = PomSettings(
      "This is the common module.",
      "com.pbassiner",
      "https://github.com/com-lihaoyi/mill",
      Seq(License(
        "Apache-2.0",
        "Apache-2.0",
        "https://www.apache.org/licenses/LICENSE-2.0.txt",
        false,
        false,
        ""
      )),
      VersionControl(
        Some("https://github.com/com-lihaoyi/mill"),
        Some("scm:git:https://github.com/com-lihaoyi/mill.git"),
        None,
        None
      ),
      Seq(
        Developer("johnd", "John Doe", "https://example.com/johnd", None, None)
      )
    )

    def artifactMetadata = Artifact("com.pbassiner", "common", "0.1.0-SNAPSHOT")

    object test extends SbtTests with TestModule.ScalaTest {

      def mandatoryMvnDeps = super.mandatoryMvnDeps() ++
        Seq(Deps.scalatest, Deps.scalacheck)

    }

  }
  object multi1 extends SbtMultiProjectExampleBaseModule {

    def scalacOptions = super.scalacOptions() ++ Seq("-encoding", "utf8", "-V")

    def mvnDeps = super.mvnDeps() ++ Seq(
      Deps.logbackClassic,
      Deps.logstashLogbackEncoder,
      Deps.scalaLogging,
      Deps.jclOverSlf4j,
      Deps.config,
      Deps.akkaStream,
      Deps.monocleCore,
      Deps.monocleMacro
    )

    def moduleDeps = super.moduleDeps ++ Seq(build.common)

    def pomSettings = PomSettings(
      "This is an sbt sample project for testing Mill's init command.",
      "com.pbassiner",
      "https://github.com/com-lihaoyi/mill",
      Seq(License(
        "Apache-2.0",
        "Apache-2.0",
        "https://www.apache.org/licenses/LICENSE-2.0.txt",
        false,
        false,
        ""
      )),
      VersionControl(
        Some("https://github.com/com-lihaoyi/mill"),
        Some("scm:git:https://github.com/com-lihaoyi/mill.git"),
        None,
        None
      ),
      Seq(
        Developer("johnd", "John Doe", "https://example.com/johnd", None, None)
      )
    )

    def artifactMetadata = Artifact("com.pbassiner", "multi1", "0.1.0-SNAPSHOT")

    object test extends SbtTests with TestModule.ScalaTest {

      def mandatoryMvnDeps = super.mandatoryMvnDeps() ++
        Seq(Deps.scalatest, Deps.scalacheck)

    }

  }
  object multi2 extends SbtMultiProjectExampleBaseModule {

    def mvnDeps = super.mvnDeps() ++ Seq(
      Deps.logbackClassic,
      Deps.logstashLogbackEncoder,
      Deps.scalaLogging,
      Deps.jclOverSlf4j,
      Deps.config,
      Deps.akkaStream,
      Deps.pureconfig
    )

    def moduleDeps = super.moduleDeps ++ Seq(build.common)

    def pomSettings = PomSettings(
      "This is an sbt sample project for testing Mill's init command.",
      "com.pbassiner",
      "https://github.com/com-lihaoyi/mill",
      Seq(License(
        "Apache-2.0",
        "Apache-2.0",
        "https://www.apache.org/licenses/LICENSE-2.0.txt",
        false,
        false,
        ""
      )),
      VersionControl(
        Some("https://github.com/com-lihaoyi/mill"),
        Some("scm:git:https://github.com/com-lihaoyi/mill.git"),
        None,
        None
      ),
      Seq(
        Developer("johnd", "John Doe", "https://example.com/johnd", None, None)
      )
    )

    def artifactMetadata = Artifact("com.pbassiner", "multi2", "0.1.0-SNAPSHOT")

    object test extends SbtTests with TestModule.ScalaTest {

      def mandatoryMvnDeps = super.mandatoryMvnDeps() ++
        Seq(Deps.scalatest, Deps.scalacheck)

    }

  }
  object nested extends Module {

    object nested extends SbtMultiProjectExampleBaseModule {

      def scalacOptions = super.scalacOptions() ++ Seq("-encoding", "utf8")

      def mvnDeps = super.mvnDeps() ++ Seq(Deps.nettyTransportNativeEpoll)

      def pomSettings = PomSettings(
        "This is an sbt sample project for testing Mill's init command.",
        "com.pbassiner",
        "https://github.com/com-lihaoyi/mill",
        Seq(License(
          "Apache-2.0",
          "Apache-2.0",
          "https://www.apache.org/licenses/LICENSE-2.0.txt",
          false,
          false,
          ""
        )),
        VersionControl(
          Some("https://github.com/com-lihaoyi/mill"),
          Some("scm:git:https://github.com/com-lihaoyi/mill.git"),
          None,
          None
        ),
        Seq(Developer(
          "johnd",
          "John Doe",
          "https://example.com/johnd",
          None,
          None
        ))
      )

      def artifactMetadata =
        Artifact("com.pbassiner", "nested", "0.1.0-SNAPSHOT")

    }
  }
}
