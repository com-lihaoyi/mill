//| mill-version: SNAPSHOT
//| mill-jvm-version: system
package build
import mill.*
import mill.javalib.*
import mill.javalib.errorprone.ErrorProneModule
object `package` extends Module {

  object app extends MavenModule {

    def moduleDeps = Seq(build.utilities)

    def mvnDeps = Seq(mvn"org.apache.commons:commons-text")

    def depManagement = Seq(mvn"org.apache.commons:commons-text:1.9")

    def javacOptions = Seq("-source", "17", "-target", "17")

    object test extends MavenTests, TestModule.Junit5 {

      def mvnDeps = Seq(mvn"org.junit.jupiter:junit-jupiter:5.9.1")

      def runMvnDeps = Seq(mvn"org.junit.platform:junit-platform-launcher")

      def bomMvnDeps = Seq(mvn"org.junit:junit-bom:5.9.1")

      def javacOptions = Seq("-source", "17", "-target", "17")

      def forkWorkingDir = moduleDir

      def testParallelism = false

      def testSandboxWorkingDir = false

    }

  }

  object list extends MavenModule, ErrorProneModule {

    def depManagement = Seq(mvn"org.apache.commons:commons-text:1.9")

    def javacOptions = Seq("-source", "17", "-target", "17")

    def errorProneDeps = Seq(mvn"com.google.errorprone:error_prone_core:2.28.0")

    def errorProneJavacEnableOptions =
      Seq("-XDshould-stop.ifError=FLOW", "-XDshouldStopPolicyIfError=FLOW")

    object test extends MavenTests, ErrorProneModule, TestModule.Junit5 {

      def mvnDeps = Seq(mvn"org.junit.jupiter:junit-jupiter:5.9.1")

      def runMvnDeps = Seq(mvn"org.junit.platform:junit-platform-launcher")

      def bomMvnDeps = Seq(mvn"org.junit:junit-bom:5.9.1")

      def javacOptions = Seq("-source", "17", "-target", "17")

      def forkWorkingDir = moduleDir

      def errorProneDeps =
        Seq(mvn"com.google.errorprone:error_prone_core:2.28.0")

      def errorProneOptions = Seq("-XepCompilingTestOnlyCode")

      def errorProneJavacEnableOptions =
        Seq("-XDshould-stop.ifError=FLOW", "-XDshouldStopPolicyIfError=FLOW")

      def testParallelism = false

      def testSandboxWorkingDir = false

    }

  }

  object utilities extends MavenModule, ErrorProneModule {

    def moduleDeps = Seq(build.list)

    def depManagement = Seq(mvn"org.apache.commons:commons-text:1.9")

    def javacOptions = Seq("-source", "17", "-target", "17")

    def errorProneDeps = Seq(mvn"com.google.errorprone:error_prone_core:2.28.0")

    def errorProneJavacEnableOptions =
      Seq("-XDshould-stop.ifError=FLOW", "-XDshouldStopPolicyIfError=FLOW")

  }
}
