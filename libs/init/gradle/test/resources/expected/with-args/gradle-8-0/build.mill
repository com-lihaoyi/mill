//| mill-version: SNAPSHOT
package build

import mill.*
import mill.api.*
import mill.api.opt.*
import mill.javalib.*
import mill.javalib.errorprone.*

object `package` extends Module {

  object app extends MavenModule {

    def mvnDeps = super.mvnDeps() ++
      Seq(mvn"org.apache.commons:commons-text:1.9")

    def moduleDeps = super.moduleDeps ++ Seq(build.utilities)

    def javacOptions = super.javacOptions() ++
      Opts("-source", "17", "-target", "17")

    def jvmId = "zulu:17"

    object test extends MavenTests with TestModule.Junit5 {

      def mvnDeps = super.mvnDeps() ++
        Seq(mvn"org.junit.jupiter:junit-jupiter:5.9.1")

      def testParallelism = false

      def testSandboxWorkingDir = false

    }

  }

  object list extends MavenModule with ErrorProneModule {

    def javacOptions = super.javacOptions() ++
      Opts("-source", "17", "-target", "17")

    def errorProneVersion = "2.28.0"

    def errorProneJavacEnableOptions = super.errorProneJavacEnableOptions() ++
      Opts("-XDshould-stop.ifError=FLOW", "-XDshouldStopPolicyIfError=FLOW")

    def jvmId = "zulu:17"

    object test
        extends MavenTests with ErrorProneModule with TestModule.Junit5 {

      def mvnDeps = super.mvnDeps() ++
        Seq(mvn"org.junit.jupiter:junit-jupiter:5.9.1")

      def errorProneVersion = "2.28.0"

      def errorProneOptions = super.errorProneOptions() ++
        Seq("-XepCompilingTestOnlyCode")

      def errorProneJavacEnableOptions = super.errorProneJavacEnableOptions() ++
        Opts("-XDshould-stop.ifError=FLOW", "-XDshouldStopPolicyIfError=FLOW")

      def testParallelism = false

      def testSandboxWorkingDir = false

    }

  }

  object utilities extends MavenModule with ErrorProneModule {

    def moduleDeps = super.moduleDeps ++ Seq(build.list)

    def javacOptions = super.javacOptions() ++
      Opts("-source", "17", "-target", "17")

    def errorProneVersion = "2.28.0"

    def errorProneJavacEnableOptions = super.errorProneJavacEnableOptions() ++
      Opts("-XDshould-stop.ifError=FLOW", "-XDshouldStopPolicyIfError=FLOW")

    def jvmId = "zulu:17"

  }

}
