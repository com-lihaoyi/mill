<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Case Study: Mill vs Gradle :: The Mill Build Tool</title>
    <link rel="prev" href="maven.html" />
    <link rel="next" href="sbt.html" />
    <meta name="generator" content="Antora 3.1.9" />
    <link rel="stylesheet" href="../../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon" />
  
  </head><body class="article">
  
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" /> The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">Source Code (GitHub)</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>
        <a class="navbar-item" href="https://discord.gg/MNAXQMAr">Chat</a>

            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../javalib/intro.html">Building Java Projects with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/installation-ide.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/module-config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/dependencies.html">Java Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/testing.html">Testing Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/linting.html">Linting Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/publishing.html">Publishing Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/build-examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/web-examples.html">Java Web Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/android-examples.html">(Experimental) Android Builds</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scalalib/intro.html">Building Scala Projects with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/installation-ide.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/module-config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/dependencies.html">Scala Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/testing.html">Testing Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/linting.html">Linting Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/publishing.html">Publishing Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/build-examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/web-examples.html">Scala Web Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kotlinlib/intro.html">(Experimental) Kotlin with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/installation-ide.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/module-config.html">Kotlin Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/dependencies.html">Kotlin Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/testing.html">Testing Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/linting.html">Linting Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/publishing.html">Publishing Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/build-examples.html">Kotlin Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/web-examples.html">Kotlin Web Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Build Tool Comparisons</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="maven.html">Case Study: Mill vs Maven</a>
  </li>

  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="gradle.html">Case Study: Mill vs Gradle</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sbt.html">Case Study: Mill vs SBT</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill Fundamentals</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/library-deps.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/out-dir.html">The Output Directory</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/query-syntax.html">Task Query Syntax</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/cross-builds.html">Cross Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/bundled-libraries.html">Bundled Libraries</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extending Mill</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/import-ivy.html">import $ivy</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/using-plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../extending/contrib-plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/sonatypecentral.html">Sonatype Central</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/thirdparty-plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/writing-plugins.html">Writing Mill Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/meta-build.html">The Mill Meta-Build</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/large-builds.html">Structuring Large Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/sandboxing.html">Mill Sandboxing</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/evaluation-model.html">The Mill Evaluation Model</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/design-principles.html">Mill Design Principles</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../reference/changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Mill Documentation</a></li>
    <li>Build Tool Comparisons</li>
    <li><a href="gradle.html">Case Study: Mill vs Gradle</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.12.0-RC3-11-6c4261</button>
  <div class="version-menu">
    <a class="version is-current" href="gradle.html">0.12.0-RC3-11-6c4261</a>
    <a class="version is-missing" href="../0.11.12/index.html">0.11.12</a>
    <a class="version is-missing" href="../0.11.11/index.html">0.11.11</a>
    <a class="version is-missing" href="../0.11.10/index.html">0.11.10</a>
    <a class="version is-missing" href="../0.11.0-M7/index.html">0.11.0-M7</a>
    <a class="version is-missing" href="../0.10.15/index.html">0.10.15</a>
    <a class="version is-missing" href="../0.10.12/index.html">0.10.12</a>
    <a class="version is-missing" href="../0.10.0/index.html">0.10.0</a>
    <a class="version is-missing" href="../0.9.12/index.html">0.9.12</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/docs/modules/ROOT/pages/comparisons/gradle.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Case Study: Mill vs Gradle</h1>
<div id="preamble">
<div class="sectionbody">
<script>
gtag('config', 'AW-16649289906');
</script>
<div class="paragraph">
<p>This page compares using Mill to Gradle, using the <a href="https://github.com/mockito/mockito">Mockito Testing Library</a>
codebase as the example. Mockito is a medium sized codebase, 100,000 lines of Java split over 22
subprojects. By porting it to Mill, this case study should give you
an idea of how Mill compares to Gradle in more realistic, real-world projects.</p>
</div>
<div class="paragraph">
<p>To do this, we have written a Mill <code>build.mill</code> file for the Mockito project. This can be used
with Mill to build and test the various submodules of the Mockito project without needing to
change any other files in the repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/com-lihaoyi/mill/blob/main/example/thirdparty/mockito/build.mill">Mockito build.mill file</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_completeness"><a class="anchor" href="#_completeness"></a>Completeness</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Mill build for Mockito is not 100% complete, but it covers most of the major parts of Mockito:
compiling Java, running JUnit tests. For now, the Android, Kotlin, and OSGI tests are skipped.</p>
</div>
<div class="paragraph">
<p>The goal of this exercise is not to be 100% feature complete enough to replace the Gradle build
today. It is instead meant to provide a realistic comparison of how using Mill in a realistic,
real-world project compares to using Gradle.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_performance"><a class="anchor" href="#_performance"></a>Performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Mill build for Mockito is generally snappier than the Gradle build. This applies to
most workflows, but the difference matters most for workflows which are short-lived,
where the difference in the fixed overhead of the build tool is most noticeable.</p>
</div>
<div class="paragraph">
<p>For comparison purposes, I disabled the Gradle subprojects that we did not fully implement in Mill
(<code>groovyTest</code>, <code>groovyInlineTest</code>, <code>kotlinTest</code>, <code>kotlinReleaseCoroutinesTest</code>, <code>android</code>,
<code>osgi-test</code>, <code>java21-test</code>).</p>
</div>
<div class="paragraph">
<p>For the benchmarks below, each provided number is the median wall time of three consecutive runs
on my M1 Macbook Pro. While ad-hoc, these benchmarks are enough to give you a flavor of how
Mill’s performance compares to Gradle:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;" />
<col style="width: 25%;" />
<col style="width: 25%;" />
<col style="width: 25%;" />
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Benchmark</th>
<th class="tableblock halign-left valign-top">Gradle</th>
<th class="tableblock halign-left valign-top">Mill</th>
<th class="tableblock halign-left valign-top">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sequential_clean_compile_all">Sequential Clean Compile All</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17.6s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.40s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_parallel_clean_compile_all">Parallel Clean Compile All</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.3s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.57s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.4x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_clean_compile_single_module">Clean Compile Single-Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.41s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.20s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.7x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_incremental_compile_single_module">Incremental Compile Single-Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.37s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.51s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_no_op_compile_single_module">No-Op Compile Single-Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.94s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.46s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0x</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The column on the right shows the speedups of how much faster Mill is compared to the
equivalent Gradle workflow. In most cases,  Mill is 5-10x faster than Gradle. Below, we
will go into more detail of each benchmark: how they were run, what they mean, and how
we can explain the difference in performing the same task with the two different build tools.</p>
</div>
<div class="sect2">
<h3 id="_sequential_clean_compile_all"><a class="anchor" href="#_sequential_clean_compile_all"></a>Sequential Clean Compile All</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew clean; time ./gradlew classes testClasses --no-build-cache
17.6s
18.2s
17.4s

$ ./mill clean; time ./mill -j 1 __.compile
5.60s
5.40s
6.13s</code></pre>
</div>
</div>
<div class="paragraph">
<p>This benchmark measures the time taken to sequentially compiled all the Java code in
the Mockito code base. The goal of this benchmark is to try and measure the &quot;clean compile
everything&quot; step, without the effects of parallelism that can be nondeterministic and vary
wildly from machine to machine depending on the number of cores available.</p>
</div>
<div class="paragraph">
<p>To limit our comparison to compiling Java code only, we avoid
using <code>build</code> in favor of <code>classes</code> and <code>testClasses</code>: this skips running tests,
lint, jar/docjar generation, and other steps that <code>build</code> performs to make it an apples-to-apples
comparison. Furthermore, Gradle parallelizes the build by default and caches things globally
under <code>~/.gradle/caches</code>, while Mill parallelizes by default but does not cache things globally.
Again to make it a fair comparison, we use <code>--no-build-cache</code> in Gradle and set
<code>org.gradle.parallel=false</code> in <code>gradle.properties</code>, and pass <code>-j 1</code> to limit Mill to a
single thread.</p>
</div>
<div class="paragraph">
<p>Here we see Mill being about ~3.3x faster than Gradle, to do the equivalent amount of work.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parallel_clean_compile_all"><a class="anchor" href="#_parallel_clean_compile_all"></a>Parallel Clean Compile All</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew clean; time ./gradlew classes testClasses --no-build-cache
13.8s
12.3s
11.4s

$ ./mill clean; time ./mill -j 10  __.compile
3.59s
3.57s
3.45s</code></pre>
</div>
</div>
<div class="paragraph">
<p>This benchmark is identical to the <a href="#_sequential_clean_compile_all">Sequential Clean Compile All</a> benchmark above, but enables
parallelism: Gradle by default, Mill via <code>-j 10</code> to run on 10 cores (the number on my Macbook Pro).</p>
</div>
<div class="paragraph">
<p>Neither Gradle nor Mill benefit hugely from parallelism: both show a moderate ~50% speedup,
despite receiving 900% more CPUs. This likely indicates that the module dependency graph
of the Mockito codebase is laid out in a way that does not allow huge amounts of compile-time
parallelism.</p>
</div>
<div class="paragraph">
<p>Again, we see Mill being about ~3.4x faster than Gradle, to do the equivalent amount of work.
This indicates the the speedup Mill provides over Gradle is unrelated to the parallelism of
each tool.</p>
</div>
</div>
<div class="sect2">
<h3 id="_clean_compile_single_module"><a class="anchor" href="#_clean_compile_single_module"></a>Clean Compile Single-Module</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew clean; time ./gradlew :classes --no-build-cache
4.14s
4.41s
4.41s

$ ./mill clean; time ./mill compile
1.20s
1.12s
1.30s</code></pre>
</div>
</div>
<div class="paragraph">
<p>This benchmark indicates the use case of clean-compiling a single module. In this case,
the root module in <code>src/main/java/</code> containing the bulk of the Mockito library code,
<em>exluding</em> the test code in <code>src/test/java/</code> and all the downstream subprojects in
<code>subprojects/</code>.</p>
</div>
<div class="paragraph">
<p>This benchmark gives us Mill being about ~3.7x faster than Gradle. This is in line with
the results above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_incremental_compile_single_module"><a class="anchor" href="#_incremental_compile_single_module"></a>Incremental Compile Single-Module</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ echo &quot;&quot; &gt;&gt; src/main/java/org/mockito/BDDMockito.java; time ./gradlew :classes
1.37s
1.39s
1.28s

$ echo &quot;&quot; &gt;&gt; src/main/java/org/mockito/BDDMockito.java; time ./mill compile
compiling 1 Java source to /Users/lihaoyi/Github/netty/out/common/compile.dest/classes ...
0.52s
0.51s
0.52s</code></pre>
</div>
</div>
<div class="paragraph">
<p>This benchmark measures the common case of making a tiny change to a single file and
re-compiling just that module. This is the common workflow that most software developers
do over and over day-in and day-out. We simulate this by appending a new line to the
file <code>src/main/java/org/mockito/BDDMockito.java</code>.</p>
</div>
<div class="paragraph">
<p>Both Mill and Gradle are able to take advantage of the small code change and re-compile
only the single files needing re-compilation, demonstrating substantial speedups over
the <a href="#_clean_compile_single_module">Clean Compile Single-Module</a> benchmark above. Mill remains faster than Gradle,
showing a ~2.7x speedup for this task</p>
</div>
</div>
<div class="sect2">
<h3 id="_no_op_compile_single_module"><a class="anchor" href="#_no_op_compile_single_module"></a>No-Op Compile Single-Module</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ time ./gradlew :classes
0.95s
0.93s
0.94s

$ time ./mill common.compile
0.46s
0.50s
0.45s</code></pre>
</div>
</div>
<div class="paragraph">
<p>This benchmark is meant to measure the pure overhead of running the build tool: given a single
module that did <em>not</em> change, the build tool should need to do <em>nothing</em> in response, and so
any time taken is pure overhead.</p>
</div>
<div class="paragraph">
<p>For both Mill and Gradle, we see small speedups relative to the <a href="#_incremental_compile_single_module">Incremental Compile Single-Module</a>
benchmark above, which likely comes from not having to compile any Java source files at all. Mill
remains faster than Gradle by about 2.0x.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_tooling"><a class="anchor" href="#_debugging_tooling"></a>Debugging Tooling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another area that Mill does better than Gradle is providing builtin tools for you to understand
what your build is doing. For example, the Mockito project build discussed has 22 submodules
and associated test suites, but how do these different modules depend on each other? With
Mill, you can run <code>./mill visualize __.compile</code>, and it will show you how the
<code>compile</code> task of each module depends on the others:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/MockitoCompileGraph.svg" alt="MockitoCompileGraph" />
</div>
</div>
<div class="paragraph">
<p>Apart from the static dependency graph, another thing of interest may be the performance
profile and timeline: where the time is spent when you actually compile everything. With
Mill, when you run a compilation using <code>./mill -j 10 __.compile</code>, you automatically get a
<code>out/mill-chrome-profile.json</code> file that you can load into your <code>chrome://tracing</code> page and
visualize where your build is spending time and where the performance bottlenecks are:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/MockitoCompileProfile.png" alt="MockitoCompileProfile" />
</div>
</div>
<div class="paragraph">
<p>If you want to inspect the tree of third-party dependencies used by any module, the
built in <code>ivyDepsTree</code> command lets you do that easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mill subprojects.junit-jupiter.ivyDepsTree
├─ org.junit.jupiter:junit-jupiter-api:5.10.3
│  ├─ org.apiguardian:apiguardian-api:1.1.2
│  ├─ org.junit.platform:junit-platform-commons:1.10.3
│  │  └─ org.apiguardian:apiguardian-api:1.1.2
│  └─ org.opentest4j:opentest4j:1.3.0
└─ org.objenesis:objenesis:3.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>None of these tools are rocket science, but Mill provides all of them out of the
box in a convenient package for you to use. Whether you want a visual graph layout,
a parallel performance profile, or a third-party dependency tree of your project,
Mill makes it easy and convenient without needing to fiddle with custom configuration
or third party plugins. This helps make it easy for you to explore, understand, and
take ownership of the build tool.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both the Mill and Gradle builds we discussed in this case study do the same thing: they
compile Java code and run tests. Sometimes they perform additional configuration, tweaking
JVM arguments or doing ad-hoc classpath mangling.</p>
</div>
<div class="paragraph">
<p>Mill doesn’t try to do <em>more</em> than Gradle does, but it
tries to do it <em>better</em>: faster compiles, shorter and easier to read configs, easier
extensibility via libraries.</p>
</div>
<div class="paragraph">
<p>Again, the Mill build used in this comparison is for demonstration purposes, and more
work would be necessary to make the Mill build production ready: publishing configuration,
code coverage integration, and so on. However, hopefully it demonstrates the potential value:
significantly improved performance, so that you spend less time waiting for your code to
compile and more time doing the work that actually matters, with builtin debugging tools
to help turn normally opaque &quot;build config&quot; into something that’s transparent and
easily understandable.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="maven.html">Case Study: Mill vs Maven</a></span>
  <span class="next"><a href="sbt.html">Case Study: Mill vs SBT</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async="async" src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async="async" src="../../search-index.js"></script>
  
</body></html>