<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Modules :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/fundamentals/modules.html">
    <link rel="prev" href="Task_Context_API.html">
    <link rel="next" href="Cross_Builds.html">
    <meta name="generator" content="Antora 3.1.12">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style>
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />&nbsp;The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/mill.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="0.10.15">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Intro_to_Mill.html">Introduction to Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Installation.html">Installation</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Getting_Started.html">Getting Started</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="IDE_Support.html">IDE Support</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Out_Dir.html">The Output Directory</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Configuration.html">Configuring your Project</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Library_Dependencies.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Common_Project_Layouts.html">Common Project Layouts</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Tasks.html">Tasks</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Task_Context_API.html">Task Context API</a>
  </li>

  <li class="nav-item is-current-page is-active" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Extending_Mill.html">Extending Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Using_Plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Mill_Internals.html">Mill Internals</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Plugin_Artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Plugin_Bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Plugin_Bloop.html">Bloop</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_BuildInfo.html">BuildInfo</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_BSP.html">BSP - Build Server Protocol</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_Codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_Docker.html">Docker</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_Flyway.html">Flyway</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_Gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_Play.html">Play Framework</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_Proguard.html">Proguard</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_ScalaPB.html">ScalaPB</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_Scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="TestNG_TestFramework.html">TestNG</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_Twirl.html">Twirl</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_VersionFile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="External_References.html">External References</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="External_References.html#_ammonite">Ammonite</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="External_References.html#_coursier">Coursier</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="External_References.html#_os_lib">OS-Lib</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.10.15</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../main-branch/index.html">main-branch</a>
        </li>
        <li class="version is-latest">
          <a href="../index.html">1.0.6</a>
        </li>
        <li class="version">
          <a href="../0.12.x/index.html">0.12.16</a>
        </li>
        <li class="version">
          <a href="../0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px; ">
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Modules</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Mill modules are <code>object</code>s extending <code>mill.Module</code>, and let you group related
tasks together to keep things neat and organized. Mill&#8217;s comes with built in
modules such as <code>mill.scalalib.ScalaModule</code> and <code>mill.scalalib.CrossSbtModule</code>,
but you can use modules for other purposes as well.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_modules"><a class="anchor" href="#_using_modules"></a>Using Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The path to a Mill module from the root of your build file corresponds to the
path you would use to run tasks within that module from the command line. e.g.
for the following build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo extends mill.Module {
  def bar = T { "hello" }
  object baz extends mill.Module {
    def qux = T { "world" }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You would be able to run the two targets via <code>mill foo.bar</code> or <code>mill
foo.baz.qux</code>. You can use <code>mill show foo.bar</code> or <code>mill show foo.baz.qux</code> to
make Mill echo out the string value being returned by each Target. The two
targets will store their output metadata &amp; files at <code>./out/foo/bar</code> and
<code>./out/foo/baz/qux</code> respectively.</p>
</div>
<div class="paragraph">
<p>Modules also provide a way to define and re-use common collections of tasks, via
Scala <code>trait</code>s. For example, you can define your own <code>FooModule</code> trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">trait FooModule extends mill.Module {
  def bar = T { "hello" }
  def baz = T { "world" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And use it to define multiple modules with the same <code>bar</code> and <code>baz</code> targets,
along with any other customizations such as <code>qux</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo1 extends FooModule
object foo2 extends FooModule {
  def qux = T { "I am Cow" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would make the following targets available from the command line</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mill show foo1.bar</code></p>
</li>
<li>
<p><code>mill show foo1.baz</code></p>
</li>
<li>
<p><code>mill show foo2.bar</code></p>
</li>
<li>
<p><code>mill show foo2.baz</code></p>
</li>
<li>
<p><code>mill show foo2.qux</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The built-in <code>mill.scalalib</code> package uses this to define
<code>mill.scalalib.ScalaModule</code>, <code>mill.scalalib.SbtModule</code> and
<code>mill.scalalib.TestScalaModule</code>, all of which contain a set of "standard"
operations such as <code>compile</code>, <code>jar</code> or <code>assembly</code> that you may expect from a
typical Scala module.</p>
</div>
<div class="paragraph">
<p>When defining your own module abstractions, in general you should use <code>trait</code>s
and not `class`es, except in the case of
<a href="https://com-lihaoyi.github.io/mill/page/cross-builds.html">Cross Builds</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overriding_targets"><a class="anchor" href="#_overriding_targets"></a>Overriding Targets</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">trait BaseModule extends Module {
  def foo = T { Seq("base") }
  def cmd(i: Int) = T.command { Seq("base" + i) }
}

object canOverrideSuper with BaseModule {
  def foo = T { super.foo() ++ Seq("object") }
  def cmd(i: Int) = T.command { super.cmd(i)() ++ Seq("object" + i) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override targets and commands to customize them or change what they do.
The overridden version is available via <code>super</code>. You can omit the <code>override</code>
keyword in Mill builds.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_millsourcepath"><a class="anchor" href="#_millsourcepath"></a>millSourcePath</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each Module has a <code>millSourcePath</code> field that corresponds to the path that module
expects its input files to be on disk. Re-visiting our examples above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo extends mill.Module {
  def bar = T { "hello" }
  object baz extends mill.Module {
    def qux = T { "world" }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>foo</code> module has a <code>millSourcePath</code> of <code>./foo</code>, while the <code>foo.baz</code> module has a
<code>millSourcePath</code> of <code>./foo/baz</code>.</p>
</div>
<div class="paragraph">
<p>You can use <code>millSourcePath</code> to automatically set the source folders of your
modules to match the build structure. You are not forced to rigidly use
<code>millSourcePath</code> to define the source folders of all your code, but it can simplify
the common case where you probably want your build-layout and on-disk-layout to
be the same.</p>
</div>
<div class="paragraph">
<p>E.g. for <code>mill.scalalib.ScalaModule</code>, the Scala source code is assumed by
default to be in <code>millSourcePath / "src"</code> while resources are automatically assumed to
be in <code>millSourcePath / "resources"</code>.</p>
</div>
<div class="paragraph">
<p>You can override <code>millSourcePath</code>:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo extends mill.Module {
  def millSourcePath = super.millSourcePath / "lols"
  def bar = T { "hello" }
  object baz extends mill.Module {
    def qux = T { "world" }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And any overrides propagate down to the module&#8217;s children: in the above example,
module <code>foo</code> would have its <code>millSourcePath</code> be <code>./foo/lols</code> while module`foo.baz`
would have its <code>millSourcePath</code> be <code>./foo/lols/baz</code>.</p>
</div>
<div class="paragraph">
<p>Note that <code>millSourcePath</code> is generally only used for a module&#8217;s input source files.
Output is always in the <code>out/</code> folder and cannot be changed, e.g. even with the
overridden <code>millSourcePath</code> the output paths are still the default <code>./out/foo/bar</code> and
<code>./out/foo/baz/qux</code> folders.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_modules"><a class="anchor" href="#_external_modules"></a>External Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Libraries for use in Mill can define <code>ExternalModule</code>s: <code>Module</code>s which are
shared between all builds which use that library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package foo
import mill._

object Bar extends mill.define.ExternalModule {
  def baz = T { 1 }
  def qux() = T.command { println(baz() + 1) }

  lazy val millDiscover = mill.define.Discover[this.type]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, <code>foo.Bar</code> is an <code>ExternalModule</code> living within the <code>foo</code>
Java package, containing the <code>baz</code> target and <code>qux</code> command. Those can be run
from the command line via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill foo.Bar/baz
mill foo.Bar/qux</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ExternalModule</code>s are useful for someone providing a library for use with Mill
that is shared by the entire build: for example,
<code>mill.scalalib.ZincWorkerApi/zincWorker</code> provides a shared Scala compilation
service &amp; cache that is shared between all <code>ScalaModule</code>s, and
<code>mill.scalalib.GenIdea/idea</code> lets you generate IntelliJ projects without
needing to define your own <code>T.command</code> in your <code>build.sc</code> file</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_foreign_modules"><a class="anchor" href="#_foreign_modules"></a>Foreign Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill can load other mill projects from external (or sub) folders,
using Ammonite&#8217;s <code>$file</code> magic import, allowing to depend on foreign modules.
This allows, for instance, to depend on other projects' sources, or split
your build logic into smaller files.</p>
</div>
<div class="paragraph">
<p>For instance, assuming the following structure :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">foo/
    build.sc
    bar/
        build.sc
baz/
    build.sc</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can write the following in <code>foo/build.sc</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $file.bar.build
import $file.^.baz.build
import mill._

def someFoo = T {

    ^.baz.build.someBaz(...)
    bar.build.someBar(...)
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the foreign tasks will be cached under <code>foo/out/foreign-modules/</code>.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="Task_Context_API.html">Task Context API</a></span>
  <span class="next"><a href="Cross_Builds.html">Cross Builds</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
