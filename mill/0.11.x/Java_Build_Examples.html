<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java Build Examples :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/javalib/build-examples.html">
    <link rel="prev" href="Java_Builtin_Commands.html">
    <link rel="next" href="Java_Module_Config.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style>
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />&nbsp;The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="0.11.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Java Quick Start</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Intro_to_Mill.html">Introduction to Mill for Java</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item is-current-page is-active" data-depth="1">
    <a class="nav-link" href="Java_Build_Examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Java_Module_Config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Java_Web_Build_Examples.html">Java Web Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Java_Case_Study_Netty.html">Java Case Study: Netty</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Scala Quick Start</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Intro_to_Mill.html">Introduction to Mill for Scala</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Scala_Build_Examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Scala_Module_Config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Scala_Web_Build_Examples.html">Scala Web Build Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Library_Dependencies.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Out_Dir.html">The Output Directory</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Tasks.html">Tasks</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Target_Query_Syntax.html">Target Query Syntax</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Extending_Mill.html">Extending Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="The_Mill_Evaluation_Model.html">The Mill Evaluation Model</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill Plugins</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Using_Plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_BSP.html">BSP - Build Server Protocol</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Third-Party Plugins</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Mill_Design_Principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="External_References.html">External References</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.11.13</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../main-branch/index.html">main-branch</a>
        </li>
        <li class="version">
          <a href="../dev-1.0.0-RC2-4-784a1c/index.html">dev-1.0.0-RC2-4-784a1c</a>
        </li>
        <li class="version is-latest">
          <a href="../index.html">0.12.14</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px; ">
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Java Build Examples</h1>
<div id="preamble">
<div class="sectionbody">
<script>
gtag('config', 'AW-16649289906');
</script>
<div class="paragraph">
<p>On this page, we will explore the Mill build tool via a series of simple Java
example projects. Each project demonstrates one particular feature of the Mill
build tool, and is also an executable codebase you can download and run. By the
end of this page, you will be familiar with how to configure Mill to work with
realistic Java codebases: cross-building, testing, and publishing them.</p>
</div>
<div class="paragraph">
<p>Many of the APIs covered here are listed in the API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://mill-build.org/api/latest/mill/main/RootModule.html"><code>mill.scalalib.RootModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/TestModule$.html"><code>mill.scalalib.TestModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/PublishModule.html"><code>mill.scalalib.PublishModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/CrossScalaModule.html"><code>mill.scalalib.CrossScalaModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/MavenModule.html"><code>mill.scalalib.MavenModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/CrossSbtModule.html"><code>mill.scalalib.CrossSbtModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/JavaModule.html"><code>mill.scalalib.JavaModule</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_configuration_overrides"><a class="anchor" href="#_common_configuration_overrides"></a>Common Configuration Overrides</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-javabuilds-1-common-config.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/javabuilds/1-common-config">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends RootModule with JavaModule {
  // You can have arbitrary numbers of third-party dependencies
  def ivyDeps = Agg(
    ivy"org.apache.commons:commons-text:1.12.0"
  )

  // Choose a main class to use for `.run` if there are multiple present
  def mainClass: T[Option[String]] = Some("foo.Foo2")

  // Add (or replace) source folders for the module to use
  def sources = T.sources{
    super.sources() ++ Seq(PathRef(millSourcePath / "custom-src"))
  }

  // Add (or replace) resource folders for the module to use
  def resources = T.sources{
    super.resources() ++ Seq(PathRef(millSourcePath / "custom-resources"))
  }

  // Generate sources at build time
  def generatedSources: T[Seq[PathRef]] = T {
    for(name &lt;- Seq("A", "B", "C")) os.write(
      T.dest / s"Foo$name.java",
      s"""
package foo;
public class Foo$name {
  public static String value = "hello $name";
}
      """.stripMargin
    )

    Seq(PathRef(T.dest))
  }

  // Pass additional JVM flags when `.run` is called or in the executable
  // generated by `.assembly`
  def forkArgs: T[Seq[String]] = Seq("-Dmy.custom.property=my-prop-value")

  // Pass additional environmental variables when `.run` is called. Note that
  // this does not apply to running externally via `.assembly
  def forkEnv: T[Map[String, String]] = Map("MY_CUSTOM_ENV" -&gt; "my-env-value")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of <code>millSourcePath</code>, <code>T.dest</code>, and <code>PathRef</code> when preforming
various filesystem operations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>millSourcePath</code> refers to the base path of the module. For the root
module, this is the root of the repo, and for inner modules it would be
the module path e.g. for module <code>foo.bar.qux</code> the <code>millSourcePath</code> would
be <code>foo/bar/qux</code>. This can also be overriden if necessary</p>
</li>
<li>
<p><code>T.dest</code> refers to the destination folder for a task in the <code>out/</code>
folder. This is unique to each task, and can act as both a scratch space
for temporary computations as well as a place to put "output" files,
without worrying about filesystem conflicts with other tasks</p>
</li>
<li>
<p><code>PathRef</code> is a way to return the <strong>contents</strong> of a file or folder, rather
than just its path as a string. This ensures that downstream tasks
properly invalidate when the contents changes even when the path stays
the same</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill run
Foo2.value: &lt;h1&gt;hello2&lt;/h1&gt;
Foo.value: &lt;h1&gt;hello&lt;/h1&gt;
FooA.value: hello A
FooB.value: hello B
FooC.value: hello C
MyResource: My Resource Contents
MyOtherResource: My Other Resource Contents
my.custom.property: my-prop-value
MY_CUSTOM_ENV: my-env-value

&gt; mill show assembly
".../out/assembly.dest/out.jar"

&gt; ./out/assembly.dest/out.jar # mac/linux
Foo2.value: &lt;h1&gt;hello2&lt;/h1&gt;
Foo.value: &lt;h1&gt;hello&lt;/h1&gt;
FooA.value: hello A
FooB.value: hello B
FooC.value: hello C
MyResource: My Resource Contents
MyOtherResource: My Other Resource Contents
my.custom.property: my-prop-value</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_tasks"><a class="anchor" href="#_custom_tasks"></a>Custom Tasks</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-javabuilds-2-custom-tasks.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/javabuilds/2-custom-tasks">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends RootModule with JavaModule {
  def ivyDeps = Agg(ivy"net.sourceforge.argparse4j:argparse4j:0.9.0")

  def generatedSources: T[Seq[PathRef]] = T {
    val prettyIvyDeps = for(ivyDep &lt;- ivyDeps()) yield {
      val org = ivyDep.dep.module.organization.value
      val name = ivyDep.dep.module.name.value
      val version = ivyDep.dep.version
      s""" "$org:$name:$version" """
    }
    val ivyDepsString = prettyIvyDeps.mkString(" + \"\\n\" + \n")
    os.write(
      T.dest / s"MyDeps.java",
      s"""
package foo;
public class MyDeps {
  public static String value =
    $ivyDepsString;
}
      """.stripMargin
    )

    Seq(PathRef(T.dest))
  }

  def lineCount: T[Int] = T {
    sources()
      .flatMap(pathRef =&gt; os.walk(pathRef.path))
      .filter(_.ext == "java")
      .map(os.read.lines(_).size)
      .sum
  }

  def forkArgs: T[Seq[String]] = Seq(s"-Dmy.line.count=${lineCount()}")

  def printLineCount() = T.command { println(lineCount()) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill lets you define new cached Targets using the <code>T {&#8230;&#8203;}</code> syntax,
depending on existing Targets e.g. <code>foo.sources</code> via the <code>foo.sources()</code>
syntax to extract their current value, as shown in <code>lineCount</code> above. The
return-type of a Target has to be JSON-serializable (using
<a href="https://github.com/lihaoyi/upickle">uPickle</a>) and the Target is cached when
first run until its inputs change (in this case, if someone edits the
<code>foo.sources</code> files which live in <code>foo/src</code>. Cached Targets cannot take
parameters.</p>
</div>
<div class="paragraph">
<p>Note that depending on a task requires use of parentheses after the task
name, e.g. <code>ivyDeps()</code>, <code>sources()</code> and <code>lineCount()</code>. This converts the
task of type <code>T[V]</code> into a value of type <code>V</code> you can make use in your task
implementation.</p>
</div>
<div class="paragraph">
<p>This example can be run as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill run --text hello
text: hello
MyDeps.value: net.sourceforge.argparse4j:argparse4j:0.9.0
my.line.count: 24

&gt; mill show lineCount
24

&gt; mill printLineCount
24</code></pre>
</div>
</div>
<div class="paragraph">
<p>Custom targets and commands can contain arbitrary code. Whether you want to
download files using <code>requests.get</code>, shell-out to Webpack
to compile some Javascript, generate sources to feed into a compiler, or
create some custom jar/zip assembly with the files you want , all of these
can simply be custom targets with your code running in the <code>T {&#8230;&#8203;}</code> block.</p>
</div>
<div class="paragraph">
<p>You can create arbitrarily long chains of dependent targets, and Mill will
handle the re-evaluation and caching of the targets' output for you.
Mill also provides you a <code>T.dest</code> folder for you to use as scratch space or
to store files you want to return: all files a task creates should live
within <code>T.dest</code>, and any files you want to modify should be copied into
<code>T.dest</code> before being modified. That ensures that the files belonging to a
particular target all live in one place, avoiding file-name conflicts and
letting Mill automatically invalidate the files when the target&#8217;s inputs
change.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overriding_tasks"><a class="anchor" href="#_overriding_tasks"></a>Overriding Tasks</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-javabuilds-3-override-tasks.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/javabuilds/3-override-tasks">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends JavaModule {

  def sources = T{
    os.write(
      T.dest / "Foo.java",
      """package foo;

public class Foo {
    public static void main(String[] args) {
        System.out.println("Hello World");
    }
}
      """.stripMargin
    )
    Seq(PathRef(T.dest))
  }

  def compile = T {
    println("Compiling...")
    super.compile()
  }

  def run(args: Task[Args] = T.task(Args())) = T.command {
    println("Running..." + args().value.mkString(" "))
    super.run(args)()
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can re-define targets and commands to override them, and use <code>super</code> if you
want to refer to the originally defined task. The above example shows how to
override <code>compile</code> and <code>run</code> to add additional logging messages, and we
override <code>sources</code> which was <code>T.sources</code> for the <code>src/</code> folder with a plain
<code>T{&#8230;&#8203;}</code> target that generates the  necessary source files on-the-fly.</p>
</div>
<div class="paragraph">
<p>Note that this example <strong>replaces</strong> your <code>src/</code> folder with the generated
sources. If you want to <strong>add</strong> generated sources, you can either override
<code>generatedSources</code>, or you can override <code>sources</code> and use <code>super</code> to
include the original source folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo2 extends JavaModule {
  def generatedSources = T{
    os.write(T.dest / "Foo.java", """...""")
    Seq(PathRef(T.dest))
  }
}

object foo3 extends JavaModule {
  def sources = T{
    os.write(T.dest / "Foo.java", """...""")
    super.sources() ++ Seq(PathRef(T.dest))
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Mill builds the <code>override</code> keyword is optional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill foo.run
Compiling...
Running...
Hello World</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nesting_modules"><a class="anchor" href="#_nesting_modules"></a>Nesting Modules</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-javabuilds-4-nested-modules.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/javabuilds/4-nested-modules">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

trait MyModule extends JavaModule {
  def ivyDeps = Agg(
    ivy"net.sourceforge.argparse4j:argparse4j:0.9.0",
    ivy"org.apache.commons:commons-text:1.12.0"
  )
}

object foo extends MyModule {
  def moduleDeps = Seq(bar, qux)

  object bar extends MyModule
  object qux extends MyModule {
    def moduleDeps = Seq(bar)
  }
}

object baz extends MyModule {
  def moduleDeps = Seq(foo.bar, foo.qux, foo)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modules can be nested arbitrarily deeply within each other. The outer module
can be the same kind of module as the ones within, or it can be a plain
<code>Module</code> if we just need a wrapper to put the modules in without any tasks
defined on the wrapper.</p>
</div>
<div class="paragraph">
<p>The outer module can also depend on the inner module (as shown above),
and vice versa, but not both at the same.</p>
</div>
<div class="paragraph">
<p>Running tasks on the nested modules requires the full module path
<code>foo.bar.run</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill resolve __.run
foo.bar.run
foo.qux.run
baz.run

&gt; mill foo.run --bar-text hello --qux-text world --foo-text today
Bar.value: &lt;h1&gt;hello&lt;/h1&gt;
Qux.value: &lt;p&gt;world&lt;/p&gt;
Foo.value: &lt;p&gt;today&lt;/p&gt;

&gt; mill baz.run --bar-text hello --qux-text world --foo-text today --baz-text yay
Bar.value: &lt;h1&gt;hello&lt;/h1&gt;
Qux.value: &lt;p&gt;world&lt;/p&gt;
Foo.value: &lt;p&gt;today&lt;/p&gt;
Baz.value: &lt;p&gt;yay&lt;/p&gt;

&gt; mill foo.qux.run --bar-text hello --qux-text world
Bar.value: &lt;h1&gt;hello&lt;/h1&gt;
Qux.value: &lt;p&gt;world&lt;/p&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_module_with_test_suite"><a class="anchor" href="#_java_module_with_test_suite"></a>Java Module With Test Suite</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-javabuilds-5-test-suite.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/javabuilds/5-test-suite">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends JavaModule {
  object test extends JavaTests {
    def testFramework = "com.novocode.junit.JUnitFramework"
    def ivyDeps = Agg(
      ivy"com.novocode:junit-interface:0.11",
      ivy"org.mockito:mockito-core:4.6.1"
    )
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This build defines a single module with a test suite, configured to use
"JUnit" as the testing framework, along with Mockito. Test suites are themselves
<code>JavaModule</code>s, nested within the enclosing module,
and have all the normal tasks like
<code>foo.test.compile</code> available to run, but with an additional <code>.test</code> task
that runs the tests. You can also run the test suite directly, in which case
it will run the <code>.test</code> task as the default task for that module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill foo.compile
compiling 1 ... source...

&gt; mill foo.test.compile
compiling 1 ... source...

&gt; mill foo.test.test
...foo.FooTests.hello ...
...foo.FooTests.world ...

&gt; mill foo.test
...foo.FooTests.hello ...
...foo.FooTests.world ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For convenience, you can also use one of the predefined test frameworks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TestModule.Junit4</code></p>
</li>
<li>
<p><code>TestModule.Junit5</code></p>
</li>
<li>
<p><code>TestModule.TestNg</code></p>
</li>
<li>
<p><code>TestModule.Munit</code></p>
</li>
<li>
<p><code>TestModule.ScalaTest</code></p>
</li>
<li>
<p><code>TestModule.Specs2</code></p>
</li>
<li>
<p><code>TestModule.Utest</code></p>
</li>
<li>
<p><code>TestModule.ZioTest</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object bar extends JavaModule {
  object test extends JavaTests with TestModule.Junit4{
    def ivyDeps = super.ivyDeps() ++ Agg(
      ivy"org.mockito:mockito-core:4.6.1"
    )
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill bar.test
...bar.BarTests.hello ...
...bar.BarTests.world ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, tests are run in a subprocess, and <code>forkArg</code> and <code>forkEnv</code> can be
overridden to pass JVM flags &amp; environment variables. You can also use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill foo.test.testLocal</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run tests in-process in an isolated classloader.</p>
</div>
<div class="paragraph">
<p>If you want to pass any arguments to the test framework, simply put them after
<code>foo.test</code> in the command line. e.g. <a href="https://github.com/com-lihaoyi/utest">uTest</a>
lets you pass in a selector to decide which test to run, which in Mill would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill bar.test bar.BarTests.hello
...bar.BarTests.hello ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define multiple test suites if you want, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object qux extends JavaModule {
  object test extends JavaTests with TestModule.Junit5
  object integration extends JavaTests with TestModule.Junit5
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example also demonstrates using Junit 5 instead of Junit 4,
with
Each of which will expect their sources to be in their respective <code>foo/test</code> and
<code>foo/integration</code> folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill qux.test
...qux.QuxTests...hello...
...qux.QuxTests...world...

&gt; mill qux.integration
...qux.QuxIntegrationTests...helloworld...

&gt; mill qux.{test,integration}
...qux.QuxTests...hello...
...qux.QuxTests...world...
...qux.QuxIntegrationTests...helloworld...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publish_module"><a class="anchor" href="#_publish_module"></a>Publish Module</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-javabuilds-6-publish-module.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/javabuilds/6-publish-module">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._, publish._

object foo extends JavaModule with PublishModule {
  def publishVersion = "0.0.1"

  def pomSettings = PomSettings(
    description = "Hello",
    organization = "com.lihaoyi",
    url = "https://github.com/lihaoyi/example",
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github("lihaoyi", "example"),
    developers = Seq(
      Developer("lihaoyi", "Li Haoyi", "https://github.com/lihaoyi")
    )
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example <code>JavaModule</code> with added publishing capabilities via
<code>PublishModule</code>. This requires that you define an additional
<code>publishVersion</code> and <code>pomSettings</code> with the relevant metadata, and provides
the <code>.publishLocal</code> and <code>publishSigned</code> tasks for publishing locally to the
machine or to the central maven repository</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill foo.publishLocal
Publishing Artifact(com.lihaoyi,foo,0.0.1) to ivy repo...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>artifactName</code> defaults to the name of your module (in this case <code>foo</code>)
but can be overridden. The <code>organization</code> is defined in <code>pomSettings</code>.</p>
</div>
<div class="paragraph">
<p>You may also check and update the values of <code>sonatypeUri</code> and <code>sonatypeSnapshotUri</code>,
which may not be correct if you have a newer Sonatype account (when created after Feb. 2021).</p>
</div>
<div class="sect2">
<h3 id="_staging_releases"><a class="anchor" href="#_staging_releases"></a>Staging Releases</h3>
<div class="paragraph">
<p>Once you&#8217;ve mixed in <code>PublishModule</code>, you can publish your libraries to maven
central via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill mill.scalalib.PublishModule/publishAll \
        foo.publishArtifacts \
        lihaoyi:$SONATYPE_PASSWORD \
        --gpgArgs --passphrase=$GPG_PASSWORD,--batch,--yes,-a,-b</code></pre>
</div>
</div>
<div class="paragraph">
<p>This uploads them to <code>oss.sonatype.org</code> where you can log-in and stage/release
them manually. You can also pass in the <code>--release true</code> flag to perform the
staging/release automatically:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Recent versions of <code>gpg</code> (versions 2.1 and above) require an additional argument
in order to accept a passphrase on the command line. Add <code>--pinentry-mode=loopback</code> to the
comma-separated list of <code>gpg</code> arguments after <code>--gpgArgs</code>, so it becomes
<code>--passphrase=$GPG_PASSWORD,--batch,--yes,-a,-b,--pinentry-mode=loopback</code>. Without the additional
argument, you may see errors like <code>gpg: signing failed: Inappropriate ioctl for device</code>.</p>
</div>
<div class="paragraph">
<p>Sonatype credentials can be passed via environment variables (<code>SONATYPE_USERNAME</code>
and <code>SONATYPE_PASSWORD</code>) or by passing second or <code>--sonatypeCreds</code> argument in format
<code>username:password</code>. Consider using environment variables over the direct CLI passing
due to security risks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill mill.scalalib.PublishModule/publishAll \
        foo.publishArtifacts \
        lihaoyi:$SONATYPE_PASSWORD \
        --gpgArgs --passphrase=$GPG_PASSWORD,--batch,--yes,-a,-b \
        --release true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to publish/release multiple modules, you can use the <code><em></code> or <code>_</em></code>
wildcard syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill mill.scalalib.PublishModule/publishAll \
        __.publishArtifacts \
        lihaoyi:$SONATYPE_PASSWORD \
        --gpgArgs --passphrase=$GPG_PASSWORD,--batch,--yes,-a,-b \
        --release true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To publish to repository other than <code>oss.sonaytype.org</code> such as internal hosted
nexus at <code>example.company.com</code>, you can pass in the <code>--sonatypeUri</code> and
<code>--sonatypeSnapshotUri</code> parameters to uploads to different site:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill mill.scalalib.PublishModule/publishAll \
        foo.publishArtifacts \
        lihaoyi:$SONATYPE_PASSWORD \
        --sonatypeUri http://example.company.com/release \
        --sonatypeSnaphostUri http://example.company.com/snapshot</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since Feb. 2021 any new Sonatype accounts have been created on
<code>s01.oss.sonatype.org</code>, so you&#8217;ll want to ensure you set the relevant URIs to match.</p>
</div>
<div class="paragraph">
<p>The symptom of using the "wrong" URL for publishling is typically a 403 error code, in response to the publish request.</p>
</div>
<div class="paragraph">
<p>See <a href="https://central.sonatype.org/publish/publish-guide/#releasing-to-central" class="bare">https://central.sonatype.org/publish/publish-guide/#releasing-to-central</a></p>
</div>
<div class="paragraph">
<p>Typically</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="https://s01.oss.sonatype.org/service/local" class="bare">https://s01.oss.sonatype.org/service/local</a></code> - for the <code>--sonatypeUri</code></p>
</li>
<li>
<p><code><a href="https://s01.oss.sonatype.org/content/repositories/snapshots" class="bare">https://s01.oss.sonatype.org/content/repositories/snapshots</a></code> - for <code>sonatypeSnapshotUri</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_non_staging_releases_classic_maven_uploads"><a class="anchor" href="#_non_staging_releases_classic_maven_uploads"></a>Non-Staging Releases (classic Maven uploads)</h3>
<div class="paragraph">
<p>If the site does not support staging releases as <code>oss.sonatype.org</code> and <code>s01.oss.sonatype.org</code> do (for
example, a self-hosted OSS nexus site), you can pass in the
<code>--stagingRelease false</code> option to simply upload release artifacts to corresponding
maven path under <code>sonatypeUri</code> instead of staging path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill mill.scalalib.PublishModule/publishAll \
        foo.publishArtifacts \
        lihaoyi:$SONATYPE_PASSWORD \
        --sonatypeUri http://example.company.com/release \
        --stagingRelease false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_compatible_modules"><a class="anchor" href="#_maven_compatible_modules"></a>Maven-Compatible Modules</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-javabuilds-8-compat-modules.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/javabuilds/8-compat-modules">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends MavenModule {
  object test extends MavenTests with TestModule.Junit4
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MavenModule</code> is a variant of <code>JavaModule</code>
that uses the more verbose folder layout of Maven, SBT, and other tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foo/src/main/java</code></p>
</li>
<li>
<p><code>foo/src/test/java</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rather than Mill&#8217;s</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foo/src</code></p>
</li>
<li>
<p><code>foo/test/src</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is especially useful if you are migrating from Maven to Mill (or vice
versa), during which a particular module may be built using both Maven and
Mill at the same time</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill foo.compile
compiling 1 Java source...

&gt; mill foo.test.compile
compiling 1 Java source...

&gt; mill foo.test.test
...foo.FooTests.hello ...

&gt; mill foo.test
...foo.FooTests.hello ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_realistic_java_example_project"><a class="anchor" href="#_realistic_java_example_project"></a>Realistic Java Example Project</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-javabuilds-9-realistic.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/javabuilds/9-realistic">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._, publish._

trait MyModule extends JavaModule with PublishModule {
  def publishVersion = "0.0.1"

  def pomSettings = PomSettings(
    description = "Hello",
    organization = "com.lihaoyi",
    url = "https://github.com/lihaoyi/example",
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github("lihaoyi", "example"),
    developers = Seq(Developer("lihaoyi", "Li Haoyi", "https://github.com/lihaoyi"))
  )

  def ivyDeps = Agg(ivy"org.apache.commons:commons-text:1.12.0")

  object test extends JavaTests with TestModule.Junit4
}

object foo extends MyModule {
  def moduleDeps = Seq(bar, qux)

  def generatedSources = T {
    os.write(
      T.dest / "Version.java",
      s"""
package foo;
public class Version {
    public static String value() {
        return "${publishVersion()}";
    }
}
      """.stripMargin
    )
    Seq(PathRef(T.dest))
  }
}

object bar extends MyModule {
  def moduleDeps = Seq(qux)
}

object qux extends MyModule</code></pre>
</div>
</div>
<div class="paragraph">
<p>A semi-realistic build setup, combining all the individual Mill concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Three `JavaModule`s that depend on each other</p>
</li>
<li>
<p>With unit testing and publishing set up</p>
</li>
<li>
<p>With generated sources to include the <code>publishVersion</code> as a string in the
code, so it can be printed at runtime</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that for multi-module builds like this, using queries to run tasks on
multiple targets at once can be very convenient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>__.test
__.publishLocal</pre>
</div>
</div>
<div class="paragraph">
<p>Also note how you can use <code>trait</code>s to bundle together common combinations of
modules: <code>My=Module</code> not only defines a <code>JavaModule</code> with some common
configuration, but it also defines a <code>object test</code> module within it with its
own configuration. This is a very useful technique for managing the often
repetitive module structure in a typical project</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill resolve __.run
bar.run
bar.test.run
foo.run
foo.test.run
qux.run

&gt; mill foo.run
foo version 0.0.1
Foo.value: &lt;h1&gt;hello&lt;/h1&gt;
Bar.value: &lt;p&gt;world&lt;/p&gt;
Qux.value: 31337

&gt; mill bar.test
...bar.BarTests.test ...

&gt; mill qux.run
Qux.value: 31337

&gt; mill __.compile

&gt; mill __.test
...bar.BarTests.test ...
...foo.FooTests.test ...

&gt; mill __.publishLocal
Publishing Artifact(com.lihaoyi,foo,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,bar,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,qux,0.0.1) to ivy repo...
...

&gt; mill show foo.assembly # mac/linux
".../out/foo/assembly.dest/out.jar"

&gt; ./out/foo/assembly.dest/out.jar # mac/linux
foo version 0.0.1
Foo.value: &lt;h1&gt;hello&lt;/h1&gt;
Bar.value: &lt;p&gt;world&lt;/p&gt;
Qux.value: 31337</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_builds_for_real_projects"><a class="anchor" href="#_example_builds_for_real_projects"></a>Example Builds for Real Projects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill comes bundled with example builds for real-world open-source projects,
demonstrating how Mill can be used to build code outside of tiny example codebases:</p>
</div>
<div class="sect2">
<h3 id="_jimfs"><a class="anchor" href="#_jimfs"></a>JimFS</h3>
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-thirdparty-jimfs.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/thirdparty/jimfs">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._, publish._

def sharedCompileIvyDeps = T{
  Agg(
    ivy"com.google.auto.service:auto-service:1.0.1",
    ivy"com.google.code.findbugs:jsr305:3.0.2",
    ivy"org.checkerframework:checker-compat-qual:2.5.5",
    ivy"com.ibm.icu:icu4j:73.1",
  )
}


object jimfs extends PublishModule with MavenModule {
  def publishVersion = "1.3.3.7"

  def pomSettings = PomSettings(
    description = artifactName(),
    organization = "com.google",
    url = "https://github.com/google/jimfs",
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github(owner = "google", repo = "jimfs"),
    developers = Nil
  )

  def ivyDeps = sharedCompileIvyDeps() ++ Agg(
    ivy"com.google.guava:guava:31.1-android",
  )

  def javacOptions = Seq("-processor", "com.google.auto.service.processor.AutoServiceProcessor")

  object test extends MavenTests {
    def ivyDeps = sharedCompileIvyDeps() ++ Agg(
      ivy"junit:junit:4.13.2",
      ivy"com.google.guava:guava-testlib:31.1-android",
      ivy"com.google.truth:truth:1.1.3",
      ivy"com.github.sbt:junit-interface:0.13.2",
      ivy"com.ibm.icu:icu4j:73.1",
    )

    def testFramework = "com.novocode.junit.JUnitFramework"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JimFS is a small Java library implementing an in-memory filesystem. It is commonly
used in test suites to validate filesystem operations without needing to write
to disk.</p>
</div>
<div class="paragraph">
<p>It has a relatively simple codebase structure, a single module and test suite.
It has a number of compile-time-only dependencies shared between the library and
test suite. One wrinkle is that it uses annotation processors as part of its build,
which Mill supports by providing the relevant <code>ivyDeps</code> of the annotation processor
and providing <code>javacOptions</code> to invoke it.</p>
</div>
<div class="paragraph">
<p>Project home: <a href="https://github.com/google/jimfs" class="bare">https://github.com/google/jimfs</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill jimfs.test
Test run com.google.common.jimfs.FileTest started
Test run com.google.common.jimfs.FileTest finished: 0 failed, 0 ignored, 7 total...
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_apache_commons_io"><a class="anchor" href="#_apache_commons_io"></a>Apache Commons IO</h3>
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-thirdparty-commons-io.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/thirdparty/commons-io">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._, publish._
import $ivy.`com.lihaoyi::mill-contrib-jmh:$MILL_VERSION`
import contrib.jmh.JmhModule

object commonsio extends RootModule with PublishModule with MavenModule {
  def publishVersion = "2.17.0-SNAPSHOT"

  def pomSettings = PomSettings(
    description = artifactName(),
    organization = "org.apache.commons",
    url = "https://github.com/apache/commons-io",
    licenses = Seq(License.`Apache-2.0`),
    versionControl = VersionControl.github(owner = "apache", repo = "commons-io"),
    developers = Nil
  )

  object test extends MavenTests with TestModule.Junit5 with  JmhModule{
    def jmhCoreVersion = "1.37"
    def ivyDeps = super.ivyDeps() ++ Agg(
      ivy"org.junit.jupiter:junit-jupiter:5.10.3",
      ivy"org.junit-pioneer:junit-pioneer:1.9.1",
      ivy"net.bytebuddy:byte-buddy:1.14.18",
      ivy"net.bytebuddy:byte-buddy-agent:1.14.18",
      ivy"org.mockito:mockito-inline:4.11.0",
      ivy"com.google.jimfs:jimfs:1.3.0",
      ivy"org.apache.commons:commons-lang3:3.14.0",
      ivy"commons-codec:commons-codec:1.17.1",
      ivy"org.openjdk.jmh:jmh-core:1.37",
      ivy"org.openjdk.jmh:jmh-generator-annprocess:1.37",
    )
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Apache Commons IO library contains utility classes, stream implementations, file filters,
file comparators, endian transformation classes, and much more.</p>
</div>
<div class="paragraph">
<p>The core library <code>commonsio</code> is dependency-free, but the test suite <code>commonsio.test</code>
as a number of libraries included. It also ships with JMH benchmarks, which Mill
supports via the built in JMH plugin</p>
</div>
<div class="paragraph">
<p>Project home: <a href="https://github.com/apache/commons-io" class="bare">https://github.com/apache/commons-io</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill compile
compiling 254 Java sources...
...

&gt; ./mill test.compile
compiling 261 Java sources...
...

&gt; ./mill test.testOnly org.apache.commons.io.FileUtilsTest
Test org.apache.commons.io.FileUtilsTest#testCopyFile1() started
Test org.apache.commons.io.FileUtilsTest#testCopyFile1() finished, took ...
...

&gt; ./mill test.testOnly org.apache.commons.io.FileSystemTest
Test org.apache.commons.io.FileSystemTest#testIsLegalName() started
Test org.apache.commons.io.FileSystemTest#testIsLegalName() finished, took ...
...

&gt; ./mill test.runJmh '.*PathUtilsContentEqualsBenchmark' -bm SingleShotTime
Benchmark                                                                Mode  Cnt ...
PathUtilsContentEqualsBenchmark.testCurrent_fileContentEquals              ss    5 ...
PathUtilsContentEqualsBenchmark.testCurrent_fileContentEquals_Blackhole    ss    5 ...
PathUtilsContentEqualsBenchmark.testProposal_contentEquals                 ss    5 ...
PathUtilsContentEqualsBenchmark.testProposal_contentEquals_Blackhole       ss    5 ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_real_world_mill_builds"><a class="anchor" href="#_real_world_mill_builds"></a>Real World Mill Builds</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_c3p0"><a class="anchor" href="#_c3p0"></a>C3P0</h3>
<div class="paragraph">
<p><a href="https://github.com/swaldman/c3p0">C3P0</a> is a JDBC connection pooling library
written in Java, built using the Mill build tool.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="Java_Builtin_Commands.html">Built-in Commands</a></span>
  <span class="next"><a href="Java_Module_Config.html">Java Module Configuration</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
