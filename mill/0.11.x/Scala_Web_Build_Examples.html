<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Scala Web Build Examples :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/0.11.x/Scala_Web_Build_Examples.html">
    <link rel="prev" href="Scala_Module_Config.html">
    <link rel="next" href="Library_Dependencies.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style>
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />&nbsp;The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="0.11.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Java Quick Start</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Intro_to_Mill.html">Introduction to Mill for Java</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Java_Build_Examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Java_Module_Config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Java_Web_Build_Examples.html">Java Web Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Java_Case_Study_Netty.html">Java Case Study: Netty</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Scala Quick Start</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Intro_to_Mill.html">Introduction to Mill for Scala</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Scala_Build_Examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Scala_Module_Config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item is-current-page is-active" data-depth="1">
    <a class="nav-link" href="Scala_Web_Build_Examples.html">Scala Web Build Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Library_Dependencies.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Out_Dir.html">The Output Directory</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Tasks.html">Tasks</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Target_Query_Syntax.html">Target Query Syntax</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Extending_Mill.html">Extending Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="The_Mill_Evaluation_Model.html">The Mill Evaluation Model</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill Plugins</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Using_Plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="Plugin_BSP.html">BSP - Build Server Protocol</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Third-Party Plugins</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Mill_Design_Principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="External_References.html">External References</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.11.13</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../main-branch/index.html">main-branch</a>
        </li>
        <li class="version">
          <a href="../dev-1.0.0-RC3-25-664912/index.html">dev-1.0.0-RC3-25-664912</a>
        </li>
        <li class="version is-latest">
          <a href="../index.html">0.12.14</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px; ">
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Scala Web Build Examples</h1>
<div id="preamble">
<div class="sectionbody">
<script>
gtag('config', 'AW-16649289906');
</script>
<div class="paragraph">
<p>This page contains examples of using Mill as a build tool for web-applications.
It covers setting up a basic backend server, Todo-MVC app, topics like cache
busting, as well as usage of Scala.js both as standalone modules as well as
integrated with your backend Scala-JVM web server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_todomvc_web_app"><a class="anchor" href="#_todomvc_web_app"></a>TodoMVC Web App</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-web-1-todo-webapp.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/web/1-todo-webapp">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

object root extends RootModule with ScalaModule {
  def scalaVersion = "2.13.8"
  def ivyDeps = Agg(
    ivy"com.lihaoyi::cask:0.9.1",
    ivy"com.lihaoyi::scalatags:0.12.0"
  )

  object test extends ScalaTests {
    def testFramework = "utest.runner.Framework"

    def ivyDeps = Agg(
      ivy"com.lihaoyi::utest::0.8.4",
      ivy"com.lihaoyi::requests::0.6.9",
    )
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example demonstrates how to set up a simple Scala webserver
implementing the popular Todo-MVC demo application. It includes a test suite
that spins up the web server locally and makes HTTP requests against it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill test
+ webapp.WebAppTests.simpleRequest...

&gt; ./mill runBackground

&gt; curl http://localhost:8080
...What needs to be done...
...

&gt; ./mill clean runBackground</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_webapp_cache_busting"><a class="anchor" href="#_webapp_cache_busting"></a>Webapp Cache Busting</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-web-2-webapp-cache-busting.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/web/2-webapp-cache-busting">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._
import java.util.Arrays

object root extends RootModule with ScalaModule {
  def scalaVersion = "2.13.8"
  def ivyDeps = Agg(
    ivy"com.lihaoyi::cask:0.9.1",
    ivy"com.lihaoyi::scalatags:0.12.0",
    ivy"com.lihaoyi::os-lib:0.9.1"
  )

  def resources = T {
    val hashMapping = for {
      resourceRoot &lt;- super.resources()
      path &lt;- os.walk(resourceRoot.path)
      if os.isFile(path)
    } yield hashFile(path, resourceRoot.path, T.dest)

    os.write(
      T.dest / "hashed-resource-mapping.json",
      upickle.default.write(hashMapping.toMap, indent = 4)
    )

    Seq(PathRef(T.dest))
  }

  object test extends ScalaTests {
    def testFramework = "utest.runner.Framework"
    def ivyDeps = Agg(
      ivy"com.lihaoyi::utest::0.8.4",
      ivy"com.lihaoyi::requests::0.6.9",
    )
  }
}

def hashFile(path: os.Path, src: os.Path, dest: os.Path) = {
  val hash = Integer.toHexString(Arrays.hashCode(os.read.bytes(path)))
  val relPath = path.relativeTo(src)
  val ext = if (relPath.ext == "") "" else s".${relPath.ext}"
  val hashedPath = relPath / os.up / s"${relPath.baseName}-$hash$ext"
  os.copy(path, dest / hashedPath, createFolders = true)
  (relPath.toString(), hashedPath.toString())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example demonstrates how to implement webapp "cache busting" in Mill,
where we serve static files with a hash appended to the filename, and save
a mapping of filename to hashed filename so that the web server can serve
HTML that references the appropriately hashed file paths. This allows us to
deploy the static files behind caches with long expiration times, while
still having the web app immediately load updated static files after a
deploy (since the HTML will reference new hashed paths that are not yet
in the cache).</p>
</div>
<div class="paragraph">
<p>We do this in an overrride of the <code>resources</code> target, that loads
<code>super.resources()</code>, hashes the files within it using <code>Arrays.hashCode</code>, and
copies the files to a new hashed path saving the overall mapping to a
<code>hashed-resource-mapping.json</code>. The webapp then loads the mapping at runtime
and uses it to serve HTML referencing the hashed paths, but without paying
the cost of hashing the static resource files at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill test
+ webapp.WebAppTests.simpleRequest ...

&gt; ./mill runBackground

&gt; curl http://localhost:8081
...What needs to be done...
...

&gt; curl http://localhost:8081/static/main-6da98e99.js # mac/linux
initListeners()

&gt; ./mill clean runBackground</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scala_js_modules"><a class="anchor" href="#_scala_js_modules"></a>Scala.js Modules</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-web-3-scalajs-module.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/web/3-scalajs-module">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._, scalajslib._

object foo extends ScalaJSModule {
  def scalaVersion = "2.13.14"
  def scalaJSVersion = "1.16.0"
  def ivyDeps = Agg(ivy"com.lihaoyi::scalatags::0.12.0")
  object test extends ScalaJSTests {
    def ivyDeps = Agg(ivy"com.lihaoyi::utest::0.8.4")
    def testFramework = "utest.runner.Framework"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This build defines a single <code>ScalaJSModule</code> with a test suite.
<code>ScalaJSModule</code> is similar to <code>ScalaModule</code>, except it requires a
<code>scalaJSVersion</code> to be provided.</p>
</div>
<div class="paragraph">
<p>By default, Scala.js code gets access to the <code>scala.scalajs.js</code> package,
which contains the core JS APIs like <code>js.JSON</code>, <code>js.Date</code>, etc. <code>ivyDeps</code> of
Scala.js-compatible dependencies can be given, which need two colons (<code>::</code>)
on the right to indicate it&#8217;s a Scala.js dependency. These can be both Scala
libraries compiled to JS, or facades for Javascript libraries. If running in
the browser, you can use the <a href="https://github.com/scala-js/scala-js-dom" class="bare">https://github.com/scala-js/scala-js-dom</a> facade
to access the browser DOM APIs.</p>
</div>
<div class="paragraph">
<p>Normal tasks like <code>compile</code>, <code>run</code>, or <code>test</code> work as expected, with <code>run</code>
and <code>test</code> calling <code>node</code> to run in a Javascript environment rather than in
the JVM. There is also additional <code>fastLinkJS</code> and <code>fullLinkJS</code> commands
that compile the module into a single Javascript file, which you can then
distribute or deploy with your web application</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill foo.run
&lt;h1&gt;Hello World&lt;/h1&gt;
stringifiedJsObject: ["hello","world","!"]

&gt; ./mill foo.test
+ foo.FooTests.hello...

&gt; ./mill show foo.fullLinkJS # mac/linux
{
...
..."jsFileName": "main.js",
  "dest": ".../out/foo/fullLinkJS.dest"
}

&gt; node out/foo/fullLinkJS.dest/main.js # mac/linux
&lt;h1&gt;Hello World&lt;/h1&gt;
stringifiedJsObject: ["hello","world","!"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that running Scala.js modules locally requires the <code>node</code> Javascript
runtime to be installed on your machine.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scala_js_webserver_integration"><a class="anchor" href="#_scala_js_webserver_integration"></a>Scala.js Webserver Integration</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-web-4-webapp-scalajs.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/web/4-webapp-scalajs">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._, scalajslib._

object root extends RootModule with ScalaModule {

  def scalaVersion = "2.13.14"
  def ivyDeps = Agg(
    ivy"com.lihaoyi::cask:0.9.1",
    ivy"com.lihaoyi::scalatags:0.12.0"
  )

  def resources = T {
    os.makeDir(T.dest / "webapp")
    val jsPath = client.fastLinkJS().dest.path
    // Move main.js[.map]into the proper filesystem position
    // in the resource folder for the web server code to pick up
    os.copy(jsPath / "main.js", T.dest / "webapp" / "main.js")
    os.copy(jsPath / "main.js.map", T.dest / "webapp" / "main.js.map")
    super.resources() ++ Seq(PathRef(T.dest))
  }

  object test extends ScalaTests {
    def testFramework = "utest.runner.Framework"

    def ivyDeps = Agg(
      ivy"com.lihaoyi::utest::0.8.4",
      ivy"com.lihaoyi::requests::0.6.9",
    )
  }

  object client extends ScalaJSModule {
    def scalaVersion = "2.13.14"
    def scalaJSVersion = "1.16.0"
    def ivyDeps = Agg(ivy"org.scala-js::scalajs-dom::2.2.0")
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A minimal example of a Scala-JVM backend server wired up with a Scala.js
front-end. The backend code is identical to the <a href="#_todomvc_web_app">TodoMVC Web App</a> example, but
we replace the <code>main.js</code> client side code with the Javascript output of
<code>ClientApp.scala</code>.</p>
</div>
<div class="paragraph">
<p>Note that the client-side Scala code is the simplest 1-to-1 translation of
the original Javascript, using <code>scalajs-dom</code>, as this example is intended to
demonstrate the <code>build.sc</code> config in Mill. A real codebase is likely to use
Javascript or Scala UI frameworks to manage the UI, but those are beyond the
scope of this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill test
+ webapp.WebAppTests.simpleRequest ...

&gt; ./mill runBackground

&gt; curl http://localhost:8082
...What needs to be done...
...

&gt; curl http://localhost:8082/static/main.js
..."org.scalajs.linker.runtime.RuntimeLong"...
...

&gt; ./mill clean runBackground</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scala_jsscala_jvm_code_sharing"><a class="anchor" href="#_scala_jsscala_jvm_code_sharing"></a>Scala.js/Scala-JVM Code Sharing</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-web-5-webapp-scalajs-shared.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/web/5-webapp-scalajs-shared">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._, scalajslib._

trait AppScalaModule extends ScalaModule {
  def scalaVersion = "3.3.3"
}

trait AppScalaJSModule extends AppScalaModule with ScalaJSModule {
  def scalaJSVersion = "1.16.0"
}

object root extends RootModule with AppScalaModule {
  def moduleDeps = Seq(shared.jvm)
  def ivyDeps = Agg(ivy"com.lihaoyi::cask:0.9.1")

  def resources = T{
    os.makeDir(T.dest / "webapp")
    val jsPath = client.fastLinkJS().dest.path
    os.copy(jsPath / "main.js", T.dest / "webapp" / "main.js")
    os.copy(jsPath / "main.js.map", T.dest / "webapp" / "main.js.map")
    super.resources() ++ Seq(PathRef(T.dest))
  }

  object test extends ScalaTests with TestModule.Utest {

    def ivyDeps = Agg(
      ivy"com.lihaoyi::utest::0.8.4",
      ivy"com.lihaoyi::requests::0.6.9",
    )
  }

  object shared extends Module {
    trait SharedModule extends AppScalaModule with PlatformScalaModule {
      def ivyDeps = Agg(
        ivy"com.lihaoyi::scalatags::0.12.0",
        ivy"com.lihaoyi::upickle::3.0.0",
      )
    }

    object jvm extends SharedModule
    object js extends SharedModule with AppScalaJSModule
  }

  object client extends AppScalaJSModule {
    def moduleDeps = Seq(shared.js)
    def ivyDeps = Agg(ivy"org.scala-js::scalajs-dom::2.2.0")
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Scala-JVM backend server wired up with a Scala.js front-end, with a
<code>shared</code> module containing code that is used in both client and server.
Rather than the server sending HTML for the initial page load and HTML for
page updates, it sends HTML for the initial load and JSON for page updates
which is then rendered into HTML on the client.</p>
</div>
<div class="paragraph">
<p>The JSON serialization logic and HTML generation logic in the <code>shared</code> module
is shared between client and server, and uses libraries like uPickle and
Scalatags which work on both ScalaJVM and Scala.js. This allows us to freely
move code between the client and server, without worrying about what
platform or language the code was originally implemented in.</p>
</div>
<div class="paragraph">
<p>This is a minimal example of shared code compiled to ScalaJVM and Scala.js,
running on both client and server, meant for illustrating the build
configuration. A full exploration of client-server code sharing techniques
is beyond the scope of this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill test
+ webapp.WebAppTests.simpleRequest ...

&gt; ./mill runBackground

&gt; curl http://localhost:8083
...What needs to be done...
...

&gt; curl http://localhost:8083/static/main.js
...Scala.js...
...

&gt; ./mill clean runBackground</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishing_cross_platform_scala_modules"><a class="anchor" href="#_publishing_cross_platform_scala_modules"></a>Publishing Cross-Platform Scala Modules</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-web-6-cross-version-platform-publishing.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/web/6-cross-version-platform-publishing">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._, scalajslib._, publish._

object foo extends Cross[FooModule]("2.13.14", "3.3.3")
trait FooModule extends Cross.Module[String] {
  trait Shared extends CrossScalaModule with CrossValue with PlatformScalaModule with PublishModule {
    def publishVersion = "0.0.1"

    def pomSettings = PomSettings(
      description = "Hello",
      organization = "com.lihaoyi",
      url = "https://github.com/lihaoyi/example",
      licenses = Seq(License.MIT),
      versionControl = VersionControl.github("lihaoyi", "example"),
      developers = Seq(Developer("lihaoyi", "Li Haoyi", "https://github.com/lihaoyi"))
    )

    def ivyDeps = Agg(ivy"com.lihaoyi::scalatags::0.12.0")
  }

  trait FooTestModule extends TestModule {
    def ivyDeps = Agg(ivy"com.lihaoyi::utest::0.8.4")
    def testFramework = "utest.runner.Framework"
  }

  trait SharedJS extends Shared with ScalaJSModule {
    def scalaJSVersion = "1.16.0"
  }

  object bar extends Module {
    object jvm extends Shared{
      object test extends ScalaTests with FooTestModule
    }
    object js extends SharedJS {
      object test extends ScalaJSTests with FooTestModule
    }
  }

  object qux extends Module {
    object jvm extends Shared {
      def moduleDeps = Seq(bar.jvm)
      def ivyDeps = super.ivyDeps() ++ Agg(ivy"com.lihaoyi::upickle::3.0.0")

      object test extends ScalaTests with FooTestModule
    }

    object js extends SharedJS {
      def moduleDeps = Seq(bar.js)

      object test extends ScalaJSTests with FooTestModule
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example demonstrates how to publish Scala modules which are both
cross-version and cross-platform: running on both Scala 2.13.14/3.3.3 as
well as Scala-JVM/JS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill show foo[2.13.14].bar.jvm.sources
[
  ".../foo/bar/src",
  ".../foo/bar/src-jvm",
  ".../foo/bar/src-2.13.14",
  ".../foo/bar/src-2.13.14-jvm",
  ".../foo/bar/src-2.13",
  ".../foo/bar/src-2.13-jvm",
  ".../foo/bar/src-2",
  ".../foo/bar/src-2-jvm"
]

&gt; ./mill show foo[3.3.3].qux.js.sources
[
  ".../foo/qux/src",
  ".../foo/qux/src-js",
  ".../foo/qux/src-3.3.3",
  ".../foo/qux/src-3.3.3-js",
  ".../foo/qux/src-3.3",
  ".../foo/qux/src-3.3-js",
  ".../foo/qux/src-3",
  ".../foo/qux/src-3-js"
]

&gt; ./mill foo[2.13.14].qux.jvm.run
Bar.value: &lt;p&gt;world Specific code for Scala 2.x&lt;/p&gt;
Parsing JSON with ujson.read
Qux.main: Set(&lt;p&gt;i&lt;/p&gt;, &lt;p&gt;cow&lt;/p&gt;, &lt;p&gt;me&lt;/p&gt;)

&gt; ./mill foo[3.3.3].qux.js.run
Bar.value: &lt;p&gt;world Specific code for Scala 3.x&lt;/p&gt;
Parsing JSON with js.JSON.parse
Qux.main: Set(&lt;p&gt;i&lt;/p&gt;, &lt;p&gt;cow&lt;/p&gt;, &lt;p&gt;me&lt;/p&gt;)

&gt; ./mill foo[3.3.3].__.js.test
+ bar.BarTests.test ...  &lt;p&gt;world Specific code for Scala 3.x&lt;/p&gt;
+ qux.QuxTests.parseJsonGetKeys ...  Set(i, cow, me)

&gt; ./mill __.publishLocal
Publishing Artifact(com.lihaoyi,foo-bar_sjs1_2.13,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,foo-bar_2.13,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,foo-qux_sjs1_2.13,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,foo-qux_2.13,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,foo-bar_sjs1_3,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,foo-bar_3,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,foo-qux_sjs1_3,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,foo-qux_3,0.0.1) to ivy repo...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishing_cross_platform_scala_modules_alternative"><a class="anchor" href="#_publishing_cross_platform_scala_modules_alternative"></a>Publishing Cross-Platform Scala Modules Alternative</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.13/0.11.13-example-web-7-cross-platform-version-publishing.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.11.13/example/web/7-cross-platform-version-publishing">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._, scalajslib._, publish._

trait Shared extends CrossScalaModule with PlatformScalaModule with PublishModule {
  def publishVersion = "0.0.1"

  def pomSettings = PomSettings(
    description = "Hello",
    organization = "com.lihaoyi",
    url = "https://github.com/lihaoyi/example",
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github("lihaoyi", "example"),
    developers = Seq(Developer("lihaoyi", "Li Haoyi", "https://github.com/lihaoyi"))
  )

  def ivyDeps = Agg(ivy"com.lihaoyi::scalatags::0.12.0")
}

trait SharedTestModule extends TestModule {
  def ivyDeps = Agg(ivy"com.lihaoyi::utest::0.8.4")
  def testFramework = "utest.runner.Framework"
}

trait SharedJS extends Shared with ScalaJSModule {
  def scalaJSVersion = "1.16.0"
}

val scalaVersions = Seq("2.13.14", "3.3.3")

object bar extends Module {
  object jvm extends Cross[JvmModule](scalaVersions)
  trait JvmModule extends Shared {
    object test extends ScalaTests with SharedTestModule
  }

  object js extends Cross[JsModule](scalaVersions)
  trait JsModule extends SharedJS {
    object test extends ScalaJSTests with SharedTestModule
  }
}

object qux extends Module {
  object jvm extends Cross[JvmModule](scalaVersions)
  trait JvmModule extends Shared {
    def moduleDeps = Seq(bar.jvm())
    def ivyDeps = super.ivyDeps() ++ Agg(ivy"com.lihaoyi::upickle::3.0.0")

    object test extends ScalaTests with SharedTestModule
  }

  object js extends Cross[JsModule](scalaVersions)
  trait JsModule extends SharedJS {
    def moduleDeps = Seq(bar.js())

    object test extends ScalaJSTests with SharedTestModule
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example demonstrates an alternative way of defining your cross-platform
cross-version modules: rather than wrapping them all in a <code>foo</code>
cross-module to provide the different versions, we instead give each module
<code>bar.jvm</code>, <code>bar.js</code>, <code>qux.jvm</code>, <code>qux.js</code> its own <code>Cross</code> module. This
approach can be useful if the different cross modules need to support
different sets of Scala versions, as it allows you to specify the
<code>scalaVersions</code> passed to each individual cross module separately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill show qux.js[3.3.3].sources
[
  ".../qux/src",
  ".../qux/src-js",
  ".../qux/src-3.3.3",
  ".../qux/src-3.3.3-js",
  ".../qux/src-3.3",
  ".../qux/src-3.3-js",
  ".../qux/src-3",
  ".../qux/src-3-js"
]

&gt; ./mill show qux.js[3.3.3].test.sources
[
  ".../qux/test/src",
  ".../qux/test/src-js",
  ".../qux/test/src-3.3.3",
  ".../qux/test/src-3.3.3-js",
  ".../qux/test/src-3.3",
  ".../qux/test/src-3.3-js",
  ".../qux/test/src-3",
  ".../qux/test/src-3-js"
]

&gt; ./mill qux.jvm[2.13.14].run
Bar.value: &lt;p&gt;world Specific code for Scala 2.x&lt;/p&gt;
Parsing JSON with ujson.read
Qux.main: Set(&lt;p&gt;i&lt;/p&gt;, &lt;p&gt;cow&lt;/p&gt;, &lt;p&gt;me&lt;/p&gt;)

&gt; ./mill __.js[3.3.3].test
+ bar.BarTests.test ...  &lt;p&gt;world Specific code for Scala 3.x&lt;/p&gt;
+ qux.QuxTests.parseJsonGetKeys ...  Set(i, cow, me)

&gt; ./mill __.publishLocal
...
Publishing Artifact(com.lihaoyi,bar_sjs1_2.13,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,bar_2.13,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,qux_sjs1_2.13,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,qux_2.13,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,bar_sjs1_3,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,bar_3,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,qux_sjs1_3,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,qux_3,0.0.1) to ivy repo...</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="Scala_Module_Config.html">Scala Module Configuration</a></span>
  <span class="next"><a href="Library_Dependencies.html">Library Dependencies in Mill</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
