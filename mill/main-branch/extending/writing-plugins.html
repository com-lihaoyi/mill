<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Writing Mill Plugins :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/extending/writing-plugins.html" />
    <link rel="prev" href="running-jvm-code.html" />
    <link rel="next" href="meta-build.html" />
    <meta name="generator" content="Antora 3.1.12" />
    <link rel="stylesheet" href="../../../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../../_/favicon.png" type="image/x-icon" />
  
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style></head><body class="article">
  
<header class="header">
  
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../../_/logo-white.svg" height="20" /> The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/mill.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="main-branch">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../javalib/intro.html">Building Java with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/config.html">Config-Based Java Modules</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/script.html">Java Single-File Scripts</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/module-config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/dependencies.html">Java Library Dependencies</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/testing.html">Testing Java Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/linting.html">Linting Java Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/publishing.html">Java Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/build-examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/web-examples.html">Java Web Project Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/spring-boot.html">Spring Boot Projects</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scalalib/intro.html">Building Scala with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/config.html">Config-Based Scala Modules</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/script.html">Scala Single-File Scripts</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/module-config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/dependencies.html">Scala Library Dependencies</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/testing.html">Testing Scala Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/linting.html">Linting Scala Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/publishing.html">Scala Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/build-examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/web-examples.html">Scala Web Project Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/native-examples.html">Scala Native Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/spark.html">Spark Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kotlinlib/intro.html">Building Kotlin with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/config.html">Config-Based Kotlin Modules</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/script.html">Kotlin Single-File Scripts</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/module-config.html">Kotlin Module Configuration</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/dependencies.html">Kotlin Library Dependencies</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/testing.html">Testing Kotlin Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/linting.html">Linting Kotlin Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/publishing.html">Kotlin Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/web-examples.html">Kotlin Web Project Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Experimental Platform Support</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Building Android Apps</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/android-initial-setup.html">Android Initial Setup</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/android-release.html">Android Release Guide</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/ide.html">Android IDE Support</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/java.html">Android Java Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/kotlin.html">Android Kotlin Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/android-linting.html">Linting Android Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/compose-samples.html">Android Jetpack Compose</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/hilt-sample.html">Android Hilt Sample</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/android-native-example.html">Android Native Example</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../pythonlib/intro.html">Building Python with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/module-config.html">Python Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/dependencies.html">Python Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/linting.html">Linting Python Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../pythonlib/testing.html">Testing Python Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../pythonlib/publishing.html">Python Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../pythonlib/web-examples.html">Python Web Project Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../javascriptlib/intro.html">Building Javascript with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/dependencies.html">Typescript Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/module-config.html">Typescript Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/testing.html">Testing Typescript Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../javascriptlib/linting.html">Linting Typescript Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../javascriptlib/publishing.html">Typescript Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../javascriptlib/build-examples.html">JavaScript Build Examples</a>
  </li>
</ul>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../comparisons/why-mill.html">Why Use Mill?</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/maven.html">Case Study: Mill vs Maven</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/gradle.html">Case Study: Mill vs Gradle</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/sbt.html">Case Study: Mill vs <code>sbt</code></a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The Mill CLI</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/installation-ide.html">Installation &amp; IDE Setup</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/flags.html">Mill Command-Line Flags</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../cli/query-syntax.html">Task Query Syntax</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../cli/build-header.html">Build Header Config</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../migrating/migrating.html">Migrating to Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migrating/auto-migrating.html">Automated Migration Tools</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill Fundamentals</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/out-dir.html">The Output Directory</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/library-deps.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/cross-builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/bundled-libraries.html">Bundled Libraries</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/configuring-jvm-versions.html">Configuring JVM Versions</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extending Mill</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="import-mvn-plugins.html">Import Libraries and Plugins</a>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="contrib-plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/sonatypecentral.html">Sonatype Central (Plugin Moved to Scalalib)</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="thirdparty-plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="running-jvm-code.html">Running Dynamic JVM Code</a>
  </li>

  <li class="nav-item is-current-page is-active" data-depth="2">
    <a class="nav-link" href="writing-plugins.html">Writing Mill Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="meta-build.html">The Mill Meta-Build</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="example-typescript-support.html">Example: Typescript Support</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="example-python-support.html">Example: Python Support</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../large/large.html">Large Builds and Monorepos</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../large/selective-execution.html">Selective Test Execution</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../large/multi-file-builds.html">Multi-File Builds</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../large/multi-language-builds.html">Multi-Language Builds</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/evaluation-model.html">The Mill Evaluation Model</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/caching.html">Caching in Mill</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/parallelism.html">Parallelism in Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/process-architecture.html">The Mill Process Architecture</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/sandboxing.html">Mill Sandboxing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/design-principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/why-scala.html">Why does Mill use Scala?</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill.html">Mill API Reference</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/com-lihaoyi/mill/blob/main/changelog.adoc">Changelog</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/talks-blog-posts.html">Talks &amp; Blog Posts</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">main-branch</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">main-branch</a>
        </li>
        <li class="version">
          <a href="../../dev-1.1.0-RC2-72-c5e504/index.html">dev-1.1.0-RC2-72-c5e504</a>
        </li>
        <li class="version is-latest">
          <a href="../../index.html">1.1.0-RC2</a>
        </li>
        <li class="version">
          <a href="../../1.0.x/index.html">1.0.6</a>
        </li>
        <li class="version">
          <a href="../../0.12.x/index.html">0.12.16</a>
        </li>
        <li class="version">
          <a href="../../0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../../0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px;">
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/docs/modules/ROOT/pages/extending/writing-plugins.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Writing Mill Plugins</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This example demonstrates how to write and test Mill plugin, and publish it to
Sonatype’s Maven Central so it can be used by other developers over the internet
via <a href="import-mvn-plugins.html" class="xref page">//| mvnDeps</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_configuration"><a class="anchor" href="#_project_configuration"></a>Project Configuration</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-1-writing-mill-plugins.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/1-writing-mill-plugins">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill.*, scalalib.*, publish.*

object myplugin extends ScalaModule, PublishModule {
  def millVersion = &quot;1.0.6&quot;

  def scalaVersion = &quot;3.7.4&quot;

  def jvmId = &quot;11&quot;

  // Set the `platformSuffix` so the name indicates what Mill version it is compiled for
  def platformSuffix = s&quot;_mill1&quot;

  // Depend on `mill-libs` so we can compile against Mill APIs
  def mvnDeps = Seq(mvn&quot;com.lihaoyi::mill-libs:$millVersion&quot;)

  object test extends ScalaTests, TestModule.Utest { // Unit test submodule
    def mvnDeps = Seq(mvn&quot;com.lihaoyi::mill-testkit:$millVersion&quot;)
  }

  // Publishing Config
  def publishVersion = &quot;0.0.1&quot;

  def pomSettings = PomSettings(
    description = &quot;Line Count Mill Plugin&quot;,
    organization = &quot;com.lihaoyi&quot;,
    url = &quot;https://github.com/lihaoyi/myplugin&quot;,
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github(&quot;lihaoyi&quot;, &quot;myplugin&quot;),
    developers = Seq(Developer(&quot;lihaoyi&quot;, &quot;Li Haoyi&quot;, &quot;https://github.com/lihaoyi&quot;))
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill plugins are fundamentally just JVM libraries that depend on Mill. Any vanilla JVM
library (whether written in Java or Scala) can be used in a Mill <code>build.mill</code> file via
<code>//| mvnDeps</code>, but Mill plugins tend to integrate with Mill by defining a
<a href="../fundamentals/modules.html#_module_traits" class="xref page">trait for modules in your <code>build.mill</code> to inherit from</a>.</p>
</div>
<div class="paragraph">
<p>The above <code>build.mill</code> file sets up a <code>object myplugin extends ScalaModule</code> not just to
compile your Mill plugin project, but also to run unit tests using <code>mill-testkit</code>,
and to configure it for publishing to Maven Central via <code>PublishModule</code>.
It looks like any other Scala project, except for a few dependencies on <code>mill-libs</code>
and <code>mill-testkit</code> to bring in the appropriate libraries</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
that Mill 1.x is <em>backwards compatible</em> but not <em>forwards compatible</em> with regard to plugins,
so a plugin published for a particular version of Mill will work on <em>newer</em> versions of Mill,
but not <em>older</em> versions. Thus when publishing plugins it is usually best to publish for as
old a 1.x version of Mill as you can, to ensure maximal compatibility with downstream projects.
In this example, we publish for Mill-1.0.6/Scala-3.7.4/JDK11, even though our plugins own build
may be on a version of Mill 1.1.0 or later.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugin_implementation"><a class="anchor" href="#_plugin_implementation"></a>Plugin Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although Mill plugins can contain arbitrary code, the most common
way that plugins interact with your project is by providing <code>trait</code>s for
your modules to inherit from.</p>
</div>
<div class="paragraph">
<p>Like any other <code>trait</code>, a Mill plugin’s traits modules allow you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add additional tasks to an existing module</p>
</li>
<li>
<p>Override existing tasks, possibly referencing the old task via <code>super</code></p>
</li>
<li>
<p>Define abstract tasks that the final module must implement</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example, we define a <code>LineCountJavaModule</code> that does all of the above:
it defines an abstract <code>def lineCountResourceFileName</code> task, it adds an additional
<code>def lineCount</code> task, and it overrides the <code>def resources</code>:</p>
</div>
<div class="listingblock">
<div class="title">myplugin/src/LineCountJavaModule.scala (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-1-writing-mill-plugins.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/1-writing-mill-plugins/myplugin/src/LineCountJavaModule.scala">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package myplugin
import mill.*

/**
 * Example Mill plugin trait that adds a `line-count.txt`
 * to the resources of your `JavaModule`
 */
trait LineCountJavaModule extends mill.javalib.JavaModule {

  /** Name of the file containing the line count that we create in the resource path */
  def lineCountResourceFileName: T[String]

  /** Total number of lines in module source files */
  def lineCount = Task {
    allSourceFiles().map(f =&gt; os.read.lines(f.path).size).sum
  }

  /** Generate resources using lineCount of sources */
  override def resources = Task {
    os.write(Task.dest / lineCountResourceFileName(), &quot;&quot; + lineCount())
    super.resources() ++ Seq(PathRef(Task.dest))
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a synthetic example, but it serves to illustrate how Mill plugins are typically
defined. The plugin can be compiled via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill myplugin.compile
compiling 1 Scala source...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill provides the <code>mill-testkit</code> library to make it easy for you to test your Mill
plugin. The example project above has set up tests that can be run via the normal <code>.test</code>
command, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill myplugin.test
+ myplugin.UnitTests.unit...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mill-testkit</code> is the same set of helpers that Mill uses internally for its
own testing, and covers three approaches:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unit_tests"><a class="anchor" href="#_unit_tests"></a>Unit Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These are tests that run in-process, with the Mill <code>build.mill</code> defined as a <code>TestRootModule</code>,
and using a <code>UnitTester</code> to run its tasks and inspect their output. <code>UnitTester</code> is provided
a path to a folder on disk containing the files that are to be built with the given <code>TestRootModule</code>,
and can be used to evaluate tasks (by direct reference or by string-selector) and inspect
the results in-memory:</p>
</div>
<div class="listingblock">
<div class="title">myplugin/test/src/mill/testkit/UnitTests.scala (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-1-writing-mill-plugins.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/1-writing-mill-plugins/myplugin/test/src/mill/testkit/UnitTests.scala">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package myplugin

import mill.testkit.{TestRootModule, UnitTester}
import mill.api.Discover
import mill.PathRef
import mill.util.TokenReaders.*
import utest.*

object UnitTests extends TestSuite {
  def tests: Tests = Tests {
    test(&quot;unit&quot;) {
      object build extends TestRootModule with LineCountJavaModule {
        def lineCountResourceFileName = &quot;line-count.txt&quot;

        lazy val millDiscover = Discover[this.type]
      }

      val resourceFolder = os.Path(sys.env(&quot;MILL_TEST_RESOURCE_DIR&quot;))
      UnitTester(build, resourceFolder / &quot;unit-test-project&quot;).scoped { eval =&gt;
        // Evaluating tasks by direct reference
        val Right(result) = eval(build.resources)
        assert(
          result.value.exists(pathref =&gt;
            os.exists(pathref.path / &quot;line-count.txt&quot;) &amp;&amp;
              os.read(pathref.path / &quot;line-count.txt&quot;) == &quot;18&quot;
          )
        )

        // Evaluating tasks by passing in their Mill selector
        val Right(result2) = eval(&quot;resources&quot;)
        val Seq(pathrefs: Seq[PathRef]) = result2.value
        assert(
          pathrefs.exists(pathref =&gt;
            os.exists(pathref.path / &quot;line-count.txt&quot;) &amp;&amp;
              os.read(pathref.path / &quot;line-count.txt&quot;) == &quot;18&quot;
          )
        )
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">myplugin/test/resources/unit-test-project/src/foo/Foo.java (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-1-writing-mill-plugins.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/1-writing-mill-plugins/myplugin/test/resources/unit-test-project/src/foo/Foo.java">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package foo;

public class Foo {
  public static String getLineCount() {
    try {
      return new String(
          Foo.class.getClassLoader().getResourceAsStream(&quot;line-count.txt&quot;).readAllBytes());
    } catch (java.io.IOException e) {
      return null;
    }
  }

  static String lineCount = getLineCount();

  public static void main(String[] args) throws Exception {
    System.out.println(&quot;Line Count: &quot; + lineCount);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill Unit tests are good for exercising most kinds of business logic in Mill plugins. Their
main limitation is that they do not exercise the Mill subprocess-launch and bootstrap process,
but that should not be a concern for most Mill plugins.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishing"><a class="anchor" href="#_publishing"></a>Publishing</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; sed -i.bak 's/0.0.1/0.0.2/g' build.mill

&gt; ./mill myplugin.publishLocal
Publishing Artifact(com.lihaoyi,myplugin_mill1_3,0.0.2) to ivy repo...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill plugins are JVM libraries like any other library written in Java or Scala. Thus they
are published the same way: by extending <code>PublishModule</code> and defining the module’s <code>publishVersion</code>
and <code>pomSettings</code>. Once done, you can publish the plugin locally via <code>publishLocal</code>,
or to Maven Central via <code>mill.scalalib.PublishModule/</code> for other developers to
use. For more details on publishing Mill projects, see the documentation for
<a href="../scalalib/publishing.html" class="xref page">Publishing Scala Projects</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_tests"><a class="anchor" href="#_integration_tests"></a>Integration Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Integration tests are one step up from Unit tests: they are significantly slower to run due
to running Mill in a subprocess, but are able to exercise the end-to-end lifecycle of a Mill
command. Integration tests require further build configuration, which is shown below:</p>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-2-plugin-integration-tests.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/2-plugin-integration-tests">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill.*, scalalib.*, publish.*

object myplugin extends ScalaModule, PublishModule {
  def millVersion = &quot;1.0.6&quot;

  def scalaVersion = &quot;3.7.4&quot;

  def jvmId = &quot;11&quot;

  // Set the `platformSuffix` so the name indicates what Mill version it is compiled for
  def platformSuffix = s&quot;_mill1&quot;

  // Depend on `mill-libs` so we can compile against Mill APIs
  def mvnDeps = Seq(mvn&quot;com.lihaoyi::mill-libs:$millVersion&quot;)

  // Setup for integration/example tests
  object integration extends ScalaTests, TestModule.Utest {
    def mvnDeps = Seq(mvn&quot;com.lihaoyi::mill-testkit:$millVersion&quot;)
    def forkEnv = Task {
      Map(
        &quot;MILL_EXECUTABLE_PATH&quot; -&gt; millExecutable.assembly().path.toString,
        &quot;MILL_USER_TEST_REPO&quot; -&gt; publishLocalTestRepo().path.toString
      )
    }

    // Create a Mill executable configured for testing our plugin
    object millExecutable extends JavaModule {
      def mvnDeps = Seq(mvn&quot;com.lihaoyi:mill-runner-launcher_3:$millVersion&quot;)
      def mainClass = Some(&quot;mill.launcher.MillLauncherMain&quot;)
    }
  }

  // Publishing Config
  def publishVersion = &quot;0.0.1&quot;

  def pomSettings = PomSettings(
    description = &quot;Line Count Mill Plugin&quot;,
    organization = &quot;com.lihaoyi&quot;,
    url = &quot;https://github.com/lihaoyi/myplugin&quot;,
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github(&quot;lihaoyi&quot;, &quot;myplugin&quot;),
    developers = Seq(Developer(&quot;lihaoyi&quot;, &quot;Li Haoyi&quot;, &quot;https://github.com/lihaoyi&quot;))
  )
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill myplugin.integration
+ myplugin.IntegrationTests.integration...
+ myplugin.ExampleTests.example...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike unit tests which define a <code>TestRootModule</code> in-memory as part of the test code,
Mill’s integration tests rely on a <code>build.mill</code> that is processed and compiled as part of the
test initialization, and can only perform assertions on the four things that are returned from
any subprocess:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>.isSuccess: Boolean</code>, whether or the Mill subprocess returned with exit code 0</p>
</li>
<li>
<p><code>.out: String</code>, the standard output captured by the Mill process</p>
</li>
<li>
<p><code>.err: String</code>, the standard error captured by the Mill process</p>
</li>
<li>
<p>Any files that are generated on disk. In particular, files generated by tasks
can be fetched via the <code>tester.out(&quot;...​&quot;).*</code> APIs to be read as JSON strings (via <code>.text</code>),
parsed <code>ujson.Value</code> ASTs (<code>.json</code>), or parsed into a typed Scala value (<code>.value[T]</code>)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">myplugin/integration/src/mill/testkit/IntegrationTests.scala (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-2-plugin-integration-tests.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/2-plugin-integration-tests/myplugin/integration/src/mill/testkit/IntegrationTests.scala">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package myplugin
import mill.testkit.IntegrationTester
import utest.*

object IntegrationTests extends TestSuite {

  println(&quot;initializing myplugin.IntegrationTest&quot;)
  def tests: Tests = Tests {
    println(&quot;initializing myplugin.IntegrationTest.tests&quot;)

    test(&quot;integration&quot;) {
      val resourceFolder = os.Path(sys.env(&quot;MILL_TEST_RESOURCE_DIR&quot;))
      val tester = new IntegrationTester(
        daemonMode = true,
        workspaceSourcePath = resourceFolder / &quot;integration-test-project&quot;,
        millExecutable = os.Path(sys.env(&quot;MILL_EXECUTABLE_PATH&quot;))
      )

      val res1 = tester.eval(&quot;run&quot;)
      assert(res1.isSuccess)
      assert(res1.err.contains(&quot;compiling 1 Java source&quot;)) // compiling the `build.mill`
      assert(res1.out.contains(&quot;Line Count: 18&quot;))
      assert(tester.out(&quot;lineCount&quot;).value[Int] == 18)

      val res2 = tester.eval(&quot;run&quot;) // No need to recompile when nothing changed
      assert(!res2.err.contains(&quot;compiling 1 Java source&quot;))
      assert(res2.out.contains(&quot;Line Count: 18&quot;))
      assert(tester.out(&quot;lineCount&quot;).value[Int] == 18)

      tester.modifyFile(tester.workspacePath / &quot;src/foo/Foo.java&quot;, _ + &quot;\n&quot;)

      val res3 = tester.eval(&quot;run&quot;) // Additional newline forces recompile and increases line count
      assert(res3.err.contains(&quot;compiling 1 Java source&quot;))
      assert(res3.out.contains(&quot;Line Count: 19&quot;))
      assert(tester.out(&quot;lineCount&quot;).value[Int] == 19)
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">myplugin/integration/resources/integration-test-project/src/foo/Foo.java (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-2-plugin-integration-tests.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/2-plugin-integration-tests/myplugin/integration/resources/integration-test-project/src/foo/Foo.java">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package foo;

public class Foo {
  public static String getLineCount() {
    try {
      return new String(
          Foo.class.getClassLoader().getResourceAsStream(&quot;line-count.txt&quot;).readAllBytes());
    } catch (java.io.IOException e) {
      return null;
    }
  }

  static String lineCount = getLineCount();

  public static void main(String[] args) throws Exception {
    System.out.println(&quot;Line Count: &quot; + lineCount);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">myplugin/integration/resources/integration-test-project/build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-2-plugin-integration-tests.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/2-plugin-integration-tests/myplugin/integration/resources/integration-test-project/build.mill">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">//| mvnDeps:
//| - com.lihaoyi::myplugin::0.0.1
package build

import mill.*, myplugin.*

object `package` extends LineCountJavaModule {
  def lineCountResourceFileName = &quot;line-count.txt&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Integration tests are generally used sparingly, but they are handy for scenarios where
your Mill plugin logic prints to standard output or standard error, and you want to assert
that the printed output is as expected.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_tests"><a class="anchor" href="#_example_tests"></a>Example Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Example tests are a variant of the integration tests mentioned above, but instead of
having the testing logic defined as part of the test suite in a <code>.scala</code> file, the testing
logic is instead defined as a <code>/** Usage */</code> comment in the <code>build.mill</code>. These tests are
a great way of documenting expected usage of your plugin: a user can glance at a single
file to see how the plugin is imported (via <code>//| mvnDeps</code>) how it is used (e.g. by being
extended by a module) and what commands they can run exercising the plugin and the resultant
output they should expect:</p>
</div>
<div class="listingblock">
<div class="title">myplugin/integration/src/mill/testkit/ExampleTests.scala (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-2-plugin-integration-tests.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/2-plugin-integration-tests/myplugin/integration/src/mill/testkit/ExampleTests.scala">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package myplugin
import mill.testkit.ExampleTester
import utest.*

object ExampleTests extends TestSuite {

  def tests: Tests = Tests {
    test(&quot;example&quot;) {
      val resourceFolder = os.Path(sys.env(&quot;MILL_TEST_RESOURCE_DIR&quot;))
      ExampleTester.run(
        daemonMode = true,
        workspaceSourcePath = resourceFolder / &quot;example-test-project&quot;,
        millExecutable = os.Path(sys.env(&quot;MILL_EXECUTABLE_PATH&quot;))
      )
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">myplugin/integration/resources/example-test-project/src/foo/Foo.java (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-2-plugin-integration-tests.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/2-plugin-integration-tests/myplugin/integration/resources/example-test-project/src/foo/Foo.java">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package foo;

public class Foo {
  public static String getLineCount() {
    try {
      return new String(
          Foo.class.getClassLoader().getResourceAsStream(&quot;line-count.txt&quot;).readAllBytes());
    } catch (java.io.IOException e) {
      return null;
    }
  }

  static String lineCount = getLineCount();

  public static void main(String[] args) throws Exception {
    System.out.println(&quot;Line Count: &quot; + lineCount);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">myplugin/integration/resources/example-test-project/build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.1.0-RC2-75-e3ba14/mill-dist-1.1.0-RC2-75-e3ba14-example-extending-plugins-2-plugin-integration-tests.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.1.0-RC2/example/extending/plugins/2-plugin-integration-tests/myplugin/integration/resources/example-test-project/build.mill">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">//| mvnDeps:
//| - com.lihaoyi::myplugin::0.0.1
package build

import mill.*, myplugin.*

object `package` extends LineCountJavaModule {
  def lineCountResourceFileName = &quot;line-count.txt&quot;
}

/** Usage

&gt; ./mill run
Line Count: 18
...

&gt; printf &quot;\n&quot; &gt;&gt; src/foo/Foo.java

&gt; ./mill run
Line Count: 19
...

*/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>/** Usage */</code> comment is of the following format:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each line prefixed with <code>&gt;</code> is a command that is to be run</p>
</li>
<li>
<p>Following lines after commands are expected output, until the next blank line</p>
</li>
<li>
<p>If the command is expected to fail, the following lines should be prefixed by `error: `</p>
</li>
<li>
<p>Expected output lines can contain <code>...​</code> wildcards to match against parts of the output
which are unstable or unnecessary for someone reading through the <code>build.mill</code>.</p>
</li>
<li>
<p>A <code>...​</code> wildcard on its own line can be used to match against any number of additional
lines of output</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The line-matching for example tests is intentionally fuzzy: it does not assert that the
ordering of the lines printed by the command matches the ordering given, as long as every
line printed is given and every line given is printed. <code>...​</code> wildcards intentionally add
additional fuzziness to the matching. The point of example tests is not to match
character-for-character exactly what the output must be, but to match on the &quot;important&quot;
parts of the output while simultaneously emphasizing these important parts to someone who
may be reading the <code>build.mill</code></p>
</div>
<div class="paragraph">
<p>Example tests are similar to integration tests in that they exercise the full Mill bootstrapping
process, and are thus much slower and more expensive to run than unit tests. However, it is
usually a good idea to have at least one example test for your Mill plugin, so a user who
wishes to use it can take the <code>build.mill</code> and associated files and immediately have a Mill
build that is runnable using your plugin, along with a list of commands they can run and
what output they should expect.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="running-jvm-code.html">Running Dynamic JVM Code</a></span>
  <span class="next"><a href="meta-build.html">The Mill Meta-Build</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async="async" src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async="async" src="../../../search-index.js"></script>
  
</body></html>