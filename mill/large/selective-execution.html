<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Selective Test Execution :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/large/selective-execution.html">
    <link rel="prev" href="large.html">
    <link rel="next" href="multi-file-builds.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style>
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />&nbsp;The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../javalib/intro.html">Building Java with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/module-config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/dependencies.html">Java Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/testing.html">Testing Java Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/linting.html">Linting Java Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/publishing.html">Java Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/build-examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/web-examples.html">Java Web Project Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scalalib/intro.html">Building Scala with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/module-config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/dependencies.html">Scala Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/testing.html">Testing Scala Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/linting.html">Linting Scala Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/publishing.html">Scala Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/build-examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/web-examples.html">Scala Web Project Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/native-examples.html">Scala Native Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/spark.html">Spark Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kotlinlib/intro.html">Building Kotlin with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/module-config.html">Kotlin Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/dependencies.html">Kotlin Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/testing.html">Testing Kotlin Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/linting.html">Linting Kotlin Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/publishing.html">Kotlin Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/web-examples.html">Kotlin Web Project Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Experimental Platform Support</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../pythonlib/intro.html">Building Python with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/module-config.html">Python Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/dependencies.html">Python Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/linting.html">Linting Python Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../pythonlib/testing.html">Testing Python Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../pythonlib/publishing.html">Python Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <span class="nav-text">xref:pythonlib/web-examples.adoc</span>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../javascriptlib/intro.html">Building Javascript with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/dependencies.html">Typescript Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/module-config.html">Typescript Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/testing.html">Testing Typescript Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../javascriptlib/linting.html">Linting Typescript Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../javascriptlib/publishing.html">Typescript Packaging &amp; Publishing</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Building Android Apps</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/java.html">Android Java Projects</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/kotlin.html">Android Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/android-linting.html">Linting Android Projects</a>
  </li>
</ul>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../comparisons/why-mill.html">Why Use Mill?</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/maven.html">Case Study: Mill vs Maven</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/gradle.html">Case Study: Mill vs Gradle</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/sbt.html">Case Study: Mill vs <code>sbt</code></a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The Mill CLI</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/installation-ide.html">Installation &amp; IDE Setup</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/flags.html">Mill Command-Line Flags</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../cli/query-syntax.html">Task Query Syntax</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../migrating/migrating.html">Migrating to Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migrating/maven.html">Migrating From Maven to Mill</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migrating/gradle.html">Migrating From Gradle to Mill</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migrating/sbt.html">Migrating From sbt to Mill</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill Fundamentals</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/out-dir.html">The Output Directory</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/library-deps.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/cross-builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/bundled-libraries.html">Bundled Libraries</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/configuring-jvm-versions.html">Configuring JVM Versions</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extending Mill</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extending/import-ivy-plugins.html">Import Libraries and Plugins</a>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../extending/contrib-plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/sonatypecentral.html">Sonatype Central</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extending/thirdparty-plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../extending/running-jvm-code.html">Running Dynamic JVM Code</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../extending/writing-plugins.html">Writing Mill Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../extending/meta-build.html">The Mill Meta-Build</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../extending/example-typescript-support.html">Example: Typescript Support</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../extending/example-python-support.html">Example: Python Support</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="large.html">Large Builds and Monorepos</a>
<ul class="nav-list">

  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="selective-execution.html">Selective Test Execution</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="multi-file-builds.html">Multi-File Builds</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="multi-language-builds.html">Multi-Language Builds</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/execution-model.html">The Mill Execution Model</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/caching.html">Caching in Mill</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/parallelism.html">Parallelism in Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/process-architecture.html">The Mill Process Architecture</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/sandboxing.html">Mill Sandboxing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/design-principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/why-scala.html">Why does Mill use Scala?</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/com-lihaoyi/mill/blob/main/changelog.adoc">Changelog</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/talks-blog-posts.html">Talks &amp; Blog Posts</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.12.14</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../main-branch/index.html">main-branch</a>
        </li>
        <li class="version">
          <a href="../dev-1.0.0-RC3-26-c3ea9b/index.html">dev-1.0.0-RC3-26-c3ea9b</a>
        </li>
        <li class="version is-current is-latest">
          <a href="../index.html">0.12.14</a>
        </li>
        <li class="version">
          <a href="../0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px; ">
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Selective Test Execution</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Mill allows you to filter the tests and other tasks you execute by limiting them
to those affected by a code change. This is useful in managing large codebases where
running the entire test suite in CI is often very slow, so you only want to run the
tests or tasks that are affected by the changes you are making.</p>
</div>
<div class="paragraph">
<p>This is done via the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mill selective.prepare &lt;selector&gt;</code>: run on the codebase before the code change,
stores a snapshot of task inputs and implementations</p>
</li>
<li>
<p><code>mill selective.run &lt;selector&gt;</code>: run on the codebase after the code change,
runs tasks in the given <code>&lt;selector&gt;</code> which are affected by the code changes
that have happen since <code>selective.prepare</code> was run</p>
</li>
<li>
<p><code>mill selective.resolve &lt;selector&gt;</code>: a dry-run version of <code>selective.run</code>, prints
out the tasks in <code>&lt;selector&gt;</code> that are affected by the code changes and would have
run, without actually tunning them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if you want to run all tests related to the code changes in a pull
request branch, you can do that as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; git checkout main # start from the target branch of the PR

&gt; ./mill selective.prepare

&gt; git checkout pull-request-branch # go to the pull request branch

&gt; ./mill selective.run __.test</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example below demonstrates selective test execution on a small 3-module Java build,
where <code>bar</code> depends on <code>foo</code> but <code>qux</code> is standalone:</p>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/0.12.14/mill-dist-0.12.14-example-large-selective-9-selective-execution.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.14/example/large/selective/9-selective-execution">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

trait MyModule extends JavaModule {
  object test extends JavaTests with TestModule.Junit4
}

object foo extends MyModule {
  def moduleDeps = Seq(bar)
}

object bar extends MyModule

object qux extends MyModule</code></pre>
</div>
</div>
<div class="paragraph">
<center>
<svg width="235px" height="129px"
 viewBox="0.00 0.00 234.54 128.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 124.8)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-124.8 230.54,-124.8 230.54,4 -4,4"/>
<!-- qux -->
<g id="node1" class="node">
<title>qux</title>
<polygon fill="white" stroke="black" points="37,-24.7 0,-24.7 0,-0.1 37,-0.1 37,-24.7"/>
<text text-anchor="middle" x="18.5" y="-8.2" font-family="Times,serif" font-size="14.00">qux</text>
</g>
<!-- qux.test -->
<g id="node2" class="node">
<title>qux.test</title>
<polygon fill="white" stroke="black" points="132.91,-24.7 73.03,-24.7 73.03,-0.1 132.91,-0.1 132.91,-24.7"/>
<text text-anchor="middle" x="102.97" y="-8.2" font-family="Times,serif" font-size="14.00">qux.test</text>
</g>
<!-- qux&#45;&gt;qux.test -->
<g id="edge1" class="edge">
<title>qux&#45;&gt;qux.test</title>
<path fill="none" stroke="black" d="M37.39,-12.4C44.82,-12.4 53.74,-12.4 62.56,-12.4"/>
<polygon fill="black" stroke="black" points="62.76,-15.9 72.76,-12.4 62.76,-8.9 62.76,-15.9"/>
</g>
<!-- bar -->
<g id="node3" class="node">
<title>bar</title>
<polygon fill="white" stroke="black" points="35.38,-88.7 1.62,-88.7 1.62,-64.1 35.38,-64.1 35.38,-88.7"/>
<text text-anchor="middle" x="18.5" y="-72.2" font-family="Times,serif" font-size="14.00">bar</text>
</g>
<!-- bar.test -->
<g id="node4" class="node">
<title>bar.test</title>
<polygon fill="white" stroke="black" points="131.29,-120.7 74.65,-120.7 74.65,-96.1 131.29,-96.1 131.29,-120.7"/>
<text text-anchor="middle" x="102.97" y="-104.2" font-family="Times,serif" font-size="14.00">bar.test</text>
</g>
<!-- bar&#45;&gt;bar.test -->
<g id="edge2" class="edge">
<title>bar&#45;&gt;bar.test</title>
<path fill="none" stroke="black" d="M35.4,-82.57C43.86,-85.85 54.64,-90.03 65.05,-94.07"/>
<polygon fill="black" stroke="black" points="63.83,-97.36 74.42,-97.71 66.37,-90.83 63.83,-97.36"/>
</g>
<!-- foo -->
<g id="node5" class="node">
<title>foo</title>
<polygon fill="white" stroke="black" points="120.13,-77.7 85.81,-77.7 85.81,-53.1 120.13,-53.1 120.13,-77.7"/>
<text text-anchor="middle" x="102.97" y="-61.2" font-family="Times,serif" font-size="14.00">foo</text>
</g>
<!-- bar&#45;&gt;foo -->
<g id="edge3" class="edge">
<title>bar&#45;&gt;foo</title>
<path fill="none" stroke="black" d="M35.4,-74.28C46.78,-72.76 62.35,-70.68 75.58,-68.92"/>
<polygon fill="black" stroke="black" points="76.1,-72.38 85.55,-67.59 75.18,-65.44 76.1,-72.38"/>
</g>
<!-- foo.test -->
<g id="node6" class="node">
<title>foo.test</title>
<polygon fill="white" stroke="black" points="226.34,-77.7 169.14,-77.7 169.14,-53.1 226.34,-53.1 226.34,-77.7"/>
<text text-anchor="middle" x="197.74" y="-61.2" font-family="Times,serif" font-size="14.00">foo.test</text>
</g>
<!-- foo&#45;&gt;foo.test -->
<g id="edge4" class="edge">
<title>foo&#45;&gt;foo.test</title>
<path fill="none" stroke="black" d="M120.56,-65.4C131.17,-65.4 145.38,-65.4 158.66,-65.4"/>
<polygon fill="black" stroke="black" points="159.02,-68.9 169.02,-65.4 159.02,-61.9 159.02,-68.9"/>
</g>
</g>
</svg>

</center>
</div>
<div class="paragraph">
<p>In this example, <code>qux.test</code> starts off failing with an error, while <code>foo.test</code> and
<code>bar.test</code> pass successfully. Normally, running <code>__.test</code> will run all three test
suites and show both successes and the one failure:</p>
</div>
<div class="paragraph">
<center>
<svg width="235px" height="129px"
 viewBox="0.00 0.00 234.54 128.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 124.8)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-124.8 230.54,-124.8 230.54,4 -4,4"/>
<!-- qux.test -->
<g id="node1" class="node">
<title>qux.test</title>
<polygon fill="white" stroke="red" stroke-width="2" points="132.91,-24.7 73.03,-24.7 73.03,-0.1 132.91,-0.1 132.91,-24.7"/>
<text text-anchor="middle" x="102.97" y="-8.2" font-family="Times,serif" font-size="14.00">qux.test</text>
</g>
<!-- qux -->
<g id="node2" class="node">
<title>qux</title>
<polygon fill="white" stroke="black" points="37,-24.7 0,-24.7 0,-0.1 37,-0.1 37,-24.7"/>
<text text-anchor="middle" x="18.5" y="-8.2" font-family="Times,serif" font-size="14.00">qux</text>
</g>
<!-- qux&#45;&gt;qux.test -->
<g id="edge1" class="edge">
<title>qux&#45;&gt;qux.test</title>
<path fill="none" stroke="black" d="M37.39,-12.4C44.82,-12.4 53.74,-12.4 62.56,-12.4"/>
<polygon fill="black" stroke="black" points="62.76,-15.9 72.76,-12.4 62.76,-8.9 62.76,-15.9"/>
</g>
<!-- bar -->
<g id="node3" class="node">
<title>bar</title>
<polygon fill="white" stroke="black" points="35.38,-88.7 1.62,-88.7 1.62,-64.1 35.38,-64.1 35.38,-88.7"/>
<text text-anchor="middle" x="18.5" y="-72.2" font-family="Times,serif" font-size="14.00">bar</text>
</g>
<!-- bar.test -->
<g id="node4" class="node">
<title>bar.test</title>
<polygon fill="white" stroke="red" stroke-width="2" points="131.29,-120.7 74.65,-120.7 74.65,-96.1 131.29,-96.1 131.29,-120.7"/>
<text text-anchor="middle" x="102.97" y="-104.2" font-family="Times,serif" font-size="14.00">bar.test</text>
</g>
<!-- bar&#45;&gt;bar.test -->
<g id="edge2" class="edge">
<title>bar&#45;&gt;bar.test</title>
<path fill="none" stroke="black" d="M35.4,-82.57C43.86,-85.85 54.64,-90.03 65.05,-94.07"/>
<polygon fill="black" stroke="black" points="63.83,-97.36 74.42,-97.71 66.37,-90.83 63.83,-97.36"/>
</g>
<!-- foo -->
<g id="node5" class="node">
<title>foo</title>
<polygon fill="white" stroke="black" points="120.13,-77.7 85.81,-77.7 85.81,-53.1 120.13,-53.1 120.13,-77.7"/>
<text text-anchor="middle" x="102.97" y="-61.2" font-family="Times,serif" font-size="14.00">foo</text>
</g>
<!-- bar&#45;&gt;foo -->
<g id="edge3" class="edge">
<title>bar&#45;&gt;foo</title>
<path fill="none" stroke="black" d="M35.4,-74.28C46.78,-72.76 62.35,-70.68 75.58,-68.92"/>
<polygon fill="black" stroke="black" points="76.1,-72.38 85.55,-67.59 75.18,-65.44 76.1,-72.38"/>
</g>
<!-- foo.test -->
<g id="node6" class="node">
<title>foo.test</title>
<polygon fill="white" stroke="red" stroke-width="2" points="226.34,-77.7 169.14,-77.7 169.14,-53.1 226.34,-53.1 226.34,-77.7"/>
<text text-anchor="middle" x="197.74" y="-61.2" font-family="Times,serif" font-size="14.00">foo.test</text>
</g>
<!-- foo&#45;&gt;foo.test -->
<g id="edge4" class="edge">
<title>foo&#45;&gt;foo.test</title>
<path fill="none" stroke="black" d="M120.56,-65.4C131.17,-65.4 145.38,-65.4 158.66,-65.4"/>
<polygon fill="black" stroke="black" points="159.02,-68.9 169.02,-65.4 159.02,-61.9 159.02,-68.9"/>
</g>
</g>
</svg>

</center>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill __.test
error: Test run foo.FooTests finished: 0 failed, 0 ignored, 1 total, ...
Test run bar.BarTests finished: 0 failed, 0 ignored, 1 total, ...
Test run qux.QuxTests finished: 1 failed, 0 ignored, 1 total, ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this is not always what you want. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are validating a pull request
in CI that only touches <code>bar/</code>, you do not want the failure in <code>qux.test</code> to fail
your tests, because you know that <code>qux.test</code> does not depend on <code>bar/</code> and thus the
failure cannot be related to your changes.</p>
</li>
<li>
<p>Even if <code>qux.test</code> wasn&#8217;t failing, running it on a pull request that changes <code>bar/</code> is
wasteful, taking up compute resources to run tests that could not possibly be affected
by the code change in question.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To solve this, you can run <code>selective.prepare</code> before the code change, then <code>selective.run</code>
after the code change, to only run the tests downstream of the change (below, <code>foo.test</code> and <code>bar.test</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill selective.prepare __.test

&gt; echo '//' &gt;&gt; bar/src/bar/Bar.java # emulate the code change

&gt; mill selective.resolve __.test # dry-run selective execution to show what would get run
foo.test.test
bar.test.test

&gt; mill selective.run __.test
Test run foo.FooTests finished: 0 failed, 0 ignored, 1 total, ...
Test run bar.BarTests finished: 0 failed, 0 ignored, 1 total, ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we only touched <code>bar</code>'s source files, we only need to run tests for</p>
</div>
<div class="paragraph">
<center>
<svg width="235px" height="129px"
 viewBox="0.00 0.00 234.54 128.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 124.8)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-124.8 230.54,-124.8 230.54,4 -4,4"/>
<!-- qux -->
<g id="node1" class="node">
<title>qux</title>
<polygon fill="white" stroke="black" points="37,-24.7 0,-24.7 0,-0.1 37,-0.1 37,-24.7"/>
<text text-anchor="middle" x="18.5" y="-8.2" font-family="Times,serif" font-size="14.00">qux</text>
</g>
<!-- qux.test -->
<g id="node2" class="node">
<title>qux.test</title>
<polygon fill="white" stroke="black" points="132.91,-24.7 73.03,-24.7 73.03,-0.1 132.91,-0.1 132.91,-24.7"/>
<text text-anchor="middle" x="102.97" y="-8.2" font-family="Times,serif" font-size="14.00">qux.test</text>
</g>
<!-- qux&#45;&gt;qux.test -->
<g id="edge1" class="edge">
<title>qux&#45;&gt;qux.test</title>
<path fill="none" stroke="black" d="M37.39,-12.4C44.82,-12.4 53.74,-12.4 62.56,-12.4"/>
<polygon fill="black" stroke="black" points="62.76,-15.9 72.76,-12.4 62.76,-8.9 62.76,-15.9"/>
</g>
<!-- bar -->
<g id="node3" class="node">
<title>bar</title>
<polygon fill="white" stroke="red" stroke-width="2" points="35.38,-88.7 1.62,-88.7 1.62,-64.1 35.38,-64.1 35.38,-88.7"/>
<text text-anchor="middle" x="18.5" y="-72.2" font-family="Times,serif" font-size="14.00">bar</text>
</g>
<!-- bar.test -->
<g id="node4" class="node">
<title>bar.test</title>
<polygon fill="white" stroke="red" stroke-width="2" points="131.29,-120.7 74.65,-120.7 74.65,-96.1 131.29,-96.1 131.29,-120.7"/>
<text text-anchor="middle" x="102.97" y="-104.2" font-family="Times,serif" font-size="14.00">bar.test</text>
</g>
<!-- bar&#45;&gt;bar.test -->
<g id="edge2" class="edge">
<title>bar&#45;&gt;bar.test</title>
<path fill="none" stroke="red" stroke-width="2" d="M35.4,-82.57C43.86,-85.85 54.64,-90.03 65.05,-94.07"/>
<polygon fill="red" stroke="red" stroke-width="2" points="63.83,-97.36 74.42,-97.71 66.37,-90.83 63.83,-97.36"/>
</g>
<!-- foo -->
<g id="node5" class="node">
<title>foo</title>
<polygon fill="white" stroke="red" stroke-width="2" points="120.13,-77.7 85.81,-77.7 85.81,-53.1 120.13,-53.1 120.13,-77.7"/>
<text text-anchor="middle" x="102.97" y="-61.2" font-family="Times,serif" font-size="14.00">foo</text>
</g>
<!-- bar&#45;&gt;foo -->
<g id="edge3" class="edge">
<title>bar&#45;&gt;foo</title>
<path fill="none" stroke="red" stroke-width="2" d="M35.4,-74.28C46.78,-72.76 62.35,-70.68 75.58,-68.92"/>
<polygon fill="red" stroke="red" stroke-width="2" points="76.1,-72.38 85.55,-67.59 75.18,-65.44 76.1,-72.38"/>
</g>
<!-- foo.test -->
<g id="node6" class="node">
<title>foo.test</title>
<polygon fill="white" stroke="red" stroke-width="2" points="226.34,-77.7 169.14,-77.7 169.14,-53.1 226.34,-53.1 226.34,-77.7"/>
<text text-anchor="middle" x="197.74" y="-61.2" font-family="Times,serif" font-size="14.00">foo.test</text>
</g>
<!-- foo&#45;&gt;foo.test -->
<g id="edge4" class="edge">
<title>foo&#45;&gt;foo.test</title>
<path fill="none" stroke="red" stroke-width="2" d="M120.56,-65.4C131.17,-65.4 145.38,-65.4 158.66,-65.4"/>
<polygon fill="red" stroke="red" stroke-width="2" points="159.02,-68.9 169.02,-65.4 159.02,-61.9 159.02,-68.9"/>
</g>
</g>
</svg>

</center>
</div>
<div class="paragraph">
<p>For a more detailed report of how the changed inputs resulted in the selected tasks
being chosen, you can also use <code>selective.resolveChanged</code> to print out the upstream
input tasks that Mill found had changed and will cause downstream tasks to be selected,
or <code>selective.resolveTree</code> to print out the selected tasks
as a JSON tree illustrating the relationships between the invalidated inputs (at the root
of the tree) and the selected tasks (at the leaves of the tree)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill selective.resolveChanged __.test
bar.sources

&gt; mill selective.resolveTree __.test
{
  "bar.sources": {
    "bar.test.sources": {
      "bar.test.allSources": {
        "bar.test.allSourceFiles": {
          "bar.test.compile": {
            "bar.test.localRunClasspath": {
              "bar.test.testClasspath": {
                "bar.test.test": {}
              }
            }
          }
        }
      }
    },
    "bar.allSources": {
      "bar.allSourceFiles": {
        "bar.compile": {
          "bar.localRunClasspath": {
            "bar.localClasspath": {
              "foo.test.transitiveLocalClasspath": {
                "foo.test.runClasspath": {
                  "foo.test.test": {}
                }
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if we make a change <code>qux/</code>, using selective execution will only run tests
in <code>qux.test</code>, and skip those in <code>foo.test</code> and <code>bar.test</code>.
These examples all use <code>__.test</code> to selectively run tasks named <code>.test</code>, but you can
use selective execution on any subset of tasks by specifying them in the selector.</p>
</div>
<div class="paragraph">
<p>Selective execution is very useful for larger codebases, where you are usually changing
only small parts of it, and thus only want to run the tests related to your changes.
This keeps CI times fast and prevents unrelated breakages from affecting your CI runs.</p>
</div>
<div class="paragraph">
<p><code>selective.run</code> relies on an <code>out/mill-selective-execution.json</code> file generated by
<code>seletive.prepare</code> in order to work, and will report an error if that file is missing.
You can also zero out that file to explicitly tell <code>selective.run</code> to run all given
tasks non-selectively, which is convenient if you want to conditionally disable selective
execution (e.g. perhaps you want to perform selective execution on pre-merge on pull
requests but not post-merge on the main branch)</p>
</div>
<div class="paragraph">
<p>Although selective execution is most commonly used for testing, it is a general-purpose
tool that can be used to selectively run any Mill tasks based on the code that changed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reproducibility_and_determinism"><a class="anchor" href="#_reproducibility_and_determinism"></a>Reproducibility and Determinism</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Selective execution relies on the inputs to your project being deterministic
and reproducible, except for the code changes between the two versions, so that
Mill can compare the state of the build inputs before and after and only run
tasks downstream of those that changed. This is usually the case, but there are
some subtleties to be aware of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Dynamic <code>Task.Input</code> to capture Git metadata must be disabled</strong>, e.g. using
<a href="https://github.com/lefou/mill-vcs-version">mill-vcs-version</a>. The easiest way to do
this is to guard such dynamic inputs on an environment variable, such that
in most scenarios it returns a constant <code>"SNAPSHOT"</code> string, and only when
necessary do you pass in the environment variable to compute a real version (e.g.
during publishing)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def myProjectVersion: T[String] = Task.Input {
  if (Task.env.contains("MY_PROJECT_STABLE_VERSION")) VcsVersion.calcVcsState(Task.log).format()
  else "SNAPSHOT"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>The filesystem layout and position of the before/after codebases must be exactly
the same</strong>. This is not an issue when running <code>selective.prepare</code>/<code>selective.run</code> on
the same folder on one machine, but if the two calls are run on separate machines
you need to make sure the directory path is the same.</p>
</li>
<li>
<p><strong>You must use the same Operating System amd Filesystem</strong>, as differences there will
cause the filesystem signatures to change and thus spuriously trigger downstream tasks.
e.g. you cannot run <code>selective.prepare</code> on a Windows machine and <code>selective.run</code> on Linux</p>
</li>
<li>
<p><strong>Filesystem permissions must be preserved before/after</strong>. e.g. running <code>selective,run}</code>
on different Github Actions machines sharing artifacts can cause issues as
<code>upload-artifact</code>/<code>download-artifact</code> <a href="https://github.com/actions/download-artifact#permission-loss">does not preserve filesystem permissions</a>.
If this is an issue, you can run <code>chmod -R . 777</code> before each of <code>selective.{prepare,run}</code>
to ensure they have the exact same filesystem permissions.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_selective_execution"><a class="anchor" href="#_debugging_selective_execution"></a>Debugging Selective Execution</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Use <code>selective.resolve</code> before <code>selective.run</code>: this will print out what it was going to run,
and can give you a chance to eyeball if the list of targets to run makes sense or not</p>
</li>
<li>
<p>Look at <a href="../fundamentals/out-dir.html#_mill_invalidation_tree_json" class="xref page">out/mill-invalidation-tree.json</a>,
whether on disk locally or printing it out (e.g via <code>cat</code>) on your CI machines to diagnose issues
there. This would give you a richer view of what source tasks or inputs are the ones actually
triggered the invalidation, and what tasks were just invalidated due to being downstream of them.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_limitations"><a class="anchor" href="#_limitations"></a>Limitations</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Selective execution can only work at the Mill Task granularity</strong>. e.g. When working with
Java/Scala/Kotlin modules and test modules, the granularity of selection is at entire modules.
That means that if your modules are individually large, selective execution may not be able
to significantly narrow down the set of tests that need to run</p>
</li>
<li>
<p><strong>Selective execution usually cannot narrow down the set of integration tests to run</strong>. Integration
tests by their nature depend on the entire application or system, and run test cases that
exercise different parts of it. But selective execution works at the task level and can only
see that every integration test depends on the entire codebase, and so any change in the
entire codebase could potentially affect any integration test, so selective execution will
select all of them.</p>
</li>
<li>
<p><strong>Selective execution is coarser-grained than runtime task caching</strong>. e.g. If you add a newline
to a <code>foo/src/Foo.java</code> file and run <code>foo.testCached</code>, selective testing only knows that
<code>foo.sources</code> changed and <code>foo.testCached</code> is downstream of it, but it cannot know that
when you run <code>foo.compile</code> on the changed sources, the compilation output is unchanged, and
so <code>.testCached</code> can be skipped. This is inherent in the nature of selective execution, which
does its analysis without evaluation-time information and thus will always be more conservative
than the task skipping and cache-reuse that is done during evaluation.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="large.html">Large Builds and Monorepos</a></span>
  <span class="next"><a href="multi-file-builds.html">Multi-File Builds</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
