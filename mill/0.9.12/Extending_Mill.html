<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Extending Mill :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/0.11.x/Extending_Mill.html">
    <link rel="prev" href="Cross_Builds.html">
    <link rel="next" href="Mill_Internals.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style>
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />&nbsp;The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/mill.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="0.9.12">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Intro_to_Mill.html">Introduction to Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Configuring_Mill.html">Configuring Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Common_Project_Layouts.html">Common Project Layouts</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Tasks.html">Tasks</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Task_Context_API.html">Task Context API</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-current-page is-active" data-depth="1">
    <a class="nav-link" href="Extending_Mill.html">Extending Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Mill_Internals.html">Mill Internals</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Thirdparty Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.9.12</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../main-branch/index.html">main-branch</a>
        </li>
        <li class="version is-latest">
          <a href="../index.html">1.0.1</a>
        </li>
        <li class="version">
          <a href="../0.12.x/index.html">0.12.14</a>
        </li>
        <li class="version">
          <a href="../0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px; ">
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Extending Mill</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>There are different ways of extending Mill, depending on how much customization and flexibility you need.
This page will go through your options from the easiest/least-flexible to the hardest/most-flexible.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_targets_commands"><a class="anchor" href="#_custom_targets_commands"></a>Custom Targets &amp; Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest way of adding custom functionality to Mill is to define a custom Target or Command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def foo = T { ... }
def bar(x: Int, s: String) = T.command { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>These can depend on other Targets, contain arbitrary code, and be placed top-level or within any module.
If you have something you just want to <em>do</em> that isn&#8217;t covered by the built-in <code>ScalaModule</code>s/<code>ScalaJSModule</code>s, simply write a custom Target (for cached computations) or Command (for un-cached actions) and you&#8217;re done.</p>
</div>
<div class="paragraph">
<p>For subprocess/filesystem operations, you can use the
<a href="https://github.com/lihaoyi/os-lib">os-lib</a> library that comes bundled with Mill, or even plain <code>java.nio</code>/<code>java.lang.Process</code>.
Each target gets its own
<a href="Tasks.html#_mill_api_ctx_dest" class="xref page">T.dest</a> folder that you can use to place files without worrying about colliding with other targets.</p>
</div>
<div class="paragraph">
<p>This covers use cases like:</p>
</div>
<div class="sect2">
<h3 id="_compile_some_javascript_with_webpack_and_put_it_in_your_runtime_classpath"><a class="anchor" href="#_compile_some_javascript_with_webpack_and_put_it_in_your_runtime_classpath"></a>Compile some Javascript with Webpack and put it in your runtime classpath:</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def doWebpackStuff(sources: Seq[PathRef]): PathRef = ???

def javascriptSources = T.sources { millSourcePath / "js" }
def compiledJavascript = T { doWebpackStuff(javascriptSources()) }
object foo extends ScalaModule {
  def runClasspath = T { super.runClasspath() ++ compiledJavascript() }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_your_compiled_assembly_to_aws"><a class="anchor" href="#_deploy_your_compiled_assembly_to_aws"></a>Deploy your compiled assembly to AWS</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo extends ScalaModule {}

def deploy(assembly: PathRef, credentials: String) = ???

def deployFoo(credentials: String) = T.command {
  deploy(foo.assembly(), credentials)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_workers"><a class="anchor" href="#_custom_workers"></a>Custom Workers</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#_custom_targets_commands">Custom Targets &amp; Commands</a> are re-computed from scratch each time; sometimes you want to keep values around in-memory when using
<code>--watch</code> or the Build REPL.
E.g. you may want to keep a webpack process running so webpack&#8217;s own internal caches are hot and compilation is fast:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def webpackWorker = T.worker {
  // Spawn a process using java.lang.Process and return it
}

def javascriptSources = T.sources { millSourcePath / "js" }

def doWebpackStuff(webpackProcess: Process, sources: Seq[PathRef]): PathRef =
  ???

def compiledJavascript = T {
  doWebpackStuff(webpackWorker(), javascriptSources())
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill itself uses <code>T.worker</code>s for its built-in Scala support: we keep the Scala compiler in memory between compilations, rather than discarding it each time, in order to improve performance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_modules"><a class="anchor" href="#_custom_modules"></a>Custom Modules</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">trait FooModule extends mill.Module {
  def bar = T { "hello" }
  def baz = T { "world" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Custom modules are useful if you have a common set of tasks that you want to re-used across different parts of your build.
You simply define a <code>trait</code>
inheriting from <code>mill.Module</code>, and then use that <code>trait</code> as many times as you want in various <code>object</code>s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo1 extends FooModule
object foo2 extends FooModule {
  def qux = T { "I am Cow" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define a <code>trait</code> extending the built-in <code>ScalaModule</code> if you have common configuration you want to apply to all your <code>ScalaModule</code>s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">trait FooModule extends ScalaModule {
  def scalaVersion = "2.11.11"
  object test extends Tests with TestModule.ScalaTest {
    def ivyDeps = Agg(ivy"org.scalatest::scalatest:3.0.4")
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_import_file"><a class="anchor" href="#_import_file"></a>import $file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to define some functionality that can be used both inside and outside the build, you can create a new <code>foo.sc</code> file next to your <code>build.sc</code>,
<code>import $file.foo</code>, and use it in your <code>build.sc</code> file:</p>
</div>
<div class="listingblock">
<div class="title"><code>foo.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def fooValue() = 31337</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $file.foo
def printFoo() = T.command { println(foo.fooValue()) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill&#8217;s <code>import $file</code> syntax supports the full functionality of
<a href="http://ammonite.io/#ScalaScripts">Ammonite Scripts</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_import_ivy"><a class="anchor" href="#_import_ivy"></a>import $ivy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to pull in artifacts from the public repositories (e.g. Maven Central) for use in your build, you can simply use <code>import $ivy</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>build.sc</code>: Using <code>scalatags</code> library to generate HTML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::scalatags:0.6.2` <i class="conum" data-value="1"></i><b>(1)</b>

def generatedHtml = T {
  import scalatags.Text.all._ <i class="conum" data-value="2"></i><b>(2)</b>
  html(
    head(),
    body(
      h1("Hello"),
      p("World")
    )
  ).render
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the scalatags library from Mavel Central repository.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates the <code>generatedHtml</code> target which is used here to generate a simple Hello World HTML document. It can be used however you would like: written to a file, further processed, etc.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please also read the next section <a href="#_using_mill_plugins_import_ivy">Using Mill Plugins (<code>import $ivy</code>)</a>].</p>
</div>
<div class="paragraph">
<p>For more information, see Ammonite&#8217;s
<a href="http://ammonite.io/#import$ivy">Ivy Dependencies documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_mill_plugins_import_ivy"><a class="anchor" href="#_using_mill_plugins_import_ivy"></a>Using Mill Plugins (<code>import $ivy</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill plugins are ordinary jars and are loaded as any other external dependency with <a href="#_import_ivy"><code>import $ivy</code></a>.</p>
</div>
<div class="paragraph">
<p>Mill plugins are typically bound to a specific version or version range of Mill.
To ease the use of the correct versions and avoid runtime issues (caused by binary incompatible plugins, which are hard to debug) you can apply one of the following techniques:</p>
</div>
<div class="sect2">
<h3 id="_use_the_specific_mill_binary_platform_notation"><a class="anchor" href="#_use_the_specific_mill_binary_platform_notation"></a>Use the specific Mill Binary Platform notation</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">// for classic Scala dependencies
import $ivy.`&lt;group&gt;::&lt;plugin&gt;::&lt;version&gt;` <i class="conum" data-value="1"></i><b>(1)</b>
// for dependencies specific to the exact Scala version
import $ivy.`&lt;group&gt;:::&lt;plugin&gt;::&lt;version&gt;` <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is equivalent to
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`&lt;group&gt;::&lt;plugin&gt;_mill$MILL_BIN_PLATFORM:&lt;version&gt;`</code></pre>
</div>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is equivalent to
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`&lt;group&gt;:::&lt;plugin&gt;_mill$MILL_BIN_PLATFORM:&lt;version&gt;`</code></pre>
</div>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_use_special_placeholders_in_your_import_ivy"><a class="anchor" href="#_use_special_placeholders_in_your_import_ivy"></a>Use special placeholders in your <code>import $ivy</code></h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>$MILL_VERSION</code> </dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>to substitute the currently used Mill version.
This is typical required for Mill contrib modules, which are developed in the Mill repository and highly bound to the current Mill version.</p>
</div>
<div class="listingblock">
<div class="title">Example: Use <code>mill-contrib-bloop</code> plugin matching the current Mill version</div>
<div class="content">
<pre>import $ivy.`com.lihaoyi:mill-contrib-bloop:$MILL_VERSION`</pre>
</div>
</div>
<div class="paragraph">
<p>There is the even more convenient option to leave the version completely empty.
Mill will substitute it with its current version.
But don&#8217;t forget to provide the trailing colon!</p>
</div>
<div class="listingblock">
<div class="title">Example: Use <code>mill-contrib-bloop</code> plugin matching the current Mill version</div>
<div class="content">
<pre>import $ivy.`com.lihaoyi:mill-contrib-bloop:`</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>$MILL_BIN_PLATFORM</code> </dt>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>to substitute the currently used Mill binary platform.</p>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example: Using <code>mill-vcs-version</code> plugin matching the current Mill Binary Platfrom</div>
<div class="content">
<pre>import $ivy.`de.tototec::de.tobiasroeser.mill.vcs.version::0.1.2`</pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to publish re-usable libraries that <em>other</em> people can use in their builds, simply publish your code as a library to maven central.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>== Evaluator Commands (experimental)</p>
</div>
<div class="paragraph">
<p><em>Evaluator Command are experimental and suspected to change.
See <a href="https://github.com/com-lihaoyi/mill/issues/502">issue #502</a> for details.</em></p>
</div>
<div class="paragraph">
<p>You can define a command that takes in the current <code>Evaluator</code> as an argument, which you can use to inspect the entire build, or run arbitrary tasks.
For example, here is the <code>mill.scalalib.GenIdea/idea</code> command which uses this to traverse the module-tree and generate an Intellij project config for your build.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def idea(ev: Evaluator) = T.command {
  mill.scalalib.GenIdea(
    implicitly,
    ev.rootModule,
    ev.discover
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many built-in tools are implemented as custom evaluator commands:
<a href="Intro_to_Mill.html#_inspect" class="xref page">inspect</a>,
<a href="Intro_to_Mill.html#_resolve" class="xref page">resolve</a>,
<a href="Intro_to_Mill.html#_show" class="xref page">show</a>.
If you want a way to run Mill commands and programmatically manipulate the tasks and outputs, you do so with your own evaluator command.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="Cross_Builds.html">Cross Builds</a></span>
  <span class="next"><a href="Mill_Internals.html">Mill Internals</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
