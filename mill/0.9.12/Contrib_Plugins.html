<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Contrib Plugins :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/extending/contrib-plugins.html" />
    <link rel="prev" href="Mill_Internals.html" />
    <link rel="next" href="Thirdparty_Plugins.html" />
    <meta name="generator" content="Antora 3.1.12" />
    <link rel="stylesheet" href="../../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon" />
  
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style></head><body class="article">
  
<header class="header">
  
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" /> The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/mill.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="0.9.12">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Intro_to_Mill.html">Introduction to Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Configuring_Mill.html">Configuring Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Common_Project_Layouts.html">Common Project Layouts</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Tasks.html">Tasks</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Task_Context_API.html">Task Context API</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Extending_Mill.html">Extending Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Mill_Internals.html">Mill Internals</a>
  </li>

  <li class="nav-item is-current-page is-active" data-depth="1">
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Thirdparty Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.9.12</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../main-branch/index.html">main-branch</a>
        </li>
        <li class="version is-latest">
          <a href="../index.html">1.0.4</a>
        </li>
        <li class="version">
          <a href="../dev-1.0.4-8-28c1bd/index.html">dev-1.0.4-8-28c1bd</a>
        </li>
        <li class="version">
          <a href="../0.12.x/index.html">0.12.14</a>
        </li>
        <li class="version">
          <a href="../0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px;">
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Contrib Plugins</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The plugins in this section are developed/maintained in the mill git tree.</p>
</div>
<div class="paragraph">
<p>For details about including plugins in your <code>build.sc</code> read <a href="Extending_Mill.html#_using_mill_plugins_import_ivy" class="xref page">Using Mill Plugins</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using one of these contribution modules, it is important that the versions you load match your mill version.
To facilitate this, Mill will automatically replace the <code>$MILL_VERSION</code> literal in your ivy imports with the correct value.
You can also leave the version completely empty to default to the mill version (but don’t forget to keep the trailing colon).</p>
</div>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-bloop:$MILL_VERSION`</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-bloop:`</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_artifactory"><a class="anchor" href="#_artifactory"></a>Artifactory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin allows publishing to Artifactory.</p>
</div>
<div class="sect2">
<h3 id="_quickstart"><a class="anchor" href="#_quickstart"></a>Quickstart</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-artifactory:`
import mill.contrib.artifactory.ArtifactoryPublishModule

object mymodule extends ArtifactoryPublishModule {
  def artifactoryUri: String = &quot;https://example.com/artifactory/my-repo&quot;
  def artifactorySnapshotUri: String = &quot;https://example.com/artifactory/my-snapshot-repo&quot;

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill mymodule.publishArtifactory --credentials $ARTIFACTORY_USER:$ARTIFACTORY_PASSWORD</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bintray"><a class="anchor" href="#_bintray"></a>Bintray</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin allows publishing to Bintray.</p>
</div>
<div class="sect2">
<h3 id="_quickstart_2"><a class="anchor" href="#_quickstart_2"></a>Quickstart</h3>
<div class="paragraph">
<p>Make sure your module extends from <code>BintrayPublishModule</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-bintray:`
import mill.contrib.bintray.BintrayPublishModule

object mymodule extends BintrayPublishModule {
  def bintrayOwner = &quot;owner&quot;
  def bintrayRepo = &quot;repo&quot;

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then ensure you have created a package in the Bintray repository.</p>
</div>
<div class="paragraph">
<p>The default package used is the artifact ID (e.g. <code>mymodule_2.12</code>). If you want to override
the package used, you can do that like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-bintray:`
import mill.contrib.bintray.BintrayPublishModule

object mymodule extends BintrayPublishModule {
  def bintrayOwner = &quot;owner&quot;
  def bintrayRepo = &quot;repo&quot;
  def bintrayPackage = T {...}

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill mymodule.publishBintray --credentials $BINTRAY_USER:$BINTRAY_PASSWORD</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_options"><a class="anchor" href="#_options"></a>Options</h3>
<div class="sect3">
<h4 id="_credentials_auth"><a class="anchor" href="#_credentials_auth"></a>&ndash;credentials &lt;auth&gt;</h4>
<div class="paragraph">
<p>Set the username and API key to use for authentication. Expected format is <code>username:api_key</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bintrayowner_owner_optional"><a class="anchor" href="#_bintrayowner_owner_optional"></a>&ndash;bintrayOwner &lt;owner&gt; (optional)</h4>
<div class="paragraph">
<p>Override the Bintray owner.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bintrayrepo_repo_optional"><a class="anchor" href="#_bintrayrepo_repo_optional"></a>&ndash;bintrayRepo &lt;repo&gt; (optional)</h4>
<div class="paragraph">
<p>Override the Bintray repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="_release_true_false_default_true"><a class="anchor" href="#_release_true_false_default_true"></a>&ndash;release &lt;true | false&gt; (default: true)</h4>
<div class="paragraph">
<p>Should the files should be published after upload?</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bloop"><a class="anchor" href="#_bloop"></a>Bloop</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin generates <a href="https://scalacenter.github.io/bloop/">bloop</a> configuration
from your build file, which lets you use the bloop CLI for compiling, and makes
your scala code editable in <a href="https://scalameta.org/metals/">Metals</a></p>
</div>
<div class="sect2">
<h3 id="_quickstart_3"><a class="anchor" href="#_quickstart_3"></a>Quickstart</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">// build.sc (or any other .sc file it depends on, including predef)
import $ivy.`com.lihaoyi::mill-contrib-bloop:`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in your terminal :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; mill mill.contrib.bloop.Bloop/install</pre>
</div>
</div>
<div class="paragraph">
<p>It generate correct bloop config for any <code>JavaModule</code>, <code>ScalaModule</code>,
<code>ScalaJsModule</code> or <code>ScalaNativeModule</code> under the <code>.bloop</code> folder</p>
</div>
</div>
<div class="sect2">
<h3 id="_mix_in"><a class="anchor" href="#_mix_in"></a>Mix-in</h3>
<div class="paragraph">
<p>You can mix-in the <code>Bloop.Module</code> trait with any JavaModule to quickly access
the deserialised configuration for that particular module:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._
import mill.scalalib._
import mill.contrib.bloop.Bloop

object MyModule extends ScalaModule with Bloop.Module {
  def myTask = T { bloop.config() }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_note_regarding_metals"><a class="anchor" href="#_note_regarding_metals"></a>Note regarding metals</h3>
<div class="paragraph">
<p>Metals will automatically detect your mill workspace and generate the necessary files that bloop needs.
You don’t need to manually include the bloop plugin in order for this to work.
Also note that your mill/ammonite related <code>.sc</code> files are only partially supported by metals when
located inside a project workspace.</p>
</div>
</div>
<div class="sect2">
<h3 id="_note_regarding_current_mill_support_in_bloop"><a class="anchor" href="#_note_regarding_current_mill_support_in_bloop"></a>Note regarding current mill support in bloop</h3>
<div class="paragraph">
<p>The mill-bloop integration currently present in the <a href="https://github.com/scalacenter/bloop/blob/master/integrations/mill-bloop/src/main/scala/bloop/integrations/mill/MillBloop.scala#L10">bloop codebase</a>
will be deprecated in favour of this implementation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_buildinfo"><a class="anchor" href="#_buildinfo"></a>BuildInfo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generate scala code from your buildfile.
This plugin generates a single object containing information from your build.</p>
</div>
<div class="paragraph">
<p>To declare a module that uses BuildInfo you must extend the <code>mill.contrib.buildinfo.BuildInfo</code> trait when defining your module.</p>
</div>
<div class="paragraph">
<p>Quickstart:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-buildinfo:`
import mill.contrib.buildinfo.BuildInfo

object project extends BuildInfo {
  val name = &quot;poject-name&quot;
  def  buildInfoMembers: T[Map[String, String]] = T {
    Map(
      &quot;name&quot; -&gt; name),
      &quot;scalaVersion&quot; -&gt; scalaVersion()
    )
  }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_options"><a class="anchor" href="#_configuration_options"></a>Configuration options</h3>
<div class="ulist">
<ul>
<li>
<p><code>def buildInfoMembers: T[Map[String, String]]</code>
The map containing all member names and values for the generated info object.</p>
</li>
<li>
<p><code>def buildInfoObjectName: String</code>, default: <code>BuildInfo</code>
The name of the object which contains all the members from <code>buildInfoMembers</code>.</p>
</li>
<li>
<p><code>def buildInfoPackageName: Option[String]</code>, default: <code>None</code>
The package name of the object.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bsp_build_server_protocol"><a class="anchor" href="#_bsp_build_server_protocol"></a>BSP - Build Server Protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The contrib.bsp module is now included in mill by default and will eventually replace GenIdea.</p>
</div>
<div class="paragraph">
<p>Run the following command in the working directory of your project to generate the BSP config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill mill.bsp.BSP/install</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_known_issues"><a class="anchor" href="#_known_issues"></a>Known Issues:</h3>
<div class="ulist">
<ul>
<li>
<p>Sometimes build from IntelliJ might fail due to a NoClassDefFoundException
being thrown during the evaluation of tasks, a bug not easy to reproduce.
In this case it is recommended to refresh the bsp project.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_codeartifact"><a class="anchor" href="#_codeartifact"></a>Codeartifact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin allows publishing to AWS Codeartifact.</p>
</div>
<div class="sect2">
<h3 id="_quickstart_4"><a class="anchor" href="#_quickstart_4"></a>Quickstart</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-codeartifact:`
import mill.contrib.codeartifact.CodeartifactPublishModule

object mymodule extends CodeartifactPublishModule {
  def codeartifactUri: String = &quot;https://domain-name-domain-owner-id.d.codeartifact.region.amazonaws.com/maven/repo-name&quot;
  def codeartifactSnapshotUri: String = &quot;https://domain-name-domain-owner-id.d.codeartifact.region.amazonaws.com/maven/snapshot-repo-name&quot;

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ export CODEARTIFACT_AUTH_TOKEN=`aws codeartifact get-authorization-token --domain domain-name --domain-owner domain-owner-id --query authorizationToken --output text --profile profile-name`
$ mill mymodule.publishCodeartifact --credentials '$CODEARTIFACT_AUTH_TOKEN'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker"><a class="anchor" href="#_docker"></a>Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Automatically build docker images from your mill project.</p>
</div>
<div class="paragraph">
<p>Requires the docker CLI to be installed.</p>
</div>
<div class="paragraph">
<p>In the simplest configuration just extend <code>DockerModule</code> and declare a <code>DockerConfig</code> object.</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

import $ivy.`com.lihaoyi::mill-contrib-docker:`
import contrib.docker.DockerModule

object foo extends JavaModule with DockerModule {
  object docker extends DockerConfig
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill foo.docker.build
$ docker run foo</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h3>
<div class="paragraph">
<p>Configure the image by overriding tasks in the <code>DockerConfig</code> object</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object docker extends DockerConfig {
  // Override tags to set the output image name
  def tags = List(&quot;aws_account_id.dkr.ecr.region.amazonaws.com/hello-repository&quot;)

  def baseImage = &quot;openjdk:11&quot;

  // Configure whether the docker build should check the remote registry for a new version of the base image before building.
  // By default this is true if the base image is using a latest tag
  def pullBaseImage = true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run mill in interactive mode to see the docker client output, like <code>mill -i foo.docker.build</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_flyway"><a class="anchor" href="#_flyway"></a>Flyway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enables you to configure and run <a href="https://flywaydb.org/">Flyway</a> commands from your mill build file.
The flyway module currently supports the most common flyway use cases with file based migrations.</p>
</div>
<div class="paragraph">
<p>Configure flyway by overriding settings in your module. For example</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

import $ivy.`com.lihaoyi::mill-contrib-flyway:`
import contrib.flyway.FlywayModule

object foo extends ScalaModule with FlywayModule {
  def scalaVersion = &quot;2.12.8&quot;

  //region flyway
  def flywayUrl = &quot;jdbc:postgresql:myDb&quot; // required
  def flywayDriverDeps = Agg(ivy&quot;org.postgresql:postgresql:42.2.5&quot;) // required
  def flywayUser = &quot;postgres&quot; // optional
  // def flywayPassword = &quot;&quot; // optional
  //endregion
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Flyway will look for migration files in <code>db/migration</code> in all resources folders by default.
This should work regardless of if you are using a mill or sbt project layout.</p>
</div>
<div class="paragraph">
<p>You can then run common flyway commands like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill foo.flywayClean
mill foo.flywayInfo
mill foo.flywayMigrate</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
You should never hard-code credentials or check them into a version control system.
You should write some code to populate the settings for flyway instead.
For example <code>def flywayPassword = T.input(T.ctx.env(&quot;FLYWAY_PASSWORD&quot;))</code>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_play_framework"><a class="anchor" href="#_play_framework"></a>Play Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module adds basic Play Framework support to mill:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>configures mill for Play default directory layout,</p>
</li>
<li>
<p>integrates the Play routes compiler,</p>
</li>
<li>
<p>provides helpers for commonly used framework libraries,</p>
</li>
<li>
<p>optionally: integrates the Twirl template engine,</p>
</li>
<li>
<p>optionally: configures mill for single module play applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is no specific Play Java support, building a Play Java application will require a bit
of customization (mostly adding the proper dependencies).</p>
</div>
<div class="sect2">
<h3 id="_using_the_plugin"><a class="anchor" href="#_using_the_plugin"></a>Using the plugin</h3>
<div class="paragraph">
<p>There are 2 base modules and 2 helper traits in this plugin, all of which can be found
 in <code>mill.playlib</code>.</p>
</div>
<div class="paragraph">
<p>The base modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PlayModule</code> applies the default Play configuration (layout, dependencies, routes compilation,
Twirl compilation and Akka HTTP server)</p>
</li>
<li>
<p><code>PlayApiModule</code> applies the default Play configuration without <code>Twirl</code> templating. This is useful
if your Play app is a pure API server or if you want to use a different templating engine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The two helper traits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SingleModule</code> can be useful to configure mill for a single module Play application such as the
<a href="https://github.com/playframework/play-scala-seed.g8">play-scala-seed project</a>. Mill is
multi-module by default and requires a bit more configuration to have source, resource, and test
directories at the top level alongside the <code>build.sc</code> file. This trait takes care of that (See
<a href="#_using_singlemodule">Using <code>SingleModule</code></a> below).</p>
</li>
<li>
<p><code>RouterModule</code> allows you to use the Play router without the rest of the configuration (see
<a href="#_using_the_router_module_directly">Using the router module directly</a>.)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_using_playmodule"><a class="anchor" href="#_using_playmodule"></a>Using <code>PlayModule</code></h3>
<div class="paragraph">
<p>In order to use the <code>PlayModule</code> for your application, you need to provide the scala, Play and
Twirl versions. You also need to define your own test object which extends the provided
<code>PlayTests</code> trait.</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._
import $ivy.`com.lihaoyi::mill-contrib-playlib:`,  mill.playlib._

object core extends PlayModule {
    //config
    override def scalaVersion= T{&quot;2.12.8&quot;}
    override def playVersion= T{&quot;2.7.0&quot;}
    override def twirlVersion= T{&quot;1.4.0&quot;}

    object test extends PlayTests
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the above definition, your build will be configured to use the default Play layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">.
├── build.sc
└── core
    ├── app
    │&nbsp;&nbsp; ├── controllers
    │&nbsp;&nbsp; └── views
    ├── conf
    │&nbsp;&nbsp; └── application.conf
    │&nbsp;&nbsp; └── routes
    │&nbsp;&nbsp; └── ...
    ├── logs
    ├── public
    │&nbsp;&nbsp; ├── images
    │&nbsp;&nbsp; ├── javascripts
    │&nbsp;&nbsp; └── stylesheets
    └── test
        └── controllers</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following compile dependencies will automatically be added to your build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">Agg(
  ivy&quot;com.typesafe.play::play:${playVersion()}&quot;,
  ivy&quot;com.typesafe.play::play-guice:${playVersion()}&quot;,
  ivy&quot;com.typesafe.play::play-server:${playVersion()}&quot;,
  ivy&quot;com.typesafe.play::play-logback:${playVersion()}&quot;
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Scala test will be setup as the default test framework and the following test dependencies will be
added (the actual version depends on the version of Play you are pulling <code>2.6.x</code> or <code>2.7.x</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">ivy&quot;org.scalatestplus.play::scalatestplus-play::4.0.1&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to have a working <code>start</code> command the following runtime dependency is also added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ivy&quot;com.typesafe.play::play-akka-http-server:${playVersion()}&quot;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_playapimodule"><a class="anchor" href="#_using_playapimodule"></a>Using <code>PlayApiModule</code></h3>
<div class="paragraph">
<p>The <code>PlayApiModule</code> trait behaves the same as the <code>PlayModule</code> trait but it won’t process .scala
.html files and you don’t need to define the `twirlVersion:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._
import $ivy.`com.lihaoyi::mill-contrib-playlib:`,  mill.playlib._

object core extends PlayApiModule {
    //config
    override def scalaVersion= T{&quot;2.12.8&quot;}
    override def playVersion= T{&quot;2.7.0&quot;}

    object test extends PlayTests
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_play_configuration_options"><a class="anchor" href="#_play_configuration_options"></a>Play configuration options</h3>
<div class="paragraph">
<p>The Play modules themselves don’t have specific configuration options at this point but the <a href="#router-configuration-options">router
module configuration options</a> and the <a href="#_twirl_configuration_options">Twirl configuration options</a> are applicable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_additional_play_libraries"><a class="anchor" href="#_additional_play_libraries"></a>Additional play libraries</h3>
<div class="paragraph">
<p>The following helpers are available to provide additional Play Framework dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>core()</code> - added by default ,</p>
</li>
<li>
<p><code>guice()</code> - added by default,</p>
</li>
<li>
<p><code>server()</code> - added by default,</p>
</li>
<li>
<p><code>logback()</code> - added by default,</p>
</li>
<li>
<p><code>evolutions()</code> - optional,</p>
</li>
<li>
<p><code>jdbc()</code> - optional,</p>
</li>
<li>
<p><code>filters()</code> - optional,</p>
</li>
<li>
<p><code>ws()</code> - optional,</p>
</li>
<li>
<p><code>caffeine()</code> - optional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to add an optional library using the helper you can do so by overriding <code>ivyDeps</code>
like in the following example build:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._
import $ivy.`com.lihaoyi::mill-contrib-playlib:`, mill.playlib._

object core extends PlayApiModule {
    //config
    override def scalaVersion= T{&quot;2.12.8&quot;}
    override def playVersion= T{&quot;2.7.0&quot;}

    object test extends PlayTests

    override def ivyDeps = T{ super.ivyDeps() ++ Agg(ws(), filters()) }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_commands_equivalence"><a class="anchor" href="#_commands_equivalence"></a>Commands equivalence</h3>
<div class="paragraph">
<p>Mill commands are targets on a named build. For example if your build is called <code>core</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>compile: <code>core.compile</code></p>
</li>
<li>
<p>run: <em>NOT Implemented yet</em>. It can be approximated with <code>mill -w core.runBackground</code> but this
starts a server in <em>PROD</em> mode which:</p>
</li>
<li>
<p>doesn’t do any kind of classloading magic (meaning potentially slower restarts)</p>
</li>
<li>
<p>returns less detailed error messages (no source code extract and line numbers)</p>
</li>
<li>
<p>can sometimes fail because of a leftover RUNNING_PID file</p>
</li>
<li>
<p>start: <code>core.start</code> or <code>core.run</code> both start the server in <em>PROD</em> mode.</p>
</li>
<li>
<p>test: <code>core.test</code></p>
</li>
<li>
<p>dist: <em>NOT Implemented yet</em>. However you can use the equivalent <code>core.assembly</code>
command to get a runnable fat jar of the project. The packaging is slightly different but should
be find for a production deployment.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_using_singlemodule"><a class="anchor" href="#_using_singlemodule"></a>Using <code>SingleModule</code></h3>
<div class="paragraph">
<p>The <code>SingleModule</code> trait allows you to have the build descriptor at the same level as the source
 code on the filesystem. You can move from there to a multi-module build either by refactoring
 your directory layout into multiple subdirectories or by using mill’s nested modules feature.</p>
</div>
<div class="paragraph">
<p>Looking back at the sample build definition in <a href="#_using_playmodule">Using <code>PlayModule</code></a>:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._
import $ivy.`com.lihaoyi::mill-contrib-playlib:`, mill.playlib._

object core extends PlayModule {
    //config
    override def scalaVersion= T{&quot;2.12.8&quot;}
    override def playVersion= T{&quot;2.7.0&quot;}
    override def twirlVersion= T{&quot;1.4.0&quot;}

    object test extends PlayTests
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The directory layout was:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">.
├── build.sc
└── core
    ├── app
    │&nbsp;&nbsp; ├── controllers
    │&nbsp;&nbsp; └── views
    ├── conf
    │&nbsp;&nbsp; └── application.conf
    │&nbsp;&nbsp; └── routes
    │&nbsp;&nbsp; └── ...
    ├── logs
    ├── public
    │&nbsp;&nbsp; ├── images
    │&nbsp;&nbsp; ├── javascripts
    │&nbsp;&nbsp; └── stylesheets
    └── test
        └── controllers</code></pre>
</div>
</div>
<div class="paragraph">
<p>by mixing in the <code>SingleModule</code> trait in your build:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._
import $ivy.`com.lihaoyi::mill-contrib-playlib:`,  mill.playlib._

object core extends PlayModule with SingleModule {
 //config
 override def scalaVersion= T{&quot;2.12.8&quot;}
 override def playVersion= T{&quot;2.7.0&quot;}
 override def twirlVersion= T{&quot;1.4.0&quot;}

 object test extends PlayTests
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the layout becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">.
└── core
    ├── build.sc
    ├── app
    │&nbsp;&nbsp; ├── controllers
    │&nbsp;&nbsp; └── views
    ├── conf
    │&nbsp;&nbsp; └── application.conf
    │&nbsp;&nbsp; └── routes
    │&nbsp;&nbsp; └── ...
    ├── logs
    ├── public
    │&nbsp;&nbsp; ├── images
    │&nbsp;&nbsp; ├── javascripts
    │&nbsp;&nbsp; └── stylesheets
    └── test
        └── controllers</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_router_module_directly"><a class="anchor" href="#_using_the_router_module_directly"></a>Using the router module directly</h4>
<div class="paragraph">
<p>If you want to use the router module in a project which doesn’t use the default Play layout, you
can mix-in the <code>mill.playlib.routesModule</code> trait directly when defining your module. Your app must
define <code>playVersion</code> and <code>scalaVersion</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._
import $ivy.`com.lihaoyi::mill-contrib-playlib:`,  mill.playlib._

object app extends ScalaModule with RouterModule {
  def playVersion= T{&quot;2.7.0&quot;}
  def scalaVersion= T{&quot;2.12.8&quot;}
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_router_configuration_options"><a class="anchor" href="#_router_configuration_options"></a>Router Configuration options</h5>
<div class="ulist">
<ul>
<li>
<p><code>def playVersion: T[String]</code> (mandatory) - The version of Play to use to compile the routes file.</p>
</li>
<li>
<p><code>def scalaVersion: T[String]</code> - The scalaVersion in use in your project.</p>
</li>
<li>
<p><code>def routes: Sources</code> - The directory which contains your route files. (Defaults to : <code>routes/</code>)</p>
</li>
<li>
<p><code>def routesAdditionalImport: Seq[String]</code> - Additional imports to use in the generated routers.
(Defaults to <code>Seq(&quot;controllers.Assets.Asset&quot;, &quot;play.libs.F&quot;)</code></p>
</li>
<li>
<p><code>def generateForwardsRouter: Boolean = true</code> - Enables the forward router generation.</p>
</li>
<li>
<p><code>def generateReverseRouter: Boolean = true</code> - Enables the reverse router generation.</p>
</li>
<li>
<p><code>def namespaceReverseRouter: Boolean = false</code> - Enables the namespacing of reverse routers.</p>
</li>
<li>
<p><code>def generatorType: RouteCompilerType = RouteCompilerType.InjectedGenerator</code> - The routes
compiler type, one of RouteCompilerType.InjectedGenerator or RouteCompilerType.StaticGenerator</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_details"><a class="anchor" href="#_details"></a>Details</h5>
<div class="paragraph">
<p>The following filesystem layout is expected by default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">.
├── app
│&nbsp;&nbsp; └── routes
│&nbsp;&nbsp;     └── routes
└── build.sc</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>RouterModule</code> adds the <code>compileRouter</code> task to the module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill app.compileRouter</code></pre>
</div>
</div>
<div class="paragraph">
<p>(it will be automatically run whenever you compile your module)</p>
</div>
<div class="paragraph">
<p>This task will compile <code>routes</code> templates into the <code>out/app/compileRouter/dest</code>
directory. This directory must be added to the generated sources of the module to be compiled and
made accessible from the rest of the code. This is done by default in the trait, but if you need
to have a custom override for <code>generatedSources</code> you can get the list of files from <code>routerClasses</code></p>
</div>
<div class="paragraph">
<p>To add additional imports to all of the routes:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill.scalalib._

import $ivy.`com.lihaoyi::mill-contrib-playlib:`,  mill.playlib._

object app extends ScalaModule with RouterModule {
  def playVersion = &quot;2.7.0&quot;
  override def routesAdditionalImport = Seq(&quot;my.additional.stuff._&quot;, &quot;my.other.stuff._&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proguard"><a class="anchor" href="#_proguard"></a>Proguard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module allows <a href="https://www.guardsquare.com/en/products/proguard/manual/introduction">Proguard</a> to be used in Mill builds.
ProGuard is a Java class file shrinker, optimizer, obfuscator, and preverifier.</p>
</div>
<div class="paragraph">
<p>By default, all four steps - shrink, optimize, obfuscate, verify - are run, but this can be configured through task options.
Any additional options can be specified as a list of strings with <code>additionalOptions</code>. The full list of proguard options
can be found <a href="https://www.guardsquare.com/en/products/proguard/manual/usage">here</a>.</p>
</div>
<div class="paragraph">
<p>The output of <code>assembly</code> is used as the input jar and the output is written to <code>out.jar</code> in the <code>dest</code> folder.</p>
</div>
<div class="paragraph">
<p>The <code>stdout</code> and <code>stderr</code> from the proguard command can be found under the <code>dest</code> folder.</p>
</div>
<div class="paragraph">
<p>The only default entrypoint is the main class (i.e. <code>finalMainClass</code> task). Additional entrypoints can be configured using <code>additionalOptions</code> as well.</p>
</div>
<div class="paragraph">
<p>Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-proguard:`
import contrib.proguard._

object foo extends ScalaModule with Proguard {
  def scalaVersion = &quot;2.12.0&quot;

  override def shrink: T[Boolean] = T { true }
  override def optimize: T[Boolean] = T { false }
  override def obfuscate: T[Boolean] = T { false }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, please note that Proguard doesn’t seem to work with scala 2.13 yet.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scalapb"><a class="anchor" href="#_scalapb"></a>ScalaPB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module allows <a href="https://scalapb.github.io">ScalaPB</a> to be used in Mill builds. ScalaPB is a <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> compiler plugin that generates Scala case classes, encoders and decoders for protobuf messages.</p>
</div>
<div class="paragraph">
<p>To declare a module that uses ScalaPB you can extend the <code>mill.contrib.scalapblib.ScalaPBModule</code> trait when defining your module.</p>
</div>
<div class="paragraph">
<p>This creates a Scala module which compiles <code>.proto</code> files in the <code>protobuf</code> folder of the module with ScalaPB and adds the resulting <code>.scala</code> sources to your module’s <code>generatedSources</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-scalapblib:`
import contrib.scalapblib._

object example extends ScalaPBModule {
  def scalaVersion = &quot;2.12.6&quot;
  def scalaPBVersion = &quot;0.7.4&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines a project with the following layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">build.sc
example/
    src/
    protobuf/
    resources/</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_options_2"><a class="anchor" href="#_configuration_options_2"></a>Configuration options</h3>
<div class="ulist">
<ul>
<li>
<p>scalaPBVersion (mandatory) - The ScalaPB version <code>String</code> e.g. <code>&quot;0.7.4&quot;</code></p>
</li>
<li>
<p>scalaPBFlatPackage - A <code>Boolean</code> option which determines whether the <code>.proto</code> file name should be appended as the final segment of the package name in the generated sources.</p>
</li>
<li>
<p>scalaPBJavaConversions - A <code>Boolean</code> option which determines whether methods for converting between the generated Scala classes and the Protocol Buffers Java API classes should be generated.</p>
</li>
<li>
<p>scalaPBGrpc - A <code>Boolean</code> option which determines whether <a href="https://grpc.io">grpc</a> stubs should be generated.</p>
</li>
<li>
<p>scalaPBSingleLineToProtoString - A <code>Boolean</code> option which determines whether the generated <code>.toString</code> methods should use a single line format.</p>
</li>
<li>
<p>scalaPBProtocPath - A <code>Option[Path]</code> option which determines the protoc compiler to use. If <code>None</code>, a java embedded protoc will be used, if set to <code>Some</code> path, the given binary is used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you’d like to configure the <a href="https://scalapb.github.io/docs/scalapbc#passing-generator-parameters">options</a> that are passed to the ScalaPB compiler directly, you can override the <code>scalaPBOptions</code> task, for example:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-scalapblib:`
import contrib.scalapblib._

object example extends ScalaPBModule {
  def scalaVersion = &quot;2.12.6&quot;
  def scalaPBVersion = &quot;0.7.4&quot;
  override def scalaPBOptions = &quot;flat_package,java_conversions&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you’d like to pass additional arguments to the ScalaPB compiler directly, you can override the <code>scalaPBAdditionalArgs</code> task, for example:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-scalapblib:`
import contrib.scalapblib._

object example extends ScalaPBModule {
  def scalaVersion = &quot;2.12.6&quot;
  def scalaPBVersion = &quot;0.7.4&quot;
  override def scalaPBAdditionalArgs =
    Seq(s&quot;--zio_out=${T.dest.toIO.getCanonicalPath}&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scoverage"><a class="anchor" href="#_scoverage"></a>Scoverage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module allows you to generate code coverage reports for Scala projects with
<a href="https://github.com/scoverage">Scoverage</a> via the
<a href="https://github.com/scoverage/scalac-scoverage-plugin">scalac-scoverage-plugin</a>.</p>
</div>
<div class="paragraph">
<p>To declare a module for which you want to generate coverage reports you can
extends the <code>mill.contrib.scoverage.ScoverageModule</code> trait when defining your
module. Additionally, you must define a submodule that extends the
<code>ScoverageTests</code> trait that belongs to your instance of <code>ScoverageModule</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-scoverage:`
import mill.contrib.scoverage.ScoverageModule

object foo extends ScoverageModule  {
  def scalaVersion = &quot;2.12.9&quot;
  def scoverageVersion = &quot;1.4.0&quot;

  object test extends ScoverageTests with TestModule.ScalaTest {
    def ivyDeps = Agg(ivy&quot;org.scalatest::scalatest:3.0.8&quot;)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the normal tasks available to your Scala module, Scoverage
modules introduce a few new tasks and changes the behavior of an existing one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill foo.scoverage.compile      # compiles your module with test instrumentation
                                # (you don't have to run this manually, running the test task will force its invocation)

mill foo.test                   # tests your project and collects metrics on code coverage
mill foo.scoverage.htmlReport   # uses the metrics collected by a previous test run to generate a coverage report in html format
mill foo.scoverage.xmlReport    # uses the metrics collected by a previous test run to generate a coverage report in xml format</code></pre>
</div>
</div>
<div class="paragraph">
<p>The measurement data is by default available at <code>out/foo/scoverage/data/dest</code>,
the html report is saved in <code>out/foo/scoverage/htmlReport/dest/</code>,
and the xml report is saved in <code>out/foo/scoverage/xmlReport/dest/</code>.</p>
</div>
<div class="sect2">
<h3 id="_multi_module_projects"><a class="anchor" href="#_multi_module_projects"></a>Multi-module projects</h3>
<div class="paragraph">
<p>If you’re using Scoverage on a project with multiple modules then an additional
module, <code>ScoverageReport</code>, is available to help aggregate the reports from all
<code>ScoverageModule</code>s.</p>
</div>
<div class="paragraph">
<p>Simply define a <code>scoverage</code> module at the root of your project as shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">  object scoverage extends ScoverageReport {
    override def scalaVersion     = &quot;&lt;scala-version&gt;&quot;
    override def scoverageVersion = &quot;&lt;scoverage-version&gt;&quot;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This provides you with various reporting functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill __.test                     # run tests for all modules
mill scoverage.htmlReportAll     # generates report in html format for all modules
mill scoverage.xmlReportAll      # generates report in xml format for all modules
mill scoverage.consoleReportAll  # reports to the console for all modules</code></pre>
</div>
</div>
<div class="paragraph">
<p>The aggregated report will be available at either <code>out/scoverage/htmlReportAll/dest/</code>
for html reports or <code>out/scoverage/xmlReportAll/dest/</code> for xml reports.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testng"><a class="anchor" href="#_testng"></a>TestNG</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provides support for <a href="https://testng.org/doc/index.html">TestNG</a>.</p>
</div>
<div class="paragraph">
<p>To use TestNG as test framework, you need to add it to the <code>TestModule.testFramework</code> property.</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill.scalalib._

object project extends ScalaModule {
  object test extends Tests {
    def testFramework = &quot;mill.testng.TestNGFramework&quot;
    def ivyDeps = super.ivyDeps ++ Agg(
      ivy&quot;com.lihaoyi:mill-contrib-testng:${mill.BuildInfo.millVersion}&quot;
    )
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the more convenient <code>TestModule.TestNg</code> trait.</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill.scalalib._

object project extends ScalaModule {
  object test extends Tests with TestModule.TestNg
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_twirl"><a class="anchor" href="#_twirl"></a>Twirl</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Twirl templates support.</p>
</div>
<div class="paragraph">
<p>To declare a module that needs to compile twirl templates you must extend the <code>mill.twirllib.TwirlModule</code> trait when defining your module.
Also note that twirl templates get compiled into scala code, so you also need to extend <code>ScalaModule</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill.scalalib._

import $ivy.`com.lihaoyi::mill-contrib-twirllib:`,  mill.twirllib._

object app extends ScalaModule with TwirlModule {
// ...
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_details_2"><a class="anchor" href="#_details_2"></a>Details</h3>
<div class="paragraph">
<p>The following filesystem layout is expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">build.sc
app/
  views/
    view1.scala.html
    view2.scala.html</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>TwirlModule</code> adds the <code>compileTwirl</code> task to the module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">mill app.compileTwirl</code></pre>
</div>
</div>
<div class="paragraph">
<p>(it will be automatically run whenever you compile your module)</p>
</div>
<div class="paragraph">
<p>This task will compile <code><strong>.scala.html</strong></code> templates (and others, like <code>.scala.txt</code>) into the <code>out/app/compileTwirl/dest</code>
directory. This directory must be added to the generated sources of the module to be compiled and made accessible from the rest of the code:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill.scalalib._

import $ivy.`com.lihaoyi::mill-contrib-twirllib:`,  mill.twirllib._

object app extends ScalaModule with TwirlModule {
  def twirlVersion = &quot;1.3.15&quot;
  def generatedSources = T{ Seq(compileTwirl().classes) }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_twirl_configuration_options"><a class="anchor" href="#_twirl_configuration_options"></a>Twirl configuration options</h3>
<div class="sect3">
<h4 id="_def_twirlversion_tstring"><a class="anchor" href="#_def_twirlversion_tstring"></a>def twirlVersion: T[String]</h4>
<div class="paragraph">
<p>Mandatory - the version of the twirl compiler to use, like &quot;1.3.15&quot;.</p>
</div>
</div>
<div class="sect3">
<h4 id="_def_twirlimports_tseqstring"><a class="anchor" href="#_def_twirlimports_tseqstring"></a>def twirlImports: T[Seq[String]]</h4>
<div class="paragraph">
<p>The imports that will be added by the twirl compiler to the top of all templates, defaults to <a href="https://github.com/playframework/twirl/blob/1.5.0/compiler/src/main/scala/play/twirl/compiler/TwirlCompiler.scala#L166-L173">twirl’s default imports</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">Seq(
  &quot;_root_.play.twirl.api.TwirlFeatureImports._&quot;,
  &quot;_root_.play.twirl.api.TwirlHelperImports._&quot;,
  &quot;_root_.play.twirl.api.Html&quot;,
  &quot;_root_.play.twirl.api.JavaScript&quot;,
  &quot;_root_.play.twirl.api.Txt&quot;,
  &quot;_root_.play.twirl.api.Xml&quot;
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To add additional imports to all of the twirl templates, override <code>twirlImports</code> in your build:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill.scalalib._

import $ivy.`com.lihaoyi::mill-contrib-twirllib:`,  mill.twirllib._

object app extends ScalaModule with TwirlModule {
  def twirlVersion = &quot;1.3.15&quot;
  override def twirlImports = super.twirlImports() ++ Seq(&quot;my.additional.stuff._&quot;, &quot;my.other.stuff._&quot;)
  def generatedSources = T{ Seq(compileTwirl().classes) }
}

// out.template.scala
@import _root_.play.twirl.api.TwirlFeatureImports._
// ...
@import _root_.play.twirl.api.Xml
@import my.additional.stuff._
@import my.other.stuff._</code></pre>
</div>
</div>
<div class="paragraph">
<p>To exclude the default imports, simply override <code>twirlImports</code> without calling <code>super</code>:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object app extends ScalaModule with TwirlModule {
  // ...
  override def twirlImports = Seq(&quot;my.stuff._&quot;)
}

// out.template.scala
@import my.stuff._</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_def_twirlformats_mapstring_string"><a class="anchor" href="#_def_twirlformats_mapstring_string"></a>def twirlFormats: Map[String, String]</h4>
<div class="paragraph">
<p>A mapping of file extensions to class names that will be compiled by twirl, e.g. <code>Map(&quot;html&quot; -&gt; &quot;play.twirl.api.HtmlFormat&quot;)</code>.
By default <code>html</code>, <code>xml</code>, <code>js</code>, and <code>txt</code> files will be compiled using the corresponding <a href="https://github.com/playframework/twirl/blob/1.5.0/api/shared/src/main/scala/play/twirl/api/Formats.scala">twirl format</a>.</p>
</div>
<div class="paragraph">
<p>To add additional formats, override <code>twirlFormats</code> in your build:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill.scalalib._

import $ivy.`com.lihaoyi::mill-contrib-twirllib:`,  mill.twirllib._

object app extends ScalaModule with TwirlModule {
  def twirlVersion = &quot;1.3.15&quot;
  override def twirlFormats = super.twirlFormats() + Map(&quot;svg&quot; -&gt; &quot;play.twirl.api.HtmlFormat&quot;)
  def generatedSources = T{ Seq(compileTwirl().classes) }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_def_twirlconstructorannotations_seqstring_nil"><a class="anchor" href="#_def_twirlconstructorannotations_seqstring_nil"></a>def twirlConstructorAnnotations: Seq[String] = Nil</h4>
<div class="paragraph">
<p>Annotations added to the generated classes' constructors (note it only applies to templates with <code>@this(...​)</code> constructors).</p>
</div>
</div>
<div class="sect3">
<h4 id="_def_twirlcodec_codecproperties_sourceencoding"><a class="anchor" href="#_def_twirlcodec_codecproperties_sourceencoding"></a>def twirlCodec = Codec(Properties.sourceEncoding)</h4>
<div class="paragraph">
<p>The codec used to generate the files (the default is the same sbt plugin uses).</p>
</div>
</div>
<div class="sect3">
<h4 id="_def_twirlinclusivedot_boolean_false"><a class="anchor" href="#_def_twirlinclusivedot_boolean_false"></a>def twirlInclusiveDot: Boolean = false</h4>
<div class="paragraph">
<p>Whether the twirl parser should parse with an inclusive dot.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example"><a class="anchor" href="#_example"></a>Example</h3>
<div class="paragraph">
<p>There’s an <a href="https://github.com/lihaoyi/cask/tree/master/example/twirl">example project</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_version_file"><a class="anchor" href="#_version_file"></a>Version file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin provides helpers for updating a version file and committing the changes to git.</p>
</div>
<div class="paragraph">
<p><strong>Note: You can still make manual changes to the version file in-between execution of the targets provided by the module.</strong>
<strong>Each target operates on the version file as is at the time of execution.</strong></p>
</div>
<div class="sect2">
<h3 id="_quickstart_5"><a class="anchor" href="#_quickstart_5"></a>Quickstart</h3>
<div class="paragraph">
<p>Add a <code>VersionFileModule</code> to the <code>build.sc</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-versionfile:`
import mill.contrib.versionfile.VersionFileModule

object versionFile extends VersionFileModule</code></pre>
</div>
</div>
<div class="paragraph">
<p>The module will read and write to the file <code>version</code> located at the module’s <code>millSourcePath</code>.
In the example above, that would be <code>/versionFile/version</code> relative to the <code>build.sc</code> file.</p>
</div>
<div class="paragraph">
<p>Create the version file with the initial version number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ 0.1.0-SNAPSHOT &gt; versionFile/version</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then to write a release version or snapshot version to file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill versionFile.setReleaseVersion           # Sets release
$ mill versionFile.setNextVersion --bump minor # Sets snapshot</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also make manual changes in-between:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill versionFile.setReleaseVersion
$ echo 0.1.0 &gt; versionFile/version
$ mill versionFile.setNextVersion --bump minor # Will now set the version to 0.2.0-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use the version file for publishing, you can do it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-versionfile:`
import mill.contrib.versionfile.VersionFileModule

object versionFile extends VersionFileModule

object mymodule extends PublishModule {
  def publishVersion = versionFile.currentVersion().toString
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_the_version_file"><a class="anchor" href="#_configure_the_version_file"></a>Configure the version file</h3>
<div class="paragraph">
<p>If you want the version file to have another name, you will need to override the <code>versionFile</code> task.</p>
</div>
<div class="paragraph">
<p>If you have a project wide version file like in the example above, and you want the version file to reside
at the root of the project, you can override <code>millSourcePath</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import $ivy.`com.lihaoyi::mill-contrib-versionfile:`
import mill.contrib.versionfile.VersionFileModule

object versionFile extends VersionFileModule {
  def millSourcePath = millOuterCtx.millSourcePath
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, it would look for the file <code>version</code> in the same directory as the <code>build.sc</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_set_release_version"><a class="anchor" href="#_set_release_version"></a>Set release version</h3>
<div class="paragraph">
<p>The <code>setReleaseVersion</code> target removes the <code>-SNAPSHOT</code> identifier from the version,
then overwrites the previous content in the version file with this new version.</p>
</div>
<div class="sect3">
<h4 id="_example_2"><a class="anchor" href="#_example_2"></a>Example</h4>
<div class="paragraph">
<p>Your version file contains <code>0.1.0-SNAPSHOT</code>. In your terminal you do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill versionFile.setReleaseVersion</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will update the version file to contain <code>0.1.0</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_next_version"><a class="anchor" href="#_set_next_version"></a>Set next version</h3>
<div class="paragraph">
<p>The <code>setNextVersion</code> target bumps the version and changes it to a snapshot version,
then overwrites the previous content in the version file with this new version.</p>
</div>
<div class="sect3">
<h4 id="_parameters"><a class="anchor" href="#_parameters"></a>Parameters</h4>
<div class="sect4">
<h5 id="_bump_major_minor_patch"><a class="anchor" href="#_bump_major_minor_patch"></a>&ndash;bump (major | minor | patch)</h5>
<div class="paragraph">
<p>Sets what segment of the version to bump.</p>
</div>
<div class="paragraph">
<p>For a version number <code>1.2.3</code> in the version file:</p>
</div>
<div class="paragraph">
<p><code>--bump major</code> will set it to <code>2.0.0</code></p>
</div>
<div class="paragraph">
<p><code>--bump minor</code> will set it to <code>1.3.0</code></p>
</div>
<div class="paragraph">
<p><code>--bump patch</code> will set it to <code>1.2.4</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_3"><a class="anchor" href="#_example_3"></a>Example</h4>
<div class="paragraph">
<p>Your version file contains <code>0.1.0</code>. In your terminal you do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill versionFile.setNextVersion --bump minor</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will update the version file to contain <code>0.2.0-SNAPSHOT</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_version"><a class="anchor" href="#_set_version"></a>Set version</h3>
<div class="paragraph">
<p>The <code>setVersion</code> overwrites the previous content of the version file with an arbitrary version.</p>
</div>
<div class="sect3">
<h4 id="_parameters_2"><a class="anchor" href="#_parameters_2"></a>Parameters</h4>
<div class="sect4">
<h5 id="_version_x_y_z_snapshot"><a class="anchor" href="#_version_x_y_z_snapshot"></a>&ndash;version x.y.z[-SNAPSHOT]</h5>
<div class="paragraph">
<p>The version to write to the version file.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_4"><a class="anchor" href="#_example_4"></a>Example</h4>
<div class="paragraph">
<p>Your version file contains <code>0.1.0</code>. In your terminal you do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill versionFile.setVersion --version 0.5.2-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will update the version file to contain <code>0.5.2-SNAPSHOT</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_output_version_numbers"><a class="anchor" href="#_output_version_numbers"></a>Output version numbers</h3>
<div class="paragraph">
<p>If you need to output the version numbers (for example for other CI tools you might use), you can use the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Show the current version from the version file.
$ mill show versionFile.currentVersion</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Show the version that would be used as release version.
$ mill show versionFile.releaseVersion</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Show the version that would be used as next version with the given --bump argument.
$ mill show versionFile.nextVersion --bump minor</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_vcs_operations"><a class="anchor" href="#_vcs_operations"></a>VCS operations</h3>
<div class="paragraph">
<p>The module has an <code>exec</code> task that allows you to execute tasks of type <code>T[Seq[os.proc]]</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill mill.contrib.versionfile.VersionFile/exec --procs versionFile.tag
$ mill mill.contrib.versionfile.VersionFile/exec --procs versionFile.push</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_built_in_git_operations"><a class="anchor" href="#_built_in_git_operations"></a>Built-in git operations</h4>
<div class="paragraph">
<p>The <code>VersionFileModule</code> comes with two tasks of this type:</p>
</div>
<div class="sect4">
<h5 id="_tag"><a class="anchor" href="#_tag"></a>Tag</h5>
<div class="paragraph">
<p>Commits the changes, then creates a tag with the current version for that commit.</p>
</div>
</div>
<div class="sect4">
<h5 id="_push"><a class="anchor" href="#_push"></a>Push</h5>
<div class="paragraph">
<p>Commits the changes, then pushes the changes to origin/master with tags.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_operations"><a class="anchor" href="#_custom_operations"></a>Custom operations</h4>
<div class="paragraph">
<p>It’s possible to override the tasks above, or add your own tasks, to adapt the module
to work with other version control systems than git.</p>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="Mill_Internals.html">Mill Internals</a></span>
  <span class="next"><a href="Thirdparty_Plugins.html">Thirdparty Plugins</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async="async" src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async="async" src="../../search-index.js"></script>
  
</body></html>