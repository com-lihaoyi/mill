<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Introduction to Mill :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/javalib/intro.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="Configuring_Mill.html">
    <meta name="generator" content="Antora 3.1.12">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style>
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />&nbsp;The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/mill.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="0.9.12">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="Intro_to_Mill.html">Introduction to Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Configuring_Mill.html">Configuring Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Common_Project_Layouts.html">Common Project Layouts</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Tasks.html">Tasks</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Task_Context_API.html">Task Context API</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Extending_Mill.html">Extending Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Mill_Internals.html">Mill Internals</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Thirdparty Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.9.12</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../main-branch/index.html">main-branch</a>
        </li>
        <li class="version">
          <a href="../dev-1.1.0-RC2-20-a8a699/index.html">dev-1.1.0-RC2-20-a8a699</a>
        </li>
        <li class="version is-latest">
          <a href="../index.html">1.1.0-RC2</a>
        </li>
        <li class="version">
          <a href="../1.0.x/index.html">1.0.6</a>
        </li>
        <li class="version">
          <a href="../0.12.x/index.html">0.12.16</a>
        </li>
        <li class="version">
          <a href="../0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px; ">
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Introduction to Mill</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/com-lihaoyi/mill">Mill</a> is your shiny new Java/Scala build tool!
<a href="http://www.lihaoyi.com/post/SowhatswrongwithSBT.html">Scared of SBT</a>? Melancholy over Maven? Grumbling about Gradle?
Baffled by Bazel? Give Mill a try!</p>
</div>
<div class="paragraph">
<p>Mill aims for simplicity by re-using concepts you are already
<a href="http://www.lihaoyi.com/post/BuildToolsasPureFunctionalPrograms.html">familiar with</a>, borrowing ideas from modern tools
like <a href="https://bazel.build/">Bazel</a>, to let you build your projects in a way that&#8217;s simple, fast, and predictable.</p>
</div>
<div class="paragraph">
<p>Mill has built in support for the <a href="https://www.scala-lang.org/">Scala</a>
programming language, and can serve as a replacement for
<a href="http://www.scala-sbt.org/">SBT</a>, but can also be
<a href="Extending_Mill.html" class="xref page">extended</a> to support any other language or platform via modules (written in Java or Scala) or through external subprocesses.</p>
</div>
<div class="paragraph">
<p>If you are using Mill, you will probably find the following book by the Author useful in using Mill to the fullest:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://handsonscala.com/" class="bare">https://handsonscala.com/</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a>Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_os_x"><a class="anchor" href="#_os_x"></a>OS X</h3>
<div class="paragraph">
<p>Installation via <a href="https://github.com/Homebrew/homebrew-core/blob/master/Formula/mill.rb">homebrew</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">brew install mill</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arch_linux"><a class="anchor" href="#_arch_linux"></a>Arch Linux</h3>
<div class="paragraph">
<p>Arch Linux has a <a href="https://www.archlinux.org/packages/community/any/mill/">Community package for mill</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pacman -S mill</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_freebsd"><a class="anchor" href="#_freebsd"></a>FreeBSD</h3>
<div class="paragraph">
<p>Installation via <a href="http://man.freebsd.org/pkg/8">pkg(8)</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">pkg install mill</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_windows"><a class="anchor" href="#_windows"></a>Windows</h3>
<div class="paragraph">
<p>To get started, download Mill from:
<a href="https://github.com/com-lihaoyi/mill/releases/download/0.9.12/0.9.12-assembly" class="bare">https://github.com/com-lihaoyi/mill/releases/download/0.9.12/0.9.12-assembly</a>, and save it as <code>mill.bat</code>.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re using <a href="https://scoop.sh">Scoop</a> you can install Mill via</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">scoop install mill</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill also works on a sh environment on Windows (e.g.,
<a href="https://www.msys2.org">MSYS2</a>,
<a href="https://www.cygwin.com">Cygwin</a>,
<a href="https://gitforwindows.org">Git-Bash</a>,
<a href="https://docs.microsoft.com/en-us/windows/wsl">WSL</a>; to get started, follow the instructions in the <a href="#_manual">Manual</a>
section below. Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In some environments (such as WSL), mill might have to be run without a server (using <code>-i</code>, <code>--interactive</code>
, <code>--no-server</code>, or
<code>--repl</code>.)</p>
</li>
<li>
<p>On Cygwin, run the following after downloading mill:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '0,/-cp "\$0"/{s/-cp "\$0"/-cp `cygpath -w "\$0"`/}; 0,/-cp "\$0"/{s/-cp "\$0"/-cp `cygpath -w "\$0"`/}' /usr/local/bin/mill</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docker"><a class="anchor" href="#_docker"></a>Docker</h3>
<div class="paragraph">
<p>You can download and run
a <a href="https://hub.docker.com/r/nightscape/scala-mill/">"Docker image containing OpenJDK, Scala and Mill"</a> using</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker pull nightscape/scala-mill
docker run -it nightscape/scala-mill</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manual"><a class="anchor" href="#_manual"></a>Manual</h3>
<div class="paragraph">
<p>To get started, download Mill and install it into your system via the following
<code>curl</code>/<code>chmod</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo sh -c "curl -L https://github.com/com-lihaoyi/mill/releases/download/0.9.12/0.9.12 &gt; /usr/local/bin/mill &amp;&amp; chmod +x /usr/local/bin/mill"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bootstrap_scripts_linuxos_x_only"><a class="anchor" href="#_bootstrap_scripts_linuxos_x_only"></a>Bootstrap Scripts (Linux/OS-X Only)</h3>
<div class="paragraph">
<p>If you are using Mill in a codebase, you can commit the bootstrap launcher as a
<code>./mill</code> script in the project folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -L https://github.com/com-lihaoyi/mill/releases/download/0.9.12/0.9.12 &gt; mill &amp;&amp; chmod +x mill</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, anyone who wants to work with the project can simply use the <code>./mill</code>
script directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mill version
./mill __.compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mill</code> command will automatically use the version specified by the bootstrap script, even if you installed it via
other means. The <code>./mill</code> file has a version number embedded within it, which you can update simply by editing the
script. Note this only works for versions 0.5.0 and above.</p>
</div>
<div class="paragraph">
<p>Bootstrap scripts are also useful for running Mill in CI, ensuring that your Jenkins/Travis/etc. box has the correct
version of Mill present to build/compile/test your code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_millw"><a class="anchor" href="#_millw"></a>millw</h3>
<div class="paragraph">
<p>Instead of installing mill directly, you can also use <a href="https://github.com/lefou/millw">lefou/millw</a> as drop-in
replacement for mill. It provides a small shell script and also a Windows batch file, that transparently downloads mill
and executes it on your behalf. It respects various ways to configure the preferred mill version (<code>MILL_VERSION</code> env
var, <code>.mill-version</code> file, <code>--mill-version</code> option) and can also be used as bootstrap script in your project.</p>
</div>
</div>
<div class="sect2">
<h3 id="_coursier_unsupported"><a class="anchor" href="#_coursier_unsupported"></a>Coursier (unsupported)</h3>
<div class="paragraph">
<p>Installing mill via <code>coursier</code> or <code>cs</code> is currently not officially supported. There are various issues, especially with
interactive mode.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_updating_mill"><a class="anchor" href="#_updating_mill"></a>Updating Mill</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once installed mill is able to use newer or different versions for each project automatically. You don&#8217;t need to install
multiple versions of mill yourself.</p>
</div>
<div class="paragraph">
<p>See section <a href="#_overriding_mill_versions">Overriding Mill Versions</a> how to do it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest Mill build for a Java project looks as follows:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

object foo extends JavaModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The simplest Mill build for a Scala project looks as follows:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

object foo extends ScalaModule {
  def scalaVersion = "2.13.1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of these would build a project laid out as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>build.sc
foo/
    src/
        FileA.java
        FileB.scala
    resources/
        ...
out/
    foo/
        ...</pre>
</div>
</div>
<div class="paragraph">
<p>You can download an example project with this layout here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/com-lihaoyi/mill/releases/download/0.9.12/0.9.12-example-1.zip">Example 1</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The source code for this module would live in the <code>foo/src/</code> folder, matching the name you assigned to the module.
Output for this module (compiled files, resolved dependency lists, ...) would live in <code>out/foo/</code>.</p>
</div>
<div class="paragraph">
<p>This can be run from the Bash shell via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill foo.compile                 # compile sources into classfiles

$ mill foo.run                     # run the main method, if any

$ mill foo.runBackground           # run the main method in the background

$ mill foo.launcher                # prepares a foo/launcher/dest/run you can run later

$ mill foo.jar                     # bundle the classfiles into a jar

$ mill foo.assembly                # bundle classfiles and all dependencies into a jar

$ mill -i foo.console              # start a Scala console within your project (in interactive mode: "-i")

$ mill -i foo.repl                 # start an Ammonite REPL within your project (in interactive mode: "-i")</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run <code>mill resolve <em>_</code> to see a full list of the different tasks that are available, <code>mill resolve foo.</em></code> to see
the tasks within <code>foo</code>, <code>mill inspect foo.compile</code> to inspect a task&#8217;s doc-comment documentation or what it depends on,
or <code>mill show foo.scalaVersion</code> to show the output of any task.</p>
</div>
<div class="paragraph">
<p>The most common <strong>tasks</strong> that Mill can run are cached <strong>targets</strong>, such as
<code>compile</code>, and un-cached <strong>commands</strong> such as <code>foo.run</code>. Targets do not re-evaluate unless one of their inputs changes,
where-as commands re-run every time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_output"><a class="anchor" href="#_output"></a>Output</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill puts all its output in the top-level <code>out/</code> folder. The above commands would end up in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">out/
    foo/
        compile/
        run/
        runBackground/
        launcher/
        jar/
        assembly/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the output folder for each task, there&#8217;s a <code>meta.json</code> file containing the metadata returned by that task, and
a <code>dest/</code> folder containing any files that the task generates. For example, <code>out/foo/compile/dest/</code> contains the
compiled classfiles, while <code>out/foo/assembly/dest/</code> contains the self-contained assembly with the project&#8217;s classfiles
jar-ed up with all its dependencies.</p>
</div>
<div class="paragraph">
<p>Given a task <code>foo.bar</code>, all its output and results can be found be within its respective <code>out/foo/bar/</code> folder.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_modules"><a class="anchor" href="#_multiple_modules"></a>Multiple Modules</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_java_example"><a class="anchor" href="#_java_example"></a>Java Example</h3>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

object foo extends JavaModule

object bar extends JavaModule {
  def moduleDeps = Seq(foo)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scala_example"><a class="anchor" href="#_scala_example"></a>Scala Example</h3>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

object foo extends ScalaModule {
  def scalaVersion = "2.13.1"
}

object bar extends ScalaModule {
  def moduleDeps = Seq(foo)

  def scalaVersion = "2.13.1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define multiple modules the same way you define a single module, using
<code>def moduleDeps</code> to define the relationship between them. The above builds expects the following project layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>build.sc
foo/
    src/
        Main.scala
    resources/
        ...
bar/
    src/
        Main2.scala
    resources/
        ...
out/
    foo/
        ...
    bar/
        ...</pre>
</div>
</div>
<div class="paragraph">
<p>And can be built/run using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill foo.compile
$ mill bar.compile

$ mill foo.run
$ mill bar.run

$ mill foo.jar
$ mill bar.jar

$ mill foo.assembly
$ mill bar.assembly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill&#8217;s evaluator will ensure that the modules are compiled in the right order, and re-compiled as necessary when source
code in each module changes.</p>
</div>
<div class="paragraph">
<p>Modules can also be nested:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

object foo extends ScalaModule {
  def scalaVersion = "2.13.1"

  object bar extends ScalaModule {
    def moduleDeps = Seq(foo)

    def scalaVersion = "2.13.1"
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which would result in a similarly nested project layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>build.sc
foo/
    src/
        Main.scala
    resources/
        ...
    bar/
        src/
            Main2.scala
        resources/
            ...
out/
    foo/
        ...
        bar/
            ...</pre>
</div>
</div>
<div class="paragraph">
<p>Where the nested modules can be run via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill foo.compile
$ mill foo.bar.compile

$ mill foo.run
$ mill foo.bar.run

$ mill foo.jar
$ mill foo.bar.jar

$ mill foo.assembly
$ mill foo.bar.assembly</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_watch_and_re_evaluate"><a class="anchor" href="#_watch_and_re_evaluate"></a>Watch and Re-evaluate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the <code>--watch</code> flag to make Mill watch a task&#8217;s inputs, re-evaluating the task as necessary when the inputs
change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill --watch foo.compile
$ mill --watch foo.run
$ mill -w foo.compile
$ mill -w foo.run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill&#8217;s <code>--watch</code> flag watches both the files you are building using Mill, as well as Mill&#8217;s own <code>build.sc</code> file and
anything it imports, so any changes to your <code>build.sc</code> will automatically get picked up.</p>
</div>
<div class="paragraph">
<p>For long-running processes like web-servers, you can use <code>.runBackground</code> to make sure they re-compile and re-start when
code changes, forcefully terminating the previous process even though it may be still alive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill -w foo.compile
$ mill -w foo.runBackground</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_parallel_task_execution_experimental"><a class="anchor" href="#_parallel_task_execution_experimental"></a>Parallel Task Execution (Experimental)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, mill will evaluate all tasks in sequence. But mill also has support to process tasks in parallel. This
feature is currently experimental and we encourage you to report any issues you find on our bug tracker.</p>
</div>
<div class="paragraph">
<p>To enable parallel task execution, use the <code>--jobs</code> (<code>-j</code>) option followed by a number of maximal parallel threads.</p>
</div>
<div class="paragraph">
<p>Example: Use up to 4 parallel thread to compile all modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill -j 4 __.compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use as much threads as your machine has (logical) processor cores use <code>--jobs 0</code>. To disable parallel execution
use <code>--jobs 1</code>. This is currently the default.</p>
</div>
<div class="paragraph">
<p>Please note that the maximal possible parallelism depends on your project. Tasks that depend on each other can&#8217;t be
processes in parallel.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_line_usage"><a class="anchor" href="#_command_line_usage"></a>Command-line usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill is a command-line tool and supports various options.</p>
</div>
<div class="paragraph">
<p>Run <code>mill --help</code> for a complete list of options</p>
</div>
<div class="listingblock">
<div class="title">Output of <code>mill --help</code></div>
<div class="content">
<pre>Mill Build Tool
usage: mill [options] [[target [target-options]] [+ [target ...]]]
  --no-default-predef  Disable the default predef and run Ammonite with the minimal predef possible
  -s --silent          Make ivy logs go silent instead of printing though failures will still throw
                       exception
  -w --watch           Watch and re-run your scripts when they change
  --bsp                Run a BSP server against the passed scripts
  -c --code &lt;str&gt;      Pass in code to be run immediately in the REPL
  -h --home &lt;path&gt;     The home directory of the REPL; where it looks for config and caches
  -p --predef &lt;path&gt;   Lets you load your predef from a custom location, rather than the "default
                       location in your Ammonite home
  --color &lt;bool&gt;       Enable or disable colored output; by default colors are enabled in both REPL
                       and scripts if the console is interactive, and disabled otherwise
  --thin               Hide parts of the core of Ammonite and some of its dependencies. By default,
                       the core of Ammonite and all of its dependencies can be seen by users from
                       the Ammonite session. This option mitigates that via class loader isolation.
  --help               Print this message
  -h --home &lt;path&gt;     The home directory of the REPL; where it looks for config and caches
  --repl               Run Mill in interactive mode and start a build REPL. In this mode, no mill
                       server will be used. Must be the first argument.
  --no-server          Run Mill in interactive mode, suitable for opening REPLs and taking user
                       input. In this mode, no mill server will be used. Must be the first argument.
  -i --interactive     Run Mill in interactive mode, suitable for opening REPLs and taking user
                       input. In this mode, no mill server will be used. Must be the first argument.
  -v --version         Show mill version and exit.
  -b --bell            Ring the bell once if the run completes successfully, twice if it fails.
  --disable-ticker     Disable ticker log (e.g. short-lived prints of stages and progress bars)
  -d --debug           Show debug output on STDOUT
  -k --keep-going      Continue build, even after build failures
  -D --define &lt;k=v&gt;    Define (or overwrite) a system property
  -j --jobs &lt;int&gt;      Allow processing N targets in parallel. Use 1 to disable parallel and 0 to
                       use as much threads as available processors.
  rest &lt;str&gt;...        The name of the targets you want to build, followed by any parameters you
                       wish to pass to those targets.</pre>
</div>
</div>
<div class="paragraph">
<p>All <em>options</em> must be given before the first target.</p>
</div>
<div class="paragraph">
<p>A <em>target</em> is a fully qualified task or command optionally followed by target specific arguments.
You can use wildcards and brace-expansion to select multiple targets at once or to shorten the path to deeply nested targets.
If you provide optional target arguments and your wildcard or brace-expansion is resolved to multiple targets, the arguments will be applied to each of the targets.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Wildcards and brace-expansion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wildcard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches a single segment of the target path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>__</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches arbitrary segments of the target path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{a,b}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is equal to specifying two targets <code>a</code> and <code>b</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can use the <code>` symbol to add another target with optional arguments.
If you need to feed a `</code> as argument to your target, you can mask it by preceding it with a backslash (<code>\</code>).</p>
</div>
<div class="sect2">
<h3 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>mill foo._.compile</code></dt>
<dd>
<p>Runs <code>compile</code> for all direct sub-modules of <code>foo</code></p>
</dd>
<dt class="hdlist1"><code>mill foo.__.test</code> </dt>
<dd>
<p>Runs <code>test</code> for all sub-modules of <code>foo</code></p>
</dd>
<dt class="hdlist1"><code>mill {foo,bar}.__.testCached</code> </dt>
<dd>
<p>Runs <code>testCached</code> for all sub-modules of <code>foo</code> and <code>bar</code></p>
</dd>
<dt class="hdlist1"><code>mill __.compile + foo.__.test</code> </dt>
<dd>
<p>Runs all <code>compile</code></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_line_tools"><a class="anchor" href="#_command_line_tools"></a>Command-line Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill comes with a few useful command-line utilities built into it:</p>
</div>
<div class="sect2">
<h3 id="_resolve"><a class="anchor" href="#_resolve"></a>resolve</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill resolve _
[1/1] resolve
all
clean
foo
inspect
par
path
plan
resolve
show
shutdown
version
visualize
visualizePlan

$ mill resolve _.compile
[1/1] resolve
foo.compile

$ mill resolve foo._
[1/1] resolve
foo.allSourceFiles
foo.allSources
foo.ammoniteReplClasspath
foo.ammoniteVersion
foo.artifactId
foo.artifactName
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>resolve</code> lists the tasks that match a particular query, without running them. This is useful for "dry running"
an <code>mill all</code> command to see what would be run before you run them, or to explore what modules or tasks are available
from the command line using <code>resolve <em></code>, <code>resolve foo.</em></code>, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill resolve foo.{compile,run}
mill resolve "foo.{compile,run}"
mill resolve foo.compile foo.run
mill resolve _.compile          # list the compile tasks for every top-level module
mill resolve __.compile         # list the compile tasks for every module
mill resolve _                  # list every top level module and task
mill resolve foo._              # list every task directly within the foo module
mill resolve __                 # list every module and task recursively</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inspect"><a class="anchor" href="#_inspect"></a>inspect</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill inspect foo.run
[1/1] inspect
foo.run(JavaModule.scala:442)
    Runs this module's code in a subprocess and waits for it to finish

Inputs:
    foo.finalMainClass
    foo.runClasspath
    foo.forkArgs
    foo.forkEnv
    foo.forkWorkingDir</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>inspect</code> is a more verbose version of <a href="#_resolve">resolve</a>. In addition to printing out the name of one-or-more tasks,
it also displays its source location and a list of input tasks. This is very useful for debugging and interactively
exploring the structure of your build from the command line.</p>
</div>
<div class="paragraph">
<p><code>inspect</code> also works with the same <code><em></code>/<code>_</em></code> wildcard/query syntaxes that
<a href="#_all">[_all]</a>/<a href="#_resolve">resolve</a> do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill inspect foo.compile
mill inspect foo.{compile,run}
mill inspect "foo.{compile,run}"
mill inspect foo.compile foo.run
mill inspect _.compile
mill inspect __.compile
mill inspect _
mill inspect foo._
mill inspect __</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_show"><a class="anchor" href="#_show"></a>show</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill show foo.scalaVersion
[1/1] show
"2.13.1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, Mill does not print out the metadata from evaluating a task. Most people would not be interested in e.g.
viewing the metadata related to incremental compilation: they just want to compile their code! However, if you want to
inspect the build to debug problems, you can make Mill show you the metadata output for a task using the <code>show</code> command:</p>
</div>
<div class="paragraph">
<p>All tasks return values that can be <code>show</code>n, not just configuration values. e.g.
<code>compile</code> returns that path to the <code>classes</code> and <code>analysisFile</code> that are produced by the compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill show foo.compile
[1/1] show
[10/25] foo.resources
{
    "analysisFile": "/Users/lihaoyi/Dropbox/Github/test//out/foo/compile/dest/zinc",
    "classes": "ref:07960649:/Users/lihaoyi/Dropbox/Github/test//out/foo/compile/dest/classes"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>show</code> is generally useful as a debugging tool, to see what is going on in your build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill show foo.sources
[1/1] show
[1/1] foo.sources
[
    "ref:8befb7a8:/Users/lihaoyi/Dropbox/Github/test/foo/src"
]

$ mill show foo.compileClasspath
[1/1] show
[2/11] foo.resources
[
    "ref:c984eca8:/Users/lihaoyi/Dropbox/Github/test/foo/resources",
    ".../org/scala-lang/scala-library/2.13.1/scala-library-2.13.1.jar"
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>show</code> is also useful for interacting with Mill from external tools, since the JSON it outputs is structured and easily
parsed &amp; manipulated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_path"><a class="anchor" href="#_path"></a>path</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill path foo.assembly foo.sources
[1/1] path
foo.sources
foo.allSources
foo.allSourceFiles
foo.compile
foo.localClasspath
foo.assembly</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mill path</code> prints out a dependency chain between the first task and the second. It is very useful for exploring the
build graph and trying to figure out how data gets from one task to another. If there are multiple possible dependency
chains, one of them is picked arbitrarily.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plan"><a class="anchor" href="#_plan"></a>plan</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill plan foo.compileClasspath
[1/1] plan
foo.transitiveLocalClasspath
foo.resources
foo.unmanagedClasspath
foo.scalaVersion
foo.platformSuffix
foo.compileIvyDeps
foo.scalaOrganization
foo.scalaLibraryIvyDeps
foo.ivyDeps
foo.transitiveIvyDeps
foo.compileClasspath</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mill plan foo</code> prints out what tasks would be evaluated, in what order, if you ran <code>mill foo</code>, but without actually
running them. This is a useful tool for debugging your build: e.g. if you suspect a task <code>foo</code> is running things that it
shouldn&#8217;t be running, a quick <code>mill plan</code> will list out all the upstream tasks that <code>foo</code> needs to run, and you can then
follow up with <code>mill path</code> on any individual upstream task to see exactly how <code>foo</code> depends on it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_visualize"><a class="anchor" href="#_visualize"></a>visualize</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill show visualize foo._
[1/1] show
[3/3] visualize
[
    ".../out/visualize/dest/out.txt",
    ".../out/visualize/dest/out.dot",
    ".../out/visualize/dest/out.json",
    ".../out/visualize/dest/out.png",
    ".../out/visualize/dest/out.svg"
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mill show visualize</code> takes a subset of the Mill build graph (e.g. <code>core._</code> is every task directly under the <code>core</code>
module) and draws out their relationships in <code>.svg</code> and <code>.png</code> form for you to inspect. It also generates <code>.txt</code>, <code>.dot</code>
and <code>.json</code> for easy processing by downstream tools.</p>
</div>
<div class="paragraph">
<p>The above command generates the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/VisualizeFoo.svg" alt="VisualizeFoo.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_visualizeplan"><a class="anchor" href="#_visualizeplan"></a>visualizePlan</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill show visualizePlan foo.compile
[1/1] show
[3/3] visualizePlan
[
    ".../out/visualizePlan/dest/out.txt",
    ".../out/visualizePlan/dest/out.dot",
    ".../out/visualizePlan/dest/out.json",
    ".../out/visualizePlan/dest/out.png",
    ".../out/visualizePlan/dest/out.svg"
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mill show visualizePlan</code> is similar to <code>mill show visualize</code> except that it shows a graph of the entire build plan,
including tasks not directly resolved by the query. Tasks directly resolved are shown with a solid border, and
dependencies are shown with a dotted border.</p>
</div>
<div class="paragraph">
<p>The above command generates the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/VisualizePlan.svg" alt="VisualizePlan.svg">
</div>
</div>
<div class="paragraph">
<p>Another use case is to view the relationships between modules. For the following two modules:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

object foo extends ScalaModule {
  def scalaVersion = "2.13.1"
}

object bar extends ScalaModule {
  def moduleDeps = Seq(foo)

  def scalaVersion = "2.13.1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mill show visualizePlan _.compile</code> diagrams the relationships between the compile tasks of each module, which
illustrates which module depends on which other module&#8217;s compilation output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/VisualizeCompile.svg" alt="VisualizeCompile.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clean"><a class="anchor" href="#_clean"></a>clean</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill clean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>clean</code> deletes all the cached outputs of previously executed tasks. It can apply to the entire project, entire modules,
or specific tasks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill clean                     # clean all outputs
mill clean foo                 # clean all outputs for module 'foo' (including nested modules)
mill clean foo.compile         # only clean outputs for task 'compile' in module 'foo'
mill clean foo.{compile,run}
mill clean "foo.{compile,run}"
mill clean foo.compile foo.run
mill clean _.compile
mill clean __.compile</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_search_for_dependency_updates"><a class="anchor" href="#_search_for_dependency_updates"></a>Search for dependency updates</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill mill.scalalib.Dependency/showUpdates</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill can search for updated versions of your project&#8217;s dependencies, if available from your project&#8217;s configured
repositories. Note that it uses heuristics based on common versionning schemes, so it may not work as expected for
dependencies with particularly weird version numbers.</p>
</div>
<div class="paragraph">
<p>Current limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only works for <code>JavaModule</code>s (including <code>ScalaModule</code>s,
<code>CrossScalaModule</code>s, etc.) and Maven repositories.</p>
</li>
<li>
<p>Always applies to all modules in the build.</p>
</li>
<li>
<p>Doesn&#8217;t apply to <code>$ivy</code> dependencies used in the build definition itself.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill mill.scalalib.Dependency/showUpdates
mill mill.scalalib.Dependency/showUpdates --allowPreRelease true # also show pre-release versions</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ide_support"><a class="anchor" href="#_ide_support"></a>IDE Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill supports any IDE that is compatible with <a href="https://build-server-protocol.github.io/">BSP</a>, such as IntelliJ.<br>
Use <code>mill mill.bsp.BSP/install</code> to generate the BSP project config for your build.</p>
</div>
<div class="paragraph">
<p>It also enables Intellij to provide navigation &amp; code-completion features within your build file itself.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_intellij_support_legacy"><a class="anchor" href="#_intellij_support_legacy"></a>IntelliJ Support (legacy)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill supports IntelliJ configuration generation. Use <code>mill mill.scalalib.GenIdea/idea</code> to generate an IntelliJ project
config for your build.</p>
</div>
<div class="paragraph">
<p>This also configures IntelliJ to allow easy navigate &amp; code-completion within your build file itself.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_build_repl"><a class="anchor" href="#_the_build_repl"></a>The Build REPL</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">$ mill --repl
Loading...
@ foo
res0: foo.type = ammonite.predef.build#foo:4
Commands:
    .ideaJavaModuleFacets(ideaConfigVersion: Int)()
    .ideaConfigFiles(ideaConfigVersion: Int)()
    .ivyDepsTree(inverse: Boolean, withCompile: Boolean, withRuntime: Boolean)()
    .runLocal(args: String*)()
    .run(args: String*)()
    .runBackground(args: String*)()
    .runMainBackground(mainClass: String, args: String*)()
    .runMainLocal(mainClass: String, args: String*)()
    .runMain(mainClass: String, args: String*)()
    .console()()
    .repl(replOptions: String*)()
Targets:
...

@ foo.compile
res1: mill.package.T[mill.scalalib.api.CompilationResult] = foo.compile(ScalaModule.scala:143)
    Compiles the current module to generate compiled classfiles/bytecode

Inputs:
    foo.upstreamCompileOutput
    foo.allSourceFiles
    foo.compileClasspath
...

@ foo.compile()
[25/25] foo.compile
res2: mill.scalalib.api.CompilationResult = CompilationResult(
  /Users/lihaoyi/Dropbox/Github/test/out/foo/compile/dest/zinc,
  PathRef(/Users/lihaoyi/Dropbox/Github/test/out/foo/compile/dest/classes, false, -61934706)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run <code>mill --repl</code> to open a build REPL; this is a Scala console with your <code>build.sc</code> loaded, which lets you run
tasks interactively. The task-running syntax is slightly different from the command-line, but more in-line with how you
would depend on tasks from within your build file.</p>
</div>
<div class="paragraph">
<p>You can use this REPL to interactively explore your build to see what is available.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying_your_code"><a class="anchor" href="#_deploying_your_code"></a>Deploying your code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The two most common things to do once your code is complete is to make an assembly (e.g. for deployment/installation) or
publishing (e.g. to Maven Central). Mill comes with both capabilities built in.</p>
</div>
<div class="paragraph">
<p>Mill comes built-in with the ability to make assemblies. Given a simple Mill build:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._

object foo extends ScalaModule {
  def scalaVersion = "2.13.1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can make a self-contained assembly via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill foo.assembly

$ ls -lh out/foo/assembly/dest/out.jar
-rw-r--r--  1 lihaoyi  staff   5.0M Feb 17 11:14 out/foo/assembly/dest/out.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then move the <code>out.jar</code> file anywhere you would like, and run it standalone using <code>java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -cp out/foo/assembly/dest/out.jar foo.Example
Hello World!</code></pre>
</div>
</div>
<div class="paragraph">
<p>To publish to Maven Central, you need to make <code>foo</code> also extend Mill&#8217;s
<code>PublishModule</code> trait:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.sc</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, scalalib._, publish._

object foo extends ScalaModule with PublishModule {
  def scalaVersion = "2.13.1"

  def publishVersion = "0.0.1"

  def pomSettings = PomSettings(
    description = "Hello",
    organization = "com.lihaoyi",
    url = "https://github.com/lihaoyi/example",
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github("lihaoyi", "example"),
    developers = Seq(
      Developer("lihaoyi", "Li Haoyi", "https://github.com/lihaoyi")
    )
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can change the name of the published artifact (artifactId in the Maven POM)
by overriding <code>artifactName</code> in the module you want to publish.</p>
</div>
<div class="paragraph">
<p>You can download an example project with this layout here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/com-lihaoyi/mill/releases/download/0.9.12/0.9.12-example-2.zip">Example 2</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which you can then publish using the <code>mill foo.publish</code> command, which takes your sonatype credentials (
e.g. <code>lihaoyi:foobarbaz</code>) and GPG password as inputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mill foo.publish
Missing arguments: (--sonatypeCreds: String, --release: Boolean)

Arguments provided did not match expected signature:

publish
  --sonatypeCreds   String (format: "username:password")
  --signed          Boolean (default true)
  --gpgArgs         Seq[String] (default Seq("--batch", "--yes", "-a", "-b"))
  --readTimeout     Int (default 60000)
  --release         Boolean (default true)
  --connectTimeout  Int (default 5000)
  --awaitTimeout    Int (default 120000)
  --stagingRelease  Boolean (default true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You also need to specify <code>release</code> as <code>true</code> or <code>false</code>, depending on whether you just want to stage your module
on <code>oss.sonatype.org</code> or you want Mill to complete the release process to Maven Central.</p>
</div>
<div class="paragraph">
<p>If you are publishing multiple artifacts, you can also use <code>mill mill.scalalib.PublishModule/publishAll</code> as described
<a href="https://com-lihaoyi.github.io/mill/page/common-project-layouts.html#publishing">here</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_structure_of_the_out_folder"><a class="anchor" href="#_structure_of_the_out_folder"></a>Structure of the <code>out/</code> folder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>out/</code> folder contains all the generated files &amp; metadata for your build. It is structured with one folder
per <code>Target</code>/<code>Command</code>, that is run, e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>out/core/compile/</code></p>
</li>
<li>
<p><code>out/main/test/compile/</code></p>
</li>
<li>
<p><code>out/main/test/forkTest/</code></p>
</li>
<li>
<p><code>out/scalalib/compile/</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are also top-level build-related files in the <code>out/</code> folder, prefixed as
<code>mill-*</code>. The most useful is <code>mill-profile.json</code>, which logs the tasks run and time taken for the last Mill command you
executed. This is very useful if you want to find out exactly what tasks are being run and Mill is being slow.</p>
</div>
<div class="paragraph">
<p>Each folder currently contains the following files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dest/</code>: a path for the <code>Task</code> to use either as a scratch space, or to place generated files that are returned
using <code>PathRef</code>s. <code>Task</code>s should only output files within their given <code>dest/</code> folder (available as <code>T.dest</code>) to avoid
conflicting with other <code>Task</code>s, but files within <code>dest/</code> can be named arbitrarily.</p>
</li>
<li>
<p><code>log</code>: the <code>stdout</code>/<code>stderr</code> of the <code>Task</code>. This is also streamed to the console during evaluation.</p>
</li>
<li>
<p><code>meta.json</code>: the cache-key and JSON-serialized return-value of the
<code>Target</code>/<code>Command</code>. The return-value can also be retrieved via <code>mill show foo.compile</code>. Binary blobs are typically not
included in <code>meta.json</code>, and instead stored as separate binary files in <code>dest/</code> which are then referenced
by <code>meta.json</code> via <code>PathRef</code>s</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>out/</code> folder is intentionally kept simplistic and user-readable. If your build is not behaving as you would expect,
feel free to poke around the various
<code>dest/</code> folders to see what files are being created, or the <code>meta.json</code> files to see what is being returned by a
particular task. You can also simply delete folders within <code>out/</code> if you want to force portions of your project to be
re-built, e.g. deleting the <code>out/main/</code> or <code>out/main/test/compile/</code> folders.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overriding_mill_versions"><a class="anchor" href="#_overriding_mill_versions"></a>Overriding Mill Versions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apart from downloading and installing new versions of Mill globally, there are a few ways of selecting/updating your
Mill version:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a <code>.mill-version</code> file to specify the version of Mill you wish to use:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>echo "0.5.0" &gt; .mill-version</pre>
</div>
</div>
<div class="paragraph">
<p><code>.mill-version</code> takes precedence over the version of Mill specified in the
<code>./mill</code> script.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass in a <code>MILL_VERSION</code> environment variable, e.g.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>MILL_VERSION=0.5.0-3-4faefb mill __.compile</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">MILL_VERSION=0.5.0-3-4faefb ./mill __.compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>to override the Mill version manually. This takes precedence over the version specified in <code>./mill</code> or <code>.mill-version</code></p>
</div>
<div class="paragraph">
<p>Note that both of these overrides only work for versions 0.5.0 and above.</p>
</div>
<div class="sect2">
<h3 id="_development_releases"><a class="anchor" href="#_development_releases"></a>Development Releases</h3>
<div class="paragraph">
<p>In case you want to try out the latest features and improvements that are currently in the main branch, unstable versions of Mill
are
<a href="https://github.com/com-lihaoyi/mill/releases">available</a> as binaries named
<code>#.#.#-n-hash</code> linked to the latest tag. Installing the latest unstable release is recommended for bootstrapping mill.</p>
</div>
<div class="paragraph">
<p>The easiest way to use a development release is by updating the <a href="#_bootstrap_scripts_linuxos_x_only">Bootstrap Scripts (Linux/OS-X Only)</a>,
or
<a href="#_overriding_mill_versions">Overriding Mill Versions</a> via an environment variable or <code>.mill-version</code> file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_mill_with_custom_jvm_options"><a class="anchor" href="#_running_mill_with_custom_jvm_options"></a>Running Mill with custom JVM options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s possible to pass JVM options to the Mill launcher. To do this you need to create a <code>.mill-jvm-opts</code> file in your
project&#8217;s root. This file should contain JVM options (strings, starting with <code>-X</code>), one per line. All other lines will
be ignored.</p>
</div>
<div class="paragraph">
<p>For example, if your build requires a lot of memory and bigger stack size, your <code>.mill-jvm-opts</code> could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-Xss10m
-Xmx10G</pre>
</div>
</div>
<div class="paragraph">
<p>The file name for passing JVM options to the Mill launcher is configurable. If for some reason you don&#8217;t want to
use <code>.mill-jvm-opts</code> file name, add <code>MILL_JVM_OPTS_PATH</code> environment variable with any other file name.</p>
</div>
<hr>
<div class="paragraph">
<p>Come by our <a href="https://gitter.im/lihaoyi/mill">Gitter Channel</a> if you want to ask questions or say hi!</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Mill Documentation</a></span>
  <span class="next"><a href="Configuring_Mill.html">Configuring Mill</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
