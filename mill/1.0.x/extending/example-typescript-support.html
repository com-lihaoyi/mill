<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Example: Typescript Support :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/extending/example-typescript-support.html" />
    <link rel="prev" href="meta-build.html" />
    <link rel="next" href="example-python-support.html" />
    <meta name="generator" content="Antora 3.1.12" />
    <link rel="stylesheet" href="../../../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../../_/favicon.png" type="image/x-icon" />
  
  <style>
  /* auto-hyphenation is super ugly */
  *{
    hyphens: manual !important;
  }

  /* Reduce font size from 17px to something reasonable */
  .doc {
   font-size: 16px !important;
  }
  .doc pre {
   font-size: 14px !important;
  }
  /* Shrink unreasonably large top bar */
  nav.navbar{
    height: 2.5rem;
  }
  body.article{
    padding-top: 2.5rem;
  }
  div.nav-container{
    top: 2.5rem;
  }
  div.toolbar{
    top: 2.5rem;
  }
  aside.nav{
    top: 2.5rem;
    height: calc(100vh - 2.5rem);
  }
  </style></head><body class="article">
  
<header class="header">
  
  <script>
  gtag('config', 'AW-16649289906');

  document.addEventListener('DOMContentLoaded', function() {
  const links = document.querySelectorAll('a');
    links.forEach(link => {
      if (link.textContent.trim().toLowerCase() === 'download') {
        link.addEventListener('click', function(event) {
          console.log("download link clicked")
          gtag('event', 'conversion', {'send_to': 'AW-16649289906/rsphCKfVq8QZELKBgIM-'});
        });
      }
    });
  });
  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../../_/logo-white.svg" height="20" /> The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">GitHub</a>
        <a class="navbar-item" href="https://mill-build.org/blog/index.html">Blog</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/mill.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>


            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="1.0.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../javalib/intro.html">Building Java with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/module-config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/dependencies.html">Java Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javalib/testing.html">Testing Java Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/linting.html">Linting Java Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/publishing.html">Java Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/build-examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../javalib/web-examples.html">Java Web Project Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scalalib/intro.html">Building Scala with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/module-config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/dependencies.html">Scala Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalalib/testing.html">Testing Scala Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/linting.html">Linting Scala Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/publishing.html">Scala Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/build-examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/web-examples.html">Scala Web Project Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/native-examples.html">Scala Native Examples</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../scalalib/spark.html">Spark Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kotlinlib/intro.html">Building Kotlin with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/module-config.html">Kotlin Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/dependencies.html">Kotlin Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlinlib/testing.html">Testing Kotlin Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/linting.html">Linting Kotlin Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/publishing.html">Kotlin Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../kotlinlib/web-examples.html">Kotlin Web Project Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Experimental Platform Support</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Building Android Apps</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/android-initial-setup.html">Android Initial Setup</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/ide.html">Android IDE Support</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../android/java.html">Android Java Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/kotlin.html">Android Kotlin Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/android-linting.html">Linting Android Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/compose-samples.html">Android Jetpack Compose</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/hilt-sample.html">Android Hilt Sample</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../android/android-native-example.html">Android Native Example</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../pythonlib/intro.html">Building Python with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/module-config.html">Python Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/dependencies.html">Python Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../pythonlib/linting.html">Linting Python Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../pythonlib/testing.html">Testing Python Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../pythonlib/publishing.html">Python Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <span class="nav-text">xref:pythonlib/web-examples.adoc</span>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../javascriptlib/intro.html">Building Javascript with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/dependencies.html">Typescript Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/module-config.html">Typescript Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../javascriptlib/testing.html">Testing Typescript Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../javascriptlib/linting.html">Linting Typescript Projects</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../javascriptlib/publishing.html">Typescript Packaging &amp; Publishing</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../javascriptlib/build-examples.html">JavaScript Build Examples</a>
  </li>
</ul>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../comparisons/why-mill.html">Why Use Mill?</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/maven.html">Case Study: Mill vs Maven</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/gradle.html">Case Study: Mill vs Gradle</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../comparisons/sbt.html">Case Study: Mill vs <code>sbt</code></a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The Mill CLI</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/installation-ide.html">Installation &amp; IDE Setup</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/flags.html">Mill Command-Line Flags</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../cli/query-syntax.html">Task Query Syntax</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../cli/build-header.html">Build Header Config</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../migrating/migrating.html">Migrating to Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migrating/auto-migrating.html">Automated Migration Tools</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill Fundamentals</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fundamentals/out-dir.html">The Output Directory</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/library-deps.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/cross-builds.html">Cross Builds</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/bundled-libraries.html">Bundled Libraries</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../fundamentals/configuring-jvm-versions.html">Configuring JVM Versions</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extending Mill</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="import-mvn-plugins.html">Import Libraries and Plugins</a>
  </li>

  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="contrib-plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/sonatypecentral.html">Sonatype Central (Plugin Moved to Scalalib)</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="../contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="thirdparty-plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="running-jvm-code.html">Running Dynamic JVM Code</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="writing-plugins.html">Writing Mill Plugins</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="meta-build.html">The Mill Meta-Build</a>
  </li>

  <li class="nav-item is-current-page is-active" data-depth="2">
    <a class="nav-link" href="example-typescript-support.html">Example: Typescript Support</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="example-python-support.html">Example: Python Support</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../large/large.html">Large Builds and Monorepos</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../large/selective-execution.html">Selective Test Execution</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../large/multi-file-builds.html">Multi-File Builds</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../large/multi-language-builds.html">Multi-Language Builds</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/evaluation-model.html">The Mill Evaluation Model</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/caching.html">Caching in Mill</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../depth/parallelism.html">Parallelism in Mill</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/process-architecture.html">The Mill Process Architecture</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/sandboxing.html">Mill Sandboxing</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/design-principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="../depth/why-scala.html">Why does Mill use Scala?</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill.html">Mill API Reference</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/com-lihaoyi/mill/blob/main/changelog.adoc">Changelog</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/talks-blog-posts.html">Talks &amp; Blog Posts</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">1.0.6</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../../main-branch/index.html">main-branch</a>
        </li>
        <li class="version is-latest">
          <a href="../../index.html">1.1.0-RC1</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">1.0.6</a>
        </li>
        <li class="version">
          <a href="../../0.12.x/index.html">0.12.16</a>
        </li>
        <li class="version">
          <a href="../../0.11.x/index.html">0.11.13</a>
        </li>
        <li class="version">
          <a href="../../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../../0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../blog/index.html">The Mill Build Engineering Blog</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">

<div class="toolbar" role="navigation" style="position: fixed; top: 2.5rem; height: 2rem; left: 0px;">
<button class="nav-toggle"></button>
</div>
<div class="toolbar" style="position: fixed; top: 2.5rem; height: 1.5rem; right: 0px;">
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Example: Typescript Support</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section walks through the process of adding support for a new programming
language to Mill. We will be adding a small <code>trait TypeScriptModule</code> with the
ability to resolve dependencies, typecheck local code, and optimize a final
bundle.</p>
</div>
<div class="paragraph">
<p>The TypeScript integration here is not intended for production usage, but is
instead meant for illustration purposes of the techniques typically used in
implementing language toolchains.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_typescript_build_pipeline"><a class="anchor" href="#_basic_typescript_build_pipeline"></a>Basic TypeScript Build Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example demonstrates basic integration of <a href="https://www.typescriptlang.org/">Typescript</a>
compilation into a Mill build to compile <a href="https://nodejs.org/en">Node.js</a> apps. Mill
does not come bundled with a Typescript integration, so here we begin setting
one up from first principles using the <a href="https://www.npmjs.com/">NPM</a> command line
tool and package repository</p>
</div>
<div class="sect2">
<h3 id="_installing_typescript"><a class="anchor" href="#_installing_typescript"></a>Installing TypeScript</h3>
<div class="paragraph">
<p>First, we need to use the <code>npm</code> CLI tool to install typescript and the <code>@types/node</code>
library necessary for accessing Node.js APIs:</p>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.0.6/mill-dist-1.0.6-example-extending-typescript-1-hello-typescript.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/1-hello-typescript">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill.*

def npmInstall = Task {
  os.call((&quot;npm&quot;, &quot;install&quot;, &quot;--save-dev&quot;, &quot;typescript@5.6.3&quot;, &quot;@types/node@22.7.8&quot;))
  PathRef(Task.dest)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>npmInstall</code> task runs <code>npm install</code> to install TypeScript locally, following
the <a href="https://www.typescriptlang.org/download/">TypeScript installation instructions</a>.
The <code>os.call</code> above by default runs inside the <code>npmInstall</code> task’s unique <code>Task.dest</code>
output directory due to <a href="../depth/sandboxing.html" class="xref page">task sandboxing</a>. Note that we
use an explicit version on each of the modules to ensure the <code>Task</code> is reproducible.
We then return a <code>PathRef</code> to the <code>Task.dest</code> so downstream tasks can make use of it.</p>
</div>
<div class="paragraph">
<p>Note that as written, the <code>npmInstall</code> task will never invalidate unless you change its
code. This is what we should expect, since <code>npmInstall</code> has no upstream tasks it depends
on and the versions of <code>typescript</code> and <code>@types/node</code> are fully specified in the task.
This assumes that the <code>npm</code> package repository always returns the same artifacts for
the given name and version, which is a reasonable assumption for most package repositories.</p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_our_sources"><a class="anchor" href="#_defining_our_sources"></a>Defining our sources</h3>
<div class="paragraph">
<p>Next, we define the <code>sources</code> of our Typescript build using a
<a href="../fundamentals/tasks.html#_sources" class="xref page">source task</a>. Here <code>sources</code> refers to the
source folder, and the subsequent <code>allSources</code> walks that folder and picks up all
the individual typescript files within. This is a common pattern to give flexibility,
e.g. someone can later easily override <code>allSources</code> to add additional filtering
on exactly which files within the source root they wish to pick up.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def sources = Task.Source(&quot;src&quot;)
def allSources = Task {
  os.walk(sources().path).filter(_.ext == &quot;ts&quot;).map(PathRef(_))
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compilation"><a class="anchor" href="#_compilation"></a>Compilation</h3>
<div class="paragraph">
<p>Next, we define our <code>compile</code> task. This is again a relatively straightforward subprocess
call invoking the <code>typescript/bin/tsc</code> executable within the <code>node_modules</code> folder from the
upstream <code>npmInstall</code> task, passing it the sources, <code>--outDir</code>, <code>--types</code>, and <code>--typeRoots</code>
Again we return a <code>PathRef</code> to the <code>Task.dest</code> folder we output the compiled JS files to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def compile = Task {
  os.call(
    (
      npmInstall().path / &quot;node_modules/typescript/bin/tsc&quot;,
      allSources().map(_.path),
      &quot;--outDir&quot;,
      Task.dest,
      &quot;--typeRoots&quot;,
      npmInstall().path / &quot;node_modules/@types&quot;
    )
  )
  PathRef(Task.dest)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, we have a minimal working build, with a build graph that looks like this:</p>
</div>
<div class="paragraph">
<center>
<svg width="275px" height="76px" viewBox="0.00 0.00 274.96 75.80" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 71.8)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-71.8 270.96,-71.8 270.96,4 -4,4"></polygon>
<!-- npmInstall -->
<g id="node1" class="node">
<title>npmInstall</title>
<polygon fill="white" stroke="black" points="169.8,-67.7 94.04,-67.7 94.04,-43.1 169.8,-43.1 169.8,-67.7"></polygon>
<text text-anchor="middle" x="131.92" y="-51.2" font-family="Times,serif" font-size="14.00">npmInstall</text>
</g>
<!-- compile -->
<g id="node2" class="node">
<title>compile</title>
<polygon fill="white" stroke="black" points="267.01,-45.7 205.81,-45.7 205.81,-21.1 267.01,-21.1 267.01,-45.7"></polygon>
<text text-anchor="middle" x="236.41" y="-29.2" font-family="Times,serif" font-size="14.00">compile</text>
</g>
<!-- npmInstall&#45;&gt;compile -->
<g id="edge1" class="edge">
<title>npmInstall-&gt;compile</title>
<path fill="none" stroke="black" d="M169.92,-47.46C178.41,-45.64 187.47,-43.69 196.05,-41.85"></path>
<polygon fill="black" stroke="black" points="196.81,-45.27 205.85,-39.74 195.34,-38.42 196.81,-45.27"></polygon>
</g>
<!-- sources -->
<g id="node3" class="node">
<title>sources</title>
<polygon fill="white" stroke="black" points="57.97,-24.7 0.01,-24.7 0.01,-0.1 57.97,-0.1 57.97,-24.7"></polygon>
<text text-anchor="middle" x="28.99" y="-8.2" font-family="Times,serif" font-size="14.00">sources</text>
</g>
<!-- allSources -->
<g id="node4" class="node">
<title>allSources</title>
<polygon fill="white" stroke="black" points="169.23,-24.7 94.61,-24.7 94.61,-0.1 169.23,-0.1 169.23,-24.7"></polygon>
<text text-anchor="middle" x="131.92" y="-8.2" font-family="Times,serif" font-size="14.00">allSources</text>
</g>
<!-- sources&#45;&gt;allSources -->
<g id="edge2" class="edge">
<title>sources-&gt;allSources</title>
<path fill="none" stroke="black" d="M58.1,-12.4C66.33,-12.4 75.54,-12.4 84.58,-12.4"></path>
<polygon fill="black" stroke="black" points="84.64,-15.9 94.64,-12.4 84.64,-8.9 84.64,-15.9"></polygon>
</g>
<!-- allSources&#45;&gt;compile -->
<g id="edge3" class="edge">
<title>allSources-&gt;compile</title>
<path fill="none" stroke="black" d="M169.34,-19.86C177.95,-21.63 187.16,-23.51 195.89,-25.3"></path>
<polygon fill="black" stroke="black" points="195.35,-28.76 205.85,-27.34 196.76,-21.91 195.35,-28.76"></polygon>
</g>
</g>
</svg>

</center>
</div>
<div class="paragraph">
<p>Given an input file below, we can run
<code>mill compile</code> and demonstrate it is installing typescript locally and using it to compile
the <code>.ts</code> files in out <code>src/</code> folder:</p>
</div>
<div class="listingblock">
<div class="title">src/hello.ts (<a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/1-hello-typescript/src/hello.ts">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">interface User {
    firstName: string
    lastName: string
    role: string
}

const user: User = {
    firstName: process.argv[2],
    lastName: process.argv[3],
    role: &quot;Professor&quot;,
}

console.log(&quot;Hello &quot; + user.name + &quot; &quot; + user.lastName)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill compile
error: .../src/hello.ts(...): error ... Property 'name' does not exist on type...

&gt; sed -i.bak 's/user.name/user.firstName/g' src/hello.ts

&gt; ./mill compile

&gt; cat out/compile.dest/hello.js # Output is stripped of types and converted to javascript
var user = {
    firstName: process.argv[2],
    lastName: process.argv[3],
    role: &quot;Professor&quot;,
};
console.log(&quot;Hello &quot; + user.firstName + &quot; &quot; + user.lastName);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running"><a class="anchor" href="#_running"></a>Running</h3>
<div class="paragraph">
<p>The last step here is to allow the ability to run our compiled JavaScript file.
To do this, we need a <code>mainFileName</code> task to tell Mill which file should be used
as the program entrypoint, and a <code>run</code> command taking arguments that get used to
call <code>node</code> along with the main Javascript file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def mainFileName = Task { &quot;hello.js&quot; }
def run(args: mill.api.Args) = Task.Command {
  os.call(
    (&quot;node&quot;, compile().path / mainFileName(), args.value),
    stdout = os.Inherit
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we use <code>stdout = os.Inherit</code> since we want to display any output to
the user, rather than capturing it for use in our command.</p>
</div>
<div class="paragraph">
<center>
<svg width="384px" height="97px" viewBox="0.00 0.00 383.72 96.80" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 92.8)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-92.8 379.72,-92.8 379.72,4 -4,4"></polygon>
<!-- npmInstall -->
<g id="node1" class="node">
<title>npmInstall</title>
<polygon fill="white" stroke="black" points="169.8,-88.7 94.04,-88.7 94.04,-64.1 169.8,-64.1 169.8,-88.7"></polygon>
<text text-anchor="middle" x="131.92" y="-72.2" font-family="Times,serif" font-size="14.00">npmInstall</text>
</g>
<!-- compile -->
<g id="node2" class="node">
<title>compile</title>
<polygon fill="white" stroke="black" points="286.06,-67.7 224.86,-67.7 224.86,-43.1 286.06,-43.1 286.06,-67.7"></polygon>
<text text-anchor="middle" x="255.46" y="-51.2" font-family="Times,serif" font-size="14.00">compile</text>
</g>
<!-- npmInstall&#45;&gt;compile -->
<g id="edge1" class="edge">
<title>npmInstall-&gt;compile</title>
<path fill="none" stroke="black" d="M170.05,-69.99C184.2,-67.54 200.39,-64.74 214.77,-62.26"></path>
<polygon fill="black" stroke="black" points="215.62,-65.66 224.87,-60.51 214.42,-58.77 215.62,-65.66"></polygon>
</g>
<!-- run -->
<g id="node5" class="node">
<title>run</title>
<polygon fill="white" stroke="green" stroke-width="3" points="375.55,-45.7 341.23,-45.7 341.23,-21.1 375.55,-21.1 375.55,-45.7"></polygon>
<text text-anchor="middle" x="358.39" y="-29.2" font-family="Times,serif" font-size="14.00">run</text>
</g>
<!-- compile&#45;&gt;run -->
<g id="edge4" class="edge">
<title>compile-&gt;run</title>
<path fill="none" stroke="black" d="M286.2,-48.92C300.47,-45.81 317.42,-42.11 331.2,-39.11"></path>
<polygon fill="black" stroke="black" points="332,-42.52 341.02,-36.97 330.51,-35.68 332,-42.52"></polygon>
</g>
<!-- sources -->
<g id="node3" class="node">
<title>sources</title>
<polygon fill="white" stroke="black" points="57.97,-45.7 0.01,-45.7 0.01,-21.1 57.97,-21.1 57.97,-45.7"></polygon>
<text text-anchor="middle" x="28.99" y="-29.2" font-family="Times,serif" font-size="14.00">sources</text>
</g>
<!-- allSources -->
<g id="node4" class="node">
<title>allSources</title>
<polygon fill="white" stroke="black" points="169.23,-45.7 94.61,-45.7 94.61,-21.1 169.23,-21.1 169.23,-45.7"></polygon>
<text text-anchor="middle" x="131.92" y="-29.2" font-family="Times,serif" font-size="14.00">allSources</text>
</g>
<!-- sources&#45;&gt;allSources -->
<g id="edge2" class="edge">
<title>sources-&gt;allSources</title>
<path fill="none" stroke="black" d="M58.1,-33.4C66.33,-33.4 75.54,-33.4 84.58,-33.4"></path>
<polygon fill="black" stroke="black" points="84.64,-36.9 94.64,-33.4 84.64,-29.9 84.64,-36.9"></polygon>
</g>
<!-- allSources&#45;&gt;compile -->
<g id="edge3" class="edge">
<title>allSources-&gt;compile</title>
<path fill="none" stroke="black" d="M169.39,-40C183.57,-42.57 199.86,-45.52 214.37,-48.14"></path>
<polygon fill="black" stroke="black" points="214.1,-51.65 224.56,-49.99 215.34,-44.76 214.1,-51.65"></polygon>
</g>
<!-- mainFileName -->
<g id="node6" class="node">
<title>mainFileName</title>
<polygon fill="white" stroke="green" stroke-width="3" points="305.16,-24.7 205.76,-24.7 205.76,-0.1 305.16,-0.1 305.16,-24.7"></polygon>
<text text-anchor="middle" x="255.46" y="-8.2" font-family="Times,serif" font-size="14.00">mainFileName</text>
</g>
<!-- mainFileName&#45;&gt;run -->
<g id="edge5" class="edge">
<title>mainFileName-&gt;run</title>
<path fill="none" stroke="black" d="M305.15,-22.53C314.13,-24.4 323.17,-26.28 331.16,-27.94"></path>
<polygon fill="black" stroke="black" points="330.45,-31.37 340.95,-29.98 331.87,-24.52 330.45,-31.37"></polygon>
</g>
</g>
</svg>

</center>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill run James Bond
Hello James Bond</code></pre>
</div>
</div>
<div class="paragraph">
<p>So that’s a minimal example of implementing a single TypeScript to JavaScript build
pipeline locally. Next, we will look at turning it into a <code>TypeScriptModule</code> that
can be re-used</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_re_usable_typescriptmodule"><a class="anchor" href="#_re_usable_typescriptmodule"></a>Re-usable TypeScriptModule</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this example, we will explore how to take the one-off typescript build pipeline
we wrote above, and turn it into a re-usable <code>TypeScriptModule</code>.</p>
</div>
<div class="paragraph">
<p>To do this, we take all the code we wrote earlier and surround it with
<code>trait TypeScriptModule extends Module</code> wrapper:</p>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.0.6/mill-dist-1.0.6-example-extending-typescript-2-typescript-modules.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/2-typescript-modules">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill.*

trait TypeScriptModule extends Module {
  def npmInstall = Task {
    os.call((&quot;npm&quot;, &quot;install&quot;, &quot;--save-dev&quot;, &quot;typescript@5.6.3&quot;, &quot;@types/node@22.7.8&quot;))
    PathRef(Task.dest)
  }

  def sources = Task.Source(&quot;src&quot;)
  def allSources = Task {
    os.walk(sources().path).filter(_.ext == &quot;ts&quot;).map(PathRef(_))
  }

  def compile = Task {
    val tsc = npmInstall().path / &quot;node_modules/typescript/bin/tsc&quot;
    val types = npmInstall().path / &quot;node_modules/@types&quot;
    os.call((tsc, allSources().map(_.path), &quot;--outDir&quot;, Task.dest, &quot;--typeRoots&quot;, types))
    PathRef(Task.dest)
  }

  def mainFileName = Task { s&quot;${moduleDir.last}.js&quot; }
  def run(args: mill.api.Args) = Task.Command {
    val mainFile = compile().path / mainFileName()
    os.call((&quot;node&quot;, mainFile, args.value), stdout = os.Inherit)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then instantiate the module three times. Module can be adjacent or nested,
as shown belo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo extends TypeScriptModule {
  object bar extends TypeScriptModule
}
object qux extends TypeScriptModule</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">foo/src/foo.ts (<a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/2-typescript-modules/foo/src/foo.ts">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">interface User { firstName: string }

const user: User = { firstName: process.argv[2] }

console.log(&quot;Hello &quot; + user.firstName + &quot; Foo&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">foo/bar/src/bar.ts (<a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/2-typescript-modules/foo/bar/src/bar.ts">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">interface User { firstName: string }

const user: User = { firstName: process.argv[2] }

console.log(&quot;Hello &quot; + user.firstName + &quot; Bar&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">qux/src/qux.ts (<a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/2-typescript-modules/qux/src/qux.ts">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">interface User { firstName: string }

const user: User = { firstName: process.argv[2] }

console.log(&quot;Hello &quot; + user.firstName + &quot; Qux&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then invoke the <code>.run</code> method on each module from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill foo.run James
Hello James Foo

&gt; ./mill foo.bar.run James
Hello James Bar

&gt; ./mill qux.run James
Hello James Qux</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, we have multiple <code>TypeScriptModule</code>s, with <code>bar</code> nested inside <code>foo</code>,
but they are each independent and do not depend on one another.</p>
</div>
<div class="paragraph">
<center>
<svg width="527px" height="367px" viewBox="0.00 0.00 526.60 367.00" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 363.0)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-363 522.6,-363 522.6,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_3</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="14.44,-8 14.44,-116 504.16,-116 504.16,-8 14.44,-8"></polygon>
<text text-anchor="middle" x="259.3" y="-99.4" font-family="Times,serif" font-size="14.00">qux</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8,-124 8,-351 510.6,-351 510.6,-124 8,-124"></polygon>
<text text-anchor="middle" x="259.3" y="-334.4" font-family="Times,serif" font-size="14.00">foo</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_2</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="16,-210 16,-318 502.6,-318 502.6,-210 16,-210"></polygon>
<text text-anchor="middle" x="259.3" y="-301.4" font-family="Times,serif" font-size="14.00">bar</text>
</g>
<!-- qux.npmInstall -->
<g id="node1" class="node">
<title>qux.npmInstall</title>
<polygon fill="white" stroke="black" points="241.49,-83.3 140.72,-83.3 140.72,-58.7 241.49,-58.7 241.49,-83.3"></polygon>
<text text-anchor="middle" x="191.11" y="-66.8" font-family="Times,serif" font-size="14.00">qux.npmInstall</text>
</g>
<!-- qux.compile -->
<g id="node2" class="node">
<title>qux.compile</title>
<polygon fill="white" stroke="black" points="381.75,-83.3 296.55,-83.3 296.55,-58.7 381.75,-58.7 381.75,-83.3"></polygon>
<text text-anchor="middle" x="339.15" y="-66.8" font-family="Times,serif" font-size="14.00">qux.compile</text>
</g>
<!-- qux.npmInstall&#45;&gt;qux.compile -->
<g id="edge1" class="edge">
<title>qux.npmInstall-&gt;qux.compile</title>
<path fill="none" stroke="black" d="M241.55,-71C255.93,-71 271.68,-71 286.21,-71"></path>
<polygon fill="black" stroke="black" points="286.54,-74.5 296.54,-71 286.54,-67.5 286.54,-74.5"></polygon>
</g>
<!-- qux.run -->
<g id="node5" class="node">
<title>qux.run</title>
<polygon fill="white" stroke="black" points="496.24,-61.3 436.92,-61.3 436.92,-36.7 496.24,-36.7 496.24,-61.3"></polygon>
<text text-anchor="middle" x="466.58" y="-44.8" font-family="Times,serif" font-size="14.00">qux.run</text>
</g>
<!-- qux.compile&#45;&gt;qux.run -->
<g id="edge4" class="edge">
<title>qux.compile-&gt;qux.run</title>
<path fill="none" stroke="black" d="M381.92,-63.67C396.37,-61.14 412.49,-58.31 426.7,-55.82"></path>
<polygon fill="black" stroke="black" points="427.42,-59.25 436.66,-54.07 426.21,-52.35 427.42,-59.25"></polygon>
</g>
<!-- qux.sources -->
<g id="node3" class="node">
<title>qux.sources</title>
<polygon fill="white" stroke="black" points="105.16,-40.3 22.2,-40.3 22.2,-15.7 105.16,-15.7 105.16,-40.3"></polygon>
<text text-anchor="middle" x="63.68" y="-23.8" font-family="Times,serif" font-size="14.00">qux.sources</text>
</g>
<!-- qux.allSources -->
<g id="node4" class="node">
<title>qux.allSources</title>
<polygon fill="white" stroke="black" points="240.42,-40.3 141.79,-40.3 141.79,-15.7 240.42,-15.7 240.42,-40.3"></polygon>
<text text-anchor="middle" x="191.11" y="-23.8" font-family="Times,serif" font-size="14.00">qux.allSources</text>
</g>
<!-- qux.sources&#45;&gt;qux.allSources -->
<g id="edge2" class="edge">
<title>qux.sources-&gt;qux.allSources</title>
<path fill="none" stroke="black" d="M105.05,-28C113.48,-28 122.53,-28 131.47,-28"></path>
<polygon fill="black" stroke="black" points="131.48,-31.5 141.48,-28 131.48,-24.5 131.48,-31.5"></polygon>
</g>
<!-- qux.allSources&#45;&gt;qux.compile -->
<g id="edge3" class="edge">
<title>qux.allSources-&gt;qux.compile</title>
<path fill="none" stroke="black" d="M233.96,-40.32C250.37,-45.16 269.38,-50.75 286.63,-55.83"></path>
<polygon fill="black" stroke="black" points="285.96,-59.28 296.55,-58.75 287.94,-52.57 285.96,-59.28"></polygon>
</g>
<!-- qux.mainFileName -->
<g id="node6" class="node">
<title>qux.mainFileName</title>
<polygon fill="white" stroke="black" points="400.85,-40.3 277.45,-40.3 277.45,-15.7 400.85,-15.7 400.85,-40.3"></polygon>
<text text-anchor="middle" x="339.15" y="-23.8" font-family="Times,serif" font-size="14.00">qux.mainFileName</text>
</g>
<!-- qux.mainFileName&#45;&gt;qux.run -->
<g id="edge5" class="edge">
<title>qux.mainFileName-&gt;qux.run</title>
<path fill="none" stroke="black" d="M401.03,-38.19C409.8,-39.66 418.63,-41.14 426.82,-42.51"></path>
<polygon fill="black" stroke="black" points="426.35,-45.98 436.79,-44.18 427.5,-39.08 426.35,-45.98"></polygon>
</g>
<!-- bar.npmInstall -->
<g id="node7" class="node">
<title>bar.npmInstall</title>
<polygon fill="white" stroke="black" points="239.87,-285.3 142.35,-285.3 142.35,-260.7 239.87,-260.7 239.87,-285.3"></polygon>
<text text-anchor="middle" x="191.11" y="-268.8" font-family="Times,serif" font-size="14.00">bar.npmInstall</text>
</g>
<!-- bar.compile -->
<g id="node8" class="node">
<title>bar.compile</title>
<polygon fill="white" stroke="black" points="380.63,-285.3 297.67,-285.3 297.67,-260.7 380.63,-260.7 380.63,-285.3"></polygon>
<text text-anchor="middle" x="339.15" y="-268.8" font-family="Times,serif" font-size="14.00">bar.compile</text>
</g>
<!-- bar.npmInstall&#45;&gt;bar.compile -->
<g id="edge6" class="edge">
<title>bar.npmInstall-&gt;bar.compile</title>
<path fill="none" stroke="black" d="M239.93,-273C255.07,-273 271.85,-273 287.21,-273"></path>
<polygon fill="black" stroke="black" points="287.57,-276.5 297.57,-273 287.57,-269.5 287.57,-276.5"></polygon>
</g>
<!-- bar.run -->
<g id="node11" class="node">
<title>bar.run</title>
<polygon fill="white" stroke="black" points="494.62,-263.3 438.54,-263.3 438.54,-238.7 494.62,-238.7 494.62,-263.3"></polygon>
<text text-anchor="middle" x="466.58" y="-246.8" font-family="Times,serif" font-size="14.00">bar.run</text>
</g>
<!-- bar.compile&#45;&gt;bar.run -->
<g id="edge9" class="edge">
<title>bar.compile-&gt;bar.run</title>
<path fill="none" stroke="black" d="M380.53,-265.92C395.89,-263.22 413.31,-260.17 428.36,-257.53"></path>
<polygon fill="black" stroke="black" points="429.11,-260.95 438.35,-255.78 427.9,-254.06 429.11,-260.95"></polygon>
</g>
<!-- bar.sources -->
<g id="node9" class="node">
<title>bar.sources</title>
<polygon fill="white" stroke="black" points="103.53,-242.3 23.82,-242.3 23.82,-217.7 103.53,-217.7 103.53,-242.3"></polygon>
<text text-anchor="middle" x="63.68" y="-225.8" font-family="Times,serif" font-size="14.00">bar.sources</text>
</g>
<!-- bar.allSources -->
<g id="node10" class="node">
<title>bar.allSources</title>
<polygon fill="white" stroke="black" points="238.8,-242.3 143.42,-242.3 143.42,-217.7 238.8,-217.7 238.8,-242.3"></polygon>
<text text-anchor="middle" x="191.11" y="-225.8" font-family="Times,serif" font-size="14.00">bar.allSources</text>
</g>
<!-- bar.sources&#45;&gt;bar.allSources -->
<g id="edge7" class="edge">
<title>bar.sources-&gt;bar.allSources</title>
<path fill="none" stroke="black" d="M103.68,-230C112.96,-230 123.06,-230 132.98,-230"></path>
<polygon fill="black" stroke="black" points="133.2,-233.5 143.2,-230 133.2,-226.5 133.2,-233.5"></polygon>
</g>
<!-- bar.allSources&#45;&gt;bar.compile -->
<g id="edge8" class="edge">
<title>bar.allSources-&gt;bar.compile</title>
<path fill="none" stroke="black" d="M233.96,-242.32C250.73,-247.26 270.2,-252.99 287.73,-258.16"></path>
<polygon fill="black" stroke="black" points="287.22,-261.65 297.8,-261.12 289.2,-254.94 287.22,-261.65"></polygon>
</g>
<!-- bar.mainFileName -->
<g id="node12" class="node">
<title>bar.mainFileName</title>
<polygon fill="white" stroke="black" points="399.23,-242.3 279.07,-242.3 279.07,-217.7 399.23,-217.7 399.23,-242.3"></polygon>
<text text-anchor="middle" x="339.15" y="-225.8" font-family="Times,serif" font-size="14.00">bar.mainFileName</text>
</g>
<!-- bar.mainFileName&#45;&gt;bar.run -->
<g id="edge10" class="edge">
<title>bar.mainFileName-&gt;bar.run</title>
<path fill="none" stroke="black" d="M399.56,-239.95C409.3,-241.58 419.14,-243.23 428.15,-244.73"></path>
<polygon fill="black" stroke="black" points="427.85,-248.23 438.29,-246.43 429,-241.33 427.85,-248.23"></polygon>
</g>
<!-- foo.npmInstall -->
<g id="node13" class="node">
<title>foo.npmInstall</title>
<polygon fill="white" stroke="black" points="240.15,-199.3 142.06,-199.3 142.06,-174.7 240.15,-174.7 240.15,-199.3"></polygon>
<text text-anchor="middle" x="191.11" y="-182.8" font-family="Times,serif" font-size="14.00">foo.npmInstall</text>
</g>
<!-- foo.compile -->
<g id="node14" class="node">
<title>foo.compile</title>
<polygon fill="white" stroke="black" points="380.91,-199.3 297.39,-199.3 297.39,-174.7 380.91,-174.7 380.91,-199.3"></polygon>
<text text-anchor="middle" x="339.15" y="-182.8" font-family="Times,serif" font-size="14.00">foo.compile</text>
</g>
<!-- foo.npmInstall&#45;&gt;foo.compile -->
<g id="edge11" class="edge">
<title>foo.npmInstall-&gt;foo.compile</title>
<path fill="none" stroke="black" d="M240.33,-187C255.32,-187 271.89,-187 287.06,-187"></path>
<polygon fill="black" stroke="black" points="287.31,-190.5 297.31,-187 287.31,-183.5 287.31,-190.5"></polygon>
</g>
<!-- foo.run -->
<g id="node17" class="node">
<title>foo.run</title>
<polygon fill="white" stroke="black" points="494.9,-177.3 438.26,-177.3 438.26,-152.7 494.9,-152.7 494.9,-177.3"></polygon>
<text text-anchor="middle" x="466.58" y="-160.8" font-family="Times,serif" font-size="14.00">foo.run</text>
</g>
<!-- foo.compile&#45;&gt;foo.run -->
<g id="edge14" class="edge">
<title>foo.compile-&gt;foo.run</title>
<path fill="none" stroke="black" d="M380.87,-179.86C396.1,-177.19 413.31,-174.17 428.22,-171.55"></path>
<polygon fill="black" stroke="black" points="428.88,-174.99 438.12,-169.82 427.67,-168.1 428.88,-174.99"></polygon>
</g>
<!-- foo.sources -->
<g id="node15" class="node">
<title>foo.sources</title>
<polygon fill="white" stroke="black" points="103.82,-156.3 23.54,-156.3 23.54,-131.7 103.82,-131.7 103.82,-156.3"></polygon>
<text text-anchor="middle" x="63.68" y="-139.8" font-family="Times,serif" font-size="14.00">foo.sources</text>
</g>
<!-- foo.allSources -->
<g id="node16" class="node">
<title>foo.allSources</title>
<polygon fill="white" stroke="black" points="239.58,-156.3 142.63,-156.3 142.63,-131.7 239.58,-131.7 239.58,-156.3"></polygon>
<text text-anchor="middle" x="191.11" y="-139.8" font-family="Times,serif" font-size="14.00">foo.allSources</text>
</g>
<!-- foo.sources&#45;&gt;foo.allSources -->
<g id="edge12" class="edge">
<title>foo.sources-&gt;foo.allSources</title>
<path fill="none" stroke="black" d="M104.02,-144C112.99,-144 122.7,-144 132.26,-144"></path>
<polygon fill="black" stroke="black" points="132.54,-147.5 142.54,-144 132.54,-140.5 132.54,-147.5"></polygon>
</g>
<!-- foo.allSources&#45;&gt;foo.compile -->
<g id="edge13" class="edge">
<title>foo.allSources-&gt;foo.compile</title>
<path fill="none" stroke="black" d="M233.96,-156.32C250.59,-161.22 269.87,-166.9 287.29,-172.03"></path>
<polygon fill="black" stroke="black" points="286.72,-175.51 297.3,-174.97 288.7,-168.79 286.72,-175.51"></polygon>
</g>
<!-- foo.mainFileName -->
<g id="node18" class="node">
<title>foo.mainFileName</title>
<polygon fill="white" stroke="black" points="400.01,-156.3 278.29,-156.3 278.29,-131.7 400.01,-131.7 400.01,-156.3"></polygon>
<text text-anchor="middle" x="339.15" y="-139.8" font-family="Times,serif" font-size="14.00">foo.mainFileName</text>
</g>
<!-- foo.mainFileName&#45;&gt;foo.run -->
<g id="edge15" class="edge">
<title>foo.mainFileName-&gt;foo.run</title>
<path fill="none" stroke="black" d="M399.93,-154.01C409.54,-155.62 419.25,-157.24 428.14,-158.73"></path>
<polygon fill="black" stroke="black" points="427.71,-162.21 438.15,-160.41 428.87,-155.3 427.71,-162.21"></polygon>
</g>
</g>
</svg>

</center>
</div>
<div class="paragraph">
<p>Next, we will look at how to wire them up using
<code>moduleDeps</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_typescriptmodule_moduledeps"><a class="anchor" href="#_typescriptmodule_moduledeps"></a>TypeScriptModule <code>moduleDeps</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example extends <code>TypeScriptModule</code> to support <code>moduleDeps</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>def compile</code> task is considerably fleshed out: rather than using command
line flags, we generate a <code>tsconfig.json</code> file using the <code>ujson.Obj</code>/<code>ujson.Arr</code>
JSON factory methods from the bundled <a href="https://github.com/com-lihaoyi/upickle">uPickle</a> library.</p>
</li>
<li>
<p><code>def compile</code> now returns two <code>PathRef`s: one containing the `.js</code> output to use in
<code>def run</code>, and one containing the <code>.d.ts</code> output to use in downstream <code>compile</code>s.</p>
</li>
<li>
<p><code>def moduleDeps</code> is used to allow different <code>TypeScriptModule</code>s to depend on each
other, and we use <code>Task.traverse</code> to combine the upstream <code>compiledDefinitions</code> for
use in <code>compile</code>, and <code>compiledJavascript</code> for use in <code>run</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.0.6/mill-dist-1.0.6-example-extending-typescript-3-module-deps.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/3-module-deps">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill.*

trait TypeScriptModule extends Module {
  def moduleDeps: Seq[TypeScriptModule] = Nil

  def npmInstall = Task {
    os.call((&quot;npm&quot;, &quot;install&quot;, &quot;--save-dev&quot;, &quot;typescript@5.6.3&quot;, &quot;@types/node@22.7.8&quot;))
    PathRef(Task.dest)
  }

  def sources = Task.Source(&quot;src&quot;)
  def allSources = Task { os.walk(sources().path).filter(_.ext == &quot;ts&quot;).map(PathRef(_)) }

  def compile: T[(PathRef, PathRef)] = Task {

    val nodeTypes = npmInstall().path / &quot;node_modules/@types&quot;
    val javascriptOut = Task.dest / &quot;javascript&quot;
    val declarationsOut = Task.dest / &quot;declarations&quot;

    val upstreamPaths =
      for (((jsDir, dTsDir), mod) &lt;- Task.traverse(moduleDeps)(_.compile)().zip(moduleDeps))
        yield (mod.moduleDir.subRelativeTo(build.moduleDir).toString + &quot;/*&quot;, dTsDir.path)

    val allPaths = upstreamPaths ++ Seq(&quot;*&quot; -&gt; sources().path)

    os.write(
      Task.dest / &quot;tsconfig.json&quot;,
      ujson.Obj(
        &quot;compilerOptions&quot; -&gt; ujson.Obj(
          &quot;outDir&quot; -&gt; javascriptOut.toString,
          &quot;declaration&quot; -&gt; true,
          &quot;declarationDir&quot; -&gt; declarationsOut.toString,
          &quot;typeRoots&quot; -&gt; ujson.Arr(nodeTypes.toString),
          &quot;paths&quot; -&gt; ujson.Obj.from(allPaths.map { case (k, v) =&gt; (k, ujson.Arr(s&quot;$v/*&quot;)) })
        ),
        &quot;files&quot; -&gt; allSources().map(_.path.toString)
      )
    )

    os.call(npmInstall().path / &quot;node_modules/typescript/bin/tsc&quot;)
    (PathRef(javascriptOut), PathRef(declarationsOut))
  }

  def mainFileName = Task { s&quot;${moduleDir.last}.js&quot; }
  def run(args: mill.api.Args) = Task.Command {

    val upstream = Task.traverse(moduleDeps)(_.compile)().zip(moduleDeps)
    for (((jsDir, tTsDir), mod) &lt;- upstream) {
      os.copy(jsDir.path, Task.dest / mod.moduleDir.subRelativeTo(build.moduleDir))
    }
    val mainFile = compile()._1.path / mainFileName()
    os.call(
      (&quot;node&quot;, mainFile, args.value),
      stdout = os.Inherit,
      env = Map(&quot;NODE_PATH&quot; -&gt; Seq(&quot;.&quot;, compile()._1.path).mkString(&quot;:&quot;))
    )
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of <code>Task.traverse(moduleDeps)</code> in order to aggregate the <code>compile</code>
output of the upstream modules, which is necessary both to configure the <code>tsc</code> TypeScript
compiler in <code>compile</code> and also to set up the <code>node</code> working directory in <code>run</code>. This
is a common pattern when defining language modules, whose module-level dependencies need
to be translated into task-level dependencies</p>
</div>
<div class="paragraph">
<p>Again, we can instantiate <code>TypeScriptModule</code> three times, but now <code>foo/src/foo.ts</code>
and <code>foo/bar/src/bar.ts</code> export their APIs which are then imported in <code>qux/src/qux.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo extends TypeScriptModule {
  object bar extends TypeScriptModule
}
object qux extends TypeScriptModule {
  def moduleDeps = Seq(foo, foo.bar)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">foo/src/foo.ts (<a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/3-module-deps/foo/src/foo.ts">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">interface User {
    firstName: string
    lastName: string
    role: string
}

export {User}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">foo/bar/src/bar.ts (<a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/3-module-deps/foo/bar/src/bar.ts">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">const defaultRole = &quot;Professor&quot;
export {defaultRole}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">qux/src/qux.ts (<a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/3-module-deps/qux/src/qux.ts">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import {User} from &quot;foo/foo.js&quot;
import {defaultRole} from &quot;foo/bar/bar.js&quot;
const user: User = {
    firstName: process.argv[2],
    lastName: process.argv[3],
    role: defaultRole,
}

console.log(&quot;Hello &quot; + user.firstName + &quot; &quot; + user.lastName + &quot; &quot; + user.role)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then invoke the <code>qux.run</code> method on each module from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill qux.run James Bond
Hello James Bond Professor</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dependency graph of tasks now looks like this, with the output of
<code>foo.compile</code> and <code>bar.compile</code> now being fed into <code>qux.compile</code> (and
ultimately <code>qux.run</code>):</p>
</div>
<div class="paragraph">
<center>
<svg width="674px" height="367px" viewBox="0.00 0.00 674.01 367.00" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 363.0)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-363 670.01,-363 670.01,4 -4,4"></polygon>
<g id="clust2" class="cluster">
<title>cluster_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8,-124 8,-351 537.02,-351 537.02,-124 8,-124"></polygon>
<text text-anchor="middle" x="272.51" y="-334.4" font-family="Times,serif" font-size="14.00">foo</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_2</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="16,-210 16,-318 529.02,-318 529.02,-210 16,-210"></polygon>
<text text-anchor="middle" x="272.51" y="-301.4" font-family="Times,serif" font-size="14.00">bar</text>
</g>
<g id="clust1" class="cluster">
<title>cluster_3</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="139.53,-8 139.53,-116 658.01,-116 658.01,-8 139.53,-8"></polygon>
<text text-anchor="middle" x="398.77" y="-99.4" font-family="Times,serif" font-size="14.00">qux</text>
</g>
<!-- qux.npmInstall -->
<g id="node1" class="node">
<title>qux.npmInstall</title>
<polygon fill="white" stroke="black" points="384.85,-83.3 284.09,-83.3 284.09,-58.7 384.85,-58.7 384.85,-83.3"></polygon>
<text text-anchor="middle" x="334.47" y="-66.8" font-family="Times,serif" font-size="14.00">qux.npmInstall</text>
</g>
<!-- qux.compile -->
<g id="node2" class="node">
<title>qux.compile</title>
<polygon fill="white" stroke="black" points="535.6,-83.3 450.4,-83.3 450.4,-58.7 535.6,-58.7 535.6,-83.3"></polygon>
<text text-anchor="middle" x="493" y="-66.8" font-family="Times,serif" font-size="14.00">qux.compile</text>
</g>
<!-- qux.npmInstall&#45;&gt;qux.compile -->
<g id="edge1" class="edge">
<title>qux.npmInstall-&gt;qux.compile</title>
<path fill="none" stroke="black" d="M385,-71C402.52,-71 422.27,-71 439.99,-71"></path>
<polygon fill="black" stroke="black" points="440.16,-74.5 450.16,-71 440.16,-67.5 440.16,-74.5"></polygon>
</g>
<!-- qux.run -->
<g id="node5" class="node">
<title>qux.run</title>
<polygon fill="white" stroke="black" points="650.09,-61.3 590.77,-61.3 590.77,-36.7 650.09,-36.7 650.09,-61.3"></polygon>
<text text-anchor="middle" x="620.43" y="-44.8" font-family="Times,serif" font-size="14.00">qux.run</text>
</g>
<!-- qux.compile&#45;&gt;qux.run -->
<g id="edge4" class="edge">
<title>qux.compile-&gt;qux.run</title>
<path fill="none" stroke="black" d="M535.77,-63.67C550.22,-61.14 566.35,-58.31 580.56,-55.82"></path>
<polygon fill="black" stroke="black" points="581.27,-59.25 590.51,-54.07 580.06,-52.35 581.27,-59.25"></polygon>
</g>
<!-- qux.sources -->
<g id="node3" class="node">
<title>qux.sources</title>
<polygon fill="white" stroke="black" points="230.25,-40.3 147.29,-40.3 147.29,-15.7 230.25,-15.7 230.25,-40.3"></polygon>
<text text-anchor="middle" x="188.77" y="-23.8" font-family="Times,serif" font-size="14.00">qux.sources</text>
</g>
<!-- qux.allSources -->
<g id="node4" class="node">
<title>qux.allSources</title>
<polygon fill="white" stroke="black" points="383.78,-40.3 285.16,-40.3 285.16,-15.7 383.78,-15.7 383.78,-40.3"></polygon>
<text text-anchor="middle" x="334.47" y="-23.8" font-family="Times,serif" font-size="14.00">qux.allSources</text>
</g>
<!-- qux.sources&#45;&gt;qux.allSources -->
<g id="edge2" class="edge">
<title>qux.sources-&gt;qux.allSources</title>
<path fill="none" stroke="black" d="M230.18,-28C244.01,-28 259.77,-28 274.74,-28"></path>
<polygon fill="black" stroke="black" points="274.95,-31.5 284.95,-28 274.95,-24.5 274.95,-31.5"></polygon>
</g>
<!-- qux.allSources&#45;&gt;qux.compile -->
<g id="edge3" class="edge">
<title>qux.allSources-&gt;qux.compile</title>
<path fill="none" stroke="black" d="M380.33,-40.32C399.1,-45.48 421.02,-51.5 440.46,-56.84"></path>
<polygon fill="black" stroke="black" points="439.79,-60.29 450.36,-59.56 441.64,-53.54 439.79,-60.29"></polygon>
</g>
<!-- qux.mainFileName -->
<g id="node6" class="node">
<title>qux.mainFileName</title>
<polygon fill="white" stroke="black" points="554.7,-40.3 431.3,-40.3 431.3,-15.7 554.7,-15.7 554.7,-40.3"></polygon>
<text text-anchor="middle" x="493" y="-23.8" font-family="Times,serif" font-size="14.00">qux.mainFileName</text>
</g>
<!-- qux.mainFileName&#45;&gt;qux.run -->
<g id="edge5" class="edge">
<title>qux.mainFileName-&gt;qux.run</title>
<path fill="none" stroke="black" d="M554.88,-38.19C563.66,-39.66 572.48,-41.14 580.67,-42.51"></path>
<polygon fill="black" stroke="black" points="580.2,-45.98 590.64,-44.18 581.36,-39.08 580.2,-45.98"></polygon>
</g>
<!-- bar.npmInstall -->
<g id="node7" class="node">
<title>bar.npmInstall</title>
<polygon fill="white" stroke="black" points="237.53,-285.3 140.01,-285.3 140.01,-260.7 237.53,-260.7 237.53,-285.3"></polygon>
<text text-anchor="middle" x="188.77" y="-268.8" font-family="Times,serif" font-size="14.00">bar.npmInstall</text>
</g>
<!-- bar.compile -->
<g id="node8" class="node">
<title>bar.compile</title>
<polygon fill="white" stroke="black" points="375.95,-242.3 292.99,-242.3 292.99,-217.7 375.95,-217.7 375.95,-242.3"></polygon>
<text text-anchor="middle" x="334.47" y="-225.8" font-family="Times,serif" font-size="14.00">bar.compile</text>
</g>
<!-- bar.npmInstall&#45;&gt;bar.compile -->
<g id="edge6" class="edge">
<title>bar.npmInstall-&gt;bar.compile</title>
<path fill="none" stroke="black" d="M230.95,-260.68C247.17,-255.82 265.96,-250.2 282.99,-245.1"></path>
<polygon fill="black" stroke="black" points="284.2,-248.4 292.78,-242.18 282.2,-241.69 284.2,-248.4"></polygon>
</g>
<!-- bar.compile&#45;&gt;qux.compile -->
<g id="edge16" class="edge">
<title>bar.compile-&gt;qux.compile</title>
<path fill="none" stroke="green" stroke-width="3" d="M375.99,-224.69C382.98,-222.3 389.73,-218.88 395.15,-214 428.38,-184.05 404.82,-156.17 431.15,-120 439.8,-108.12 452.03,-97.51 463.26,-89.24"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="465.42,-92 471.58,-83.38 461.39,-86.27 465.42,-92"></polygon>
</g>
<!-- bar.run -->
<g id="node11" class="node">
<title>bar.run</title>
<polygon fill="white" stroke="black" points="521.04,-263.3 464.97,-263.3 464.97,-238.7 521.04,-238.7 521.04,-263.3"></polygon>
<text text-anchor="middle" x="493" y="-246.8" font-family="Times,serif" font-size="14.00">bar.run</text>
</g>
<!-- bar.compile&#45;&gt;bar.run -->
<g id="edge9" class="edge">
<title>bar.compile-&gt;bar.run</title>
<path fill="none" stroke="black" d="M375.78,-235.41C400.08,-238.67 430.83,-242.79 454.59,-245.98"></path>
<polygon fill="black" stroke="black" points="454.26,-249.47 464.64,-247.33 455.19,-242.53 454.26,-249.47"></polygon>
</g>
<!-- bar.sources -->
<g id="node9" class="node">
<title>bar.sources</title>
<polygon fill="white" stroke="black" points="103.53,-242.3 23.82,-242.3 23.82,-217.7 103.53,-217.7 103.53,-242.3"></polygon>
<text text-anchor="middle" x="63.68" y="-225.8" font-family="Times,serif" font-size="14.00">bar.sources</text>
</g>
<!-- bar.allSources -->
<g id="node10" class="node">
<title>bar.allSources</title>
<polygon fill="white" stroke="black" points="236.46,-242.3 141.08,-242.3 141.08,-217.7 236.46,-217.7 236.46,-242.3"></polygon>
<text text-anchor="middle" x="188.77" y="-225.8" font-family="Times,serif" font-size="14.00">bar.allSources</text>
</g>
<!-- bar.sources&#45;&gt;bar.allSources -->
<g id="edge7" class="edge">
<title>bar.sources-&gt;bar.allSources</title>
<path fill="none" stroke="black" d="M103.62,-230C112.22,-230 121.5,-230 130.65,-230"></path>
<polygon fill="black" stroke="black" points="130.88,-233.5 140.88,-230 130.88,-226.5 130.88,-233.5"></polygon>
</g>
<!-- bar.allSources&#45;&gt;bar.compile -->
<g id="edge8" class="edge">
<title>bar.allSources-&gt;bar.compile</title>
<path fill="none" stroke="black" d="M236.82,-230C251.59,-230 267.94,-230 282.94,-230"></path>
<polygon fill="black" stroke="black" points="283.06,-233.5 293.06,-230 283.06,-226.5 283.06,-233.5"></polygon>
</g>
<!-- bar.mainFileName -->
<g id="node12" class="node">
<title>bar.mainFileName</title>
<polygon fill="white" stroke="black" points="394.55,-285.3 274.39,-285.3 274.39,-260.7 394.55,-260.7 394.55,-285.3"></polygon>
<text text-anchor="middle" x="334.47" y="-268.8" font-family="Times,serif" font-size="14.00">bar.mainFileName</text>
</g>
<!-- bar.mainFileName&#45;&gt;bar.run -->
<g id="edge10" class="edge">
<title>bar.mainFileName-&gt;bar.run</title>
<path fill="none" stroke="black" d="M394.65,-264.68C414.77,-261.86 436.68,-258.78 454.61,-256.26"></path>
<polygon fill="black" stroke="black" points="455.25,-259.7 464.67,-254.84 454.28,-252.77 455.25,-259.7"></polygon>
</g>
<!-- foo.npmInstall -->
<g id="node13" class="node">
<title>foo.npmInstall</title>
<polygon fill="white" stroke="black" points="237.81,-199.3 139.73,-199.3 139.73,-174.7 237.81,-174.7 237.81,-199.3"></polygon>
<text text-anchor="middle" x="188.77" y="-182.8" font-family="Times,serif" font-size="14.00">foo.npmInstall</text>
</g>
<!-- foo.compile -->
<g id="node14" class="node">
<title>foo.compile</title>
<polygon fill="white" stroke="black" points="376.23,-156.3 292.71,-156.3 292.71,-131.7 376.23,-131.7 376.23,-156.3"></polygon>
<text text-anchor="middle" x="334.47" y="-139.8" font-family="Times,serif" font-size="14.00">foo.compile</text>
</g>
<!-- foo.npmInstall&#45;&gt;foo.compile -->
<g id="edge11" class="edge">
<title>foo.npmInstall-&gt;foo.compile</title>
<path fill="none" stroke="black" d="M230.95,-174.68C247.17,-169.82 265.96,-164.2 282.99,-159.1"></path>
<polygon fill="black" stroke="black" points="284.2,-162.4 292.78,-156.18 282.2,-155.69 284.2,-162.4"></polygon>
</g>
<!-- foo.compile&#45;&gt;qux.compile -->
<g id="edge17" class="edge">
<title>foo.compile-&gt;qux.compile</title>
<path fill="none" stroke="green" stroke-width="3" d="M367.59,-131.67C376.57,-128.07 386.3,-124.01 395.15,-120 417.03,-110.09 441.13,-97.9 459.82,-88.16"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="461.56,-91.2 468.79,-83.45 458.31,-85 461.56,-91.2"></polygon>
</g>
<!-- foo.run -->
<g id="node17" class="node">
<title>foo.run</title>
<polygon fill="white" stroke="black" points="521.32,-177.3 464.68,-177.3 464.68,-152.7 521.32,-152.7 521.32,-177.3"></polygon>
<text text-anchor="middle" x="493" y="-160.8" font-family="Times,serif" font-size="14.00">foo.run</text>
</g>
<!-- foo.compile&#45;&gt;foo.run -->
<g id="edge14" class="edge">
<title>foo.compile-&gt;foo.run</title>
<path fill="none" stroke="black" d="M376.19,-149.46C400.33,-152.7 430.73,-156.78 454.32,-159.94"></path>
<polygon fill="black" stroke="black" points="453.93,-163.42 464.31,-161.28 454.86,-156.49 453.93,-163.42"></polygon>
</g>
<!-- foo.sources -->
<g id="node15" class="node">
<title>foo.sources</title>
<polygon fill="white" stroke="black" points="103.82,-156.3 23.54,-156.3 23.54,-131.7 103.82,-131.7 103.82,-156.3"></polygon>
<text text-anchor="middle" x="63.68" y="-139.8" font-family="Times,serif" font-size="14.00">foo.sources</text>
</g>
<!-- foo.allSources -->
<g id="node16" class="node">
<title>foo.allSources</title>
<polygon fill="white" stroke="black" points="237.24,-156.3 140.29,-156.3 140.29,-131.7 237.24,-131.7 237.24,-156.3"></polygon>
<text text-anchor="middle" x="188.77" y="-139.8" font-family="Times,serif" font-size="14.00">foo.allSources</text>
</g>
<!-- foo.sources&#45;&gt;foo.allSources -->
<g id="edge12" class="edge">
<title>foo.sources-&gt;foo.allSources</title>
<path fill="none" stroke="black" d="M103.96,-144C112.26,-144 121.17,-144 129.99,-144"></path>
<polygon fill="black" stroke="black" points="130.24,-147.5 140.24,-144 130.24,-140.5 130.24,-147.5"></polygon>
</g>
<!-- foo.allSources&#45;&gt;foo.compile -->
<g id="edge13" class="edge">
<title>foo.allSources-&gt;foo.compile</title>
<path fill="none" stroke="black" d="M237.22,-144C251.83,-144 267.97,-144 282.8,-144"></path>
<polygon fill="black" stroke="black" points="282.81,-147.5 292.81,-144 282.81,-140.5 282.81,-147.5"></polygon>
</g>
<!-- foo.mainFileName -->
<g id="node18" class="node">
<title>foo.mainFileName</title>
<polygon fill="white" stroke="black" points="395.33,-199.3 273.61,-199.3 273.61,-174.7 395.33,-174.7 395.33,-199.3"></polygon>
<text text-anchor="middle" x="334.47" y="-182.8" font-family="Times,serif" font-size="14.00">foo.mainFileName</text>
</g>
<!-- foo.mainFileName&#45;&gt;foo.run -->
<g id="edge15" class="edge">
<title>foo.mainFileName-&gt;foo.run</title>
<path fill="none" stroke="black" d="M395.54,-178.56C415.43,-175.76 436.98,-172.73 454.66,-170.25"></path>
<polygon fill="black" stroke="black" points="455.16,-173.71 464.58,-168.85 454.19,-166.78 455.16,-173.71"></polygon>
</g>
</g>
</svg>

</center>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_npm_dependencies_and_bundling"><a class="anchor" href="#_npm_dependencies_and_bundling"></a>NPM dependencies and bundling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example expands <code>TypeScriptModule</code> in two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Previously, <code>def npmInstall</code> was hardcoded to
 install <code>typescript</code> and <code>@types/node</code>, because that was what was needed
 to compile Typescript against the builtin Node.js APIs. In this example,
 we add a <code>def npmDeps</code> task, that is aggregated using <code>Task.traverse</code> into
<code>def transitiveNpmDeps</code>, that are then included in the body of <code>def npmInstall</code>.
 The <code>npmInstall</code> destination folder in then used both in <code>def compile</code> to
 provide the <code>tsc</code> compiler and supporting installed type definitions, as well
 as in <code>def run</code> in order to provide the necessary files to the <code>node</code> runtime.</p>
</li>
<li>
<p>We include <code>esbuild@0.24.0</code> as part of our <code>npm install</code>, for use in a <code>def bundle</code>
task that uses it to call <code>esbuild</code> to bundle our 3 <code>TypeScriptModule</code>s into a single
<code>bundle.js</code> file. The logic shared between <code>def run</code> and <code>def bundle</code> has been extracted
into a <code>def prepareRun</code> task.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://repo1.maven.org/maven2/com/lihaoyi/mill-dist/1.0.6/mill-dist-1.0.6-example-extending-typescript-4-npm-deps-bundle.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/1.0.6/example/extending/typescript/4-npm-deps-bundle">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill.*

trait TypeScriptModule extends Module {
  def moduleDeps: Seq[TypeScriptModule] = Nil

  def npmDeps: T[Seq[String]] = Task { Seq() }

  def transitiveNpmDeps: T[Seq[String]] = Task {
    Task.traverse(moduleDeps)(_.npmDeps)().flatten ++ npmDeps()
  }

  def npmInstall = Task {
    os.call((
      &quot;npm&quot;,
      &quot;install&quot;,
      &quot;--save-dev&quot;,
      &quot;typescript@5.6.3&quot;,
      &quot;@types/node@22.7.8&quot;,
      &quot;esbuild@0.24.0&quot;,
      transitiveNpmDeps()
    ))
    PathRef(Task.dest)
  }

  def sources = Task.Source(&quot;src&quot;)
  def allSources = Task { os.walk(sources().path).filter(_.ext == &quot;ts&quot;).map(PathRef(_)) }

  def compile: T[(PathRef, PathRef)] = Task {
    val nodeTypes = npmInstall().path / &quot;node_modules/@types&quot;
    val javascriptOut = Task.dest / &quot;javascript&quot;
    val declarationsOut = Task.dest / &quot;declarations&quot;

    val upstreamPaths =
      for (((jsDir, dTsDir), mod) &lt;- Task.traverse(moduleDeps)(_.compile)().zip(moduleDeps))
        yield (mod.moduleDir.subRelativeTo(build.moduleDir).toString + &quot;/*&quot;, dTsDir.path)

    val allPaths = upstreamPaths ++ Seq(&quot;*&quot; -&gt; sources().path, &quot;*&quot; -&gt; npmInstall().path)

    os.write(
      Task.dest / &quot;tsconfig.json&quot;,
      ujson.Obj(
        &quot;compilerOptions&quot; -&gt; ujson.Obj(
          &quot;outDir&quot; -&gt; javascriptOut.toString,
          &quot;declaration&quot; -&gt; true,
          &quot;declarationDir&quot; -&gt; declarationsOut.toString,
          &quot;typeRoots&quot; -&gt; ujson.Arr(nodeTypes.toString),
          &quot;paths&quot; -&gt; ujson.Obj.from(allPaths.map { case (k, v) =&gt; (k, ujson.Arr(s&quot;$v/*&quot;)) })
        ),
        &quot;files&quot; -&gt; allSources().map(_.path.toString)
      )
    )

    os.call((npmInstall().path / &quot;node_modules/typescript/bin/tsc&quot;))

    (PathRef(javascriptOut), PathRef(declarationsOut))
  }

  def mainFileName = Task { s&quot;${moduleDir.last}.js&quot; }

  def prepareRun = Task.Anon {
    val upstream = Task.traverse(moduleDeps)(_.compile)().zip(moduleDeps)
    for (((jsDir, tTsDir), mod) &lt;- upstream) {
      os.copy(jsDir.path, Task.dest / mod.moduleDir.subRelativeTo(build.moduleDir))
    }
    val mainFile = compile()._1.path / mainFileName()
    val env = Map(&quot;NODE_PATH&quot; -&gt; Seq(&quot;.&quot;, compile()._1.path, npmInstall().path).mkString(&quot;:&quot;))
    (mainFile, env)
  }

  def run(args: mill.api.Args) = Task.Command {
    val (mainFile, env) = prepareRun()
    os.call((&quot;node&quot;, mainFile, args.value), stdout = os.Inherit, env = env)
  }

  def bundle = Task {
    val (mainFile, env) = prepareRun()
    val esbuild = npmInstall().path / &quot;node_modules/esbuild/bin/esbuild&quot;
    val bundle = Task.dest / &quot;bundle.js&quot;
    os.call((esbuild, mainFile, &quot;--bundle&quot;, s&quot;--outfile=$bundle&quot;), env = env)
    PathRef(bundle)
  }
}

object foo extends TypeScriptModule {
  object bar extends TypeScriptModule {
    def npmDeps = Seq(&quot;immutable@4.3.7&quot;)
  }
}
object qux extends TypeScriptModule {
  def moduleDeps = Seq(foo, foo.bar)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now not only invoke the <code>qux.run</code> to run the <code>TypeScriptModule</code> immediately
using <code>node</code>, we can also use <code>qux.bundle</code> to generate a <code>bundle.js</code> file we can run
standalone using <code>node</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&gt; ./mill qux.run James Bond prof
Hello James Bond Professor

&gt; ./mill show qux.bundle
&quot;.../out/qux/bundle.dest/bundle.js&quot;

&gt; node out/qux/bundle.dest/bundle.js James Bond prof
Hello James Bond Professor</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final module tree and task graph is now as follows, with the
additional <code>npmDeps</code> tasks upstream and the <code>bundle</code> tasks downstream:</p>
</div>
<div class="paragraph">
<center>
<svg width="705px" height="367px" viewBox="0.00 0.00 705.13 367.00" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.0 1.0) rotate(0.0) translate(4.0 363.0)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-363 701.13,-363 701.13,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_3</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="145.37,-8 145.37,-116 689.13,-116 689.13,-8 145.37,-8"></polygon>
<text text-anchor="middle" x="417.25" y="-99.4" font-family="Times,serif" font-size="14.00">qux</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8,-124 8,-351 558.42,-351 558.42,-124 8,-124"></polygon>
<text text-anchor="middle" x="283.21" y="-334.4" font-family="Times,serif" font-size="14.00">foo</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_2</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="16,-210 16,-318 550.42,-318 550.42,-210 16,-210"></polygon>
<text text-anchor="middle" x="283.21" y="-301.4" font-family="Times,serif" font-size="14.00">bar</text>
</g>
<!-- qux.npmInstall -->
<g id="node1" class="node">
<title>qux.npmInstall</title>
<polygon fill="white" stroke="black" points="396.53,-40.3 295.76,-40.3 295.76,-15.7 396.53,-15.7 396.53,-40.3"></polygon>
<text text-anchor="middle" x="346.15" y="-23.8" font-family="Times,serif" font-size="14.00">qux.npmInstall</text>
</g>
<!-- qux.compile -->
<g id="node2" class="node">
<title>qux.compile</title>
<polygon fill="white" stroke="black" points="547.28,-40.3 462.08,-40.3 462.08,-15.7 547.28,-15.7 547.28,-40.3"></polygon>
<text text-anchor="middle" x="504.68" y="-23.8" font-family="Times,serif" font-size="14.00">qux.compile</text>
</g>
<!-- qux.npmInstall&#45;&gt;qux.compile -->
<g id="edge1" class="edge">
<title>qux.npmInstall-&gt;qux.compile</title>
<path fill="none" stroke="black" d="M396.68,-28C414.2,-28 433.95,-28 451.67,-28"></path>
<polygon fill="black" stroke="black" points="451.83,-31.5 461.83,-28 451.83,-24.5 451.83,-31.5"></polygon>
</g>
<!-- qux.run -->
<g id="node5" class="node">
<title>qux.run</title>
<polygon fill="white" stroke="black" points="671.49,-40.3 612.17,-40.3 612.17,-15.7 671.49,-15.7 671.49,-40.3"></polygon>
<text text-anchor="middle" x="641.83" y="-23.8" font-family="Times,serif" font-size="14.00">qux.run</text>
</g>
<!-- qux.compile&#45;&gt;qux.run -->
<g id="edge4" class="edge">
<title>qux.compile-&gt;qux.run</title>
<path fill="none" stroke="black" d="M547.33,-28C564.67,-28 584.7,-28 601.76,-28"></path>
<polygon fill="black" stroke="black" points="601.95,-31.5 611.95,-28 601.95,-24.5 601.95,-31.5"></polygon>
</g>
<!-- qux.bundle -->
<g id="node7" class="node">
<title>qux.bundle</title>
<polygon fill="white" stroke="green" stroke-width="3" points="680.94,-83.3 602.73,-83.3 602.73,-58.7 680.94,-58.7 680.94,-83.3"></polygon>
<text text-anchor="middle" x="641.83" y="-66.8" font-family="Times,serif" font-size="14.00">qux.bundle</text>
</g>
<!-- qux.compile&#45;&gt;qux.bundle -->
<g id="edge7" class="edge">
<title>qux.compile-&gt;qux.bundle</title>
<path fill="none" stroke="green" stroke-width="3" d="M544.41,-40.32C559.52,-45.13 577.01,-50.69 592.91,-55.75"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="591.97,-59.13 602.56,-58.82 594.1,-52.46 591.97,-59.13"></polygon>
</g>
<!-- qux.sources -->
<g id="node3" class="node">
<title>qux.sources</title>
<polygon fill="white" stroke="black" points="241.93,-83.3 158.97,-83.3 158.97,-58.7 241.93,-58.7 241.93,-83.3"></polygon>
<text text-anchor="middle" x="200.45" y="-66.8" font-family="Times,serif" font-size="14.00">qux.sources</text>
</g>
<!-- qux.allSources -->
<g id="node4" class="node">
<title>qux.allSources</title>
<polygon fill="white" stroke="black" points="395.46,-83.3 296.83,-83.3 296.83,-58.7 395.46,-58.7 395.46,-83.3"></polygon>
<text text-anchor="middle" x="346.15" y="-66.8" font-family="Times,serif" font-size="14.00">qux.allSources</text>
</g>
<!-- qux.sources&#45;&gt;qux.allSources -->
<g id="edge2" class="edge">
<title>qux.sources-&gt;qux.allSources</title>
<path fill="none" stroke="black" d="M241.86,-71C255.68,-71 271.45,-71 286.42,-71"></path>
<polygon fill="black" stroke="black" points="286.63,-74.5 296.63,-71 286.63,-67.5 286.63,-74.5"></polygon>
</g>
<!-- qux.allSources&#45;&gt;qux.compile -->
<g id="edge3" class="edge">
<title>qux.allSources-&gt;qux.compile</title>
<path fill="none" stroke="black" d="M392,-58.68C410.77,-53.52 432.7,-47.5 452.13,-42.16"></path>
<polygon fill="black" stroke="black" points="453.32,-45.46 462.04,-39.44 451.47,-38.71 453.32,-45.46"></polygon>
</g>
<!-- qux.mainFileName -->
<g id="node6" class="node">
<title>qux.mainFileName</title>
<polygon fill="white" stroke="black" points="566.38,-83.3 442.98,-83.3 442.98,-58.7 566.38,-58.7 566.38,-83.3"></polygon>
<text text-anchor="middle" x="504.68" y="-66.8" font-family="Times,serif" font-size="14.00">qux.mainFileName</text>
</g>
<!-- qux.mainFileName&#45;&gt;qux.run -->
<g id="edge5" class="edge">
<title>qux.mainFileName-&gt;qux.run</title>
<path fill="none" stroke="black" d="M544.41,-58.68C562.57,-52.9 584.16,-46.03 602.3,-40.26"></path>
<polygon fill="black" stroke="black" points="603.51,-43.55 611.98,-37.18 601.39,-36.88 603.51,-43.55"></polygon>
</g>
<!-- qux.mainFileName&#45;&gt;qux.bundle -->
<g id="edge6" class="edge">
<title>qux.mainFileName-&gt;qux.bundle</title>
<path fill="none" stroke="green" stroke-width="3" d="M566.53,-71C575.11,-71 583.82,-71 592.13,-71"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="592.38,-74.5 602.38,-71 592.38,-67.5 592.38,-74.5"></polygon>
</g>
<!-- qux.npmDeps -->
<g id="node8" class="node">
<title>qux.npmDeps</title>
<polygon fill="white" stroke="green" stroke-width="3" points="247.6,-40.3 153.29,-40.3 153.29,-15.7 247.6,-15.7 247.6,-40.3"></polygon>
<text text-anchor="middle" x="200.45" y="-23.8" font-family="Times,serif" font-size="14.00">qux.npmDeps</text>
</g>
<!-- qux.npmDeps&#45;&gt;qux.npmInstall -->
<g id="edge8" class="edge">
<title>qux.npmDeps-&gt;qux.npmInstall</title>
<path fill="none" stroke="green" stroke-width="3" d="M247.7,-28C259.63,-28 272.63,-28 285.14,-28"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="285.5,-31.5 295.5,-28 285.5,-24.5 285.5,-31.5"></polygon>
</g>
<!-- bar.npmInstall -->
<g id="node9" class="node">
<title>bar.npmInstall</title>
<polygon fill="white" stroke="black" points="249.2,-242.3 151.69,-242.3 151.69,-217.7 249.2,-217.7 249.2,-242.3"></polygon>
<text text-anchor="middle" x="200.45" y="-225.8" font-family="Times,serif" font-size="14.00">bar.npmInstall</text>
</g>
<!-- bar.compile -->
<g id="node10" class="node">
<title>bar.compile</title>
<polygon fill="white" stroke="black" points="387.63,-242.3 304.67,-242.3 304.67,-217.7 387.63,-217.7 387.63,-242.3"></polygon>
<text text-anchor="middle" x="346.15" y="-225.8" font-family="Times,serif" font-size="14.00">bar.compile</text>
</g>
<!-- bar.npmInstall&#45;&gt;bar.compile -->
<g id="edge9" class="edge">
<title>bar.npmInstall-&gt;bar.compile</title>
<path fill="none" stroke="black" d="M249.3,-230C263.75,-230 279.67,-230 294.31,-230"></path>
<polygon fill="black" stroke="black" points="294.71,-233.5 304.71,-230 294.71,-226.5 294.71,-233.5"></polygon>
</g>
<!-- bar.compile&#45;&gt;qux.compile -->
<g id="edge25" class="edge">
<title>bar.compile-&gt;qux.compile</title>
<path fill="none" stroke="black" d="M387.67,-225.53C394.83,-223.09 401.64,-219.43 406.83,-214 458.37,-160.04 393.62,-106.1 442.83,-50 445.7,-46.72 449.11,-43.93 452.81,-41.56"></path>
<polygon fill="black" stroke="black" points="454.7,-44.52 461.89,-36.74 451.41,-38.34 454.7,-44.52"></polygon>
</g>
<!-- bar.run -->
<g id="node13" class="node">
<title>bar.run</title>
<polygon fill="white" stroke="black" points="532.71,-242.3 476.64,-242.3 476.64,-217.7 532.71,-217.7 532.71,-242.3"></polygon>
<text text-anchor="middle" x="504.68" y="-225.8" font-family="Times,serif" font-size="14.00">bar.run</text>
</g>
<!-- bar.compile&#45;&gt;bar.run -->
<g id="edge12" class="edge">
<title>bar.compile-&gt;bar.run</title>
<path fill="none" stroke="black" d="M387.46,-230C411.76,-230 442.51,-230 466.27,-230"></path>
<polygon fill="black" stroke="black" points="466.32,-233.5 476.32,-230 466.32,-226.5 466.32,-233.5"></polygon>
</g>
<!-- bar.bundle -->
<g id="node15" class="node">
<title>bar.bundle</title>
<polygon fill="white" stroke="green" stroke-width="3" points="542.66,-285.3 466.7,-285.3 466.7,-260.7 542.66,-260.7 542.66,-285.3"></polygon>
<text text-anchor="middle" x="504.68" y="-268.8" font-family="Times,serif" font-size="14.00">bar.bundle</text>
</g>
<!-- bar.compile&#45;&gt;bar.bundle -->
<g id="edge15" class="edge">
<title>bar.compile-&gt;bar.bundle</title>
<path fill="none" stroke="green" stroke-width="3" d="M387.46,-241.07C408.67,-246.9 434.78,-254.07 456.88,-260.15"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="456.15,-263.57 466.72,-262.85 458.01,-256.82 456.15,-263.57"></polygon>
</g>
<!-- bar.sources -->
<g id="node11" class="node">
<title>bar.sources</title>
<polygon fill="white" stroke="black" points="109.37,-285.3 29.66,-285.3 29.66,-260.7 109.37,-260.7 109.37,-285.3"></polygon>
<text text-anchor="middle" x="69.52" y="-268.8" font-family="Times,serif" font-size="14.00">bar.sources</text>
</g>
<!-- bar.allSources -->
<g id="node12" class="node">
<title>bar.allSources</title>
<polygon fill="white" stroke="black" points="248.13,-285.3 152.76,-285.3 152.76,-260.7 248.13,-260.7 248.13,-285.3"></polygon>
<text text-anchor="middle" x="200.45" y="-268.8" font-family="Times,serif" font-size="14.00">bar.allSources</text>
</g>
<!-- bar.sources&#45;&gt;bar.allSources -->
<g id="edge10" class="edge">
<title>bar.sources-&gt;bar.allSources</title>
<path fill="none" stroke="black" d="M109.2,-273C119.65,-273 131.18,-273 142.41,-273"></path>
<polygon fill="black" stroke="black" points="142.59,-276.5 152.59,-273 142.59,-269.5 142.59,-276.5"></polygon>
</g>
<!-- bar.allSources&#45;&gt;bar.compile -->
<g id="edge11" class="edge">
<title>bar.allSources-&gt;bar.compile</title>
<path fill="none" stroke="black" d="M242.62,-260.68C258.85,-255.82 277.64,-250.2 294.67,-245.1"></path>
<polygon fill="black" stroke="black" points="295.88,-248.4 304.46,-242.18 293.88,-241.69 295.88,-248.4"></polygon>
</g>
<!-- bar.mainFileName -->
<g id="node14" class="node">
<title>bar.mainFileName</title>
<polygon fill="white" stroke="black" points="406.22,-285.3 286.07,-285.3 286.07,-260.7 406.22,-260.7 406.22,-285.3"></polygon>
<text text-anchor="middle" x="346.15" y="-268.8" font-family="Times,serif" font-size="14.00">bar.mainFileName</text>
</g>
<!-- bar.mainFileName&#45;&gt;bar.run -->
<g id="edge13" class="edge">
<title>bar.mainFileName-&gt;bar.run</title>
<path fill="none" stroke="black" d="M392,-260.68C415.66,-254.18 444.34,-246.3 466.71,-240.16"></path>
<polygon fill="black" stroke="black" points="467.78,-243.49 476.5,-237.47 465.93,-236.74 467.78,-243.49"></polygon>
</g>
<!-- bar.mainFileName&#45;&gt;bar.bundle -->
<g id="edge14" class="edge">
<title>bar.mainFileName-&gt;bar.bundle</title>
<path fill="none" stroke="green" stroke-width="3" d="M406.33,-273C422.94,-273 440.79,-273 456.6,-273"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="456.66,-276.5 466.66,-273 456.66,-269.5 456.66,-276.5"></polygon>
</g>
<!-- bar.npmDeps -->
<g id="node16" class="node">
<title>bar.npmDeps</title>
<polygon fill="white" stroke="green" stroke-width="3" points="115.05,-242.3 23.98,-242.3 23.98,-217.7 115.05,-217.7 115.05,-242.3"></polygon>
<text text-anchor="middle" x="69.52" y="-225.8" font-family="Times,serif" font-size="14.00">bar.npmDeps</text>
</g>
<!-- bar.npmDeps&#45;&gt;qux.npmDeps -->
<g id="edge28" class="edge">
<title>bar.npmDeps-&gt;qux.npmDeps</title>
<path fill="none" stroke="green" stroke-width="3" d="M111.91,-217.49C113.17,-216.42 114.35,-215.26 115.42,-214 163.42,-157.55 98.63,-107.5 145.37,-50 146.35,-48.8 147.4,-47.66 148.52,-46.58"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="150.88,-49.18 156.7,-40.33 146.63,-43.62 150.88,-49.18"></polygon>
</g>
<!-- bar.npmDeps&#45;&gt;bar.npmInstall -->
<g id="edge16" class="edge">
<title>bar.npmDeps-&gt;bar.npmInstall</title>
<path fill="none" stroke="green" stroke-width="3" d="M115.25,-230C123.72,-230 132.69,-230 141.49,-230"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="141.72,-233.5 151.72,-230 141.72,-226.5 141.72,-233.5"></polygon>
</g>
<!-- foo.npmInstall -->
<g id="node17" class="node">
<title>foo.npmInstall</title>
<polygon fill="white" stroke="black" points="249.49,-156.3 151.4,-156.3 151.4,-131.7 249.49,-131.7 249.49,-156.3"></polygon>
<text text-anchor="middle" x="200.45" y="-139.8" font-family="Times,serif" font-size="14.00">foo.npmInstall</text>
</g>
<!-- foo.compile -->
<g id="node18" class="node">
<title>foo.compile</title>
<polygon fill="white" stroke="black" points="387.91,-156.3 304.39,-156.3 304.39,-131.7 387.91,-131.7 387.91,-156.3"></polygon>
<text text-anchor="middle" x="346.15" y="-139.8" font-family="Times,serif" font-size="14.00">foo.compile</text>
</g>
<!-- foo.npmInstall&#45;&gt;foo.compile -->
<g id="edge17" class="edge">
<title>foo.npmInstall-&gt;foo.compile</title>
<path fill="none" stroke="black" d="M249.7,-144C264,-144 279.71,-144 294.18,-144"></path>
<polygon fill="black" stroke="black" points="294.46,-147.5 304.46,-144 294.46,-140.5 294.46,-147.5"></polygon>
</g>
<!-- foo.compile&#45;&gt;qux.compile -->
<g id="edge26" class="edge">
<title>foo.compile-&gt;qux.compile</title>
<path fill="none" stroke="black" d="M387.97,-132.17C394.78,-128.96 401.38,-124.96 406.83,-120 432.69,-96.43 416.56,-73.1 442.83,-50 445.83,-47.36 449.17,-45.03 452.69,-42.98"></path>
<polygon fill="black" stroke="black" points="454.4,-46.04 461.76,-38.41 451.26,-39.78 454.4,-46.04"></polygon>
</g>
<!-- foo.run -->
<g id="node21" class="node">
<title>foo.run</title>
<polygon fill="white" stroke="black" points="533,-156.3 476.36,-156.3 476.36,-131.7 533,-131.7 533,-156.3"></polygon>
<text text-anchor="middle" x="504.68" y="-139.8" font-family="Times,serif" font-size="14.00">foo.run</text>
</g>
<!-- foo.compile&#45;&gt;foo.run -->
<g id="edge20" class="edge">
<title>foo.compile-&gt;foo.run</title>
<path fill="none" stroke="black" d="M387.87,-144C411.9,-144 442.13,-144 465.68,-144"></path>
<polygon fill="black" stroke="black" points="465.98,-147.5 475.98,-144 465.98,-140.5 465.98,-147.5"></polygon>
</g>
<!-- foo.bundle -->
<g id="node23" class="node">
<title>foo.bundle</title>
<polygon fill="white" stroke="green" stroke-width="3" points="542.94,-199.3 466.41,-199.3 466.41,-174.7 542.94,-174.7 542.94,-199.3"></polygon>
<text text-anchor="middle" x="504.68" y="-182.8" font-family="Times,serif" font-size="14.00">foo.bundle</text>
</g>
<!-- foo.compile&#45;&gt;foo.bundle -->
<g id="edge23" class="edge">
<title>foo.compile-&gt;foo.bundle</title>
<path fill="none" stroke="green" stroke-width="3" d="M387.87,-155.19C408.92,-160.97 434.72,-168.06 456.62,-174.07"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="455.81,-177.48 466.38,-176.75 457.67,-170.73 455.81,-177.48"></polygon>
</g>
<!-- foo.sources -->
<g id="node19" class="node">
<title>foo.sources</title>
<polygon fill="white" stroke="black" points="109.66,-199.3 29.38,-199.3 29.38,-174.7 109.66,-174.7 109.66,-199.3"></polygon>
<text text-anchor="middle" x="69.52" y="-182.8" font-family="Times,serif" font-size="14.00">foo.sources</text>
</g>
<!-- foo.allSources -->
<g id="node20" class="node">
<title>foo.allSources</title>
<polygon fill="white" stroke="black" points="248.92,-199.3 151.97,-199.3 151.97,-174.7 248.92,-174.7 248.92,-199.3"></polygon>
<text text-anchor="middle" x="200.45" y="-182.8" font-family="Times,serif" font-size="14.00">foo.allSources</text>
</g>
<!-- foo.sources&#45;&gt;foo.allSources -->
<g id="edge18" class="edge">
<title>foo.sources-&gt;foo.allSources</title>
<path fill="none" stroke="black" d="M109.9,-187C120,-187 131.08,-187 141.89,-187"></path>
<polygon fill="black" stroke="black" points="142.13,-190.5 152.13,-187 142.13,-183.5 142.13,-190.5"></polygon>
</g>
<!-- foo.allSources&#45;&gt;foo.compile -->
<g id="edge19" class="edge">
<title>foo.allSources-&gt;foo.compile</title>
<path fill="none" stroke="black" d="M242.62,-174.68C258.85,-169.82 277.64,-164.2 294.67,-159.1"></path>
<polygon fill="black" stroke="black" points="295.88,-162.4 304.46,-156.18 293.88,-155.69 295.88,-162.4"></polygon>
</g>
<!-- foo.mainFileName -->
<g id="node22" class="node">
<title>foo.mainFileName</title>
<polygon fill="white" stroke="black" points="407.01,-199.3 285.29,-199.3 285.29,-174.7 407.01,-174.7 407.01,-199.3"></polygon>
<text text-anchor="middle" x="346.15" y="-182.8" font-family="Times,serif" font-size="14.00">foo.mainFileName</text>
</g>
<!-- foo.mainFileName&#45;&gt;foo.run -->
<g id="edge21" class="edge">
<title>foo.mainFileName-&gt;foo.run</title>
<path fill="none" stroke="black" d="M392,-174.68C415.51,-168.22 443.96,-160.41 466.26,-154.28"></path>
<polygon fill="black" stroke="black" points="467.32,-157.62 476.03,-151.59 465.46,-150.87 467.32,-157.62"></polygon>
</g>
<!-- foo.mainFileName&#45;&gt;foo.bundle -->
<g id="edge22" class="edge">
<title>foo.mainFileName-&gt;foo.bundle</title>
<path fill="none" stroke="green" stroke-width="3" d="M407.22,-187C423.33,-187 440.53,-187 455.88,-187"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="456.17,-190.5 466.17,-187 456.17,-183.5 456.17,-190.5"></polygon>
</g>
<!-- foo.npmDeps -->
<g id="node24" class="node">
<title>foo.npmDeps</title>
<polygon fill="white" stroke="green" stroke-width="3" points="115.33,-156.3 23.7,-156.3 23.7,-131.7 115.33,-131.7 115.33,-156.3"></polygon>
<text text-anchor="middle" x="69.52" y="-139.8" font-family="Times,serif" font-size="14.00">foo.npmDeps</text>
</g>
<!-- foo.npmDeps&#45;&gt;qux.npmDeps -->
<g id="edge27" class="edge">
<title>foo.npmDeps-&gt;qux.npmDeps</title>
<path fill="none" stroke="green" stroke-width="3" d="M77.46,-131.65C89.14,-111.91 114.47,-73.12 145.37,-50 147.69,-48.26 150.16,-46.64 152.73,-45.13"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="154.51,-48.15 161.73,-40.4 151.25,-41.95 154.51,-48.15"></polygon>
</g>
<!-- foo.npmDeps&#45;&gt;foo.npmInstall -->
<g id="edge24" class="edge">
<title>foo.npmDeps-&gt;foo.npmInstall</title>
<path fill="none" stroke="green" stroke-width="3" d="M115.61,-144C123.77,-144 132.38,-144 140.86,-144"></path>
<polygon fill="green" stroke="green" stroke-width="3" points="141.09,-147.5 151.09,-144 141.09,-140.5 141.09,-147.5"></polygon>
</g>
</g>
</svg>

</center>
</div>
<div class="paragraph">
<p>As mentioned earlier, the <code>TypeScriptModule</code> examples on this page are meant for
demo purposes: to show what it looks like to add support in Mill for a new
programming language toolchain. It would take significantly more work to flesh out
the feature set and performance of <code>TypeScriptModule</code> to be usable in a real world
build. But this should be enough to get you started working with Mill to add support
to any language you need: whether it’s TypeScript or some other language, most programming
language toolchains have similar concepts of <code>compile</code>, <code>run</code>, <code>bundle</code>, etc.</p>
</div>
<div class="paragraph">
<p>As mentioned, The <code>PythonModule</code> examples here demonstrate
how to add support for a new language toolchain in Mill.
A production-ready version would require more work to enhance features and performance.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="meta-build.html">The Mill Meta-Build</a></span>
  <span class="next"><a href="example-python-support.html">Example: Python Support</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async="async" src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async="async" src="../../../search-index.js"></script>
  
</body></html>