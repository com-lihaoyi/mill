<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Java Module Configuration :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/0.11.12/Java_Module_Config.html" />
    <link rel="prev" href="Java_Builtin_Commands.html" />
    <link rel="next" href="Java_Build_Examples.html" />
    <meta name="generator" content="Antora 3.1.9" />
    <link rel="stylesheet" href="../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../_/favicon.png" type="image/x-icon" />
  
  </head><body class="article">
  
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../_/logo-white.svg" height="20" /> The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">Source Code (GitHub)</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>
        <a class="navbar-item" href="https://gitter.im/lihaoyi/mill">Chat</a>

            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Java_Intro_to_Mill.html">Introduction to Mill for Java</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="Java_Module_Config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Build_Examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Testing_Java_Projects.html">Testing Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Web_Examples.html">Java Web Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Case_Study_Mill_vs_Maven.html">Case Study: Mill vs Maven</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Case_Study_Mill_vs_Gradle.html">Case Study: Mill vs Gradle</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Scala_Intro_to_Mill.html">Introduction to Mill for Scala</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Module_Config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Build_Examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Testing_Scala_Projects.html">Testing Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Web_Examples.html">Scala Web Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Case_Study_Mill_vs_SBT.html">Case Study: Mill vs SBT</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Library_Dependencies.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Out_Dir.html">The Output Directory</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Target_Query_Syntax.html">Target Query Syntax</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Structuring_Large_Builds.html">Structuring Large Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="The_Mill_Evaluation_Model.html">The Mill Evaluation Model</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extending Mill</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Import_File_And_Import_Ivy.html">import $file and import $ivy</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Using_Plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Writing_Mill_Plugins.html">Writing Mill Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="The_Mill_Meta_Build.html">The Mill Meta-Build</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Mill_Design_Principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Bundled_Libraries.html">Bundled Libraries</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.12.0-M0-84-6e35f6</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="0.11.12/index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">0.12.0-M0-84-6e35f6</a>
        </li>
        <li class="version is-latest">
          <a href="0.11.12/index.html">0.11.12</a>
        </li>
        <li class="version">
          <a href="0.11.11/index.html">0.11.11</a>
        </li>
        <li class="version">
          <a href="0.11.10/index.html">0.11.10</a>
        </li>
        <li class="version">
          <a href="0.11.0-M7/index.html">0.11.0-M7</a>
        </li>
        <li class="version">
          <a href="0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="0.10.12/index.html">0.10.12</a>
        </li>
        <li class="version">
          <a href="0.10.0/index.html">0.10.0</a>
        </li>
        <li class="version">
          <a href="0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="0.11.12/Java_Intro_to_Mill.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Mill Documentation</a></li>
    <li><a href="Java_Intro_to_Mill.html">Introduction to Mill for Java</a></li>
    <li><a href="Java_Module_Config.html">Java Module Configuration</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.12.0-M0-84-6e35f6</button>
  <div class="version-menu">
    <a class="version is-current" href="Java_Module_Config.html">0.12.0-M0-84-6e35f6</a>
    <a class="version" href="0.11.12/Java_Module_Config.html">0.11.12</a>
    <a class="version" href="0.11.11/Java_Module_Config.html">0.11.11</a>
    <a class="version" href="0.11.10/Java_Module_Config.html">0.11.10</a>
    <a class="version is-missing" href="0.11.0-M7/index.html">0.11.0-M7</a>
    <a class="version is-missing" href="0.10.15/index.html">0.10.15</a>
    <a class="version is-missing" href="0.10.12/index.html">0.10.12</a>
    <a class="version is-missing" href="0.10.0/index.html">0.10.0</a>
    <a class="version is-missing" href="0.9.12/index.html">0.9.12</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/docs/modules/ROOT/pages/Java_Module_Config.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Java Module Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<script>
gtag('config', 'AW-16649289906');
</script>
<div class="paragraph">
<p>This page goes into more detail about the various configuration options
for <code>JavaModule</code>.</p>
</div>
<div class="paragraph">
<p>Many of the APIs covered here are listed in the API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/JavaModule.html">mill.javaalib.JavaModule</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compilation_execution_flags"><a class="anchor" href="#_compilation_execution_flags"></a>Compilation &amp; Execution Flags</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-1-compilation-execution-flags.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/1-compilation-execution-flags">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object `package` extends RootModule with JavaModule{
  def forkArgs = Seq(&quot;-Xmx4g&quot;, &quot;-Dmy.jvm.property=hello&quot;)
  def forkEnv = Map(&quot;MY_ENV_VAR&quot; -&gt; &quot;WORLD&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_ivy_dependencies"><a class="anchor" href="#_adding_ivy_dependencies"></a>Adding Ivy Dependencies</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-2-ivy-deps.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/2-ivy-deps">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object `package` extends RootModule with JavaModule {
  def ivyDeps = Agg(
    ivy&quot;com.fasterxml.jackson.core:jackson-databind:2.13.4&quot;,
  )
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill run i am cow
JSONified using Jackson: [&quot;i&quot;,&quot;am&quot;,&quot;cow&quot;]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_runtime_and_compile_time_dependencies"><a class="anchor" href="#_runtime_and_compile_time_dependencies"></a>Runtime and Compile-time Dependencies</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-3-run-compile-deps.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/3-run-compile-deps">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object foo extends JavaModule {
  def moduleDeps = Seq(bar)
  def runIvyDeps = Agg(
    ivy&quot;javax.servlet:servlet-api:2.5&quot;,
    ivy&quot;org.eclipse.jetty:jetty-server:9.4.42.v20210604&quot;,
    ivy&quot;org.eclipse.jetty:jetty-servlet:9.4.42.v20210604&quot;
  )
  def mainClass = Some(&quot;bar.Bar&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object bar extends JavaModule {
  def compileIvyDeps = Agg(
    ivy&quot;javax.servlet:servlet-api:2.5&quot;,
    ivy&quot;org.eclipse.jetty:jetty-server:9.4.42.v20210604&quot;,
    ivy&quot;org.eclipse.jetty:jetty-servlet:9.4.42.v20210604&quot;
  )
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_classpath_and_filesystem_resources"><a class="anchor" href="#_classpath_and_filesystem_resources"></a>Classpath and Filesystem Resources</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-5-resources.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/5-resources">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object foo extends JavaModule {
  object test extends JavaTests with TestModule.Junit4 {
    def otherFiles = T.source(millSourcePath / &quot;other-files&quot;)

    def forkEnv = super.forkEnv() ++ Map(
      &quot;OTHER_FILES_FOLDER&quot; -&gt; otherFiles().path.toString
    )
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">foo/src/Foo.java (<a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/5-resources/foo/src/Foo.java">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package foo;

import java.io.IOException;
import java.io.InputStream;

public class Foo {

  // Read `file.txt` from classpath
  public static String classpathResourceText() throws IOException {
    // Get the resource as an InputStream
    try (InputStream inputStream = Foo.class.getClassLoader().getResourceAsStream(&quot;file.txt&quot;)) {
      return new String(inputStream.readAllBytes());
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">foo/test/src/FooTests.java (<a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/5-resources/foo/test/src/FooTests.java">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package foo;

import org.junit.Test;
import static org.junit.Assert.*;

import java.io.InputStream;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.nio.file.Path;
import java.util.List;
import java.util.ArrayList;

public class FooTests {

  @Test
  public void simple() throws IOException {
    // Reference app module's `Foo` class which reads `file.txt` from classpath
    String appClasspathResourceText = Foo.classpathResourceText();
    assertEquals(&quot;Hello World Resource File&quot;, appClasspathResourceText);

    // Read `test-file-a.txt` from classpath
    String testClasspathResourceText;
    try (InputStream inputStream = Foo.class.getClassLoader().getResourceAsStream(&quot;test-file-a.txt&quot;)) {
      testClasspathResourceText = new String(inputStream.readAllBytes());
    }
    assertEquals(&quot;Test Hello World Resource File A&quot;, testClasspathResourceText);

    // Use `MILL_TEST_RESOURCE_FOLDER` to read `test-file-b.txt` from filesystem
    Path testFileResourceDir = Paths.get(System.getenv(&quot;MILL_TEST_RESOURCE_FOLDER&quot;));
    String testFileResourceText = new String(
            Files.readAllBytes(testFileResourceDir.resolve(&quot;test-file-b.txt&quot;))
    );
    assertEquals(&quot;Test Hello World Resource File B&quot;, testFileResourceText);

    // Use `MILL_TEST_RESOURCE_FOLDER` to list files available in resource folder
    List&lt;Path&gt; actualFiles = new ArrayList&lt;&gt;(Files.list(testFileResourceDir).toList());
    actualFiles.sort(Path::compareTo);
    List&lt;Path&gt; expectedFiles = List.of(
            testFileResourceDir.resolve(&quot;test-file-a.txt&quot;),
            testFileResourceDir.resolve(&quot;test-file-b.txt&quot;)
    );
    assertEquals(expectedFiles, actualFiles);

    // Use the `OTHER_FILES_FOLDER` configured in your build to access the
    // files in `foo/test/other-files/`.
    String otherFileText = new String(
            Files.readAllBytes(Paths.get(System.getenv(&quot;OTHER_FILES_FOLDER&quot;), &quot;other-file.txt&quot;))
    );
    assertEquals(&quot;Other Hello World File&quot;, otherFileText);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annotation_processors"><a class="anchor" href="#_annotation_processors"></a>Annotation Processors</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-6-annotation-processors.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/6-annotation-processors">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._
import java.io.File

object foo extends JavaModule {
  def compileIvyDeps = Agg(ivy&quot;org.projectlombok:lombok:1.18.34&quot;)

  object test extends JavaTests with TestModule.Junit4
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example of how to use Mill to build Java projects using Java annotations and
annotation processors. In this case, we use the annotations provided by
<a href="https://projectlombok.org">Project Lombok</a> to automatically generate getters and setters
from class private fields</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill foo.test
Test foo.HelloWorldTest.testSimple started
Test foo.HelloWorldTest.testSimple finished...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java compiler automatically discovers annotation processors based on the
classes available during compilation, e.g. on <code>compileIvyDeps</code> or <code>ivyDeps</code>,
which is what takes place in the example above.</p>
</div>
<div class="paragraph">
<p>In some cases, you may need
to pass in the annotation processors manually, e.g. if you need annotation
processors that are not on the compilation classpath, or you need finer control
over exactly which annotation processors are active. To do this, you can define
a module to contain the exact annotation processors you want, and pass
in <code>-processorpath</code> to <code>javacOptions</code> explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object bar extends JavaModule {
  def compileIvyDeps = Agg(ivy&quot;org.projectlombok:lombok:1.18.34&quot;)

  def processors = T{
    defaultResolver().resolveDeps(Agg(ivy&quot;org.projectlombok:lombok:1.18.34&quot;))
  }

  def javacOptions = Seq(
    &quot;-processorpath&quot;,
    processors().map(_.path).mkString(File.pathSeparator),
  )

  object test extends JavaTests with TestModule.Junit4
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill bar.test
Test bar.HelloWorldTest.testSimple started
Test bar.HelloWorldTest.testSimple finished...
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javadoc_config"><a class="anchor" href="#_javadoc_config"></a>Javadoc Config</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-7-docjar.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/7-docjar">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object foo extends JavaModule {
  def javadocOptions = Seq(&quot;-quiet&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unmanaged_jars"><a class="anchor" href="#_unmanaged_jars"></a>Unmanaged Jars</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-8-unmanaged-jars.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/8-unmanaged-jars">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object `package` extends RootModule with JavaModule {
  def unmanagedClasspath = T {
    if (!os.exists(millSourcePath / &quot;lib&quot;)) Agg()
    else Agg.from(os.list(millSourcePath / &quot;lib&quot;).map(PathRef(_)))
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifying_the_main_class"><a class="anchor" href="#_specifying_the_main_class"></a>Specifying the Main Class</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-9-main-class.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/9-main-class">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object `package` extends RootModule with JavaModule {
  def mainClass = Some(&quot;foo.Qux&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_downloading_non_maven_jars"><a class="anchor" href="#_downloading_non_maven_jars"></a>Downloading Non-Maven Jars</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-10-downloading-non-maven-jars.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/10-downloading-non-maven-jars">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object `package` extends RootModule with JavaModule {
  def unmanagedClasspath = T {
    os.write(
      T.dest / &quot;fastjavaio.jar&quot;,
      requests.get.stream(
        &quot;https://github.com/williamfiset/FastJavaIO/releases/download/1.1/fastjavaio.jar&quot;
      )
    )
    Agg(PathRef(T.dest / &quot;fastjavaio.jar&quot;))
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_assembly"><a class="anchor" href="#_customizing_the_assembly"></a>Customizing the Assembly</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-11-assembly-config.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/11-assembly-config">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._
import mill.javalib.Assembly._

object foo extends JavaModule {
  def moduleDeps = Seq(bar)
  def assemblyRules = Seq(
    // all application.conf files will be concatenated into single file
    Rule.Append(&quot;application.conf&quot;),
    // all *.conf files will be concatenated into single file
    Rule.AppendPattern(&quot;.*\\.conf&quot;),
    // all *.temp files will be excluded from a final jar
    Rule.ExcludePattern(&quot;.*\\.temp&quot;),
    // the `shapeless` package will be shaded under the `shade` package
    Rule.Relocate(&quot;shapeless.**&quot;, &quot;shade.shapless.@1&quot;)
  )
}

object bar extends JavaModule {
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repository_config"><a class="anchor" href="#_repository_config"></a>Repository Config</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-12-repository-config.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/12-repository-config">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._
import mill.define.ModuleRef
import coursier.maven.MavenRepository

val sonatypeReleases = Seq(
  MavenRepository(&quot;https://oss.sonatype.org/content/repositories/releases&quot;)
)

object foo extends JavaModule {

  def ivyDeps = Agg(
    ivy&quot;net.sourceforge.argparse4j:argparse4j:0.9.0&quot;,
    ivy&quot;org.apache.commons:commons-text:1.12.0&quot;
  )

  def repositoriesTask = T.task { super.repositoriesTask() ++ sonatypeReleases }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object CustomZincWorkerModule extends ZincWorkerModule with CoursierModule {
  def repositoriesTask = T.task { super.repositoriesTask() ++ sonatypeReleases }
}

object bar extends JavaModule {
  def zincWorker = ModuleRef(CustomZincWorkerModule)
  // ... rest of your build definitions

  def repositoriesTask = T.task { super.repositoriesTask() ++ sonatypeReleases }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_maven_central_blocked"><a class="anchor" href="#_maven_central_blocked"></a>Maven Central: Blocked!</h3>
<div class="paragraph">
<p>Under some circumstances (e.g. corporate firewalls), you may not have access maven central. The typical symptom will be error messages which look like this;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 targets failed
mill.scalalib.ZincWorkerModule.classpath
Resolution failed for 1 modules:
--------------------------------------------
  com.lihaoyi:mill-scalalib-worker_2.13:0.11.1
        not found: C:\Users\partens\.ivy2\local\com.lihaoyi\mill-scalalib-worker_2.13\0.11.1\ivys\ivy.xml
        download error: Caught java.io.IOException (Server returned HTTP response code: 503 for URL: https://repo1.maven.org/maven2/com/lihaoyi/mill-scalalib-worker_2.13/0.11.1/mill-scalalib-worker_2.13-0.11.1.pom) while downloading https://repo1.maven.org/maven2/com/lihaoyi/mill-scalalib-worker_2.13/0.11.1/mill-scalalib-worker_2.13-0.11.1.pom</pre>
</div>
</div>
<div class="paragraph">
<p>It is expected that basic commands (e.g. clean) will not work, as Mill saying it is unable to resolve it’s own, fundamental, dependencies. Under such circumstances, you will normally have access to some proxy, or other corporate repository which resolves maven artefacts. The strategy is simply to tell mill to use that instead.</p>
</div>
<div class="paragraph">
<p>The idea is to set an environment variable COURSIER_REPOSITORIES (see coursier docs). The below command should set the environment variable for the current shell, and then run the mill command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> COURSIER_REPOSITORIES=https://packages.corp.com/artifactory/maven/ mill resolve _</pre>
</div>
</div>
<div class="paragraph">
<p>If you are using millw, a more permanent solution could be to set the environment variable at the top of the millw script, or as a user environment variable etc.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_native_c_code_with_jni"><a class="anchor" href="#_native_c_code_with_jni"></a>Native C Code with JNI</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-module-13-jni.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/module/13-jni">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._, util.Jvm

object `package` extends RootModule with JavaModule {
  // Additional source folder to put C sources
  def nativeSources = T.sources(millSourcePath / &quot;native-src&quot;)

  // Auto-generate JNI `.h` files from Java classes using Javac
  def nativeHeaders = T {
    os.proc(Jvm.jdkTool(&quot;javac&quot;), &quot;-h&quot;, T.dest, &quot;-d&quot;, T.dest.toString, allSourceFiles().map(_.path)).call()
    PathRef(T.dest)
  }

  // Compile C
  def nativeCompiled = T{
    val cSourceFiles = nativeSources().map(_.path).flatMap(os.walk(_)).filter(_.ext == &quot;c&quot;)
    val output = &quot;libhelloworld.so&quot;
    os.proc(
        &quot;clang&quot;, &quot;-shared&quot;, &quot;-fPIC&quot;,
        &quot;-I&quot; + nativeHeaders().path, //
        &quot;-I&quot; + sys.props(&quot;java.home&quot;) + &quot;/include/&quot;, // global JVM header files
        &quot;-I&quot; + sys.props(&quot;java.home&quot;) + &quot;/include/darwin&quot;,
        &quot;-I&quot; + sys.props(&quot;java.home&quot;) + &quot;/include/linux&quot;,
        &quot;-o&quot;, T.dest / output,
        cSourceFiles
      )
      .call(stdout = os.Inherit)

    PathRef(T.dest / output)
  }

  def forkEnv = Map(&quot;HELLO_WORLD_BINARY&quot; -&gt; nativeCompiled().path.toString)

  object test extends JavaTests with TestModule.Junit4{
    def forkEnv = Map(&quot;HELLO_WORLD_BINARY&quot; -&gt; nativeCompiled().path.toString)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example of how use Mill to compile C code together with your Java
code using JNI. There are three main steps: defining the C source folder,
generating the header files using <code>javac</code>, and then compiling the C code
using <code>clang</code>. After that we have the <code>libhelloworld.so</code> on disk ready to use,
and in this example we use an environment variable to pass the path of that
file to the application code to load it using <code>System.load</code>.</p>
</div>
<div class="paragraph">
<p>The above builds expect the following project layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>build.mill
src/
    foo/
        HelloWorld.java

native-src/
    HelloWorld.c

test/
    src/
        foo/
            HelloWorldTest.java</pre>
</div>
</div>
<div class="paragraph">
<p>This example is pretty minimal, but it demonstrates the core principles, and
can be extended if necessary to more elaborate use cases. The <code>native*</code> tasks
can also be extracted out into a <code>trait</code> for re-use if you have multiple
`JavaModule`s that need native C components</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill run
Hello, World!

&gt; ./mill test
Test foo.HelloWorldTest.testSimple started
Test foo.HelloWorldTest.testSimple finished...
...</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="Java_Builtin_Commands.html">Built-in Commands</a></span>
  <span class="next"><a href="Java_Build_Examples.html">Java Build Examples</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async="async" src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async="async" src="../search-index.js"></script>
  
</body></html>