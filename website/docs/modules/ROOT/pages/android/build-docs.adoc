= Android Build File

This is an example of a build file for an Android application using Mill. It demonstrates how to set up an Android project, configure the SDK, and define tasks for building and testing the application.

[source,scala]
----
package build

import mill._, javalib._
import mill.javalib.android.{AndroidAppModule, AndroidSdkModule}
import mill.javalib.android.AndroidTestModule

// Create and configure an Android SDK module to manage Android SDK paths and tools. <3>
object androidSdkModule0 extends AndroidSdkModule {
  def buildToolsVersion = "35.0.0"
}

// Actual android application <4>
object app extends AndroidAppModule {
  def androidSdkModule = mill.define.ModuleRef(androidSdkModule0)
  def androidMinSdk = 19
  def androidCompileSdk = 35

  /**
   * Configuration for ReleaseKey
   * WARNING: Replace these default values with secure and private credentials before using in production.
   * Never use these defaults in a production environment as they are not secure.
   * This is just for testing purposes.
   */
  def androidReleaseKeyName: T[Option[String]] = Task { Some("releaseKey.jks") } // <5>
  def androidReleaseKeyAlias: T[Option[String]] = Task { Some("releaseKey") }
  def androidReleaseKeyPass: T[Option[String]] = Task { Some("MillBuildTool") }
  def androidReleaseKeyStorePass: T[Option[String]] = Task { Some("MillBuildTool") }

  override def androidVirtualDeviceIdentifier: String = "java-test"

  // Unit tests for the application <6>
  object test extends AndroidAppTests with TestModule.Junit4 {
    def ivyDeps = super.ivyDeps() ++ Seq(
      ivy"junit:junit:4.13.2"
    )
  }

  // Instrumented tests (runs on device/emulator) <7>
  object it extends AndroidAppInstrumentedTests with AndroidTestModule.AndroidJUnit {
    def androidSdkModule = mill.define.ModuleRef(androidSdkModule0)
    override def instrumentationPackage = "com.helloworld.app"

    /* TODO currently the dependency resolution ignores the platform type and kotlinx-coroutines-core has
     * conflicting classes with kotlinx-coroutines-core-jvm . Remove the exclusions once the dependency
     * resolution resolves conflicts between androidJvm and jvm platform types
     */
    def ivyDeps = super.ivyDeps() ++ Seq(
      ivy"androidx.test.ext:junit:1.2.1".exclude(
        ("org.jetbrains.kotlinx", "kotlinx-coroutines-core-jvm")
      ),
      ivy"androidx.test:runner:1.6.2",
      ivy"androidx.test.espresso:espresso-core:3.5.1".exclude(
        ("org.jetbrains.kotlinx", "kotlinx-coroutines-core-jvm")
      ),
      ivy"junit:junit:4.13.2"
    )
  }

}
----
<1> High-level summary of the build file, describing how it sets up an Android project in Mill.
<2> Explanation of how `AndroidAppModule` automatically provides tasks for building an Android app (resource generation, APK building, signing, etc.).
<3> The `androidSdkModule0` object extends `AndroidSdkModule`, controlling SDK versioning and tool paths.
<4> The `app` object defines the main Android application module by extending `AndroidAppModule`.
<5> **Release key configuration**. These lines demonstrate how to declare release key credentials (FOR DEMO ONLY - DO NOT use in production).
<6> The `test` object includes local JUnit-based unit tests.
<7> The `it` object includes instrumented tests, which run on an emulator