package build

import mill._
import mill.javalib._
import mill.javalib.publish._

object `package` extends RootModule with PublishModule with MavenModule {

  def artifactName = "single-module-project"

  def javacOptions = super.javacOptions() ++
    Seq("-source", "1.6", "-target", "1.6")

  def repositoriesTask = Task.Anon {
    super.repositoriesTask() ++ Seq(
      coursier.maven.MavenRepository(
        "http://repository.jboss.org/nexus/content/groups/public/"
      ),
      coursier.maven
        .MavenRepository("https://maven.java.net/content/repositories/public/")
    )
  }

  def ivyDeps = super.ivyDeps() ++
    Seq(ivy"javax.servlet.jsp:jsp-api:2.2", ivy"javax.servlet:servlet-api:2.5")

  def pomSettings = PomSettings(
    "Sample single module Maven project with a working, deployable site.",
    "com.example.maven-samples",
    "http://www.example.com",
    Seq(),
    VersionControl(
      Some("http://github.com/gabrielf/maven-samples"),
      Some("scm:git:git@github.com:gabrielf/maven-samples.git"),
      Some("scm:git:git@github.com:gabrielf/maven-samples.git"),
      Some("HEAD")
    ),
    Seq()
  )

  def publishVersion = "1.0-SNAPSHOT"

  def resources = Task
    .Sources { super.resources() ++ Seq(PathRef(moduleDir / "resources")) }

  object test extends MavenTests with TestModule.Junit4 {

    def ivyDeps = super.ivyDeps() ++ Seq(
      ivy"junit:junit-dep:4.10",
      ivy"org.hamcrest:hamcrest-core:1.2.1",
      ivy"org.hamcrest:hamcrest-library:1.2.1",
      ivy"org.mockito:mockito-core:1.8.5"
    )

    def resources = Task.Sources {
      super.resources() ++ Seq(
        PathRef(moduleDir / "test/resources"),
        PathRef(moduleDir / "src/test/secrets")
      )
    }
  }
}
